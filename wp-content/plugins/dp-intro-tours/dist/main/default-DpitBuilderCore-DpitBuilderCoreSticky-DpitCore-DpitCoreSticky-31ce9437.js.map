{"version":3,"sources":["webpack:///./includes/assets/js/modules/DpitColor.js","webpack:///./includes/assets/js/modules/dpitHidden.js","webpack:///./includes/assets/js/modules/DpitColorAnalyze.js","webpack:///./includes/assets/js/modules/BulletsAnimation.js","webpack:///./public/assets/js/modules/core/EventListeners.js","webpack:///./public/assets/js/modules/core/ExclusiveClickListener.js","webpack:///./node_modules/@babel/runtime/helpers/esm/slicedToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack:///./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","webpack:///./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack:///./public/assets/js/modules/core/DpitTarget.js","webpack:///./public/assets/js/modules/core/DpitStickyEvents.js","webpack:///./public/assets/js/modules/core/DpitTargetParent.js","webpack:///./public/assets/js/modules/core/DpitCore.js","webpack:///./public/assets/js/modules/core/dpitGoldenRatioPosAlg.js","webpack:///./public/assets/js/modules/core/DpitTargetBranch.js","webpack:///./public/assets/js/modules/core/DpitUserInteraction.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js"],"names":["DpitColor","constructor","src","this","rgbObj","r","g","b","startsWith","hexStringToRgbObj","rgbStringToRgbObj","Error","colorDefinition","toRgbStringCommaSeparated","rgbString","match","parseInt","hex","replace","m","result","exec","contrast","color2","lum1","luminosity","lum2","lum","Object","keys","forEach","key","chan","Math","pow","red","green","blue","isDark","isLight","mix","colorToMixIn","weight","color1","w1","undefined","w2","fromRgb","max","min","round","concat","setAsCssVariable","varName","arguments","length","document","documentElement","style","setProperty","hideElement","element","byOpacity","noSpace","noTransition","transitionBkp","transition","classList","add","setTimeout","showElement","remove","DpitColorAnalyze","config","dpDebugEn","console","log","srcColor","preferWhiteText","colorRangeArray","fallBackContrastThreshold","fallbackColor","contrasts","srcColorObj","color","colorObj","push","sort","a","fallbackColorObj","dpitColors","rgbIdx","res","Array","isArray","dpitColorsToSort","compareColorsByRgbHue","_defineProperty","rgbKey","getRgbHueFeature","BulletsAnimation","rootSelectorOrElement","additionalClasses","tickMs","totalSize","visibleSize","activeSize","symmetrical","id","activeBulletClass","bemRoot","classNames","inactiveClass","getModifiedClass","activeClass","activeHalfSize","floor","getRootElement","HTMLElement","querySelector","modifier","start","backward","loops","loopsPassedCb","rootElement","focus","preventScroll","isRunning","bulletsLayer","createBullets","startReloadingSpinnerBack","startReloadingSpinner","getLoopTimeMs","count","createElement","className","setAttribute","opacity","display","bulletElements","containerEl","i","bulletEl","appendChild","activateBullet","activeIdx","idx","distanceFromActive","distanceFromActiveAbs","abs","stopAfterLoopEnd","loopEndCallback","finishAfterLoopEnd","finishAfterLoopEndCallback","stop","_this$bulletsLayer","_this$rootElement","clearBulletActiveStates","stopReloadSpinner","blur","_this$bulletElements","spinnerInterval","clearInterval","bulletHideTimeout","clearTimeout","setInterval","checkAfterLoopEnd","finishLoop","Function","EventListeners","listeners","getEventId","type","eventId","Date","getTime","random","toString","functionRef","addEventListener","_this$listeners$event","removeEventListener","removeAll","ExclusiveClickListener","stopPropagationEnabled","disableAllPointerEvents","suppressParentsLinkElements","excludeTargetBlank","leftButtonOnly","data","noEventTimeoutAfterVeryFirstClickMs","addElements","elements","addElement","dataItem","noEventsData","event","handleVeryFirstClickEvent","handleFollowingClickEvents","clear","clearNoEvents","bind","dataBkp","activateAfterClear","isLeftClickEvent","button","stopImmediatePropagation","activateNoEvents","preventDefault","startNoEventTimeout","onCleared","noEventsTimeout","noEventElements","getParentsLinkElements","addElementNoEvents","pointerEventsProp","getPropertyValue","pointerEventsBkp","clearNoEventsOnNoEventsItem","noEventsDataItem","removeProperty","_slicedToArray","arr","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","call","next","done","value","err","unsupportedIterableToArray","TypeError","DpitTarget","contains","$element","$","beforeOffset","offset","afterOffset","setOffset","top","attrsBkp","left","cssPosition","getComputedStyle","analysis","isSticky","isFixed","hasAltPosition","includes","process","CLASSES_CORE","target","addClassSafe","relativePosition","destroy","removeClassSafe","propName","ClassName","DpitStickyEvents","_ref","_ref$container","container","_ref$enabled","enabled","observers","stickyElements","state","Map","headerSentinels","footerSentinels","enableEvents","setState","sticky","get","headerSentinel","addSentinel","set","footerSentinel","window","self","header","createHeaderObserver","footer","createFooterObserver","warn","disableEvents","fire","values","observer","disconnect","addStickies","stickies","addSticky","sentinel","stickyParent","parentElement","cssText","assign","position","right","visibility","insertBefore","getSentinelPosition","observe","IntersectionObserver","_ref2","record","boundingClientRect","isIntersecting","rootBounds","stickyTarget","bottom","POSITION_TOP","threshold","HTMLDocument","root","_ref4","POSITION_BOTTOM","isSticking","dispatchEvent","CustomEvent","CHANGE","detail","bubbles","STUCK","UNSTUCK","stickyElement","stickyStyle","parentStyle","height","parentPadding","paddingTop","getBoundingClientRect","topSentinel","previousElementSibling","stickyOffset","topSentinelOffset","isSomeSticky","DpitTargetParent","super","computedStyle","zIndex","getComputedCssValFloat","hasFilter","hasCssPropertyPrefixed","hasTransform","hasDecreasedOpacity","hasZIndex","test","isScrollable","isElementScrollable","isZIdxFixParent","targetParent","needsZIndexFix","doesNeedZIndexFix","MODIFIERS","zIdxFix","DpitCore","wrapEl","mainCfg","tourCfg","_this","insensitivityFirst","insensitivity","isDummyModeActive","isDummyMode","followTargetInterval","options","followTargetEn","stepItem","targetDummyBkpEl","isDummyBkpActive","currentTargetEl","tooltipRefEl","lastTargetBB","DpitBB","fromElement","lastRefBB","lastRefDiffBB","diff","isFollowTargetEnabled","processing","hidden","hasClass","insensitivityFinal","isFollowTargetInAction","newTargetBB","newRefBB","newRefDiffBB","refDiffAbsDiffBB","diffAbs","width","stepIdx","softRefresh","REFRESH_REASONS","followTarget","followTargetIntervalInActionMs","followTargetIntervalStandbyMs","option","stepLabel","stepNumLabel","Number","isNaN","goToStep","cbEnd","overlayContainer","above","overlayContainerTransitionDelayMs","_len","args","_key","layer","_len2","_key2","leaveActiveOverlay","force","reason","isRedirect","disableAnimation","ending","leaveOverlayAlways","doAction","EVENTS","onBeforeEnd","continueExit","onBeforeEndCallback","disablePointerEvents","disableKeyboardNavig","showBackgroundOverlay","bringOverlayAboveIntroLayers","properties","disableStartAnimation","exitingProcess","startFullScreenAnimation","stopFullScreenAnimationAfterLoopEnd","object","nodeType","temp","jQuery","deepCloneObject","isDocumentSize","margin","docMargin","windowMargin","docBB","winBB","maxROI","supplyWidthHeight","useLastTooltipPos","useLastNumberPos","placeTooltipIterations","isCrowdedPos","prevIterationTooltipPos","tooltipPos","actualizeTooltipBB","tooltipClass","tooltipEl","isProgressBarEnabled","tooltip","_this$placeTooltipCor","placeTooltipCore","isNeededNextIteration","desiredNumberPos","placeTooltip","actualizeBulletScrollBar","showStepNumbers","placeNumber","targetBB","numberEl","tooltipWidth","desiredAlignment","maxArea","calculateTooltipAlignmentScore","tooltipLeft","tooltipRight","overLeft","overRight","possibleXAlignments","score","indexOf","tooltipHeight","tooltipTop","tooltipBottom","overTop","overBottom","possibleYAlignments","isFixedPos","fixedPosition","toElement","isInit","isTargetInMobileMenu","isTargetMobileAlt","isStepMobileAlt","documentQuerySelectorSafe","alt_mobile_selector","selector","isStepItemInMobileMenu","userInteraction","update","isFirstStep","isLastStep","controlsAutoFocusEnable","elementToFocusOn","isBackward","buttonPrevEl","buttonNextEl","buttonCancelEl","stepItems","activeElement","focusVisible","$buttonTextEl","children","CLASSES_CHILD","buttonText","text","targetBranch","stickyPosElements","onStickyEvent","stickyEvents","targetElement","targetElForSticky","containsFixedPosRes","containsFixedPos","setFixedMode","containsSticky","stickyDetLabel","stickyDetector","toUpperCase","prevIsFixedPos","printDebugMessage","tourId","prevStepItem","tooltipPadding","isPortraitOrientation","finalizeRefreshCounter","highlightExtensionPx","empty","tooltipRadius","hookBaseArgs","currentUrl","URL","location","labeling","nextLabel","prevLabel","skipLabel","doneLabel","button_arrows","hide_previous_step_button","disable_navigation_by_bullets","hide_skip_button","highlightClass","exitOnEsc","exitOnOverlayClick","keyboardNavigation","showBullets","showProgress","tooltipDistanceFromTarget","defaultBoardMarginPx","x","y","targetExtendPaddingPercent","targetExtendPaddingMaxPx","scrollTo","scrollSpeed","scrollSpeedPerPageMs","maxScrollSpeedPerPageMs","positionPrecedence","enable_interaction","buttonClass","overlayOpacityFull","overlayOpacityLight","defaultWinBoardMarginMobSizeCoef","centerTopBottomPosOffset","max_tooltip_width","customTextStylesEn","FEATURES","initOverlayOpacity","eventListeners","resumeFullOverlayOpacity","initDebugVisualizer","actualizeDocAndScreenAreas","initUserInteraction","DpitUserInteraction","inHighlightLayerAnimation","onUserInteractionIterateStep","onUserInteractionIterateStepInProgress","onBeforeUnloadByLinkClick","getOnBeforeUnloadByLinkClickConfirmMessage","i18n","started","enablePointerEvents","disableStepChanging","goToNextStep","resetUserInteraction","enableUserInteraction","enable","disableUserInteraction","userInteractionTryWhenDisabledFce","disable","VERSION","IS_DEBUG","VISUALIZE_BB","then","module","debugVisualizer","default","tag","isThisInRun","DpitHooks","currentStepObj","stepObject4Hooks","_stepItem$enable_inte","index","step","tooltipContent","intro","tooltipPosition","isEnabledInteraction","val","url","altMobileSelector","isInMobileMenu","is_in_mobile_menu","skipOnBigScreen","skip_on_big_screen","skipOnMobile","skip_on_mobile","pauseFollowTarget","wasFollowTargetEnabled","stopFollowTarget","restoreFollowTarget","startFollowTarget","pauseResizeRefresh","isResizeRefreshPaused","restoreResizeRefresh","restartFollowTarget","showArrowEl","arrowPosId","arrowPos","base","ceil","hideArrowEl","arrowEl","arrow","align","removeAttribute","actualizeArrowEl","targetDummyEl","actualizeDummyMode","shouldSwitchToDummyMode","targetElementIsNotVisibleAndNotSkipped","skip_absent_ref_el","backupDummy","activateDummyMode","deactivateDummyMode","createDummyLayer","updateIndexOfStepItem","newZeroBasedIdx","initSteps","steps","stepConfig","actualizeTargetItem","startCore","startStep","startCoreBasic","enableKeyboardNavig","init","actualizeScrollSpeedOptions","isScreenPortraitOrientation","startStepNum","onOverlayClick","exitCoreWithHiddenOverlay","setOptions","getOption","name","processBeforeStepChange","newStepItem","beforeChangeRes","RES_PROCESS_ASYNC","continue","beforeStepChangeCallback","stepIdxZeroBased","_this$prevStepItem","isStepChangingDisabled","asyncWait","beforeStepChange","nextStepObj","skip","abort","disconnectListeners","resetCoreOnStepChanged","actualizeCurrentStep","showStep","removeClass","stepSpecifier","addClass","goToPrevStep","onSkipButtonClick","hideIntroLayers","_this$userInteraction","hideLayers","disableInteractionLayer","highlightEl","highlight","hideIntroLayersWithShownBgOverlay","showIntroLayers","_this$userInteraction2","hideBackgroundOverlay","showLayers","connectListeners","listenersConnected","overlayEl","onKeyDown","onResize","stopAutoScrollWhenUserAction","finalizeExit","arrowIcoWrapData","cancelButtonIcoWrapEl","initialized","parentNode","removeChild","resetCore","hideShadowOverlay","TIMING","ended","exitCore","pointerEvents","isInRun","tourInRun","keyboardNavigEnabled","softenOverlayOpacity","lightOverlayOpacity","updateCssVar","actualizeHighlightBorder","targetPureBB","numberElBB","minExtensionSize","tb","lr","maxExtensionSize","highlightExtensionSizeBase","highlightExtensionSizeTbLr","borderWidthCoef","highlightBorderWidth","calculateTargetBBs","numberElBBSizeStandard","extend","intersectionBB","intersect","actualizeBoardSizes","visualizeBoards","docBoardBB","winBoardBB","unsubscribeEvent","providedCallback","subscribeEvent","unsubscribe","join","removeAction","addAction","pauseRefreshers","all","restoreRefreshers","startRefreshers","getTourIdPostfix","prefix","didOrientationChanged","currentNumberPos","hardReset","forceHideLayers","doNotHideIntroLayers","clearFixedMode","resetTargetElement","actualizeTheme","clearMobileMenuTarget","clearStepVisualizers","unplugTheme","pauseTour","addDocumentClass","pause","isPaused","restoreTour","removeDocumentClass","restore","hardRefresh","setInRunClasses","clearInRunClasses","showShadowOverlay","noOverlay","actualizeShadowOverlay","hasTargetItemHiddenOverlay","dummy","wrap","hiddenKeepEvents","initBGOverlayLayer","bulletsAnimation","finishCallback","stopFullScreenAnimation","setAsRunningTour","callbacksFromSecLayer","DpitApi","disableApi","COMMANDS","goToNext","goToPrev","goToStepByStepLabel","exit","setAccent","actualizeAccentColor","getScrollSpeed","_this$tourCfg","_this$tourCfg$propert","setScrollSpeed","scrollSpeedOption","setCoreOptions","getCoreOptions","resetAsRunningTour","setRadiuses","tooltip_radius","highlight_radius","button_radius","accentColorDefinition","accentColor","accentContrastColor","getContrastColor","accentContrastInvColor","lightAccent","theme","themeSpecifier","actualizeThemeSpecifier","newTheme","currentTheme","getThemeClassName","initThemeOptions","themeOverride","accentColorOverride","_this$tourCfg2","_this$mainCfg","_this$mainCfg$mobile_","setTextStyles","text_styles","mobile_break_points","mobile","getCssValFloat","isStickyTheme","actualizeWrapperSize","_this$tourCfg3","_this$mainCfg2","_this$mainCfg2$mobile","getDocBB","getWinBB","oldDocBB","isMobileSize","getIsMobileSize","round1dec","sqrt","BrowserSupport","vHFix","setMobileSizeCoef","actualizeBulletsAnimationSize","getBoardMargin","getBoardBB","actualizeScreenArea","actualizeTooltipMinWidth","isResizeWithOrientationToggle","currentWinBB","oldWinBB","isResizeWithMajorAreaChange","relativeThreshold","currentArea","area","oldArea","getResizeReactionAndType","isOrientationToggle","reaction","RESIZE_REACTION","hard","RESIZE_TYPE","orientationToggle","majorAreaChange","none","mobUrlBarVisibilityToggle","soft","minorAreaChange","_this$tourCfg4","_this$tourCfg4$proper","bulletAnimSize","size1Bullet","round3dec","bulletAnimBorderRadius","resizeRefresh","sizes","_this$getResizeReacti","currentWinSize","oldWinSize","resize","resizeType","resizeRefreshEn","_this$getResizeReacti2","resizeTimeout","restartResizeTimeout","disableOnResize","shouldHideIntroLayers","oldSize","currentSize","resizeReaction","e","_e$key","_code","code","keyCode","isHideNextByCurrentStepMeta","charCode","srcElement","getAttribute","click","returnValue","extendBoardMarginByTarget","containerBB","extendedMargin","filterWinBoardMargin","filterMarginEn","mobileSizeCoef","getDesiredNumberPos","onTooltip","getArrowData","arrowHalfSizes","arrowSizes","arrowElRelPos","getReverseBasePos","tooltipBB","actualizeTooltipRadiusPadding","radiusPaddingFix","fixArrowInTooltipRadius","tooltipElRelPos","arrowRight","arrowBottom","actualizeTooltipPosition","relativeLeft","relativeTop","actualizeTooltipSizeAndPos","isOverLeft","isOverRight","newLeft","filterTooltipElRelPos","elRelPos","useLastPosition","offsetWidth","offsetHeight","determineTooltipPosition","ceil1dec","floor1dec","stepContent","getStepContent","arrowWidthMinusTargetWidth","arrowHeightMinusTargetHeight","_this$getArrowData","goldenRatioPosAlgEn","filter","dpitGoldenRatioPosAlg","minTooltipWidth","fixPositionOutOfTheWindow","initTooltip","_this$numberEl","_this$stepItem","_this$stepItem$hidden","_this$stepItem$hidden2","tooltipTextEl","hasScrollBar","actualizeTooltipMaxWidth","maxHeight","marginLeft","marginTop","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","number","hidden_meta","ext","build_with_wp_editor","tooltipText","whiteSpacingNormal","customStyle","actualizeStepNumber","actualizeStepNumberEl","stepNumber","firstChild","innerHTML","actualizeNumberBB","actualizeLayer","isEnabled","layerElement","hideByDisp","classWhenLayerShown","takeNumberBBSizeStandardSnapShot","numberBB","getActualNumberPosY","lastPositionKey","lastPositionData","bbNumberDest","indention","lastPositionKeyBase","lastPositionParts","split","lastPositionBase","numberPosCoef","numberLayerHalfSize","scrollTop","getActualNumberPosX","scrollLeft","placeNumberFast","lastPosition","newPosition","getIsPossibleNumberPositionsInBoardObject","possiblePositionsLT","maxAreaBB","getNumberIntersectionFeature","posX","posY","bbContainerToTest","numBBToTest","fromLeftTopWidthHeight","getNumberDestElSizeFeature","getPlaceNumberRepetitionParams","oldDesiredPosition","iterations","enableIndentation","desiredPosition","maxIterations","numberDestEl","bbOther","numberSizeCoef","numberPosFeatures","leftIndented","rightIndented","topIndented","bottomIndented","isInWindow","allowedPositionKeys","positionKeysY","positionKeysX","finalPositions","idxY","idxX","numberPositionType","intersection","isNumberCloseToTooltip","nextRunParams","tooltipPosBase","isOnTooltip","_tooltipPosBase","adjustTooltipTopAfterHeightChange","oldTop","oldHeight","middleHeightCoef","actualizeTooltipScrollBars","newHeight","heightDiff","newTop","fixOverWinBoardTopForFixedElements","topBkp","tooltipHeightBkp","tooltipTextHeight","textLayerMaxHeight","SIZE_LIMITS_PX","minTooltipContentHeightFixedPos","fixOverWinBoardBottomForFixedElements","isOverBottom","actualizeTextScrollbar","hasElementScrollBarY","fixPositionOutOfTheBoard","boardBB","fixPositionOutOfTheWindowForNotFixedElements","actualizeFlier","flierBB","minTooltipContentHeight","requiredHeightDiff","getDummyTooltipPosition","targetItem","calculatedPosition","desiredTooltipPosition","reversePosition","possiblePositionsScoreInc","disabled","tooltipSizesArrowInc","newTooltipWidthArrowInc","newTooltipWidth","rightWidthArrowInc","rightWidth","leftWidthArrowInc","leftWidth","minTargetCenterHeight","bottomSpaceHardLimit","minTooltipHeight","bottomSpaceSoftLimit","topSpaceHardLimit","topSpaceSoftLimit","possiblePositionsScoreIncArr","pos","possiblePositions","map","hyphenIndex","substr","desiredPosIdx","determineTooltipAlignmentX","determineTooltipAlignmentY","actualizeOverSizeRadiuses","baseLayerClass","placeTargetPosBasedLayers","moveLayer2Target","actualizeUserInteraction","updateDisableInteractionLayer","isUserInteractionEnabled","_this$userInteraction3","skipCurrentStep","visibleLastStepShouldBeEvaluated","visibleFirstStepShouldBeEvaluated","checkTargetElValidity","skipStep","shouldBeStepSkipped","setNotVisibleRefBullet","visibleLastStepIdx","visibleFirstStepIdx","item","_item$enable_interact","hide_overlay","_this$stepItem$enable","hide_next_btn","breakPointOverride","enableStepSkippingWhenNotFoundRefEl","disabledStepSkippingWhenNotFoundRefEl","disableStepSkippingWhenNotFoundRefEl","isElementVisible","isElementInsideDocBoard","bb","getHighlightLayerClassName","getStartStepIdx","getEndStepIdx","intro_proc","setTooltipContent","find","attr","getNotVisibleStepCnt","actualizeProgressBar","progressLayer","progressVal","getProgressInPercent","progressBarLayer","isBulletNavig","actualizeBulletsNavigActiveItem","bullets","isBulletsNavigEnabled","autoScroll","listInBulletsNavigLayer","hasElementScrollBarX","activeEl","scrollIntoView","validTarget","time","actualizeSkipButton","buttonSkipLabel","buttonSkipTextLayer","actualizeButtons","buttonPrevClass","buttonPrev","hiddenHard","noTrans","buttonNextClass","buttonNext","full","buttonSkipClass","buttonSkip","buttonDone","actualizeButtonFocus","onNavigBulletClick","closest","createButtonContent","textContent","buttonContentLayer","loadIcons","loadArrowButtonIcons","loadCancelButtonIcons","button_cancel_ico","iconOption","_this$arrowIcoWrapDat","_this$arrowIcoWrapDat2","_this$arrowButtonSpac","_this$arrowButtonSpac2","prev","arrowButtonSpacersData","appendIcoSpacerToPrevNextButtons","buttonIcoWrap","svgLoader","svgStringPrevNext","buttonIco","appendTo","prependTo","textInButtonClass","textIconClass","symbol","_this$arrowIcoWrapDat3","_this$arrowIcoWrapDat4","_this$arrowButtonSpac3","_this$arrowButtonSpac4","buttonSpacer","cancelButtonSpacerEl","appendIcoSpacerToCancelButton","svgStringCancel","spacerClass","buttonSpacers","cancelButtonSpacer","createLayers","onInit","setAsButton","anchor","label","tabIndex","createBullet","roleLinkList","isActive","onClickCallback","innerLi","title","onclick","innerNumber","createNavigBullets","dpitScrollBar","createNumberLayer","numberTextEl","numberText","targetDummy","flierEl","flier","rbAnim","inHighlight","tooltipReference","tooltipRadiusPaddingEl","tooltipRadiusPadding","progress","progressBar","tooltipButtonsEl","tooltipButtons","buttonPrevNextWrapEl","buttonPrevNextWrap","reInitLayers","clearFlier","isUserScrolling","userInteractTimeout","userScrolling","getFlierBB","merge","extendByMarginBB","finalizeStepChange","finalizeStepChangeEn","isBoundingBoxInsideViewPort","finalize","processTargetBranchAndFixedPosState","_this$stepItem2","DpitTargetBranch","actualizeFixedAndStickyPos","dbgEnWhenFalse","dbgInfo","disableStickyEvents","containsFixed","overlay","getTransitionDurationMs","initBulletsAnimation","bulletRootElement","omitNumberEl","calculateScrollTimeToTarget","_this$stepItem3","targetOffset","startOffset","getScrollSpeedOptions","scrollSpeedOptionSanitized","SCROLL_SPEED","logCoef","constant","maxCoef","forceScrollTopOffset","getScrollFlierOptions","scrollTimeMs","getFlierPureWidth","getFlierPureHeight","lockX","isElementScrollableX","topOffset","leftOffset","onlyWhenNeeded","defaultFlierScroll","afterStepChanged","scrollOptions","isAutoScrolling","initScrollFlierTime","now","onFlierScrolledInView","getScrollTargetOptions","_this$targetBranch","firstScrollableChildFromClosestFixedParent","getFirstScrollableChildFromClosestFixedParent","scrollTargetIntoView","_this$stepItem4","_this$targetBranch2","defaultTargetScroll","containsScrollable","Promise","resolve","visualizeStepData","fireAfterStepChangeEvent","initScrollTime","willBeRefreshed","afterStepChange","getMinimalTooltipWidth","_this$radiusPaddingFi","_this$radiusPaddingFi2","minWidth","outerWidth","actualizeButtonsTextVisibility","hideText","buttonNoTextClass","noText","getMaximalTooltipWidth","vert","maxTooltipWidth","maxWidth","processFce","processImmediatelyWhenReady","actualizeTargetLock","deferred","processFceToRun","lockActualizeTarget","unlockActualizeTarget","fceBkp","tryUnlockActualizeTarget","processOnBeforeShowStep","onBeforeShowStepCallback","printDbgStepInfo","isFlierOnScreen","bbToTest","thresholdRatio","isBoundingBoxInsideContainer","finalizeFollowTarget","finalizeSoftRefresh","mode","startStepIdx","softRefreshTimer","regularStepChange","regular","placeTooltipInSoftRefresh","isInside","unknown","noData","async","doNotScroll","maxParentScrollTimeMs","scrollFlierIntoView","scrollOnlyWhenNeeded","calculateSpaceAroundFeature","maxScreenBB","isLeftOrRight","spaceAroundRatio","determineGoldenIncrement","spaceAroundFeature","isOverHeight","maxDocBB","closerToTargetBB","moveCloserToWinBorder","sign","range","modifyTooltipPosition","increment","tooltipMinWidth","bkpTooltipBB","newWidth","outerHeight","bkpTooltipHeight","bkpTooltipWidth","currentLeft","appliedIncrement","returnResult","wasPosAdjusted","dbgFailedReason","revertLastModificationAndReturn","lastTooltipInlineStyle","lastIsOverHeight","getInlineStyleOfElement","inlineStyle","initTooltipBB","maxWinBB","initIsOverHeight","lastTooltipBB","lastFeatureSpaceAround","featureSpaceAround","isBestPosFound","featureSpaceAroundDerivation","wasPositionChange","_lastIsOverHeight","_lastIsOverHeight2","_lastIsOverHeight3","isEqual","initBranch","initProcessData","closestFixedPosItem","fixedPosElements","scrollableElements","branchItems","distance","tagName","toLowerCase","getTargetItem","_this$fixedPosElement","containsFixedParent","_this$closestFixedPos","getClosestFixedParent","_this$closestFixedPos2","_this$closestFixedPos3","closestFixedPosItemIdx","distanceFromTarget","_this$stickyPosElemen","_this$scrollableEleme","animation","onIterateStep","onIterateStepInProgress","debugEn","isIterateStepInAction","hoverListeners","linkClickListener","processTargetLinkClick","iterateClickListener","iterateStepAfterUserAction","blockClickListener","updateIterateAfterClick","updateIterateAfterHover","updateLinkClick","clearIterateAfterClick","clearIterateAfterHover","clearTargetLinkClickAdjustment","moveLayer2TargetFce","insertDisableInteractionLayer","removeDisableInteractionLayer","disableInteraction","isBlockClicks","isIterateAfterClick","startTargetLinkClickAdjustment","allElementsToBlock","getParentsAndChildrenLinkElements","linkElement","hrefAttribute","isOpenTargetLinkClicksInNewTab","defaultPrevented","open","exception","error","blockClick","_this$stepItem$enable2","_this$stepItem$enable3","delay","iterate_after_click_delay_ms","defaultIterateAfterClick","isInteractionFeatureEnabled","featureId","isIterateAfterHover","hover","_this$stepItem$enable4","iterate_after_hover","_arrayLikeToArray","len","arr2","_unsupportedIterableToArray","o","minLen","n","prototype","slice","from"],"mappings":"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","file":"main/default-DpitBuilderCore-DpitBuilderCoreSticky-DpitCore-DpitCoreSticky-31ce9437.js","sourcesContent":["export default class DpitColor {\r\n\tconstructor(src) {\r\n\r\n\t\tif (src == null) { // eslint-disable-line no-eq-null,eqeqeq\r\n\t\t\tthis.rgbObj = {\r\n\t\t\t\tr: 0,\r\n\t\t\t\tg: 0,\r\n\t\t\t\tb: 0\r\n\t\t\t};\r\n\t\t} else if (src instanceof DpitColor) {\r\n\t\t\tthis.rgbObj = { ...src.rgbObj };\r\n\t\t} else if (typeof src === 'string') {\r\n\t\t\tif (src.startsWith('#')) {\r\n\t\t\t\tthis.rgbObj = DpitColor.hexStringToRgbObj(src);\r\n\t\t\t} else {\r\n\t\t\t\tthis.rgbObj = DpitColor.rgbStringToRgbObj(src);\r\n\t\t\t\tif (!this.rgbObj) {\r\n\t\t\t\t\tthrow new Error('Argument \"src\" isn\\'t valid');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (src) {\r\n\t\t\tthis.rgbObj = { ...src };\r\n\t\t}\r\n\t}\r\n\r\n\tstatic getRgbStringCommaSeparated(colorDefinition) {\r\n\t\tif (colorDefinition) {\r\n\t\t\ttry {\r\n\t\t\t\tconst colorObj = new DpitColor(colorDefinition);\r\n\t\t\t\treturn colorObj.toRgbStringCommaSeparated();\r\n\t\t\t}\r\n\t\t\tcatch {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic fromRgb(r, g, b) {\r\n\t\treturn new DpitColor({ r, g, b });\r\n\t}\r\n\r\n\tstatic rgbStringToRgbObj(rgbString) {\r\n\t\tconst regex = /^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/;\r\n\t\tconst match = rgbString.match(regex);\r\n\t\tif (match) {\r\n\t\t\tconst r = parseInt(match[1], 10);\r\n\t\t\tconst g = parseInt(match[2], 10);\r\n\t\t\tconst b = parseInt(match[3], 10);\r\n\t\t\treturn { r, g, b };\r\n\t\t}\r\n\t\treturn null; // Invalid RGB string format\r\n\t}\r\n\r\n\tstatic hexStringToRgbObj(hex) {\r\n\t\t// Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n\t\tvar shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n\t\thex = hex.replace(shorthandRegex, function (m, r, g, b) {\r\n\t\t\treturn r + r + g + g + b + b;\r\n\t\t});\r\n\r\n\t\tvar result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n\t\treturn result ? {\r\n\t\t\tr: parseInt(result[1], 16),\r\n\t\t\tg: parseInt(result[2], 16),\r\n\t\t\tb: parseInt(result[3], 16)\r\n\t\t} : null;\r\n\t}\r\n\r\n\tcontrast(color2) {\r\n\t\t// http://www.w3.org/TR/WCAG20/#contrast-ratiodef\r\n\t\tvar lum1 = this.luminosity();\r\n\t\tvar lum2 = color2.luminosity();\r\n\r\n\t\tif (lum1 > lum2) {\r\n\t\t\treturn (lum1 + 0.05) / (lum2 + 0.05);\r\n\t\t}\r\n\r\n\t\treturn (lum2 + 0.05) / (lum1 + 0.05);\r\n\t}\r\n\r\n\tluminosity() {\r\n\t\t// http://www.w3.org/TR/WCAG20/#relativeluminancedef\r\n\t\tvar lum = {};\r\n\t\tObject.keys(this.rgbObj).forEach(key => {\r\n\t\t\tvar chan = this.rgbObj[key] / 255;\r\n\t\t\tlum[key] = (chan <= 0.03928) ? chan / 12.92 : Math.pow(((chan + 0.055) / 1.055), 2.4);\r\n\t\t});\r\n\t\treturn 0.2126 * lum.r + 0.7152 * lum.g + 0.0722 * lum.b;\r\n\t}\r\n\r\n\tred() { return this.rgbObj.r; }\r\n\tgreen() { return this.rgbObj.g; }\r\n\tblue() { return this.rgbObj.b; }\r\n\tisDark() {\r\n\t\t// YIQ equation from http://24ways.org/2010/calculating-color-contrast\r\n\t\tvar yiq = (this.rgbObj.r * 299 + this.rgbObj.g * 587 + this.rgbObj.b * 114) / 1000;\r\n\t\treturn yiq < 128;\r\n\t}\r\n\r\n\tisLight() {\r\n\t\treturn !this.isDark();\r\n\t}\r\n\r\n\tmix(colorToMixIn, weight) {\r\n\r\n\t\tif (!(colorToMixIn instanceof DpitColor) || !colorToMixIn.rgbObj) {\r\n\t\t\tthrow new Error('Argument \"mixinColor\" isn\\'t a DpitColor instance, but rather an instance of ' + typeof colorToMixIn);\r\n\t\t}\r\n\t\tvar color1 = colorToMixIn;\r\n\t\tvar color2 = this;\r\n\t\tvar p = weight === undefined ? 0.5 : weight;\r\n\r\n\t\tvar w = 2 * p - 1;\r\n\t\tvar w1 = (w + 1) / 2.0;\r\n\t\tvar w2 = 1 - w1;\r\n\r\n\t\treturn DpitColor.fromRgb(\r\n\t\t\tMath.max(Math.min(255, Math.round(w1 * color1.red() + w2 * color2.red())), 1),\r\n\t\t\tMath.max(Math.min(255, Math.round(w1 * color1.green() + w2 * color2.green())), 1),\r\n\t\t\tMath.max(Math.min(255, Math.round(w1 * color1.blue() + w2 * color2.blue())), 1)\r\n\t\t);\r\n\t}\r\n\r\n\ttoRgbStringCommaSeparated() {\r\n\t\treturn `${this.red()}, ${this.green()}, ${this.blue()}`;\r\n\t}\r\n\r\n\tsetAsCssVariable(varName, element = document.documentElement) {\r\n\t\telement.style.setProperty(varName, this.toRgbStringCommaSeparated());\r\n\t}\r\n\r\n}\r\n","/**\r\n * @param {Element} element element to hide\r\n */\r\nexport const hideElement = (element, byOpacity = true, noSpace = false, noTransition = false) => {\r\n\tif (element) {\r\n\t\tlet transitionBkp = '';\r\n\t\tif (noTransition) {\r\n\t\t\ttransitionBkp = element.style.transition;\r\n\t\t\telement.style.transition = 'unset';\r\n\t\t}\r\n\r\n\t\telement.classList.add('dpit-hidden');\r\n\t\tif (!byOpacity) element.classList.add('dpit-hidden--by-disp');\r\n\t\tif (noSpace) element.classList.add('dpit-hidden--no-space');\r\n\r\n\t\tif (noTransition) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\telement.style.transition = transitionBkp;\r\n\t\t\t}, 50);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @param {Element} element element to hide\r\n */\r\nexport const hideElementImmediately = (element, byOpacity = true, noSpace = false) => {\r\n\thideElement(element, byOpacity, noSpace, true);\r\n};\r\n\r\n/**\r\n * @param {Element} element element to hide\r\n */\r\nexport const showElement = (element) => {\r\n\tif (element) {\r\n\t\telement.classList.remove('dpit-hidden', 'dpit-hidden--no-space', 'dpit-hidden--by-disp', 'dpit-hidden-keep-events');\r\n\t}\r\n};","\r\nimport DpitColor from './DpitColor';\r\nexport default class DpitColorAnalyze {\r\n\tconstructor(config) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT DpitColorAnalyze');\r\n\t}\r\n\t// contrast range: 1 - 21\r\n\tstatic getContrastColor(srcColor, preferWhiteText = true, colorRangeArray = ['#fff', '#252525'], fallBackContrastThreshold = 3, fallbackColor = '#222') {\r\n\t\tconst contrasts = [];\r\n\t\tconst srcColorObj = new DpitColor(srcColor);\r\n\t\tcolorRangeArray.forEach((color) => {\r\n\t\t\tconst colorObj = new DpitColor(color);\r\n\t\t\tcontrasts.push({\r\n\t\t\t\tcolor: colorObj,\r\n\t\t\t\tcontrast: srcColorObj.contrast(colorObj)\r\n\t\t\t});\r\n\t\t});\r\n\t\tif (contrasts.length) {\r\n\t\t\tif (preferWhiteText) contrasts[0].contrast *= 3.2;\r\n\t\t\telse contrasts[0].contrast *= 1.5;\r\n\t\t\tcontrasts.sort((a, b) => b.contrast - a.contrast);\r\n\t\t\t//console.log(contrasts.map((element) => element.contrast));\r\n\t\t\tif (contrasts[0].contrast < fallBackContrastThreshold) {\r\n\t\t\t\tconst fallbackColorObj = new DpitColor(fallbackColor);\r\n\t\t\t\tcontrasts.push({\r\n\t\t\t\t\tcolor: fallbackColorObj,\r\n\t\t\t\t\tcontrast: srcColorObj.contrast(fallbackColorObj)\r\n\t\t\t\t});\r\n\t\t\t\tcontrasts.sort((a, b) => b.contrast - a.contrast);\r\n\t\t\t}\r\n\t\t\treturn contrasts[0].color;\r\n\t\t}\r\n\t\treturn colorRangeArray && colorRangeArray[0]\r\n\t\t\t? new DpitColor(colorRangeArray[0])\r\n\t\t\t: new DpitColor(fallbackColor);\r\n\t}\r\n\r\n\tstatic getMostColor(dpitColors, rgbIdx /*r = red*, g = green, b = blue*/) {\r\n\t\tlet res = null;\r\n\t\tif (!Array.isArray(dpitColors)) {\r\n\t\t\tthrow new Error('Argument \"mixinColor\" isn\\'t a DpitColor instance, but rather an instance of ' + typeof colorToMixIn);\r\n\t\t}\r\n\t\tconst dpitColorsToSort = [...dpitColors];\r\n\t\tdpitColorsToSort.sort((a, b) => DpitColorAnalyze.compareColorsByRgbHue(rgbIdx, a, b));\r\n\t\tres = dpitColorsToSort[0];\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tstatic getRgbHueFeature = (rgbIdx, color) => {\r\n\t\tswitch (rgbIdx) {\r\n\t\t\tcase 'r': return color.red() + (color.red() - color.green()) + (color.red() - color.blue());\r\n\t\t\tcase 'g': return color.green() + (color.green() - color.red()) + (color.green() - color.blue());\r\n\t\t\tcase 'b': return color.blue() + (color.blue() - color.red()) + (color.blue() - color.green());\r\n\t\t}\r\n\t};\r\n\r\n\tstatic getRgbHueAdjustedColor = (rgbKey, color) => {\r\n\t\tconst addVal = 100;\r\n\t\tswitch (rgbKey) {\r\n\t\t\tcase 'r': return DpitColor.fromRgb(Math.min(color.red() + addVal, 255), Math.max(color.green() - addVal, 0), Math.max(color.blue() - addVal, 0));\r\n\t\t\tcase 'g': return DpitColor.fromRgb(Math.max(color.red() - addVal, 0), Math.min(color.green() + addVal, 255), Math.max(color.blue() - addVal, 0));\r\n\t\t\tcase 'b': return DpitColor.fromRgb(Math.max(color.red() - addVal, 0), Math.max(color.green() - addVal, 0), Math.min(color.blue() + addVal, 255));\r\n\t\t}\r\n\t};\r\n\r\n\tstatic compareColorsByRgbHue = (rgbKey, a, b) => {\r\n\t\treturn DpitColorAnalyze.getRgbHueFeature(rgbKey, b) - DpitColorAnalyze.getRgbHueFeature(rgbKey, a);\r\n\t};\r\n}","import classNames from 'classnames';\r\n\r\nexport default class BulletsAnimation {\r\n\t/**\r\n\t * Insert animation and highlight class to the element specified by rootSelectorOrElement\r\n\t * @param {Element|String} rootSelectorOrElement\r\n\t * @param {Array|String} additionalClasses\r\n\t * @param {string} removeHighlightClickChildSelector\r\n\t * @param {Number} tickMs\r\n\t * @param {Int} totalSize \r\n\t * @param {Int} visibleSize \r\n\t * @param {Int} activeSize \r\n\t * @param {Bool} symmetrical \r\n\t * @param {string} id\r\n\t * @param {string} activeBulletClass\r\n\t */\r\n\tconstructor(rootSelectorOrElement, additionalClasses = '', tickMs = 70, totalSize = 15, visibleSize = 6, activeSize = 4, symmetrical = true, id = '', activeBulletClass = 'dpit-on') {\r\n\r\n\t\tthis.rootSelectorOrElement = rootSelectorOrElement;\r\n\t\tthis.bemRoot = 'dpit-anim-rb';\r\n\t\tthis.additionalClasses = classNames([additionalClasses, 'dpit-anim-rb']);\r\n\t\tthis.inactiveClass = BulletsAnimation.getModifiedClass(this.bemRoot, 'off');\r\n\t\tthis.activeClass = activeBulletClass;\r\n\t\tthis.id = id;\r\n\t\tthis.visibleSize = visibleSize;\r\n\t\tthis.totalSize = totalSize;\r\n\t\tthis.tickMs = tickMs;\r\n\t\tthis.activeSize = activeSize;\r\n\t\tthis.activeHalfSize = Math.floor(activeSize / 2);\r\n\t\tthis.symmetrical = symmetrical;\r\n\t}\r\n\r\n\tgetRootElement() {\r\n\t\treturn this.rootSelectorOrElement instanceof HTMLElement\r\n\t\t\t? this.rootSelectorOrElement\r\n\t\t\t: document.querySelector(this.rootSelectorOrElement);\r\n\t}\r\n\r\n\tstatic getModifiedClass(bemRoot, modifier) {\r\n\t\tlet res = '';\r\n\t\tif (bemRoot) res = bemRoot + '--';\r\n\t\tres += modifier;\r\n\t\treturn res;\r\n\t}\r\n\r\n\tstart(backward = false, loops = -1, loopsPassedCb = null) {\r\n\t\tthis.backward = backward;\r\n\t\tthis.rootElement = this.getRootElement();\r\n\t\tif (this.rootElement) {\r\n\t\t\tthis.rootElement.focus({ preventScroll: true });\r\n\t\t\tthis.isRunning = true;\r\n\t\t\tif (!this.bulletsLayer) {\r\n\t\t\t\tthis.createBullets(this.visibleSize, this.rootElement);\r\n\t\t\t} else {\r\n\t\t\t\tthis.bulletsLayer.classList.remove(this.inactiveClass);\r\n\t\t\t}\r\n\r\n\t\t\tif (backward) this.startReloadingSpinnerBack(loops, loopsPassedCb);\r\n\t\t\telse this.startReloadingSpinner(loops, loopsPassedCb);\r\n\t\t}\r\n\t}\r\n\r\n\tgetLoopTimeMs() {\r\n\t\treturn this.totalSize * this.tickMs;\r\n\t}\r\n\r\n\tcreateBullets(count, rootElement) {\r\n\r\n\t\tthis.bulletsLayer = document.createElement('div');\r\n\t\tthis.bulletsLayer.className = classNames([this.bemRoot, this.additionalClasses]);\r\n\t\tthis.bulletsLayer.setAttribute('aria-hidden', 'true');\r\n\t\tthis.bulletsLayer.id = this.id;\r\n\t\tthis.bulletsLayer.style.opacity = 0;\r\n\t\tthis.bulletsLayer.style.display = 'block';\r\n\t\tthis.bulletElements = [];\r\n\t\tconst containerEl = document.createElement('div');\r\n\t\tcontainerEl.classList.add(this.bemRoot + '__wrap');\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst bulletEl = document.createElement('div');\r\n\t\t\tthis.bulletElements.push(bulletEl);\r\n\t\t\tcontainerEl.appendChild(bulletEl);\r\n\t\t}\r\n\t\tthis.bulletsLayer.appendChild(containerEl);\r\n\t\tthis.bulletsLayer.style.opacity = 1;\r\n\t\trootElement.appendChild(this.bulletsLayer);\r\n\t}\r\n\r\n\r\n\r\n\tactivateBullet(activeIdx) {\r\n\t\tthis.bulletElements.forEach((element, idx) => {\r\n\t\t\tlet className = '';\r\n\t\t\tconst distanceFromActive = activeIdx - idx;\r\n\t\t\tif (distanceFromActive === 0) {\r\n\t\t\t\tclassName = this.activeClass;\r\n\t\t\t} else {\r\n\t\t\t\tconst distanceFromActiveAbs = Math.abs(distanceFromActive);\r\n\t\t\t\tif (this.symmetrical) {\r\n\t\t\t\t\tif (distanceFromActiveAbs <= this.activeHalfSize) {\r\n\t\t\t\t\t\tclassName = this.activeClass + '--' + distanceFromActiveAbs;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (distanceFromActiveAbs < this.activeSize) {\r\n\t\t\t\t\tif (distanceFromActive > 0 && !this.backward) {\r\n\t\t\t\t\t\tclassName = this.activeClass + '--' + distanceFromActiveAbs;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (distanceFromActive < 0 && this.backward) {\r\n\t\t\t\t\t\tclassName = this.activeClass + '--' + distanceFromActiveAbs;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telement.className = className;\r\n\t\t});\r\n\t}\r\n\r\n\tstopAfterLoopEnd(loopEndCallback = null) {\r\n\t\tthis.finishAfterLoopEnd = true;\r\n\t\tthis.finishAfterLoopEndCallback = loopEndCallback;\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis.bulletsLayer?.classList.add(this.inactiveClass);\r\n\t\tthis.clearBulletActiveStates();\r\n\t\tthis.stopReloadSpinner();\r\n\t\tthis.rootElement?.blur();\r\n\t}\r\n\r\n\tclearBulletActiveStates() {\r\n\t\tthis.bulletElements?.forEach(element => {\r\n\t\t\telement.className = '';\r\n\t\t});\r\n\t}\r\n\r\n\tstopReloadSpinner() {\r\n\t\tif (this.spinnerInterval) clearInterval(this.spinnerInterval);\r\n\t\tthis.spinnerInterval = null;\r\n\t\tthis.isRunning = false;\r\n\t}\r\n\r\n\tstartReloadingSpinner(loops, loopsPassedCb) {\r\n\t\tlet idx = this.symmetrical ? - this.activeHalfSize : 0;\r\n\t\tif (this.spinnerInterval) clearInterval(this.spinnerInterval);\r\n\t\tif (this.bulletHideTimeout) clearTimeout(this.bulletHideTimeout);\r\n\t\tthis.spinnerInterval = setInterval(() => {\r\n\t\t\tthis.activateBullet(idx, idx - 1);\r\n\t\t\tidx++;\r\n\t\t\tif (idx > this.totalSize) {\r\n\t\t\t\tidx = this.symmetrical ? - this.activeHalfSize : 0;\r\n\t\t\t\tthis.checkAfterLoopEnd();\r\n\t\t\t\tif (loops > 0) {\r\n\t\t\t\t\tloops = this.finishLoop(loops, loopsPassedCb);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}, this.tickMs);\r\n\t}\r\n\r\n\tstartReloadingSpinnerBack(loops, loopsPassedCb) {\r\n\t\tif (this.spinnerInterval) clearInterval(this.spinnerInterval);\r\n\t\tif (this.bulletHideTimeout) clearTimeout(this.bulletHideTimeout);\r\n\t\tlet idx = this.symmetrical ? this.visibleSize + this.activeHalfSize : this.visibleSize;\r\n\t\tthis.spinnerInterval = setInterval(() => {\r\n\t\t\tthis.activateBullet(idx);\r\n\t\t\tidx--;\r\n\t\t\tif (idx < this.visibleSize - this.totalSize) {\r\n\t\t\t\tidx = this.symmetrical ? this.visibleSize + this.activeHalfSize : this.visibleSize;\r\n\t\t\t\tthis.checkAfterLoopEnd();\r\n\t\t\t\tif (loops > 0) {\r\n\t\t\t\t\tloops = this.finishLoop(loops, loopsPassedCb);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}, this.tickMs);\r\n\t}\r\n\r\n\tcheckAfterLoopEnd() {\r\n\t\tif (this.finishAfterLoopEnd) {\r\n\t\t\tthis.finishAfterLoopEnd = false;\r\n\t\t\tthis.stop();\r\n\t\t\tif (this.finishAfterLoopEndCallback instanceof Function) this.finishAfterLoopEndCallback();\r\n\t\t\tthis.finishAfterLoopEndCallback = null;\r\n\t\t}\r\n\t}\r\n\r\n\tfinishLoop(loops, loopsPassedCb) {\r\n\t\tif (loops > 0) {\r\n\t\t\tloops--;\r\n\t\t\tif (loops === 0) {\r\n\t\t\t\tthis.stop();\r\n\t\t\t\tif (loopsPassedCb && loopsPassedCb instanceof Function) loopsPassedCb();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn loops;\r\n\t}\r\n\r\n}\r\n","\r\nexport default class EventListeners {\r\n\tconstructor() {\r\n\t\tthis.listeners = {};\r\n\t}\r\n\r\n\t/**\r\n\t * If not eventId set, generate generic ID\r\n\t * @param {string} type event type key\r\n\t * @param {string} eventId event id\r\n\t */\r\n\tgetEventId(type, eventId = null) {\r\n\t\treturn eventId ?? type + (new Date()).getTime() + Math.random().toString(36);\r\n\t}\r\n\t/**\r\n\t * Subscribe event on element and store data for unsubscribe\r\n\t *\r\n\t * @param {Element} element element where event occurs\r\n\t * @param {string} type event type key\r\n\t * @param {Function} functionRef to run while event occurs\r\n\t * @param {string} eventId event id\r\n\t */\r\n\tadd(element, type, functionRef, eventId = null) {\r\n\t\tif (element && type && functionRef) {\r\n\t\t\tthis.listeners[this.getEventId(type, eventId)] = {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tfunctionRef: functionRef,\r\n\t\t\t\telement: element,\r\n\t\t\t};\r\n\t\t\telement.addEventListener(type, functionRef);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Unsubscribe event on element and delete stored data\r\n\t * @param {string} eventId event id\r\n\t*/\r\n\tremove(eventId) {\r\n\t\tif (this.listeners[eventId] && this.listeners[eventId]) {\r\n\t\t\tconst { element, type, functionRef } = this.listeners[eventId];\r\n\t\t\tif (element && type && functionRef) {\r\n\t\t\t\telement.removeEventListener(type, functionRef);\r\n\t\t\t\tdelete this.listeners[eventId];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unsubscribe all stored events and delete stored data\r\n\t*/\r\n\tremoveAll() {\r\n\t\tObject.keys(this.listeners).forEach(eventId => {\r\n\t\t\tthis.remove(eventId);\r\n\t\t});\r\n\t}\r\n}","import { getParentsLinkElements } from '../dpitUtilsPublic';\r\nimport EventListeners from './EventListeners';\r\n\r\nexport default class ExclusiveClickListener {\r\n\t/**\r\n\t * Init module for adjusting a click events, so only first event is captured and rest possibly registered events are suppressed \r\n\t *\r\n\t * @param {Function} functionRef to run while event occurs\r\n\t * @param {Boolean} stopPropagationEnabled should be propagation of click events stopped\r\n\t * @param {Boolean} leftButtonOnly only left mouse button is captured\r\n\t */\r\n\tconstructor(functionRef, stopPropagationEnabled = true, disableAllPointerEvents = true, suppressParentsLinkElements = false, excludeTargetBlank = false, leftButtonOnly = true) {\r\n\t\tthis.data = [];\r\n\t\tthis.noEventTimeoutAfterVeryFirstClickMs = 1000;\r\n\t\tthis.stopPropagationEnabled = stopPropagationEnabled;\r\n\t\tthis.leftButtonOnly = leftButtonOnly;\r\n\t\tthis.excludeTargetBlank = excludeTargetBlank;\r\n\t\tthis.disableAllPointerEvents = disableAllPointerEvents;\r\n\t\tthis.suppressParentsLinkElements = suppressParentsLinkElements;\r\n\t\tthis.listeners = new EventListeners();\r\n\t\tthis.functionRef = functionRef;\r\n\t}\r\n\t/**\r\n\t * Subscribe element click events so only first event is captured and rest possibly registered events are suppressed \r\n\t *\r\n\t * @param {HTMLCollection|Array} elements element or elements, where subscribe exclusive click\r\n\t*/\r\n\taddElements(elements) {\r\n\t\tif (elements) {\r\n\t\t\telements.forEach((element) => this.addElement(element));\r\n\t\t}\r\n\t}\r\n\r\n\taddElement(element) {\r\n\t\tif (element) {\r\n\t\t\tconst dataItem = {\r\n\t\t\t\telement: element,\r\n\t\t\t\tnoEventsData: null\r\n\t\t\t};\r\n\t\t\tthis.data.push = dataItem;\r\n\t\t\tthis.listeners.add(element, 'mousedown', (event) => this.handleVeryFirstClickEvent(event, dataItem));\r\n\t\t\tthis.listeners.add(element, 'touchstart', (event) => this.handleVeryFirstClickEvent(event, dataItem));\r\n\t\t\tthis.listeners.add(element, 'click', (event) => this.handleFollowingClickEvents(event, dataItem));\r\n\t\t\tthis.listeners.add(element, 'mouseup', (event) => this.handleFollowingClickEvents(event, dataItem));\r\n\t\t\tthis.listeners.add(element, 'touchend', (event) => this.handleFollowingClickEvents(event, dataItem));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unsubscribe all subscribed events and clear pointer-events modification\r\n\t * @param {Element} element element to unsubscribe\r\n\t*/\r\n\tclear(immediate = false) {\r\n\r\n\t\tif (immediate) {\r\n\t\t\tthis.data.forEach(this.clearNoEvents.bind(this));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst dataBkp = [...this.data];\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdataBkp.forEach(this.clearNoEvents.bind(this));\r\n\t\t\t}, this.noEventTimeoutAfterVeryFirstClickMs);\r\n\t\t}\r\n\r\n\t\tthis.data = [];\r\n\t\tthis.listeners.removeAll();\r\n\t}\r\n\r\n\tactivateAfterClear() {\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.clear(true);\r\n\t\t}, this.noEventTimeoutAfterVeryFirstClickMs);\r\n\t}\r\n\r\n\tisLeftClickEvent(event) {\r\n\t\tif (!this.leftButtonOnly) return true;\r\n\t\treturn event.button === 0;\r\n\t}\r\n\r\n\thandleVeryFirstClickEvent(event, dataItem) {\r\n\t\tlet res = true;\r\n\t\tif (this.isLeftClickEvent(event)) {\r\n\t\t\tres = false;\r\n\t\t\t//console.log('handleFollowingClickEvents sssssssssssssssssssssssssssssssssssssssssssssssssssssss', event.type, event);\r\n\t\t\tif (this.functionRef instanceof Function) {\r\n\t\t\t\tres = this.functionRef(event, dataItem.element);\r\n\t\t\t}\r\n\t\t\tif (!res) {\r\n\t\t\t\tif (this.stopPropagationEnabled) event.stopImmediatePropagation();\r\n\t\t\t\tthis.activateNoEvents(dataItem);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\thandleFollowingClickEvents(event, dataItem) {\r\n\t\t//console.log('handleFollowingClickEvents sssssssssssssssssssssssssssssssssssssssssssssssssssssss', event.type, event);\r\n\t\tif (this.isLeftClickEvent(event)) {\r\n\t\t\tif (event.type === 'click') event.preventDefault();\r\n\t\t\tif (this.stopPropagationEnabled) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t\tthis.activateNoEvents(dataItem);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tstartNoEventTimeout(dataItem, onCleared) {\r\n\t\tif (dataItem.noEventsTimeout) clearTimeout(dataItem.noEventsTimeout);\r\n\t\tdataItem.noEventsTimeout = setTimeout(() => {\r\n\t\t\tthis.clearNoEvents(dataItem);\r\n\t\t\tif (onCleared instanceof Function) onCleared(dataItem.element);\r\n\t\t}, this.noEventTimeoutAfterVeryFirstClickMs);\r\n\t}\r\n\r\n\tactivateNoEvents(dataItem) {\r\n\t\tif (this.disableAllPointerEvents) {\r\n\t\t\tif (!dataItem.noEventsData) {\r\n\t\t\t\tlet noEventElements = [dataItem.element];\r\n\t\t\t\tif (this.suppressParentsLinkElements) {\r\n\t\t\t\t\tnoEventElements = getParentsLinkElements(dataItem.element, true, this.excludeTargetBlank);\r\n\t\t\t\t}\r\n\t\t\t\tnoEventElements.forEach((element) => this.addElementNoEvents(dataItem, element));\r\n\t\t\t\tthis.startNoEventTimeout(dataItem);\r\n\t\t\t} else {\r\n\t\t\t\tthis.startNoEventTimeout(dataItem);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\taddElementNoEvents(dataItem, element) {\r\n\t\tif (dataItem && element) {\r\n\t\t\tconst pointerEventsProp = element.style.getPropertyValue('pointer-events');\r\n\t\t\telement.style.setProperty('pointer-events', 'none', 'important');\r\n\t\t\tif (!dataItem.noEventsData) dataItem.noEventsData = [];\r\n\t\t\tdataItem.noEventsData.push({\r\n\t\t\t\telement,\r\n\t\t\t\tpointerEventsBkp: pointerEventsProp\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tclearNoEvents(dataItem) {\r\n\t\tif (dataItem.noEventsData) {\r\n\t\t\tdataItem.noEventsData.forEach(this.clearNoEventsOnNoEventsItem.bind(this));\r\n\t\t\tif (dataItem.noEventsTimeout) clearTimeout(dataItem.noEventsTimeout);\r\n\t\t\tdataItem.noEventsTimeout = null;\r\n\t\t}\r\n\t\tdataItem.noEventsData = null;\r\n\t}\r\n\r\n\tclearNoEventsOnNoEventsItem(noEventsDataItem) {\r\n\t\tif (noEventsDataItem?.element) {\r\n\t\t\tif (noEventsDataItem.pointerEventsBkp) {\r\n\t\t\t\tnoEventsDataItem.element.style.setProperty('pointer-events', noEventsDataItem.pointerEventsBkp);\r\n\t\t\t}\r\n\t\t\telse noEventsDataItem.element.style.removeProperty('pointer-events');\r\n\t\t}\r\n\t}\r\n\r\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import { CLASSES_CORE } from './constants';\r\n\r\nexport default class DpitTarget {\r\n\r\n\t/**\r\n\t * Initialize target object\r\n\t *\r\n\t * @param {Element} element\r\n\t*/\r\n\tconstructor(element) {\r\n\t\tthis.element = element;\r\n\t\tconst computedStyle = getComputedStyle(element);\r\n\t\tconst cssPosition = computedStyle.getPropertyValue('position');\r\n\t\tthis.analysis = {\r\n\t\t\tisSticky: cssPosition === 'sticky',\r\n\t\t\tisFixed: cssPosition === 'fixed',\r\n\t\t\thasAltPosition: ['fixed', 'sticky', 'absolute'].includes(cssPosition),\r\n\t\t\t//isSvg: element.tagName.toLowerCase() === 'svg',\r\n\t\t};\r\n\t}\r\n\r\n\tprocess() {\r\n\t\tthis.attrsBkp = {};\r\n\t\tthis.element.classList.add(CLASSES_CORE.target);\r\n\t\tif (this.analysis.hasAltPosition) {\r\n\t\t\tthis.addClassSafe(CLASSES_CORE.relativePosition);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tdestroy() {\r\n\t\tthis.element.classList.remove(CLASSES_CORE.target);\r\n\t\tthis.removeClassSafe(CLASSES_CORE.relativePosition);\r\n\t}\r\n\r\n\r\n\taddClassSafe = (className) => {\r\n\t\tif (!this.element.classList.contains(className)) {\r\n\t\t\tconst $element = $(this.element);\r\n\t\t\tconst beforeOffset = $element.offset();\r\n\t\t\tthis.element.classList.add(className);\r\n\t\t\tconst afterOffset = $element.offset();\r\n\r\n\t\t\tlet setOffset = false;\r\n\t\t\tif (Math.abs(afterOffset.top - beforeOffset.top) > 1) {\r\n\t\t\t\tthis.attrsBkp.top = this.element.style.top;\r\n\t\t\t\tsetOffset = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (Math.abs(afterOffset.left - beforeOffset.left) > 1) {\r\n\t\t\t\tthis.attrsBkp.left = this.element.style.left;\r\n\t\t\t\tsetOffset = true;\r\n\t\t\t}\r\n\t\t\tif (setOffset) {\r\n\t\t\t\t$element.offset(beforeOffset);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tremoveClassSafe(className) {\r\n\t\tif (this.element.classList.contains(className)) {\r\n\t\t\tthis.element.classList.remove(className);\r\n\t\t}\r\n\t\tif (this.attrsBkp) {\r\n\t\t\tObject.keys(this.attrsBkp).forEach(propName => {\r\n\t\t\t\tthis.element.setAttribute(propName, this.attrsBkp[propName]);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}","\r\nconst ClassName = {\r\n\tSENTINEL: 'sticky-events--sentinel',\r\n\tSENTINEL_TOP: 'sticky-events--sentinel-top',\r\n\tSENTINEL_BOTTOM: 'sticky-events--sentinel-bottom',\r\n};\r\n\r\n\r\n// DpitStickyEvents class\r\n\r\nexport default class DpitStickyEvents {\r\n\t/**\r\n\t * Initialize a set of sticky elements with events\r\n\t *\r\n\t * @param {Element|Document} container\r\n\t * @param {boolean} enabled\r\n\t * @param {string} stickySelector\r\n\t */\r\n\r\n\tconstructor({ container = document, enabled = true } = {}) {\r\n\t\tthis.container = container;\r\n\t\tthis.observers = {};\r\n\t\tthis.stickyElements = [];\r\n\t\tthis.state = new Map();\r\n\t\tthis.headerSentinels = new Map();\r\n\t\tthis.footerSentinels = new Map();\r\n\r\n\t\tif (enabled) {\r\n\t\t\tthis.enableEvents();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Initialize the state for a sticky:\r\n\t * 1. Default isSticky to false\r\n\t * 2. Create and observe a header sentinel\r\n\t * 3. Create and observe a footer sentinel\r\n\t *\r\n\t * @param {HTMLElement|Node} sticky\r\n\t */\r\n\r\n\tsetState(sticky) {\r\n\t\tif (this.state.get(sticky)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst headerSentinel = this.addSentinel(sticky, ClassName.SENTINEL_TOP);\r\n\t\tthis.headerSentinels.set(headerSentinel, sticky);\r\n\r\n\t\tconst footerSentinel = this.addSentinel(sticky, ClassName.SENTINEL_BOTTOM);\r\n\t\tthis.footerSentinels.set(footerSentinel, sticky);\r\n\r\n\t\tthis.state.set(sticky, {\r\n\t\t\tisSticky: false,\r\n\t\t\theaderSentinel: headerSentinel,\r\n\t\t\tfooterSentinel: footerSentinel,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Initialize the intersection observers on `.sticky` elements within the specified container.\r\n\t * Container defaults to `document`.\r\n\t */\r\n\r\n\tenableEvents() {\r\n\t\tif (window.self !== window.top) {\r\n\t\t\tconsole.warn('StickyEvents: There are issues with using IntersectionObservers in an iframe, canceling initialization. Please see https://github.com/w3c/IntersectionObserver/issues/183');\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Create IntersectionObservers for header and footer sentinels\r\n\r\n\t\tthis.observers = {\r\n\t\t\theader: this.createHeaderObserver(),\r\n\t\t\tfooter: this.createFooterObserver(),\r\n\t\t};\r\n\r\n\t\t// Then, initialize the sticky's state\r\n\r\n\t\tthis.stickyElements.forEach((sticky) => {\r\n\t\t\tthis.setState(sticky);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Reset the DOM to it's pre-sticky state.\r\n\t * 1. (Optionally) Fire a sticky-unstuck event on all stickies to reset them to their original unstuck state\r\n\t * 2. Disconnect and remove IntersectionObservers\r\n\t * 3. Clear out the global state\r\n\t *\r\n\t * @param {boolean} resetStickies\r\n\t */\r\n\r\n\tdisableEvents(resetStickies = true) {\r\n\t\tif (resetStickies) {\r\n\t\t\tthis.stickyElements.forEach(sticky => this.fire(false, sticky));\r\n\t\t}\r\n\r\n\t\tObject.values(this.observers).forEach(observer => observer.disconnect());\r\n\r\n\t\tthis.observers = null;\r\n\r\n\t\tthis.state.clear();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Add a list of stickies to the existing set\r\n\t *\r\n\t * @param {NodeList} stickies\r\n\t */\r\n\r\n\taddStickies(stickies) {\r\n\t\tthis.stickyElements.push(...stickies);\r\n\t\tthis.stickyElements.forEach(sticky => this.setState(sticky));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Add a single sticky to the existing set\r\n\t *\r\n\t * @param {Node} sticky\r\n\t */\r\n\r\n\taddSticky(sticky) {\r\n\t\tthis.stickyElements.push(sticky);\r\n\t\tthis.setState(sticky);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Create and observe a sentinel for given sticky. Type of sentinel is determined by className.\r\n\t *\r\n\t * @param {HTMLElement} sticky\r\n\t * @param {string} className\r\n\t * @returns {Element}\r\n\t */\r\n\r\n\taddSentinel(sticky, className) {\r\n\t\tconst sentinel = document.createElement('div');\r\n\t\tconst stickyParent = sticky.parentElement;\r\n\r\n\t\t// Apply styles to the sticky element\r\n\r\n\t\tsticky.style.cssText = `\r\n\t\tposition: -webkit-sticky;\r\n\t\tposition: sticky;\r\n\t  `;\r\n\r\n\t\t// Apply default sentinel styles\r\n\r\n\t\tsentinel.classList.add(ClassName.SENTINEL, className);\r\n\r\n\t\tObject.assign(sentinel.style, {\r\n\t\t\tleft: 0,\r\n\t\t\tposition: 'absolute',\r\n\t\t\tright: 0,\r\n\t\t\tvisibility: 'hidden',\r\n\t\t});\r\n\r\n\t\tswitch (className) {\r\n\t\t\tcase ClassName.SENTINEL_TOP: {\r\n\t\t\t\tstickyParent.insertBefore(sentinel, sticky);\r\n\r\n\t\t\t\t// Apply styles specific to the top sentinel\r\n\r\n\t\t\t\tObject.assign(\r\n\t\t\t\t\tsentinel.style,\r\n\t\t\t\t\tthis.getSentinelPosition(sticky, sentinel, className),\r\n\t\t\t\t\t{ position: 'relative' },\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Observe the sentinel\r\n\r\n\t\t\t\tthis.observers.header.observe(sentinel);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase ClassName.SENTINEL_BOTTOM: {\r\n\t\t\t\tstickyParent.appendChild(sentinel);\r\n\r\n\t\t\t\t// Apply styles specific to the bottom sentinel\r\n\r\n\t\t\t\tObject.assign(sentinel.style, this.getSentinelPosition(sticky, sentinel, className));\r\n\r\n\t\t\t\t// Observe the sentinel\r\n\r\n\t\t\t\tthis.observers.footer.observe(sentinel);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn sentinel;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Sets up an intersection observer to notify `document` when elements with the `ClassName.SENTINEL_TOP` become\r\n\t * visible/hidden at the top of the sticky container.\r\n\t *\r\n\t * @returns {IntersectionObserver}\r\n\t */\r\n\r\n\tcreateHeaderObserver() {\r\n\t\treturn new IntersectionObserver(([record]) => {\r\n\t\t\tconst { boundingClientRect, isIntersecting, rootBounds } = record;\r\n\t\t\tconst stickyParent = record.target.parentElement;\r\n\t\t\tconst stickyTarget = this.headerSentinels.get(record.target);\r\n\r\n\t\t\tstickyParent.style.position = 'relative';\r\n\r\n\t\t\tif (boundingClientRect.bottom < rootBounds.bottom && isIntersecting) {\r\n\t\t\t\tthis.fire(false, stickyTarget, DpitStickyEvents.POSITION_TOP);\r\n\t\t\t}\r\n\r\n\t\t\telse if (boundingClientRect.bottom <= rootBounds.top && !isIntersecting) {\r\n\t\t\t\tthis.fire(true, stickyTarget, DpitStickyEvents.POSITION_TOP);\r\n\t\t\t}\r\n\t\t}, Object.assign({\r\n\t\t\tthreshold: 0,\r\n\t\t}, !(this.container instanceof HTMLDocument) && {\r\n\t\t\troot: this.container\r\n\t\t}));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Sets up an intersection observer to notify `document` when elements with the `ClassName.SENTINEL_BOTTOM` become\r\n\t * visible/hidden at the bottom of the sticky container.\r\n\t *\r\n\t * @returns {IntersectionObserver}\r\n\t */\r\n\r\n\tcreateFooterObserver() {\r\n\t\treturn new IntersectionObserver(([record]) => {\r\n\t\t\tconst { boundingClientRect, isIntersecting, rootBounds } = record;\r\n\t\t\tconst stickyTarget = this.footerSentinels.get(record.target);\r\n\t\t\tif (boundingClientRect.top < rootBounds.top && boundingClientRect.bottom < rootBounds.bottom && !isIntersecting) {\r\n\t\t\t\tthis.fire(false, stickyTarget, DpitStickyEvents.POSITION_BOTTOM);\r\n\t\t\t}\r\n\r\n\t\t\telse if (boundingClientRect.bottom > rootBounds.top && this.isSticking(stickyTarget) && isIntersecting) {\r\n\t\t\t\tthis.fire(true, stickyTarget, DpitStickyEvents.POSITION_BOTTOM);\r\n\t\t\t}\r\n\t\t}, Object.assign({\r\n\t\t\tthreshold: 1,\r\n\t\t}, !(this.container instanceof HTMLDocument) && {\r\n\t\t\troot: this.container\r\n\t\t}));\r\n\t}\r\n\r\n\r\n\r\n\r\n\t/**\r\n\t * Dispatch the following events:\r\n\t * - `sticky-change`\r\n\t * - `sticky-stuck` or `sticky-unstuck`\r\n\t *\r\n\t * @param {Boolean} isSticky\r\n\t * @param {Element} stickyTarget\r\n\t * @param {DpitStickyEvents.POSITION_BOTTOM|DpitStickyEvents.POSITION_TOP} position\r\n\t */\r\n\r\n\tfire(isSticky, stickyTarget, position) {\r\n\t\tif (!stickyTarget) return;\r\n\t\tconst { isSticky: previouslySticky } = this.state.get(stickyTarget);\r\n\r\n\t\t// Don't fire any events if the new state is the same as the previous state\r\n\r\n\t\tif (previouslySticky === isSticky) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Update the sticky state\r\n\r\n\t\tthis.state.set(stickyTarget, { isSticky });\r\n\r\n\t\t// Fire some events if the state is changing\r\n\r\n\t\tstickyTarget.dispatchEvent(new CustomEvent(DpitStickyEvents.CHANGE, { detail: { isSticky, position }, bubbles: true }));\r\n\t\tstickyTarget.dispatchEvent(new CustomEvent(isSticky ? DpitStickyEvents.STUCK : DpitStickyEvents.UNSTUCK, { detail: { isSticky, position }, bubbles: true }));\r\n\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Determine the position of the sentinel\r\n\t *\r\n\t * @param {Element|Node} stickyElement\r\n\t * @param {Element|Node} sentinel\r\n\t * @param {String} className\r\n\t * @returns {Object}\r\n\t */\r\n\r\n\tgetSentinelPosition(stickyElement, sentinel, className) {\r\n\t\tconst stickyStyle = window.getComputedStyle(stickyElement);\r\n\t\tconst parentStyle = window.getComputedStyle(stickyElement.parentElement);\r\n\r\n\t\tswitch (className) {\r\n\t\t\tcase ClassName.SENTINEL_TOP:\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: `calc(${stickyStyle.getPropertyValue('top')} * -1)`,\r\n\t\t\t\t\theight: 1,\r\n\t\t\t\t};\r\n\r\n\t\t\tcase ClassName.SENTINEL_BOTTOM: {\r\n\t\t\t\tconst parentPadding = parseInt(parentStyle.paddingTop);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tbottom: stickyStyle.top,\r\n\t\t\t\t\theight: `${stickyElement.getBoundingClientRect().height + parentPadding}px`,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Determine if the sticky element is currently sticking in the browser\r\n\t *\r\n\t * @param {Element} stickyElement\r\n\t * @returns {boolean}\r\n\t */\r\n\r\n\tisSticking(stickyElement) {\r\n\t\tif (!stickyElement) return false;\r\n\t\tconst topSentinel = stickyElement.previousElementSibling;\r\n\r\n\t\tconst stickyOffset = stickyElement.getBoundingClientRect().top;\r\n\t\tconst topSentinelOffset = topSentinel.getBoundingClientRect().top;\r\n\t\tconst difference = Math.round(Math.abs(stickyOffset - topSentinelOffset));\r\n\r\n\t\tconst topSentinelTopPosition = Math.abs(parseInt(window.getComputedStyle(topSentinel).getPropertyValue('top')));\r\n\r\n\t\treturn difference !== topSentinelTopPosition;\r\n\t}\r\n\r\n\r\n\tisSomeSticky() {\r\n\t\tlet res = false;\r\n\t\tthis.state.forEach((value) => {\r\n\t\t\tif (value.isSticky) {\r\n\t\t\t\tres = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n}\r\n\r\n// Events\r\n\r\nDpitStickyEvents.CHANGE = 'sticky-change';\r\nDpitStickyEvents.STUCK = 'sticky-stuck';\r\nDpitStickyEvents.UNSTUCK = 'sticky-unstuck';\r\n\r\n// Position\r\n\r\nDpitStickyEvents.POSITION_BOTTOM = 'bottom';\r\nDpitStickyEvents.POSITION_TOP = 'top';","\r\nimport { getComputedCssValFloat, hasCssPropertyPrefixed, isElementScrollable } from '../dpitUtilsPublic';\r\nimport DpitTarget from './DpitTarget';\r\nimport { CLASSES_CORE, MODIFIERS } from './constants';\r\n\r\n\r\n\r\nexport default class DpitTargetParent extends DpitTarget {\r\n\t/**\r\n\t * Initialize target object\r\n\t *\r\n\t * @param {Element} element\r\n\t*/\r\n\tconstructor(element) {\r\n\t\tsuper(element);\r\n\t\tconst computedStyle = getComputedStyle(element);\r\n\t\tconst zIndex = computedStyle.getPropertyValue('z-index');\r\n\t\tconst opacity = getComputedCssValFloat(element, 'opacity', 1, computedStyle);\r\n\t\tthis.analysis = {\r\n\t\t\t...this.analysis,\r\n\t\t\thasFilter: hasCssPropertyPrefixed(computedStyle, 'filter'),\r\n\t\t\thasTransform: hasCssPropertyPrefixed(computedStyle, 'transform'),\r\n\t\t\thasDecreasedOpacity: opacity < 1,\r\n\t\t\thasZIndex: /[0-9]+/.test(zIndex),\r\n\t\t\tisScrollable: isElementScrollable(element, computedStyle)\r\n\t\t};\r\n\t}\r\n\r\n\tprocess(isZIdxFixParent) {\r\n\t\tthis.element.classList.add(CLASSES_CORE.targetParent);\r\n\t\tthis.needsZIndexFix = this.doesNeedZIndexFix(isZIdxFixParent, this.analysis);\r\n\t\tif (this.needsZIndexFix) {\r\n\t\t\tthis.addClassSafe(CLASSES_CORE.targetParent + MODIFIERS.zIdxFix);\r\n\t\t}\r\n\t}\r\n\r\n\tdoesNeedZIndexFix(isZIdxFixParent, analysis) {\r\n\t\treturn isZIdxFixParent || analysis.hasTransform || analysis.hasFilter || analysis.hasDecreasedOpacity || analysis.hasZIndex || analysis.hasAltPosition;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.element.classList.remove(CLASSES_CORE.targetParent);\r\n\t\tthis.removeClassSafe(CLASSES_CORE.targetParent + MODIFIERS.zIdxFix);\r\n\t}\r\n}","\r\nimport classNames from 'classnames';\r\n\r\nimport {\r\n\ti18n, getWinBB, getDocBB, getTransitionDurationMs,\r\n\tgetCssValFloat, getReverseBasePos, hasElementScrollBarX, documentQuerySelectorSafe,\r\n\tisElementScrollableX, isBoundingBoxInsideContainer, hasElementScrollBarY\r\n} from '../dpitUtilsPublic';\r\n\r\nimport {\r\n\tVERSION,\r\n\tIS_DEBUG,\r\n\tVISUALIZE_BB,\r\n\tCLASSES_CORE,\r\n\tMODIFIERS,\r\n\tEVENTS,\r\n\tCOMMANDS,\r\n\tRESIZE_REACTION,\r\n\tREFRESH_REASONS,\r\n\tRES_PROCESS_ASYNC,\r\n\tCLASSES_CHILD,\r\n\tSCROLL_SPEED,\r\n\tTIMING,\r\n\tSIZE_LIMITS_PX,\r\n\tRESIZE_TYPE,\r\n\tFEATURES\r\n} from './constants';\r\n\r\nimport {\r\n\tupdateCssVar,\r\n\tround1dec,\r\n\tsetTextStyles,\r\n\tscrollIntoView,\r\n\tsetMobileSizeCoef,\r\n\tround3dec,\r\n\tfloor1dec,\r\n\tceil1dec,\r\n\tasyncWait,\r\n} from '../../../../../includes/assets/js/modules/dpitUtilsInc';\r\n\r\nimport {\r\n\thideElement,\r\n\tshowElement\r\n} from '../../../../../includes/assets/js/modules/dpitHidden';\r\n\r\nimport DpitBB from './DpitBB';\r\nimport dpitGoldenRatioPosAlg from './dpitGoldenRatioPosAlg';\r\n\r\nimport BulletsAnimation from '../../../../../includes/assets/js/modules/BulletsAnimation';\r\nimport DpitHooks from '../../../../../includes/assets/js/modules/DpitHooks';\r\nimport DpitStickyEvents from './DpitStickyEvents';\r\nimport DpitColor from '../../../../../includes/assets/js/modules/DpitColor';\r\nimport DpitColorAnalyze from '../../../../../includes/assets/js/modules/DpitColorAnalyze';\r\nimport DpitTargetBranch from './DpitTargetBranch';\r\nimport BrowserSupport from '../../../../../includes/assets/js/modules/BrowserSupport';\r\nimport DpitUserInteraction from './DpitUserInteraction';\r\nimport EventListeners from './EventListeners';\r\n\r\nexport default class DpitCore {\r\n\tconstructor(wrapEl, mainCfg, tourCfg) {\r\n\t\tif (mainCfg.dpDebugEn) this.printDebugMessage();\r\n\t\tthis.mainCfg = mainCfg;\r\n\t\tthis.tourCfg = tourCfg;\r\n\t\tthis.wrapEl = wrapEl;\r\n\t\tthis.tourId = tourCfg.tourId;\r\n\r\n\t\tthis.stepItems = [];\r\n\t\tthis.stepItem = null;\r\n\t\tthis.prevStepItem = null;\r\n\t\tthis.tooltipPadding = {\r\n\t\t\tleft: 20,\r\n\t\t\tright: 20\r\n\t\t};\r\n\r\n\t\tthis.isPortraitOrientation = null;\r\n\t\tthis.finalizeRefreshCounter = 0;\r\n\t\tthis.highlightExtensionPx = 8;\r\n\t\tthis.windowMargin = DpitBB.empty(true, false);\r\n\t\tthis.docMargin = DpitBB.empty(true, false);\r\n\t\tthis.tooltipRadius = 0;\r\n\r\n\t\tthis.hookBaseArgs = {\r\n\t\t\ttourId: this.tourId,\r\n\t\t\tcurrentUrl: new URL(window.location)\r\n\t\t};\r\n\r\n\t\tthis.options = {\r\n\t\t\tdpDebugEn: mainCfg.dpDebugEn,\r\n\t\t\tlabeling: {\r\n\t\t\t\t/* Next button label in tooltip box */\r\n\t\t\t\tnextLabel: 'Next', // &rarr\r\n\t\t\t\t/* Previous button label in tooltip box */\r\n\t\t\t\tprevLabel: 'Back',\r\n\t\t\t\t/* Cancel button label in tooltip box */\r\n\t\t\t\tskipLabel: 'Cancel',\r\n\t\t\t\t/* Done button label in tooltip box */\r\n\t\t\t\tdoneLabel: 'Done',\r\n\t\t\t\tbutton_arrows: 'vector'\r\n\t\t\t},\r\n\t\t\t/* Hide previous button always. */\r\n\t\t\thide_previous_step_button: false,\r\n\t\t\t/* Disable navigation to step by click to bullet. */\r\n\t\t\tdisable_navigation_by_bullets: false,\r\n\t\t\t/* Hide skip button if it is not DONE - in the last step? */\r\n\t\t\thide_skip_button: false,\r\n\t\t\t/* Next CSS class for tooltip box */\r\n\t\t\ttooltipClass: '',\r\n\t\t\t/* CSS class that is added to the highlight el */\r\n\t\t\thighlightClass: '',\r\n\t\t\t/* Close introduction when pressing Escape button? */\r\n\t\t\texitOnEsc: true,\r\n\t\t\t/* Close introduction when clicking on overlay el? */\r\n\t\t\texitOnOverlayClick: true,\r\n\t\t\t/* Show step numbers in introduction? */\r\n\t\t\tshowStepNumbers: true,\r\n\t\t\t/* Let user use keyboard to navigate the tour? */\r\n\t\t\tkeyboardNavigation: true,\r\n\t\t\t/* Show tour bullets? */\r\n\t\t\tshowBullets: true,\r\n\t\t\t/* Show tour progress? */\r\n\t\t\tshowProgress: false,\r\n\t\t\t/* Distance of tooltip ... resp tooltip arrow from highlighted box on targeted element */\r\n\t\t\ttooltipDistanceFromTarget: 8,\r\n\r\n\t\t\tdefaultBoardMarginPx: { x: 10, y: 10 },\r\n\r\n\t\t\ttargetExtendPaddingPercent: 10,// percents from the target\r\n\t\t\ttargetExtendPaddingMaxPx: 12,\r\n\r\n\t\t\t//Should we scroll the tooltip target element or both?  Options are: 'element', 'tooltip' or all\r\n\t\t\tscrollTo: 'all',\r\n\t\t\tscrollSpeed: 20, // %\r\n\t\t\tscrollSpeedPerPageMs: 300,\r\n\t\t\tmaxScrollSpeedPerPageMs: 1200,\r\n\r\n\t\t\t/* Precedence of positions, when auto is enabled */\r\n\t\t\tpositionPrecedence: ['bottom', 'top', 'right', 'left', 'center'],\r\n\t\t\t/* Disable an interaction with element? */\r\n\t\t\tenable_interaction: '1',\r\n\r\n\t\t\t/* additional classes to put on the buttons */\r\n\t\t\tbuttonClass: CLASSES_CORE.button,\r\n\r\n\t\t\toverlayOpacityFull: 0.8,\r\n\t\t\toverlayOpacityLight: 0.65,\r\n\t\t\tdefaultWinBoardMarginMobSizeCoef: 1,\r\n\r\n\t\t\tcenterTopBottomPosOffset: 80,\r\n\r\n\t\t\tmax_tooltip_width: 0,\r\n\r\n\t\t\tfollowTargetIntervalInActionMs: 10,\r\n\t\t\tfollowTargetIntervalStandbyMs: 100,\r\n\t\t\tleaveOverlayAlways: false,\r\n\t\t\tcustomTextStylesEn: true,\r\n\t\t\t...FEATURES\r\n\t\t};\r\n\t\tthis.initOverlayOpacity = this.options.overlayOpacityFull;\r\n\t\tthis.eventListeners = new EventListeners();\r\n\t\tthis.resumeFullOverlayOpacity();\r\n\t\tthis.initDebugVisualizer();\r\n\t\tthis.actualizeDocAndScreenAreas();\r\n\t}\r\n\r\n\tinitUserInteraction() {\r\n\t\tif (FEATURES.userInteraction) {\r\n\t\t\tthis.userInteraction = new DpitUserInteraction(\r\n\t\t\t\tthis.options,\r\n\t\t\t\tthis.tooltipRefEl,\r\n\t\t\t\tthis.inHighlightLayerAnimation,\r\n\t\t\t\tthis.onUserInteractionIterateStep.bind(this),\r\n\t\t\t\tthis.onUserInteractionIterateStepInProgress.bind(this),\r\n\t\t\t\tthis.onBeforeUnloadByLinkClick.bind(this)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tgetOnBeforeUnloadByLinkClickConfirmMessage() {\r\n\t\treturn i18n('end-a-tour-q', this.mainCfg.i18n);\r\n\t}\r\n\r\n\tonBeforeUnloadByLinkClick(/*href*/) {\r\n\t\t/*if (window.confirm(this.getOnBeforeUnloadByLinkClickConfirmMessage())) {\r\n\t\t\twindow.location.href = href;\r\n\t\t}*/\r\n\t}\r\n\r\n\tonUserInteractionIterateStepInProgress(started) {\r\n\t\tstarted ? this.disablePointerEvents() : this.enablePointerEvents();\r\n\t\tthis.disableStepChanging(started);\r\n\t}\r\n\r\n\tonUserInteractionIterateStep() {\r\n\t\tif (this.isLastStep() && this.userInteraction) {\r\n\t\t\tthis.userInteraction.update(this.stepItem);\r\n\t\t} else {\r\n\t\t\tthis.goToNextStep();\r\n\t\t}\r\n\t}\r\n\r\n\tresetUserInteraction() {\r\n\t\tif (this.userInteraction) {\r\n\t\t\tthis.userInteraction.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tenableUserInteraction() {\r\n\t\tif (this.userInteraction) {\r\n\t\t\tthis.userInteraction.enable();\r\n\t\t}\r\n\t}\r\n\r\n\tdisableUserInteraction(userInteractionTryWhenDisabledFce) {\r\n\t\tif (this.userInteraction) {\r\n\t\t\tthis.userInteraction.disable(userInteractionTryWhenDisabledFce);\r\n\t\t}\r\n\t}\r\n\r\n\tprintDebugMessage() {\r\n\t\tconsole.log('[dpit] INIT DpitCore: v' + VERSION);\r\n\t}\r\n\r\n\tinitDebugVisualizer() {\r\n\t\tif (IS_DEBUG && VISUALIZE_BB) {\r\n\t\t\timport(/* webpackChunkName: \"DpitDebugVisualizer\" */ './DpitDebugVisualizer').then(module => {\r\n\t\t\t\tthis.debugVisualizer = new module.default(this.wrapEl);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tdoAction(tag, args = {}) {\r\n\t\tif (this.isThisInRun()) {\r\n\t\t\tDpitHooks.doAction(tag, {\r\n\t\t\t\t...this.hookBaseArgs,\r\n\t\t\t\tcurrentStepObj: this.stepObject4Hooks(this.stepItem),\r\n\t\t\t\t...args,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstepObject4Hooks(stepItem) {\r\n\t\tif (!stepItem) return null;\r\n\t\tlet res = {\r\n\t\t\tindex: stepItem.step,\r\n\t\t\ttooltipContent: stepItem.intro,\r\n\t\t\ttooltipPosition: stepItem.position || 'auto',\r\n\t\t\telement: this.isDummyMode() ? null : stepItem.element,\r\n\t\t\tselector: stepItem.selector,\r\n\t\t\tisEnabledInteraction: stepItem.enable_interaction?.val == 1,\r\n\t\t};\r\n\t\t// PRO features\r\n\t\tif (typeof stepItem.url !== 'undefined') {\r\n\t\t\tres = {\r\n\t\t\t\t...res,\r\n\t\t\t\turl: stepItem.url,\r\n\t\t\t\taltMobileSelector: stepItem.alt_mobile_selector,\r\n\t\t\t\tisInMobileMenu: stepItem.is_in_mobile_menu === '1',\r\n\t\t\t\tskipOnBigScreen: stepItem.skip_on_big_screen === '1',\r\n\t\t\t\tskipOnMobile: stepItem.skip_on_mobile == 1\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tstartFollowTarget = (insensitivityFirst = 2, insensitivity = 1) => {\r\n\t\tconst isDummyModeActive = this.isDummyMode();\r\n\t\tif (/*this.isFixedPos ||*/ this.followTargetInterval || !this.options.followTargetEn || !this.stepItem || (isDummyModeActive && !this.targetDummyBkpEl)) return;\r\n\t\tconst isDummyBkpActive = isDummyModeActive && this.targetDummyBkpEl;\r\n\t\tconst currentTargetEl = isDummyBkpActive ? this.targetDummyBkpEl : this.stepItem.element;\r\n\t\tif (!currentTargetEl || !this.tooltipRefEl) return;\r\n\r\n\t\tlet lastTargetBB = DpitBB.fromElement(currentTargetEl);\r\n\t\tconst lastRefBB = DpitBB.fromElement(this.tooltipRefEl);\r\n\t\tlet lastRefDiffBB = DpitBB.diff(lastTargetBB, lastRefBB);\r\n\r\n\r\n\t\tthis.isFollowTargetEnabled = true;\r\n\t\tlet processing = false;\r\n\r\n\r\n\r\n\t\tthis.followTargetInterval = setInterval(() => {\r\n\t\t\tif (!processing && document.hidden /* active tab */\r\n\t\t\t\t|| !currentTargetEl\r\n\t\t\t\t|| !this.tooltipRefEl\r\n\t\t\t\t|| (!$(currentTargetEl).hasClass(CLASSES_CORE.target) && !isDummyBkpActive)\r\n\t\t\t) return;\r\n\t\t\tprocessing = true;\r\n\t\t\tconst insensitivityFinal = !this.isFollowTargetInAction ? insensitivityFirst : insensitivity;\r\n\r\n\t\t\tconst newTargetBB = DpitBB.fromElement(currentTargetEl);\r\n\t\t\tconst newRefBB = DpitBB.fromElement(this.tooltipRefEl);\r\n\t\t\tconst newRefDiffBB = DpitBB.diff(newTargetBB, newRefBB);\r\n\t\t\tconst refDiffAbsDiffBB = DpitBB.diffAbs(lastRefDiffBB, newRefDiffBB);\r\n\t\t\tif (refDiffAbsDiffBB.top > insensitivityFinal\r\n\t\t\t\t|| refDiffAbsDiffBB.left > insensitivityFinal\r\n\t\t\t\t|| refDiffAbsDiffBB.width > insensitivityFinal\r\n\t\t\t\t|| refDiffAbsDiffBB.height > insensitivityFinal\r\n\t\t\t) {\r\n\r\n\t\t\t\tif (!this.isFollowTargetInAction) {\r\n\t\t\t\t\t// first follow change\r\n\t\t\t\t\tif (this.options.dpDebugEn) console.log(`[dpit] STEP ${this.stepIdx} FOLLOW TARGET: STARTED - init target BB:`, lastTargetBB);\r\n\t\t\t\t\tthis.isFollowTargetInAction = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.softRefresh(REFRESH_REASONS.followTarget);\r\n\t\t\t\tlastRefDiffBB = newRefDiffBB;\r\n\t\t\t\tlastTargetBB = newTargetBB;\r\n\r\n\t\t\t}\r\n\t\t\tprocessing = false;\r\n\t\t}, this.isFollowTargetInAction ? this.options.followTargetIntervalInActionMs : this.options.followTargetIntervalStandbyMs);\r\n\t};\r\n\r\n\tpauseFollowTarget() {\r\n\t\tif (this.isFollowTargetEnabled) {\r\n\t\t\tthis.wasFollowTargetEnabled = true;\r\n\t\t\tthis.stopFollowTarget();\r\n\t\t}\r\n\t}\r\n\r\n\trestoreFollowTarget() {\r\n\t\tif (!this.isFollowTargetEnabled && this.wasFollowTargetEnabled) {\r\n\t\t\tthis.startFollowTarget();\r\n\t\t}\r\n\t}\r\n\r\n\tpauseResizeRefresh() {\r\n\t\tthis.isResizeRefreshPaused = true;\r\n\t}\r\n\r\n\trestoreResizeRefresh() {\r\n\t\tthis.isResizeRefreshPaused = false;\r\n\t}\r\n\r\n\tstopFollowTarget() {\r\n\t\tthis.isFollowTargetEnabled = false;\r\n\t\tclearInterval(this.followTargetInterval);\r\n\t\tthis.followTargetInterval = null;\r\n\t}\r\n\r\n\trestartFollowTarget() {\r\n\t\tthis.stopFollowTarget();\r\n\t\tthis.startFollowTarget();\r\n\t}\r\n\r\n\r\n\tshowArrowEl(left, top, tooltipPos, arrowPosId) {\r\n\t\tconst arrowPos = { left, top };\r\n\t\tswitch (tooltipPos.base) {\r\n\t\t\tcase 'left':\r\n\t\t\t\tarrowPos.left = Math.floor(left);\r\n\t\t\t\tarrowPos.top = Math.round(top);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'right':\r\n\t\t\t\tarrowPos.left = Math.ceil(left);\r\n\t\t\t\tarrowPos.top = Math.round(top);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'top':\r\n\t\t\t\tarrowPos.top = Math.floor(top);\r\n\t\t\t\tarrowPos.left = Math.round(left);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bottom':\r\n\t\t\t\tarrowPos.top = Math.ceil(top);\r\n\t\t\t\tarrowPos.left = Math.round(left);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis.hideArrowEl();\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.arrowEl.style.left = arrowPos.left + 'px';\r\n\t\tthis.arrowEl.style.top = arrowPos.top + 'px';\r\n\t\tthis.arrowEl.classList.add(\r\n\t\t\t`${CLASSES_CORE.arrow}--${arrowPosId}`,\r\n\t\t\t`${CLASSES_CORE.arrow}--${tooltipPos.align}-aligned`\r\n\t\t);\r\n\t\tshowElement(this.arrowEl);\r\n\t}\r\n\r\n\thideArrowEl() {\r\n\t\thideElement(this.arrowEl);\r\n\t\tthis.arrowEl.removeAttribute('style');\r\n\t}\r\n\r\n\tactualizeArrowEl(left, top, tooltipPos, arrowPos) {\r\n\t\tif (!this.isDummyMode()) this.showArrowEl(left, top, tooltipPos, arrowPos);\r\n\t\telse this.hideArrowEl();\r\n\t}\r\n\r\n\r\n\tisDummyMode() {\r\n\t\treturn this.targetDummyEl && this.targetDummyEl === this.stepItem.element;\r\n\t}\r\n\r\n\r\n\r\n\tactualizeDummyMode() {\r\n\t\tconst shouldSwitchToDummyMode = this.isDummyMode();\r\n\t\tconst targetElementIsNotVisibleAndNotSkipped = this.stepItem.element\r\n\t\t\t&& !this.options.skip_absent_ref_el\r\n\t\t\t&& shouldSwitchToDummyMode\r\n\t\t\t&& !this.isTargetInMobileMenu;\r\n\t\tif (!this.stepItem.element || targetElementIsNotVisibleAndNotSkipped) {\r\n\t\t\tthis.backupDummy(targetElementIsNotVisibleAndNotSkipped);\r\n\t\t\tthis.activateDummyMode();\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.deactivateDummyMode();\r\n\t\t}\r\n\t}\r\n\r\n\tbackupDummy(targetElementIsNotVisibleAndNotSkipped) {\r\n\t\tthis.targetDummyBkpEl = targetElementIsNotVisibleAndNotSkipped ? this.stepItem.element : null;\r\n\t}\r\n\r\n\r\n\tactivateDummyMode() {\r\n\t\tif (this.stepItem) {\r\n\t\t\tif (!this.targetDummyEl) {\r\n\t\t\t\tthis.targetDummyEl = this.createDummyLayer();\r\n\t\t\t\tthis.wrapEl.appendChild(this.targetDummyEl);\r\n\t\t\t} else {\r\n\t\t\t\tshowElement(this.targetDummyEl);\r\n\t\t\t}\r\n\t\t\tthis.stepItem.element = this.targetDummyEl;\r\n\t\t}\r\n\t}\r\n\r\n\tdeactivateDummyMode() {\r\n\t\thideElement(this.targetDummyEl, false);\r\n\t\tthis.targetDummyBkpEl = null;\r\n\t}\r\n\r\n\r\n\tupdateIndexOfStepItem(stepItem, newZeroBasedIdx) {\r\n\t\tstepItem.step = newZeroBasedIdx + 1;\r\n\t\tstepItem.idx = newZeroBasedIdx;\r\n\t}\r\n\r\n\tinitSteps() {\r\n\t\tlet stepItems = [];\r\n\t\tif (this.options.steps && Array.isArray(this.options.steps)) {\r\n\t\t\tthis.options.steps.forEach((stepConfig, stepIdx) => {\r\n\t\t\t\tconst stepItem = this.deepCloneObject(stepConfig);\r\n\r\n\t\t\t\t//set the step\r\n\t\t\t\tstepItem.step = stepIdx + 1;\r\n\t\t\t\tstepItem.idx = stepIdx;\r\n\t\t\t\tthis.updateIndexOfStepItem(stepItem, stepIdx);\r\n\t\t\t\tstepItem.selector = stepItem.element;\r\n\r\n\t\t\t\tthis.actualizeTargetItem(stepItem, true);\r\n\r\n\t\t\t\tif (typeof (stepItem.enable_interaction) === 'undefined') {\r\n\t\t\t\t\tstepItem.enable_interaction = { val: this.options.enable_interaction };\r\n\t\t\t\t}\r\n\t\t\t\tstepItems.push(stepItem);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.stepItems = stepItems;\r\n\t\treturn this.stepItems.length > 0;\r\n\t}\r\n\r\n\t/**\r\n\t* Start a new intro tour\r\n\t*\r\n\t* @api private\r\n\t* @method startCore\r\n\t* @returns {Boolean} Success or not?\r\n\t*/\r\n\tstartCore(isBackward = false, startStep = 0) {\r\n\t\t//set it to the DpitCore object\r\n\t\tif (this.initSteps()) {\r\n\t\t\tthis.startCoreBasic(isBackward, startStep);\r\n\t\t}\r\n\t}\r\n\r\n\tstartCoreBasic(isBackward, startStep) {\r\n\t\tthis.ending = false;\r\n\t\tthis.enableKeyboardNavig();\r\n\t\tthis.init();\r\n\t\tthis.actualizeScrollSpeedOptions(this.options.scrollSpeed);\r\n\t\tthis.actualizeDocAndScreenAreas();\r\n\t\tthis.doAction(EVENTS.started);\r\n\t\tthis.isPortraitOrientation = this.isScreenPortraitOrientation(this.winBB);\r\n\t\tconst startStepNum = Number(startStep);\r\n\t\tif (!this.goToStep(isNaN(startStepNum) ? 0 : startStepNum, isBackward)) {\r\n\t\t\tthis.showBackgroundOverlay();\r\n\t\t}\r\n\t}\r\n\r\n\tonOverlayClick() {\r\n\t\tif (this.options.exitOnOverlayClick === true && this.isRunning) {\r\n\t\t\tthis.exitCoreWithHiddenOverlay('skip');\r\n\t\t}\r\n\t\tthis.doAction(EVENTS.onOverlayClick);\r\n\t}\r\n\r\n\tsetOption = (option, value) => {\r\n\t\tthis.options[option] = value;\r\n\t};\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = {\r\n\t\t\t...this.options,\r\n\t\t\t...options\r\n\t\t};\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name];\r\n\t}\r\n\r\n\tprocessBeforeStepChange(newStepItem, prevStepItem) {\r\n\t\tlet beforeChangeRes = RES_PROCESS_ASYNC.continue;\r\n\t\tthis.finalizeRefreshCounter = 0;\r\n\t\tif (this.beforeStepChangeCallback instanceof Function) {\r\n\t\t\tbeforeChangeRes = this.beforeStepChangeCallback(newStepItem, this.isBackward, prevStepItem);\r\n\t\t}\r\n\r\n\t\treturn beforeChangeRes;\r\n\t}\r\n\r\n\r\n\tasync goToStep(stepIdxZeroBased, isBackward = false) {\r\n\t\tif (this.isStepChangingDisabled\r\n\t\t\t|| !this.stepItems\r\n\t\t\t|| stepIdxZeroBased < 0\r\n\t\t\t|| stepIdxZeroBased >= this.stepItems.length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tawait asyncWait(50);\r\n\r\n\t\tthis.prevStepItem = this.stepItem;\r\n\t\tthis.isBackward = isBackward;\r\n\r\n\t\tconst newStepItem = this.stepItems[stepIdxZeroBased];\r\n\t\tif (this.prevStepItem?.step) {\r\n\t\t\tthis.isBackward = newStepItem.step < this.prevStepItem.step;\r\n\t\t}\r\n\t\tconst beforeChangeRes = this.processBeforeStepChange(newStepItem, this.prevStepItem);\r\n\r\n\t\tswitch (beforeChangeRes) {\r\n\t\t\tcase RES_PROCESS_ASYNC.continue:\r\n\t\t\t\tthis.doAction(EVENTS.beforeStepChange, {\r\n\t\t\t\t\tnextStepObj: this.stepObject4Hooks(newStepItem),\r\n\t\t\t\t\tbackward: this.isBackward,\r\n\t\t\t\t\tcurrentStepObj: this.stepObject4Hooks(this.prevStepItem)\r\n\t\t\t\t}); break;\r\n\t\t\tcase RES_PROCESS_ASYNC.skip: return this.goToStep(stepIdxZeroBased + (this.isBackward ? -1 : 1));\r\n\t\t\tcase RES_PROCESS_ASYNC.abort:\r\n\t\t\t\tthis.disconnectListeners();\r\n\t\t\t\tthis.ending = true;\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.resetCoreOnStepChanged();\r\n\t\tthis.actualizeCurrentStep(newStepItem);\r\n\t\t$(document.documentElement).stop(true, false);\r\n\t\tthis.showStep();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tactualizeCurrentStep(newStepItem) {\r\n\t\tif (this.stepItem) $(document.documentElement).removeClass(CLASSES_CORE.stepSpecifier + '-' + this.stepItem.step);\r\n\t\tif (newStepItem) {\r\n\t\t\t$(document.documentElement).addClass(CLASSES_CORE.stepSpecifier + '-' + newStepItem.step);\r\n\t\t\tthis.stepItem = newStepItem;\r\n\t\t\tthis.stepIdx = newStepItem.idx;\r\n\t\t}\r\n\t}\r\n\r\n\tgoToStepByStepLabel = (stepLabel) => {\r\n\t\tconst stepNumLabel = Number(stepLabel);\r\n\t\tif (!Number.isNaN(stepNumLabel)) {\r\n\t\t\tthis.goToStep(stepLabel - 1);\r\n\t\t}\r\n\t};\r\n\r\n\tgoToPrevStep() {\r\n\t\treturn this.goToStep(this.stepIdx - 1);\r\n\t}\r\n\r\n\tgoToNextStep() {\r\n\t\treturn this.goToStep(this.stepIdx + 1);\r\n\t}\r\n\r\n\r\n\tonSkipButtonClick() {\r\n\t\tthis.exitCoreWithHiddenOverlay('skip');\r\n\t}\r\n\r\n\r\n\r\n\tbringOverlayAboveIntroLayers = (cbEnd) => {\r\n\t\tif (this.overlayContainer) this.overlayContainer.classList.add(CLASSES_CORE.overlayContainer + MODIFIERS.above);\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (cbEnd) cbEnd();\r\n\t\t}, this.overlayContainerTransitionDelayMs);\r\n\t};\r\n\r\n\thideLayers = (byOpacity, noSpace, noTransition, ...args) => {\r\n\t\tif (args.length) {\r\n\t\t\targs.forEach(layer => {\r\n\t\t\t\thideElement(layer, byOpacity, noSpace, noTransition);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tshowLayers = (...args) => {\r\n\t\tif (args.length) {\r\n\t\t\targs.forEach(layer => { showElement(layer); });\r\n\t\t}\r\n\t};\r\n\r\n\thideIntroLayers(noSpace = false, byOpacity = true, noTransition = false) {\r\n\t\t//if (IS_DEBUG) return;\r\n\t\tthis.hideLayers(byOpacity, noSpace, noTransition, this.userInteraction?.disableInteractionLayer, this.tooltipRefEl);\r\n\t\tif (this.highlightEl) {\r\n\t\t\tthis.highlightEl.classList.add(CLASSES_CORE.highlight + MODIFIERS.hidden);\r\n\t\t\tthis.highlightEl.removeAttribute('style');\r\n\t\t}\r\n\t}\r\n\r\n\thideIntroLayersWithShownBgOverlay(noSpace = false, byOpacity = true, noTransition = false) {\r\n\t\tthis.showBackgroundOverlay();\r\n\t\tthis.hideIntroLayers(noSpace, byOpacity, noTransition);\r\n\t}\r\n\r\n\tshowIntroLayers() {\r\n\t\tif (!this.ending) this.hideBackgroundOverlay();\r\n\t\tif (this.highlightEl) {\r\n\t\t\thideElement(this.highlightEl, true, true, true);\r\n\t\t\tthis.highlightEl.classList.remove(CLASSES_CORE.highlight + MODIFIERS.hidden);\r\n\t\t}\r\n\t\tthis.showLayers(this.tooltipRefEl, this.highlightEl, this.userInteraction?.disableInteractionLayer, this.wrapEl);\r\n\t}\r\n\r\n\tconnectListeners() {\r\n\t\tif (!this.listenersConnected) {\r\n\t\t\tthis.listenersConnected = true;\r\n\t\t\tthis.eventListeners.add(this.overlayEl, 'click', this.onOverlayClick.bind(this));\r\n\r\n\t\t\tthis.eventListeners.add(window, 'keydown', this.onKeyDown.bind(this));\r\n\t\t\tthis.eventListeners.add(window, 'resize', this.onResize.bind(this));\r\n\r\n\r\n\t\t\t//this.eventListeners.add(document.documentElement, 'scroll wheel DOMMouseScroll mousewheel touchmove', this.stopAutoScrollWhenUserAction.bind(this));\r\n\t\t\tthis.eventListeners.add(document.documentElement, 'scroll', this.stopAutoScrollWhenUserAction.bind(this));\r\n\t\t\tthis.eventListeners.add(document.documentElement, 'wheel', this.stopAutoScrollWhenUserAction.bind(this));\r\n\t\t\tthis.eventListeners.add(document.documentElement, 'DOMMouseScroll', this.stopAutoScrollWhenUserAction.bind(this));\r\n\t\t\tthis.eventListeners.add(document.documentElement, 'mousewheel', this.stopAutoScrollWhenUserAction.bind(this));\r\n\t\t\tthis.eventListeners.add(document.documentElement, 'touchmove', this.stopAutoScrollWhenUserAction.bind(this));\r\n\r\n\t\t\tif (this.buttonCancelEl) this.eventListeners.add(this.buttonCancelEl, 'click', this.onSkipButtonClick.bind(this));\r\n\t\t\tif (this.buttonPrevEl) this.eventListeners.add(this.buttonPrevEl, 'click', this.goToPrevStep.bind(this));\r\n\t\t\tif (this.buttonNextEl) this.eventListeners.add(this.buttonNextEl, 'click', this.goToNextStep.bind(this));\r\n\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tdisconnectListeners() {\r\n\t\tif (this.listenersConnected) {\r\n\t\t\tthis.listenersConnected = false;\r\n\t\t\tthis.eventListeners.removeAll();\r\n\t\t}\r\n\t}\r\n\r\n\tfinalizeExit() {\r\n\t\t$(this.wrapEl).empty();\r\n\t\tthis.highlightEl = null;\r\n\t\tthis.arrowIcoWrapData = null;\r\n\t\tthis.cancelButtonIcoWrapEl = null;\r\n\t\tthis.overlayContainer = null;\r\n\t\tthis.stepIdx = undefined;\r\n\t\tthis.initialized = false;\r\n\r\n\t}\r\n\r\n\tasync exitingProcess(leaveActiveOverlay, reason, isRedirect) {\r\n\t\tif (this.targetDummyEl) {\r\n\t\t\tthis.targetDummyEl.parentNode.removeChild(this.targetDummyEl);\r\n\t\t\tthis.targetDummyEl = null;\r\n\t\t}\r\n\t\tthis.resetCore(false, false, true);\r\n\t\tthis.disableKeyboardNavig();\r\n\r\n\t\tif (isRedirect) return;\r\n\t\tthis.hideShadowOverlay();\r\n\t\tthis.resetCore(true);\r\n\t\tawait asyncWait(TIMING.finalizeExit);\r\n\r\n\t\tthis.doAction(EVENTS.ended, { reason });\r\n\t\tthis.finalizeExit();\r\n\t}\r\n\r\n\texitCoreWithHiddenOverlay(reason) {\r\n\t\tthis.exitCore(false, false, reason);\r\n\t}\r\n\r\n\tenablePointerEvents() {\r\n\t\tif (this.wrapEl) this.wrapEl.style.pointerEvents = '';\r\n\t\tif (this.tooltipEl) this.tooltipEl.style.pointerEvents = '';\r\n\t}\r\n\r\n\tdisablePointerEvents() {\r\n\t\tif (this.wrapEl) this.wrapEl.style.pointerEvents = 'none';\r\n\t\tif (this.tooltipEl) this.tooltipEl.style.pointerEvents = 'none';\r\n\t}\r\n\r\n\texitCore = (leaveActiveOverlay = false, force = false, reason = '', isRedirect = false, disableAnimation = false) => {\r\n\t\tthis.ending = true;\r\n\t\tif (this.options.leaveOverlayAlways) leaveActiveOverlay = true;\r\n\r\n\t\tthis.doAction(EVENTS.onBeforeEnd, { reason });\r\n\r\n\t\t// calling onBeforeEnd callback\r\n\t\t// If this callback return `false`, it would halt the process\r\n\t\tlet continueExit = true;\r\n\t\tif (this.onBeforeEndCallback instanceof Function) {\r\n\t\t\tcontinueExit = this.onBeforeEndCallback(this);\r\n\t\t}\r\n\t\t// skip this check if `force` parameter is `true`\r\n\t\t// otherwise, if `onBeforeEnd` returned `false`, don't exit the intro\r\n\t\tif (!force && continueExit === false) return;\r\n\r\n\t\tthis.disablePointerEvents();\r\n\t\tthis.disableKeyboardNavig();\r\n\t\tthis.showBackgroundOverlay();\r\n\t\tthis.bringOverlayAboveIntroLayers(() => {\r\n\r\n\t\t\tif (!this.tourCfg.properties.disableStartAnimation && !disableAnimation) {\r\n\r\n\t\t\t\tthis.startFullScreenAnimation(true);\r\n\t\t\t\tif (!isRedirect) {\r\n\t\t\t\t\tthis.stopFullScreenAnimationAfterLoopEnd(() => {\r\n\t\t\t\t\t\tthis.exitingProcess(leaveActiveOverlay, reason, isRedirect);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.exitingProcess(leaveActiveOverlay, reason, isRedirect);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\r\n\r\n\tisInRun() {\r\n\t\treturn document.documentElement.classList.contains(CLASSES_CORE.tourInRun);\r\n\t}\r\n\r\n\tisThisInRun() {\r\n\t\treturn this.isRunning;\r\n\t}\r\n\r\n\tenableKeyboardNavig() {\r\n\t\tthis.keyboardNavigEnabled = true;\r\n\t}\r\n\r\n\tdisableKeyboardNavig() {\r\n\t\tthis.keyboardNavigEnabled = false;\r\n\t}\r\n\r\n\tdisableStepChanging(disable) {\r\n\t\tthis.isStepChangingDisabled = disable;\r\n\t}\r\n\r\n\tsoftenOverlayOpacity(lightOverlayOpacity = this.options.overlayOpacityLight) {\r\n\t\tupdateCssVar('--overlay-opacity', lightOverlayOpacity);\r\n\t}\r\n\r\n\tresumeFullOverlayOpacity() {\r\n\t\tupdateCssVar('--overlay-opacity', this.options.overlayOpacityFull);\r\n\t}\r\n\r\n\tactualizeHighlightBorder(targetPureBB, numberElBB) {\r\n\r\n\t\tlet minExtensionSize = { tb: 4, lr: 4 };\r\n\t\tlet maxExtensionSize = {\r\n\t\t\ttb: this.options.targetExtendPaddingMaxPx,\r\n\t\t\tlr: this.options.targetExtendPaddingMaxPx\r\n\t\t};\r\n\r\n\t\tif (numberElBB) {\r\n\t\t\tminExtensionSize = {\r\n\t\t\t\ttb: numberElBB.height / 4,\r\n\t\t\t\tlr: numberElBB.width / 4\r\n\t\t\t};\r\n\t\t\tmaxExtensionSize = {\r\n\t\t\t\ttb: numberElBB.height / 3,\r\n\t\t\t\tlr: numberElBB.width / 3\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst highlightExtensionSizeBase = {\r\n\t\t\ttb: Math.ceil(targetPureBB.height * this.options.targetExtendPaddingPercent / 100),\r\n\t\t\tlr: Math.ceil(targetPureBB.width * this.options.targetExtendPaddingPercent / 100)\r\n\t\t};\r\n\r\n\t\tconst highlightExtensionSizeTbLr = {\r\n\t\t\ttb: Math.max(Math.min(highlightExtensionSizeBase.tb, maxExtensionSize.tb), minExtensionSize.tb),\r\n\t\t\tlr: Math.max(Math.min(highlightExtensionSizeBase.lr, maxExtensionSize.lr), minExtensionSize.lr)\r\n\t\t};\r\n\r\n\t\tthis.highlightExtensionPx = Math.min(highlightExtensionSizeTbLr.tb, highlightExtensionSizeTbLr.lr);\r\n\r\n\t\tconst borderWidthCoef = this.stepItem.highlight === 'full_border' ? 1 : 0.5;\r\n\t\tconst highlightBorderWidth = Math.ceil(borderWidthCoef * this.highlightExtensionPx);\r\n\t\tupdateCssVar('--highlight-border-width', highlightBorderWidth + 'px');\r\n\t}\r\n\r\n\tcalculateTargetBBs(actualizeHighlightBorder = true) {\r\n\r\n\t\tif (this.stepItem && this.stepItem.element) {\r\n\r\n\t\t\t//const targetPureBox = TheBox.getBox(this.stepItem.element);\r\n\t\t\tthis.targetPureBB = DpitBB.fromElement(this.stepItem.element, this.isFixedPos);\r\n\t\t\t//console.log(targetPureBox, this.targetPureBB);\r\n\t\t\tif (actualizeHighlightBorder) {\r\n\t\t\t\tthis.actualizeHighlightBorder(this.targetPureBB, this.numberElBBSizeStandard);\r\n\t\t\t}\r\n\t\t\tthis.targetBB = DpitBB.extend(this.targetPureBB, this.highlightExtensionPx);\r\n\t\t\tif (this.docBB) {\r\n\t\t\t\tconst intersectionBB = DpitBB.intersect(this.targetBB, this.docBB);\r\n\t\t\t\tif (intersectionBB) this.targetBB = intersectionBB;\r\n\t\t\t}\r\n\t\t\tthis.actualizeBoardSizes();\r\n\t\t\tif (this.debugVisualizer) this.debugVisualizer.visualizeBoards(/*this.docBoardBB*/this.docBoardBB, this.winBoardBB, this.docBB, this.winBB);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tunsubscribeEvent(eventId, providedCallback) {\r\n\t\tthis.subscribeEvent(eventId, providedCallback, true);\r\n\t}\r\n\r\n\tsubscribeEvent(eventId, providedCallback, unsubscribe = false) {\r\n\r\n\t\tif (typeof (providedCallback) === 'function') {\r\n\t\t\tif (eventId in EVENTS) {\r\n\t\t\t\tif (unsubscribe) DpitHooks.removeAction(eventId, providedCallback);\r\n\t\t\t\telse DpitHooks.addAction(eventId, providedCallback);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthrow new Error(`Provided event name ${eventId} was not recognized. Choose from: ${EVENTS.values().join(',')}`);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error(`Provided callback for ${eventId} was not a function.`);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpauseRefreshers(all = true) {\r\n\t\tthis.pauseFollowTarget();\r\n\t\tif (all) this.pauseResizeRefresh();\r\n\t}\r\n\r\n\trestoreRefreshers() {\r\n\t\tthis.restoreFollowTarget();\r\n\t\tthis.restoreResizeRefresh();\r\n\t}\r\n\r\n\tstartRefreshers() {\r\n\t\tthis.startFollowTarget();\r\n\t\tthis.restoreResizeRefresh();\r\n\t}\r\n\r\n\tgetTourIdPostfix(prefix = CLASSES_CORE.tourInRun) {\r\n\t\treturn `${prefix}-${this.tourId}`;\r\n\t}\r\n\r\n\r\n\tresetCoreOnStepChanged() {\r\n\t\tthis.didOrientationChanged = false;\r\n\t\tthis.currentNumberPos = null;\r\n\t}\r\n\r\n\tresetCore(hardReset = true, forceHideLayers = false, doNotHideIntroLayers = false) {\r\n\t\tif ((!IS_DEBUG || forceHideLayers) && !doNotHideIntroLayers) this.hideIntroLayers(hardReset);\r\n\t\tthis.clearFixedMode();\r\n\t\t//this.insertDisableInteractionLayer();\r\n\t\tthis.pauseRefreshers(hardReset);\r\n\r\n\t\tif (hardReset) {\r\n\t\t\tthis.resetUserInteraction();\r\n\t\t\tthis.resetTargetElement();\r\n\t\t\tthis.actualizeCurrentStep(null);\r\n\t\t\tthis.actualizeTheme(null);\r\n\t\t\tthis.disableKeyboardNavig();\r\n\t\t\tthis.disconnectListeners();\r\n\t\t\tthis.clearMobileMenuTarget();\r\n\t\t}\r\n\t\tif (this.debugVisualizer) {\r\n\t\t\tif (hardReset) this.debugVisualizer.destroy();\r\n\t\t\telse this.debugVisualizer.clearStepVisualizers();\r\n\t\t}\r\n\t}\r\n\r\n\tunplugTheme() {\r\n\r\n\t}\r\n\r\n\tpauseTour(addDocumentClass = '') {\r\n\t\tthis.resetCore(true, true);\r\n\t\tdocument.documentElement.classList.remove(CLASSES_CORE.tourInRun);\r\n\t\tdocument.documentElement.classList.add(CLASSES_CORE.pause);\r\n\t\tif (addDocumentClass) document.documentElement.classList.add(addDocumentClass);\r\n\t}\r\n\r\n\tisPaused() {\r\n\t\treturn document.documentElement.classList.contains(CLASSES_CORE.pause);\r\n\t}\r\n\r\n\trestoreTour(removeDocumentClass = '', reason = REFRESH_REASONS.restore) {\r\n\t\tdocument.documentElement.classList.add(CLASSES_CORE.tourInRun);\r\n\t\tdocument.documentElement.classList.remove(CLASSES_CORE.pause);\r\n\t\tif (removeDocumentClass) document.documentElement.classList.remove(removeDocumentClass);\r\n\t\tthis.enableKeyboardNavig();\r\n\t\tthis.connectListeners();\r\n\t\tthis.restoreRefreshers();\r\n\t\tthis.hardRefresh(reason);\r\n\t}\r\n\r\n\r\n\tsetInRunClasses() {\r\n\t\tdocument.documentElement.classList.add(CLASSES_CORE.tourInRun, this.getTourIdPostfix());\r\n\t}\r\n\r\n\tclearInRunClasses() {\r\n\t\tdocument.documentElement.classList.remove(CLASSES_CORE.tourInRun, this.getTourIdPostfix());\r\n\t}\r\n\r\n\t/*switchTheme(theme, disableAnimation = false) {\r\n\r\n\t\tif (!this.tourCfg.properties.disableStartAnimation && !disableAnimation) {\r\n\t\t\tthis.resetCore(false);\r\n\t\t\tthis.startFullScreenAnimation(true, 1, () => {\r\n\t\t\t\t\r\n\t\t\r\n\t\t\t\tthis.actualizeTheme(theme);\r\n\t\t\t\tthis.startFullScreenAnimation(false, 1, () => {\r\n\t\t\t\t\tthis.restoreTour();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.actualizeTheme(theme);\r\n\t\t}\r\n\t}*/\r\n\r\n\r\n\tshowShadowOverlay() {\r\n\t\tif (this.highlightEl) this.highlightEl.classList.remove(CLASSES_CORE.highlight + MODIFIERS.noOverlay);\r\n\t}\r\n\r\n\thideShadowOverlay() {\r\n\t\tif (this.highlightEl) this.highlightEl.classList.add(CLASSES_CORE.highlight + MODIFIERS.noOverlay);\r\n\t}\r\n\r\n\tactualizeShadowOverlay() {\r\n\t\tif (this.hasTargetItemHiddenOverlay(this.stepItem)) {\r\n\t\t\tthis.hideShadowOverlay();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.showShadowOverlay();\r\n\t\t}\r\n\r\n\t\tif (this.isDummyMode()) {\r\n\t\t\tthis.highlightEl.classList.add(CLASSES_CORE.highlight + MODIFIERS.dummy);\r\n\t\t\tthis.wrapEl.classList.add(CLASSES_CORE.wrap + MODIFIERS.dummy);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.highlightEl.classList.remove(CLASSES_CORE.highlight + MODIFIERS.dummy);\r\n\t\t\tthis.wrapEl.classList.remove(CLASSES_CORE.wrap + MODIFIERS.dummy);\r\n\t\t}\r\n\t}\r\n\r\n\tshowBackgroundOverlay() {\r\n\t\tif (this.overlayContainer) this.overlayContainer.classList.remove(CLASSES_CORE.hiddenKeepEvents);\r\n\t\t//showElement(this.overlayContainer);\r\n\t\t//this.overlayContainer.classList.add(CLASSES_CORE.overlayContainer + MODIFIERS.anim);\r\n\t}\r\n\r\n\thideBackgroundOverlay() {\r\n\t\tif (this.overlayContainer) this.overlayContainer.classList.add(CLASSES_CORE.hiddenKeepEvents);\r\n\t\t//hideElement(this.overlayContainer, true);\r\n\t\t//this.overlayContainer.classList.remove(CLASSES_CORE.overlayContainer + MODIFIERS.anim);\r\n\t}\r\n\r\n\tstartFullScreenAnimation(backward = false, loops = -1, loopsPassedCb = null) {\r\n\t\tthis.initBGOverlayLayer();\r\n\t\tthis.showBackgroundOverlay();\r\n\t\tthis.bulletsAnimation.start(backward, loops, () => {\r\n\t\t\tif (loopsPassedCb instanceof Function) loopsPassedCb();\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tstopFullScreenAnimationAfterLoopEnd(finishCallback = null, hideBackgroundOverlay = true) {\r\n\t\tthis.bulletsAnimation.stopAfterLoopEnd(() => {\r\n\t\t\tif (finishCallback instanceof Function) finishCallback();\r\n\t\t\tif (hideBackgroundOverlay) this.hideBackgroundOverlay();\r\n\t\t});\r\n\t}\r\n\r\n\tstopFullScreenAnimation() {\r\n\t\tthis.bulletsAnimation.stop();\r\n\t\tthis.hideBackgroundOverlay();\r\n\t}\r\n\r\n\r\n\tsetAsRunningTour(callbacksFromSecLayer = {}) {\r\n\t\tif (!window.DpitApi && !this.options.disableApi) window.DpitApi = {\r\n\t\t\t...callbacksFromSecLayer,\r\n\t\t\t[COMMANDS.goToNext]: () => this.goToNextStep(),\r\n\t\t\t[COMMANDS.goToPrev]: () => this.goToPrevStep(),\r\n\t\t\t[COMMANDS.goToStep]: (stepLabel) => this.goToStepByStepLabel(stepLabel),\r\n\t\t\t[COMMANDS.exit]: () => this.exitCoreWithHiddenOverlay('skip'),\r\n\t\t\t[COMMANDS.setAccent]: (color) => this.actualizeAccentColor(color),\r\n\t\t\t[COMMANDS.getScrollSpeed]: () => this.tourCfg?.properties?.scrollSpeed,\r\n\t\t\t[COMMANDS.setScrollSpeed]: (scrollSpeedOption) => this.actualizeScrollSpeedOptions(scrollSpeedOption),\r\n\t\t\t[COMMANDS.setCoreOptions]: (options) => this.setOptions(options),\r\n\t\t\t[COMMANDS.getCoreOptions]: (key) => this.getOption(key)\r\n\t\t};\r\n\t\tthis.setInRunClasses();\r\n\r\n\t\tthis.isRunning = true;\r\n\t}\r\n\r\n\tresetAsRunningTour() {\r\n\t\tthis.clearInRunClasses();\r\n\t\twindow.DpitApi = null;\r\n\t\tthis.isRunning = false;\r\n\t}\r\n\r\n\r\n\r\n\tsetRadiuses() {\r\n\t\tif (this.tourCfg.tooltip_radius !== '' && this.tourCfg.tooltip_radius >= 0) {\r\n\t\t\tupdateCssVar('--tooltip-border-radius', this.tourCfg.tooltip_radius + 'px');\r\n\t\t}\r\n\t\tif (this.tourCfg.highlight_radius !== '' && this.tourCfg.highlight_radius >= 0) {\r\n\t\t\tupdateCssVar('--highlight-border-radius', this.tourCfg.highlight_radius + 'px');\r\n\t\t}\r\n\t\tif (this.tourCfg.button_radius !== '' && this.tourCfg.button_radius >= 0) {\r\n\t\t\tupdateCssVar('--button-border-radius', this.tourCfg.button_radius + 'px');\r\n\t\t\tupdateCssVar('--button-border-radius-sm', 0.3 * this.tourCfg.button_radius + 'px');\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Actualize tour accent color \r\n\t *\r\n\t * @param {String|DpitColor} accentColor\r\n\t */\r\n\tactualizeAccentColor(accentColorDefinition) {\r\n\r\n\t\tif (document.documentElement) {\r\n\t\t\tif (accentColorDefinition) {\r\n\r\n\t\t\t\tconst accentColor = new DpitColor(accentColorDefinition);\r\n\t\t\t\taccentColor.setAsCssVariable('--accent-color');\r\n\t\t\t\tconst accentContrastColor = DpitColorAnalyze.getContrastColor(accentColor, false);\r\n\t\t\t\taccentContrastColor.setAsCssVariable('--accent-contrast-color');\r\n\t\t\t\tconst accentContrastInvColor = DpitColorAnalyze.getContrastColor(accentContrastColor, false);\r\n\t\t\t\taccentContrastInvColor.setAsCssVariable('--accent-contrast-inv-color');\r\n\r\n\t\t\t\taccentColor.mix(accentContrastColor, 0.2).setAsCssVariable('--accent-color-gentle');\r\n\t\t\t\taccentContrastColor.mix(accentContrastInvColor, 0.25).setAsCssVariable('--accent-contrast-color-gentle');\r\n\t\t\t\taccentContrastInvColor.mix(accentContrastColor, 0.25).setAsCssVariable('--accent-contrast-inv-color-gentle');\r\n\t\t\t\tif (accentContrastColor.isDark()) document.documentElement.classList.add(CLASSES_CORE.lightAccent);\r\n\t\t\t\telse document.documentElement.classList.remove(CLASSES_CORE.lightAccent);\r\n\t\t\t\tthis.tourCfg.accentColor = accentColor;\r\n\t\t\t} else {\r\n\t\t\t\tdocument.documentElement.style.removeProperty('--accent-color');\r\n\t\t\t\tdocument.documentElement.style.removeProperty('--accent-contrast-color');\r\n\t\t\t\tdocument.documentElement.style.removeProperty('--accent-color-gentle');\r\n\t\t\t\tdocument.documentElement.style.removeProperty('--accent-contrast-inv-color');\r\n\t\t\t\tdocument.documentElement.style.removeProperty('--accent-contrast-color-gentle');\r\n\t\t\t\tdocument.documentElement.style.removeProperty('--accent-contrast-inv-color-gentle');\r\n\t\t\t\tdocument.documentElement.classList.remove(CLASSES_CORE.lightAccent);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tstatic getThemeClassName(theme) {\r\n\t\treturn CLASSES_CORE.themeSpecifier + '-' + theme;\r\n\t}\r\n\r\n\tactualizeThemeSpecifier(newTheme, currentTheme) {\r\n\t\tif (document.documentElement) {\r\n\t\t\tif (currentTheme) {\r\n\t\t\t\tdocument.documentElement.classList.remove(DpitCore.getThemeClassName(currentTheme));\r\n\t\t\t}\r\n\t\t\tif (newTheme) {\r\n\t\t\t\tdocument.documentElement.classList.add(DpitCore.getThemeClassName(newTheme));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tinitThemeOptions(themeOverride, accentColorOverride) {\r\n\t\tthis.actualizeTheme(themeOverride ?? this.tourCfg.theme);\r\n\t\tthis.actualizeAccentColor(accentColorOverride ?? this.tourCfg.accentColor);\r\n\t\tthis.setRadiuses(this.tourCfg);\r\n\t\tsetTextStyles(this.tourCfg?.text_styles, this.winBB, this.mainCfg?.mobile_break_points?.mobile);\r\n\t}\r\n\r\n\r\n\r\n\tactualizeTheme(theme, accentColorOverride = null) {\r\n\t\tthis.actualizeThemeSpecifier(theme, this.tourCfg.theme);\r\n\t\tif (theme) this.tourCfg.theme = theme;\r\n\t\tthis.tooltipPadding = {\r\n\t\t\tleft: getCssValFloat(this.tooltipEl, 'padding-left', 20),\r\n\t\t\tright: getCssValFloat(this.tooltipEl, 'padding-right', 20)\r\n\t\t};\r\n\t\tthis.actualizeAccentColor(accentColorOverride ?? this.tourCfg.accentColor);\r\n\t}\r\n\r\n\tisProgressBarEnabled() {\r\n\t\treturn this.options.showProgress && this.stepItems.length > 1;\r\n\t}\r\n\r\n\tisStickyTheme() {\r\n\t\treturn document.documentElement.classList.contains('dpit-theme-sticky');\r\n\t}\r\n\r\n\r\n\tactualizeWrapperSize(docBB) {\r\n\t\tDpitBB.toElement(this.wrapEl, docBB);\r\n\t\t//this.wrapEl.style.bottom = \r\n\t}\r\n\r\n\tactualizeDocAndScreenAreas(actualizeBoardSizes = true) {\r\n\t\tthis.docBB = getDocBB();\r\n\t\tthis.actualizeWrapperSize(this.docBB);\r\n\t\tthis.winBB = getWinBB();\r\n\t\tif (!this.oldDocBB) this.oldDocBB = { ...this.docBB };\r\n\t\tthis.isMobileSize = this.getIsMobileSize();\r\n\t\tupdateCssVar('--highlight-shadow-spread', round1dec(Math.sqrt(Math.pow(this.docBB.width, 2) + Math.pow(this.docBB.height, 2))) + 'px');\r\n\t\tBrowserSupport.vHFix();\r\n\t\tsetMobileSizeCoef(this.tourCfg?.text_styles, this.winBB, this.mainCfg?.mobile_break_points?.mobile);\r\n\t\tthis.actualizeBulletsAnimationSize();\r\n\t\tif (actualizeBoardSizes) this.actualizeBoardSizes();\r\n\t}\r\n\r\n\tactualizeBoardSizes() {\r\n\t\tthis.windowMargin = this.getBoardMargin(this.targetBB, true);\r\n\t\tthis.docMargin = this.getBoardMargin(this.targetBB, false);\r\n\t\tthis.docBoardBB = this.getBoardBB(true);\r\n\t\tthis.actualizeScreenArea();\r\n\t\tthis.actualizeTooltipMinWidth();\r\n\t\tif (this.debugVisualizer) this.debugVisualizer.visualizeBoards(this.docBoardBB, this.winBoardBB, this.docBB, this.winBB);\r\n\t}\r\n\r\n\tactualizeScreenArea() {\r\n\t\tthis.winBoardBB = this.getBoardBB(false);\r\n\t}\r\n\r\n\tisResizeWithOrientationToggle(currentWinBB, oldWinBB) {\r\n\t\treturn this.isScreenPortraitOrientation(currentWinBB) !== this.isScreenPortraitOrientation(oldWinBB);\r\n\t}\r\n\r\n\tisResizeWithMajorAreaChange(currentWinBB, oldWinBB, relativeThreshold = 0.4) {\r\n\t\tconst currentArea = DpitBB.area(currentWinBB);\r\n\t\tconst oldArea = DpitBB.area(oldWinBB);\r\n\t\treturn Math.abs(currentArea - oldArea) > relativeThreshold * currentArea;\r\n\t}\r\n\r\n\tgetResizeReactionAndType(currentWinBB, oldWinBB) {\r\n\t\tconst isOrientationToggle = oldWinBB && this.isResizeWithOrientationToggle(currentWinBB, oldWinBB);\r\n\t\tif (isOrientationToggle) {\r\n\t\t\treturn { reaction: RESIZE_REACTION.hard, type: RESIZE_TYPE.orientationToggle, isOrientationToggle };\r\n\t\t}\r\n\t\tconst isMajorAreaChange = this.isResizeWithMajorAreaChange(currentWinBB, oldWinBB);\r\n\t\tif (isMajorAreaChange) {\r\n\t\t\treturn { reaction: RESIZE_REACTION.hard, type: RESIZE_TYPE.majorAreaChange, isOrientationToggle };\r\n\t\t}\r\n\t\tif (/*currentWinBB.height != this.winBB.height &&*/ currentWinBB.width === this.winBB.width) {\r\n\t\t\t// Android Chrome address bar \r\n\t\t\treturn { reaction: RESIZE_REACTION.none, type: RESIZE_TYPE.mobUrlBarVisibilityToggle, isOrientationToggle };\r\n\t\t\t// TODO getMobileAddressBarHeight\r\n\t\t\t/*\r\n\t\t\tif (currentWinBB.height < this.winBB.height) {\r\n\t\t\t\t// Android Chrome address bar has appeared\r\n\t\t\t} else {\r\n\t\t\t\t// Android Chrome address bar has disappeared\r\n\t\t\t}*/\r\n\t\t}\r\n\t\treturn { reaction: RESIZE_REACTION.soft, type: RESIZE_TYPE.minorAreaChange, isOrientationToggle };\r\n\t}\r\n\r\n\tactualizeBulletsAnimationSize() {\r\n\t\tif (this.tourCfg?.properties?.bulletAnimSize) {\r\n\t\t\tconst isMobileSize = this.getIsMobileSize(600);\r\n\t\t\tconst size1Bullet = isMobileSize ? this.tourCfg.properties.bulletAnimSize / 20 : this.tourCfg.properties.bulletAnimSize / 30; // include gap\r\n\t\t\tupdateCssVar('--bullet-anim-size', `${size1Bullet}vw`);\r\n\t\t\tupdateCssVar('--bullet-anim-gap', `${round3dec(size1Bullet / 1.1)}vw`);\r\n\t\t\tupdateCssVar('--bullet-anim-border-radius', `${this.tourCfg.properties.bulletAnimBorderRadius}%`);\r\n\t\t}\r\n\t}\r\n\r\n\tresizeRefresh(sizes) {\r\n\r\n\t\tconst { reaction, type } = this.getResizeReactionAndType(sizes.currentWinSize, sizes.oldWinSize);\r\n\t\tthis.winBB = { ...sizes.currentWinSize };\r\n\t\tthis.actualizeDocAndScreenAreas();\r\n\t\tif (this.options.dpDebugEn) console.log('[dpit] RESIZE - Sizes:', sizes, 'Reaction:', reaction, 'Type:', type);\r\n\r\n\r\n\t\tswitch (reaction) {\r\n\t\t\tcase RESIZE_REACTION.hard:\r\n\t\t\t\tthis.doAction(EVENTS.onResize, sizes);\r\n\t\t\t\t/*if (target changed due mobile alt target => regularStepChange)\r\n\t\t\t\t\telse */\r\n\t\t\t\t//this.regularStepChange(REFRESH_REASONS.resize, { resizeType: type }); break;\r\n\t\t\t\tthis.hardRefresh(REFRESH_REASONS.resize, { resizeType: type }); break;\r\n\r\n\r\n\r\n\t\t\tcase RESIZE_REACTION.soft:\r\n\t\t\t\tthis.doAction(EVENTS.onResize, sizes);\r\n\t\t\t\tthis.softRefresh(REFRESH_REASONS.resize, { resizeType: type });\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: this.showIntroLayers();\r\n\t\t}\r\n\t}\r\n\r\n\tisScreenPortraitOrientation(winBB) {\r\n\t\treturn winBB ? winBB.height > winBB.width : false;\r\n\t}\r\n\r\n\tonResize() {\r\n\t\tif (this.options.resizeRefreshEn && !this.isResizeRefreshPaused) {\r\n\t\t\t//if (this.debugVisualizer) this.debugVisualizer.clearVisualizers();\r\n\t\t\tconst currentWinSize = getWinBB();\r\n\t\t\tthis.actualizeWrapperSize(getDocBB());\r\n\t\t\tconst { reaction, isOrientationToggle } = this.getResizeReactionAndType(currentWinSize, this.oldDocBB);\r\n\t\t\tif (this.resizeTimeout) {\r\n\t\t\t\tthis.restartResizeTimeout(reaction, isOrientationToggle, currentWinSize);\r\n\t\t\t}\r\n\t\t\telse if (!this.disableOnResize) {\r\n\t\t\t\t// First resize event after not resizing\r\n\t\t\t\tthis.disableOnResize = true;\r\n\t\t\t\tthis.oldWinBB = { ...this.winBB };\r\n\t\t\t\tthis.oldDocBB = { ...this.docBB };\r\n\t\t\t\tthis.restartResizeTimeout(reaction, isOrientationToggle, currentWinSize);\r\n\t\t\t\tthis.disableOnResize = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trestartResizeTimeout(reaction, isOrientationToggle, currentWinSize) {\r\n\t\t/*if (reaction === RESIZE_REACTION.none) {\r\n\t\t\tif (this.resizeTimeout) clearTimeout(this.resizeTimeout);\r\n\t\t\tthis.resizeTimeout = null;\r\n\t\t\tthis.showIntroLayers();\r\n\t\t\treturn;\r\n\t\t}*/\r\n\t\t//const isOrientationToggle = this.isResizeWithOrientationToggle(currentWinSize, this.oldWinBB);\r\n\t\tconst shouldHideIntroLayers = isOrientationToggle || currentWinSize.width !== this.oldWinBB.width;\r\n\t\tthis.pauseFollowTarget();\r\n\t\tif (shouldHideIntroLayers/* && !this.resizeTimeout*/) {\r\n\t\t\tthis.hideIntroLayers();\r\n\t\t}\r\n\t\tif (isOrientationToggle) {\r\n\t\t\tthis.didOrientationChanged = true;\r\n\t\t}\r\n\r\n\t\tif (this.resizeTimeout) clearTimeout(this.resizeTimeout);\r\n\t\tthis.resizeTimeout = setTimeout(() => {\r\n\t\t\tthis.resizeRefresh({\r\n\t\t\t\toldWinSize: this.oldWinBB,\r\n\t\t\t\tcurrentWinSize: getWinBB(),\r\n\t\t\t\toldSize: this.oldDocBB,\r\n\t\t\t\tcurrentSize: getDocBB()\r\n\t\t\t});\r\n\t\t\tthis.resizeTimeout = null;\r\n\t\t}, TIMING.resizeReaction);\r\n\t}\r\n\r\n\tisLastStep() {\r\n\t\treturn this.stepItems.length - 1 === this.stepIdx;\r\n\t}\r\n\r\n\tonKeyDown(e) {\r\n\t\tif (this.options.keyboardNavigation && this.keyboardNavigEnabled) {\r\n\t\t\tvar code = e.key ?? e.keyCode;\r\n\t\t\tlet isHideNextByCurrentStepMeta = this.isHideNextByCurrentStepMeta();\r\n\r\n\t\t\t// if code/e.which is null\r\n\t\t\tcode ??= e.charCode;\r\n\t\t\tconst isLastStep = this.isLastStep();\r\n\t\t\tif ((code === 'Escape' || code === 27) && this.options.exitOnEsc === true) {\r\n\t\t\t\t//escape key pressed, exit the intro\r\n\t\t\t\t//check if exit callback is defined\r\n\t\t\t\tthis.exitCoreWithHiddenOverlay('skip');\r\n\t\t\t} else if (code === 'ArrowLeft' || code === 37) {\r\n\t\t\t\t//left arrow\r\n\t\t\t\tif (!this.options.hide_previous_step_button) this.goToPrevStep();\r\n\t\t\t} else if (code === 'ArrowRight' || code === 39) {\r\n\t\t\t\t//right arrow\r\n\t\t\t\tif (!isLastStep && !isHideNextByCurrentStepMeta) this.goToNextStep();\r\n\t\t\t} else if (code === 'Enter' || code === 13) {\r\n\t\t\t\t//srcElement === ie\r\n\t\t\t\tconst target = e.target || e.srcElement;\r\n\t\t\t\tif (!this.options.hide_previous_step_button && target === this.buttonPrevEl) {\r\n\t\t\t\t\t//user hit enter while focusing on previous button\r\n\t\t\t\t\tthis.goToPrevStep();\r\n\t\t\t\t} else if (target === this.buttonCancelEl) {\r\n\t\t\t\t\t//user hit enter while focusing on skip button\r\n\t\t\t\t\tthis.exitCoreWithHiddenOverlay('complete');\r\n\t\t\t\t} else if (target && target.getAttribute('data-step-number')) {\r\n\t\t\t\t\t// user hit enter while focusing on step bullet\r\n\t\t\t\t\ttarget.click();\r\n\t\t\t\t} else if (!isLastStep && !isHideNextByCurrentStepMeta) {\r\n\t\t\t\t\t//default behavior for responding to enter\r\n\t\t\t\t\tthis.goToNextStep();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//prevent default behavior on hitting Enter, to prevent steps being skipped in some browsers\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\tthis.preventDefault(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpreventDefault(event) {\r\n\t\tif (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tdeepCloneObject = (object) => {\r\n\t\tif (object === null || typeof (object) !== 'object' || typeof (object.nodeType) !== 'undefined') {\r\n\t\t\treturn object;\r\n\t\t}\r\n\t\tvar temp = {};\r\n\t\tfor (var key in object) {\r\n\t\t\tif (typeof (window.jQuery) !== 'undefined' && object[key] instanceof window.jQuery) {\r\n\t\t\t\ttemp[key] = object[key];\r\n\t\t\t} else {\r\n\t\t\t\ttemp[key] = this.deepCloneObject(object[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn temp;\r\n\t};\r\n\r\n\textendBoardMarginByTarget(margin, containerBB, targetBB, filterMarginEn = false) {\r\n\t\tconst extendedMargin = filterMarginEn ? this.filterWinBoardMargin(margin) : { ...margin };\r\n\t\tif (!this.isDummyMode() && targetBB) {\r\n\t\t\textendedMargin.left = Math.min(extendedMargin.left, targetBB.left);\r\n\t\t\textendedMargin.right = Math.min(extendedMargin.right, containerBB.right - 1 - Math.min(targetBB.right, containerBB.right));\r\n\t\t\textendedMargin.top = Math.min(extendedMargin.top, targetBB.top);\r\n\t\t\textendedMargin.bottom = Math.min(extendedMargin.bottom, containerBB.bottom - 1 - Math.min(targetBB.bottom, containerBB.bottom));\r\n\t\t}\r\n\r\n\t\treturn extendedMargin;\r\n\t}\r\n\r\n\tfilterWinBoardMargin(margin) {\r\n\t\treturn margin;\r\n\t}\r\n\r\n\tgetBoardMargin(targetBB, filterMarginEn) {\r\n\t\tlet mobileSizeCoef = 1;\r\n\t\tif (this.isMobileSize) {\r\n\t\t\tmobileSizeCoef = this.options.defaultWinBoardMarginMobSizeCoef;\r\n\t\t}\r\n\t\tlet margin = {\r\n\t\t\tleft: this.options.defaultBoardMarginPx.x * mobileSizeCoef,\r\n\t\t\tright: this.options.defaultBoardMarginPx.x * mobileSizeCoef,\r\n\t\t\ttop: this.options.defaultBoardMarginPx.y * mobileSizeCoef,\r\n\t\t\tbottom: this.options.defaultBoardMarginPx.y * mobileSizeCoef\r\n\t\t};\r\n\r\n\r\n\t\tmargin = this.extendBoardMarginByTarget(margin, this.isFixedPos ? this.winBB : this.docBB, targetBB, filterMarginEn);\r\n\r\n\r\n\t\treturn margin;\r\n\t}\r\n\r\n\r\n\tgetBoardBB = (isDocumentSize = true) => {\r\n\r\n\t\tconst margin = isDocumentSize ? this.docMargin : this.windowMargin;\r\n\t\tconst container = isDocumentSize ? this.docBB : this.winBB;\r\n\r\n\t\t/*this.windowMargins = {\r\n\t\t\ttop: 0,\r\n\t\t\tright: 0,\r\n\t\t\tbottom: 0,\r\n\t\t\tleft: 0\r\n\t\t};*/\r\n\t\tlet maxROI = {\r\n\t\t\ttop: margin.top,\r\n\t\t\tright: container.right - margin.right,\r\n\t\t\tbottom: container.bottom - margin.bottom,\r\n\t\t\tleft: margin.left\r\n\t\t};\r\n\t\treturn DpitBB.supplyWidthHeight(maxROI);\r\n\t};\r\n\r\n\tgetDesiredNumberPos(tooltipPos) {\r\n\t\tif (this.isDummyMode()) return { x: 'right', y: 'top', onTooltip: true };\r\n\t\tconst onTooltip = this.targetBB.height >= this.winBoardBB.height\r\n\t\t\t|| this.targetBB.width >= this.winBoardBB.width\r\n\t\t\t|| tooltipPos.base === 'center';\r\n\t\tlet desiredNumberPos = { x: 'right', y: 'top', onTooltip: onTooltip };\r\n\t\t// basic position\r\n\t\tif (onTooltip) {\r\n\t\t\tswitch (tooltipPos.base) {\r\n\t\t\t\tcase 'top': desiredNumberPos.y = 'top'; break;\r\n\t\t\t\tcase 'right': desiredNumberPos.x = 'right'; break;\r\n\t\t\t\tcase 'bottom': desiredNumberPos.y = 'bottom'; break;\r\n\t\t\t\tcase 'left': desiredNumberPos.x = 'left'; break;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tswitch (tooltipPos.base) {\r\n\t\t\t\tcase 'top': desiredNumberPos.y = 'bottom'; break;\r\n\t\t\t\tcase 'right': desiredNumberPos.x = 'left'; break;\r\n\t\t\t\tcase 'bottom': desiredNumberPos.y = 'top'; break;\r\n\t\t\t\tcase 'left': desiredNumberPos.x = 'right'; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// align\r\n\t\tswitch (tooltipPos.align) {\r\n\t\t\tcase 'left': desiredNumberPos.x = 'right'; break;\r\n\t\t\tcase 'right': desiredNumberPos.x = 'left'; break;\r\n\t\t\tcase 'top': desiredNumberPos.y = 'bottom'; break;\r\n\t\t\tcase 'middle': desiredNumberPos.y = 'top'; break;\r\n\t\t\tcase 'bottom': desiredNumberPos.y = 'top'; break;\r\n\t\t\tcase 'center': desiredNumberPos.x = 'right'; break;\r\n\t\t}\r\n\t\treturn desiredNumberPos;\r\n\t}\r\n\r\n\r\n\r\n\tgetArrowData(tooltipPos, arrowHalfSizes, arrowSizes) {\r\n\t\tconst tooltipRadius = this.tooltipRadius;\r\n\t\tconst arrowElRelPos = {\r\n\t\t\ttop: arrowHalfSizes.height - this.options.tooltipDistanceFromTarget,\r\n\t\t\tleft: this.targetBB.width / 2 - arrowHalfSizes.width\r\n\t\t}; // top, center aligned\r\n\r\n\t\tswitch (tooltipPos.base) {\r\n\t\t\tcase 'top': arrowElRelPos.top = - arrowHalfSizes.height - 1 - this.options.tooltipDistanceFromTarget; break;\r\n\t\t\tcase 'left': arrowElRelPos.left = - arrowHalfSizes.width - 1 - this.options.tooltipDistanceFromTarget; break;\r\n\t\t\tcase 'bottom': arrowElRelPos.top = this.targetBB.height + this.options.tooltipDistanceFromTarget - arrowHalfSizes.height; break;\r\n\t\t\tcase 'right': arrowElRelPos.left = this.targetBB.width + this.options.tooltipDistanceFromTarget - arrowHalfSizes.width; break;\r\n\t\t}\r\n\r\n\t\tlet arrowPos = getReverseBasePos(tooltipPos.base);\r\n\t\tif (tooltipPos.base !== 'center') {\r\n\t\t\tconst isLeftOrRight = ['left', 'right'].includes(tooltipPos.base);\r\n\t\t\tif (isLeftOrRight) {\r\n\t\t\t\tarrowElRelPos.top = this.targetBB.height / 2 - arrowHalfSizes.height;\r\n\t\t\t\t/*if (this.targetBB.height > this.tooltipBB.height) {\r\n\t\t\t\t\t//arrowElRelPos.top = this.targetBB.height / 2 - this.tooltipBB.height / 2 - arrowHalfSizes.height;\r\n\t\t\t\t\tthis.tooltipPos.align = 'middle';\r\n\t\t\t\t} else */if (this.tooltipBB.height < 1.8 * this.targetBB.height) {\r\n\t\t\t\t\tswitch (tooltipPos.align) {\r\n\t\t\t\t\t\tcase 'bottom':\r\n\t\t\t\t\t\t\tarrowElRelPos.top = this.targetBB.height - arrowSizes.height - tooltipRadius - this.options.tooltipDistanceFromTarget;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'top':\r\n\t\t\t\t\t\t\tarrowElRelPos.top = arrowSizes.height + tooltipRadius + this.options.tooltipDistanceFromTarget;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this.targetBB.height > this.tooltipBB.height) {\r\n\t\t\t\t\t//arrowElRelPos.top = this.targetBB.height / 2 - this.tooltipBB.height / 2 - arrowHalfSizes.height;\r\n\t\t\t\t\tthis.tooltipPos.align = 'middle';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tarrowElRelPos.left = this.targetBB.width / 2 - arrowHalfSizes.width;\r\n\t\t\t\tif (this.tooltipBB.width < 1.8 * this.targetBB.width) {\r\n\t\t\t\t\tswitch (tooltipPos.align) {\r\n\t\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\t\tarrowElRelPos.left = this.targetBB.width - arrowSizes.width - tooltipRadius - this.options.tooltipDistanceFromTarget;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\t\tarrowElRelPos.left = arrowSizes.width + tooltipRadius + this.options.tooltipDistanceFromTarget;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this.targetBB.width > this.tooltipBB.width) {\r\n\t\t\t\t\t//arrowElRelPos.left = this.targetBB.width / 2 - this.tooltipBB.width / 2 - arrowHalfSizes.width;\r\n\t\t\t\t\tthis.tooltipPos.align = 'center';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/*if (this.targetBB.width <= this.tooltipBB.width) {\r\n\t\t\t\t\tarrowElRelPos.left = this.targetBB.width / 2 - arrowHalfSizes.width;\r\n\t\t\t\t}*/\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\r\n\t\treturn {\r\n\t\t\tarrowPos,\r\n\t\t\tarrowElRelPos,\r\n\t\t};\r\n\t}\r\n\r\n\tactualizeTooltipRadiusPadding() {\r\n\r\n\t\tthis.tooltipRadius = getCssValFloat(this.tooltipEl, 'border-top-right-radius', 0);\r\n\t\t//tooltipRadius = 10000;\r\n\t\tthis.radiusPaddingFix = {\r\n\t\t\ttop: round1dec(this.tooltipRadius / 8),\r\n\t\t\tright: round1dec(this.tooltipRadius / 4),\r\n\t\t\tbottom: round1dec(this.tooltipRadius / 8),\r\n\t\t\tleft: round1dec(this.tooltipRadius / 4),\r\n\t\t};\r\n\t}\r\n\r\n\tfixArrowInTooltipRadius(tooltipPos, tooltipElRelPos, arrowPos, arrowElRelPos, arrowSizes) {\r\n\t\tconst tooltipRadius = this.tooltipRadius;\r\n\t\t//let radiusPaddingCompensation = (tooltipRadius / 8) + 'px ' + (tooltipRadius / 2) + 'px';\r\n\t\tif (this.tooltipPos.base != 'center') {\r\n\t\t\t// align\r\n\t\t\tswitch (tooltipPos.align) {\r\n\t\t\t\tcase 'left': if (tooltipRadius > 0 && arrowElRelPos.left < tooltipElRelPos.left + tooltipRadius) {\r\n\t\t\t\t\tthis.tooltipEl.style[`border-${arrowPos}-left-radius`] = (Math.max(Math.min(arrowElRelPos.left, tooltipRadius), 0)) + 'px';\r\n\t\t\t\t} break;\r\n\t\t\t\tcase 'right': {\r\n\t\t\t\t\tconst tooltipRight = tooltipElRelPos.left + this.tooltipBB.width - 1;\r\n\t\t\t\t\tconst arrowRight = arrowElRelPos.left + arrowSizes.width - 1;\r\n\t\t\t\t\tif (arrowRight > tooltipRight - tooltipRadius) {\r\n\t\t\t\t\t\tthis.tooltipEl.style[`border-${arrowPos}-right-radius`] = (Math.max(Math.min(tooltipRight - arrowRight, tooltipRadius), 0)) + 'px';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase 'top':\r\n\t\t\t\t\tif (tooltipRadius > 0 && arrowElRelPos.top < tooltipElRelPos.top + tooltipRadius) {\r\n\t\t\t\t\t\tthis.tooltipEl.style[`border-top-${arrowPos}-radius`] = (Math.max(Math.min(arrowElRelPos.top, tooltipRadius), 0)) + 'px';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'bottom': {\r\n\t\t\t\t\tconst tooltipBottom = tooltipElRelPos.top + this.tooltipBB.height - 1;\r\n\t\t\t\t\tconst arrowBottom = arrowElRelPos.top + arrowSizes.height - 1;\r\n\t\t\t\t\tif (arrowBottom > tooltipBottom - tooltipRadius) {\r\n\t\t\t\t\t\tthis.tooltipEl.style[`border-bottom-${arrowPos}-radius`] = (Math.max(Math.min(tooltipBottom - arrowBottom, tooltipRadius), 0)) + 'px';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tactualizeTooltipBB() {\r\n\t\t/*this.tooltipBBRelToTooltipRef = null;\r\n\t\tthis.tooltipRefOffset = { top: 0, left: 0 };*/\r\n\t\tthis.tooltipBB = DpitBB.fromElement(this.tooltipEl, this.isFixedPos);\r\n\t\t/*if (this.tooltipBB) {\r\n\t\t\tthis.tooltipRefOffset = $(this.tooltipRefEl).offset();\r\n\t\t\tthis.tooltipBBRelToTooltipRef = DpitBB.absoluteToRelative(this.tooltipBB, true, this.tooltipRefOffset.top, this.tooltipRefOffset.left);\r\n\t\t}*/\r\n\t}\r\n\r\n\tactualizeTooltipPosition(relativeLeft, relativeTop) {\r\n\t\tthis.tooltipEl.style.left = relativeLeft + 'px';\r\n\t\tthis.tooltipEl.style.top = relativeTop + 'px';\r\n\t\tthis.actualizeTooltipBB();\r\n\t}\r\n\r\n\tactualizeTooltipSizeAndPos(tooltipPos, tooltipElRelPos) {\r\n\r\n\t\tthis.actualizeTooltipPosition(tooltipElRelPos.left, tooltipElRelPos.top);\r\n\t\tif (tooltipPos.base) this.tooltipEl.classList.add(`${CLASSES_CORE.tooltip}--${tooltipPos.base}`);\r\n\t\tif (tooltipPos.align) this.tooltipEl.classList.add(`${CLASSES_CORE.tooltip}--${tooltipPos.align}-aligned`);\r\n\r\n\r\n\r\n\t\tif (this.tooltipBB && ['top', 'bottom'].includes(tooltipPos.base)) {\r\n\r\n\t\t\tconst maxArea = this.isFixedPos ? this.winBoardBB : this.docBoardBB;\r\n\t\t\tlet diff = 0;\r\n\r\n\t\t\tlet isOverLeft = this.tooltipBB.left < maxArea.left;\r\n\t\t\tlet isOverRight = this.tooltipBB.right > maxArea.right;\r\n\r\n\t\t\tif (isOverLeft /*&& this.targetBB.left >maxArea.left*/) {\r\n\t\t\t\tdiff = Math.abs(maxArea.left - this.tooltipBB.left);\r\n\t\t\t\tif (this.options.dpDebugEn) console.log('[dpit] TOOLTIP Pos: Over Left');\r\n\t\t\t\t$(this.tooltipEl).offset({ left: maxArea.left });\r\n\t\t\t\tthis.actualizeTooltipBB();\r\n\t\t\t\tisOverRight = this.tooltipBB.right > maxArea.right;\r\n\t\t\t\tif (isOverRight) {\r\n\r\n\t\t\t\t\tthis.tooltipEl.style.width = (this.tooltipBB.width - (2 * diff)) + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (isOverRight/* && this.targetBB.right <maxArea.right*/) {\r\n\r\n\t\t\t\tif (this.options.dpDebugEn) console.log('[dpit] TOOLTIP Pos: Over Right');\r\n\t\t\t\tconst newLeft = maxArea.right - this.tooltipBB.width;\r\n\t\t\t\tdiff = Math.abs(newLeft - this.tooltipBB.left);\r\n\t\t\t\t$(this.tooltipEl).offset({ left: newLeft });\r\n\t\t\t\tthis.actualizeTooltipBB();\r\n\t\t\t\tisOverLeft = this.tooltipBB.left < maxArea.left;\r\n\t\t\t\tif (isOverLeft) {\r\n\t\t\t\t\tthis.tooltipEl.style.width = (this.tooltipBB.width - (2 * diff)) + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tfilterTooltipElRelPos(elRelPos) {\r\n\t\treturn elRelPos;\r\n\t}\r\n\r\n\tplaceTooltipCore(\r\n\t\tplaceTooltipIterations,\r\n\t\tuseLastPosition,\r\n\t\tprevIterationTooltipPos,\r\n\t\tisCrowdedPos\r\n\t) {\r\n\t\tlet isNeededNextIteration = false;\r\n\t\tconst arrowSizes = {\r\n\t\t\twidth: this.arrowEl.offsetWidth,\r\n\t\t\theight: this.arrowEl.offsetHeight\r\n\t\t};\r\n\t\tconst arrowHalfSizes = { width: arrowSizes.width / 2, height: arrowSizes.height / 2 };\r\n\r\n\t\tif (!(useLastPosition && this.tooltipPos)) {\r\n\t\t\tthis.tooltipPos = this.determineTooltipPosition(\r\n\t\t\t\tthis.stepItem,\r\n\t\t\t\tarrowSizes,\r\n\t\t\t\tisCrowdedPos\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t//this.tooltipPos = { base: 'right', align: 'bottom', width: this.tooltipBB.width };\r\n\r\n\t\tthis.arrowEl.className = CLASSES_CORE.arrow;\r\n\r\n\t\tlet tooltipElRelPos = { top: 0, left: 0 };\r\n\t\t// basic position\r\n\t\tswitch (this.tooltipPos.base) {\r\n\t\t\tcase 'top':\r\n\t\t\t\ttooltipElRelPos.top = ceil1dec(-this.tooltipBB.height - arrowHalfSizes.height - this.options.tooltipDistanceFromTarget);\r\n\t\t\t\tthis.tooltipEl.style.width = '';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'right':\r\n\t\t\t\ttooltipElRelPos.left = floor1dec(this.targetBB.width - 1 + arrowHalfSizes.width + this.options.tooltipDistanceFromTarget); // -1 .. arrow gap\r\n\t\t\t\t/*if (placeTooltipIterations === 0)*/ this.tooltipEl.style.width = this.tooltipPos.width + 'px';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'left':\r\n\t\t\t\ttooltipElRelPos.left = ceil1dec(- arrowHalfSizes.width - this.tooltipPos.width - this.options.tooltipDistanceFromTarget);\r\n\t\t\t\t/*if (placeTooltipIterations === 0)*/ this.tooltipEl.style.width = this.tooltipPos.width + 'px';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bottom':\r\n\t\t\t\ttooltipElRelPos.top = floor1dec(this.targetBB.height - 1 + arrowHalfSizes.height + this.options.tooltipDistanceFromTarget); // -1 .. arrow gap\r\n\t\t\t\tthis.tooltipEl.style.width = '';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'center':\r\n\r\n\t\t\t\tthis.tooltipEl.style.width = '';\r\n\t\t\t\tif (this.isDummyMode()) {\r\n\t\t\t\t\tconst stepContent = this.getStepContent(this.stepItem);\r\n\t\t\t\t\tif (stepContent && stepContent.length > 100 && this.tooltipBB.width < 0.4 * this.winBoardBB.width) {\r\n\t\t\t\t\t\tthis.tooltipEl.style.width = 0.4 * this.winBoardBB.width + 'px';\r\n\t\t\t\t\t\tthis.actualizeTooltipBB();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttooltipElRelPos.left = (this.targetBB.width - this.tooltipBB.width) / 2;\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// align\r\n\t\tswitch (this.tooltipPos.align) {\r\n\t\t\tcase 'center': tooltipElRelPos.left = (this.targetBB.width - this.tooltipBB.width) / 2; break;\r\n\t\t\tcase 'right': {\r\n\t\t\t\tlet arrowWidthMinusTargetWidth = 0;\r\n\t\t\t\tif (arrowSizes.width > this.targetBB.width) {\r\n\t\t\t\t\tarrowWidthMinusTargetWidth = arrowSizes.width - this.targetBB.width;\r\n\t\t\t\t}\r\n\t\t\t\ttooltipElRelPos.left = this.targetBB.width - this.tooltipBB.width + arrowWidthMinusTargetWidth;\r\n\t\t\t} break;\r\n\t\t\tcase 'top':\r\n\t\t\t\tif (this.tooltipPos.base === 'center') {\r\n\t\t\t\t\ttooltipElRelPos.top = this.options.centerTopBottomPosOffset;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'middle': tooltipElRelPos.top = (this.targetBB.height - this.tooltipBB.height) / 2; break;\r\n\t\t\tcase 'bottom': {\r\n\t\t\t\tlet arrowHeightMinusTargetHeight = 0;\r\n\t\t\t\tif (arrowSizes.height > this.targetBB.height) {\r\n\t\t\t\t\tarrowHeightMinusTargetHeight = arrowSizes.height - this.targetBB.height;\r\n\t\t\t\t}\r\n\t\t\t\ttooltipElRelPos.top = this.targetBB.height - this.tooltipBB.height + arrowHeightMinusTargetHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\r\n\t\ttooltipElRelPos = this.filterTooltipElRelPos(tooltipElRelPos);\r\n\r\n\r\n\t\tthis.actualizeTooltipSizeAndPos(this.tooltipPos, tooltipElRelPos);\r\n\r\n\r\n\r\n\r\n\t\tconst { arrowPos, arrowElRelPos } = this.getArrowData(this.tooltipPos, arrowHalfSizes, arrowSizes);\r\n\t\tthis.fixArrowInTooltipRadius(this.tooltipPos, tooltipElRelPos, arrowPos, arrowElRelPos, arrowSizes);\r\n\t\tthis.actualizeArrowEl(arrowElRelPos.left, arrowElRelPos.top, this.tooltipPos, arrowPos);\r\n\r\n\r\n\t\tif (\r\n\t\t\tthis.options.goldenRatioPosAlgEn\r\n\t\t\t&& this.tooltipBB\r\n\t\t\t&& !useLastPosition\r\n\t\t\t&& placeTooltipIterations < 3\r\n\t\t\t&& !(placeTooltipIterations > 0 && prevIterationTooltipPos.base === this.tooltipPos.base && prevIterationTooltipPos.align === this.tooltipPos.align)\r\n\r\n\t\t) {\r\n\t\t\tlet basePositions = ['left', 'right', 'bottom', 'top'].filter(val => !isCrowdedPos[val]);\r\n\t\t\tif (basePositions.includes(this.tooltipPos.base)) {\r\n\t\t\t\t/*const goldenRatioPosAlgRes = */\r\n\t\t\t\tdpitGoldenRatioPosAlg(\r\n\t\t\t\t\tthis.targetBB,\r\n\t\t\t\t\tthis.tooltipBB,\r\n\t\t\t\t\tthis.tooltipEl,\r\n\t\t\t\t\tthis.tooltipPos,\r\n\t\t\t\t\tthis.winBoardBB,\r\n\t\t\t\t\tthis.docBoardBB,\r\n\t\t\t\t\tthis.isFixedPos,\r\n\t\t\t\t\tthis.minTooltipWidth,\r\n\t\t\t\t\tthis.options.dpDebugEn//false\r\n\t\t\t\t);\r\n\t\t\t\tisNeededNextIteration = false;//goldenRatioPosAlgRes.wasPosAdjusted;\r\n\t\t\t\tthis.actualizeTooltipBB();\r\n\t\t\t\t//if (goldenRatioPosAlgRes.isOverHeight) isCrowdedPos[this.tooltipPos.base] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!isNeededNextIteration) {\r\n\t\t\tconst doesNotFitIn = this.fixPositionOutOfTheWindow();\r\n\t\t\tif (doesNotFitIn) {\r\n\t\t\t\tisNeededNextIteration = true;\r\n\t\t\t\tisCrowdedPos[this.tooltipPos.base] = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tisNeededNextIteration,\r\n\t\t\tdesiredNumberPos: this.getDesiredNumberPos(this.tooltipPos)\r\n\t\t};\r\n\t}\r\n\r\n\r\n\tinitTooltip(hard = false) {\r\n\r\n\r\n\t\t/*if (this.isDummyMode()) {\r\n\t\t\tthis.tooltipEl.classList.add(CLASSES_CORE.tooltip + MODIFIERS.dummy);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.tooltipRefEl.classList.remove(CLASSES_CORE.tooltip + MODIFIERS.dummy);\r\n\t\t}*/\r\n\r\n\r\n\t\tif (hard) {\r\n\t\t\tthis.tooltipTextEl.classList.remove(CLASSES_CORE.hasScrollBar);\r\n\t\t\tthis.tooltipTextEl.style.height = '';\r\n\r\n\t\t\tthis.tooltipEl.className = CLASSES_CORE.tooltip;\r\n\t\t\tthis.tooltipEl.removeAttribute('style');\r\n\r\n\t\t\t//this.tooltipEl.style = '';\r\n\t\t\t/*this.tooltipEl.style.top = '';\r\n\t\t\tthis.tooltipEl.style.right = '';\r\n\t\t\tthis.tooltipEl.style.bottom = '';\r\n\t\t\tthis.tooltipEl.style.left = '';\r\n\t\t\tthis.tooltipEl.style.width = '';\r\n\t\t\tthis.tooltipEl.style.height = '';*/\r\n\t\t\tthis.actualizeScreenArea();\r\n\t\t\tthis.actualizeTooltipMaxWidth();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.tooltipTextEl.style.maxHeight = '';\r\n\t\t\tthis.tooltipEl.style.marginLeft = '';\r\n\t\t\tthis.tooltipEl.style.marginTop = '';\r\n\t\t\tthis.tooltipEl.style.borderTopLeftRadius = '';\r\n\t\t\tthis.tooltipEl.style.borderTopRightRadius = '';\r\n\t\t\tthis.tooltipEl.style.borderBottomLeftRadius = '';\r\n\t\t\tthis.tooltipEl.style.borderBottomRightRadius = '';\r\n\t\t\tthis.tooltipEl.style.width = '';\r\n\t\t}\r\n\r\n\t\tif (this.isDummyMode()) {\r\n\t\t\tthis.tooltipEl.classList.add(CLASSES_CORE.tooltip + MODIFIERS.dummy);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.tooltipEl.classList.remove(CLASSES_CORE.tooltip + MODIFIERS.dummy);\r\n\t\t}\r\n\r\n\r\n\r\n\t\tthis.numberEl?.classList.remove(CLASSES_CORE.number + MODIFIERS.onTooltip);\r\n\r\n\t\tif (this.stepItem?.hidden_meta?.ext?.build_with_wp_editor === '1') {\r\n\t\t\tthis.tooltipTextEl.classList.add(CLASSES_CORE.tooltipText + MODIFIERS.whiteSpacingNormal);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.tooltipTextEl.classList.remove(CLASSES_CORE.tooltipText + MODIFIERS.whiteSpacingNormal);\r\n\t\t}\r\n\r\n\t\tif (this.options.customTextStylesEn) {\r\n\t\t\tthis.tooltipTextEl.classList.add(CLASSES_CORE.tooltipText + MODIFIERS.customStyle);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.tooltipTextEl.classList.remove(CLASSES_CORE.tooltipText + MODIFIERS.customStyle);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Render tooltip box in the page\r\n\t *\r\n\t * @api private\r\n\t * @method placeTooltip\r\n\t * @param {HTMLElement} targetElement\r\n\t */\r\n\tplaceTooltip = (useLastTooltipPos = false, useLastNumberPos = false, placeTooltipIterations = 0, isCrowdedPos = {}) => {\r\n\r\n\t\tlet prevIterationTooltipPos = null;\r\n\r\n\t\tif (placeTooltipIterations > 0) {\r\n\t\t\tprevIterationTooltipPos = { ...this.tooltipPos };\r\n\t\t}\r\n\r\n\t\t//prevent error when `this.stepIdx` is undefined\r\n\t\tif (!this.stepItem) return;\r\n\r\n\t\tthis.actualizeTooltipBB();\r\n\r\n\t\tif (typeof (this.options.tooltipClass) === 'string' && this.options.tooltipClass) {\r\n\t\t\tthis.tooltipEl.classList.add(this.options.tooltipClass);\r\n\t\t}\r\n\t\tif (this.isProgressBarEnabled()) {\r\n\t\t\tthis.tooltipEl.classList.add(CLASSES_CORE.tooltip + '--with-progress-bar');\r\n\t\t}\r\n\r\n\t\tconst { isNeededNextIteration, desiredNumberPos } = this.placeTooltipCore(\r\n\t\t\tplaceTooltipIterations,\r\n\t\t\tuseLastTooltipPos,\r\n\t\t\tprevIterationTooltipPos,\r\n\t\t\tisCrowdedPos\r\n\t\t);\r\n\t\tthis.desiredNumberPos = desiredNumberPos;\r\n\r\n\t\tif (isNeededNextIteration && !useLastTooltipPos && placeTooltipIterations < 2) {\r\n\t\t\tif (this.options.dpDebugEn && placeTooltipIterations > 0) console.log('[dpit] TOOLTIP Pos. re-calc.', placeTooltipIterations);\r\n\t\t\t//this.initTooltip(false);\r\n\t\t\t//this.tooltipEl.style.width = '';\r\n\t\t\tthis.placeTooltip(useLastTooltipPos, false, ++placeTooltipIterations, isCrowdedPos);\r\n\t\t}\r\n\t\telse if (this.actualizeBulletScrollBar()) {\r\n\t\t\tthis.placeTooltip(true, false, ++placeTooltipIterations, isCrowdedPos);\r\n\t\t} else if (this.options.showStepNumbers) {\r\n\t\t\tthis.placeNumber(this.targetBB, this.tooltipPos, desiredNumberPos, useLastNumberPos);\r\n\t\t} else {\r\n\t\t\thideElement(this.numberEl, false);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\r\n\tactualizeStepNumber() {\r\n\t\tthis.actualizeStepNumberEl(this.numberEl);\r\n\t}\r\n\r\n\r\n\t/** \r\n\t* @param {Element} numberEl - Brief description of the parameter here. Note: For other notations of data types, please refer to JSDocs: DataTypes command.\r\n\t*/\r\n\tactualizeStepNumberEl(numberEl) {\r\n\t\tconst stepNumber = this.stepItem ? this.stepItem.step : '';\r\n\t\tnumberEl.firstChild.innerHTML = this.stepItem ? this.stepItem.step : '';\r\n\t\tif (stepNumber > 9) {\r\n\t\t\tnumberEl.classList.add(CLASSES_CORE.number + MODIFIERS['2dig']);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnumberEl.classList.remove(CLASSES_CORE.number + MODIFIERS['2dig']);\r\n\t\t}\r\n\t\tthis.actualizeNumberBB(true);\r\n\t}\r\n\r\n\tactualizeLayer(isEnabled, layerElement, hideByDisp = true, classWhenLayerShown = null) {\r\n\t\tif (isEnabled) {\r\n\t\t\tshowElement(layerElement);\r\n\t\t\tif (classWhenLayerShown && layerElement) layerElement.classList.add(classWhenLayerShown);\r\n\t\t}\r\n\t\telse {\r\n\t\t\thideElement(layerElement, !hideByDisp);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tactualizeNumberBB(takeNumberBBSizeStandardSnapShot = false) {\r\n\t\tif (this.options.showStepNumbers) {\r\n\t\t\tthis.numberBB = DpitBB.fromElement(this.numberEl, this.isFixedPos);\r\n\t\t\tif (takeNumberBBSizeStandardSnapShot) this.numberElBBSizeStandard = this.takeNumberBBSizeStandardSnapShot();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.numberElBBSizeStandard = null;\r\n\t\t}\r\n\t}\r\n\r\n\ttakeNumberBBSizeStandardSnapShot() {\r\n\t\treturn { ...this.numberBB };\r\n\t}\r\n\r\n\tgetActualNumberPosY(lastPositionKey, lastPositionData, bbNumberDest, indention) {\r\n\t\tlet lastPositionKeyBase = lastPositionKey;\r\n\t\tconst lastPositionParts = lastPositionKey.split(/(?=[A-Z])/);\r\n\t\tif (lastPositionParts.length) {\r\n\t\t\tlastPositionKeyBase = lastPositionParts[0];\r\n\t\t}\r\n\t\tlet lastPositionBase = null;\r\n\t\tswitch (lastPositionKeyBase) {\r\n\t\t\tcase 'top': lastPositionBase = bbNumberDest.top - this.numberBB.height + lastPositionData.numberPosCoef * lastPositionData.numberLayerHalfSize.height; break;\r\n\t\t\tcase 'bottom': lastPositionBase = bbNumberDest.bottom - 1 - lastPositionData.numberPosCoef * lastPositionData.numberLayerHalfSize.height; break;\r\n\t\t}\r\n\t\tswitch (lastPositionKey) {\r\n\t\t\tcase 'topIndented': return lastPositionBase + indention;\r\n\t\t\tcase 'bottomIndented': return lastPositionBase - indention;\r\n\r\n\t\t}\r\n\t\treturn this.isFixedPos ? lastPositionBase + document.documentElement.scrollTop : lastPositionBase;\r\n\t}\r\n\r\n\tgetActualNumberPosX(lastPositionKey, lastPositionData, bbNumberDest, indention) {\r\n\t\tlet lastPositionKeyBase = lastPositionKey;\r\n\t\tconst lastPositionParts = lastPositionKey.split(/(?=[A-Z])/);\r\n\t\tif (lastPositionParts.length) {\r\n\t\t\tlastPositionKeyBase = lastPositionParts[0];\r\n\t\t}\r\n\t\tlet lastPositionBase = null;\r\n\t\tswitch (lastPositionKeyBase) {\r\n\t\t\tcase 'left': lastPositionBase = bbNumberDest.left - this.numberBB.width + lastPositionData.numberPosCoef * lastPositionData.numberLayerHalfSize.width; break;\r\n\t\t\tcase 'right': lastPositionBase = bbNumberDest.right - 1 - lastPositionData.numberPosCoef * lastPositionData.numberLayerHalfSize.width; break;\r\n\t\t}\r\n\r\n\t\tswitch (lastPositionKey) {\r\n\t\t\tcase 'leftIndented': return lastPositionBase + indention;\r\n\t\t\tcase 'rightIndented': return lastPositionBase - indention;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.isFixedPos ? lastPositionBase + document.documentElement.scrollLeft : lastPositionBase;\r\n\t}\r\n\r\n\tplaceNumberFast(lastPosition, bbNumberDest) {\r\n\t\tlet newPosition = {\r\n\t\t\ttype: lastPosition.type,\r\n\t\t\ttop: this.getActualNumberPosY(lastPosition.type.y, lastPosition, bbNumberDest, lastPosition.indention),\r\n\t\t\tleft: this.getActualNumberPosX(lastPosition.type.x, lastPosition, bbNumberDest, lastPosition.indention),\r\n\t\t};\r\n\t\t$(this.numberEl).offset({ top: newPosition.top, left: newPosition.left });\r\n\t}\r\n\r\n\r\n\tgetIsPossibleNumberPositionsInBoardObject(possiblePositionsLT) {\r\n\t\tconst maxAreaBB = this.isFixedPos ? this.winBB : this.docBB;\r\n\t\treturn {\r\n\t\t\tleft: possiblePositionsLT.left >= this.docBB.left && Math.abs(possiblePositionsLT.left - this.tooltipBB.right) < this.winBB.width,\r\n\t\t\ttop: possiblePositionsLT.top >= this.docBB.top && Math.abs(possiblePositionsLT.top - this.tooltipBB.bottom) < this.winBB.height,\r\n\t\t\tright: possiblePositionsLT.right + this.numberBB.width <= maxAreaBB.right\r\n\t\t\t\t&& Math.abs(possiblePositionsLT.right + this.numberBB.width - this.tooltipBB.left) < this.winBB.width,\r\n\t\t\tbottom: possiblePositionsLT.bottom + this.numberBB.height <= maxAreaBB.bottom\r\n\t\t\t\t&& Math.abs(possiblePositionsLT.bottom + this.numberBB.height - this.tooltipBB.top) < this.winBB.height\r\n\t\t};\r\n\t}\r\n\r\n\tgetNumberIntersectionFeature(possiblePositionsLT, posX, posY, bbContainerToTest) {\r\n\t\tconst numBBToTest = DpitBB.extend(DpitBB.fromLeftTopWidthHeight(\r\n\t\t\tpossiblePositionsLT[posX],\r\n\t\t\tpossiblePositionsLT[posY],\r\n\t\t\tthis.numberBB.width,\r\n\t\t\tthis.numberBB.height\r\n\t\t), 4);\r\n\r\n\t\treturn DpitBB.intersect(bbContainerToTest, numBBToTest);\r\n\t}\r\n\r\n\tgetNumberDestElSizeFeature(numberLayerHalfSize, bbContainerToTest) {\r\n\t\treturn { x: numberLayerHalfSize.width / bbContainerToTest.width, y: numberLayerHalfSize.height / bbContainerToTest.height };\r\n\t}\r\n\r\n\r\n\tgetPlaceNumberRepetitionParams(oldDesiredPosition, iterations) {\r\n\t\tlet enableIndentation = iterations >= 2;\r\n\t\tlet desiredPosition = { ...oldDesiredPosition, onTooltip: !oldDesiredPosition.onTooltip };\r\n\t\tlet maxIterations = 3;\r\n\t\tif (this.isDummyMode()) {\r\n\t\t\tenableIndentation = true;\r\n\t\t\tdesiredPosition = { ...oldDesiredPosition, onTooltip: true };\r\n\t\t\tmaxIterations = 1;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tenableIndentation,\r\n\t\t\tdesiredPosition,\r\n\t\t\tmaxIterations\r\n\t\t};\r\n\t}\r\n\r\n\tplaceNumber(\r\n\t\ttargetBB,\r\n\t\ttooltipPos,\r\n\t\tdesiredPosition = { x: 'right', y: 'top', onTooltip: false },\r\n\t\tuseLastPosition = false,\r\n\t\titerations = 1,\r\n\t\tenableIndentation = false) {\r\n\r\n\t\tlet numberPosCoef = 1;\r\n\r\n\t\tlet numberLayerHalfSize = { width: this.numberBB.width / 2, height: this.numberBB.height / 2 };\r\n\r\n\r\n\t\tlet numberDestEl = this.highlightEl;\r\n\t\tlet bbNumberDest = targetBB;\r\n\t\tlet bbOther = this.tooltipBB;\r\n\r\n\t\tif (desiredPosition.onTooltip) {\r\n\t\t\tbbNumberDest = this.tooltipBB;\r\n\t\t\tbbOther = targetBB;\r\n\t\t\tnumberDestEl = this.tooltipEl;\r\n\t\t} else if (!useLastPosition) {\r\n\t\t\t//adjust distance of number and target ... higher dist for small targets\r\n\t\t\tconst numberSizeCoef = this.getNumberDestElSizeFeature(numberLayerHalfSize, bbNumberDest);\r\n\t\t\tconst threshold = 0.3;\r\n\r\n\t\t\tif (numberSizeCoef.x > threshold && numberSizeCoef.x < 1.5 || numberSizeCoef.y > threshold && numberSizeCoef.y < 1.5) {\r\n\t\t\t\t//enableIndentation = false;\r\n\t\t\t\tconst numberPosFeatures = { x: 1 - (numberSizeCoef.x - threshold), y: 1 - (numberSizeCoef.y - threshold) };\r\n\t\t\t\tnumberPosCoef = Math.min(numberPosFeatures.x, numberPosFeatures.y);\r\n\t\t\t\tif (this.options.dpDebugEn) console.log('[dpit] NUMBER POS: adjustment - small ref/tooltip. Coef: ', numberPosCoef, 'Features: ', numberPosFeatures);\r\n\t\t\t\t//numberSizeCoefCssVar = Math.min(Math.max(1.7 * numberPosCoef, 0.8), 1);\r\n\t\t\t\t//this.actualizeNumberBB();\r\n\t\t\t\t//numberLayerHalfSize = { width: this.numberBB.width / 2, height: this.numberBB.height / 2 };\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (useLastPosition && this.currentNumberPos) {\r\n\t\t\tthis.placeNumberFast(this.currentNumberPos, bbNumberDest);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.numberEl.classList.remove(CLASSES_CORE.number + MODIFIERS.hidden);\r\n\r\n\r\n\t\tif (desiredPosition.onTooltip) {\r\n\t\t\tthis.numberEl.classList.add(CLASSES_CORE.number + MODIFIERS.onTooltip);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.numberEl.classList.remove(CLASSES_CORE.number + MODIFIERS.onTooltip);\r\n\t\t}\r\n\t\tthis.actualizeNumberBB(true);\r\n\r\n\t\tlet possiblePositionsLT = {\r\n\t\t\tleft: bbNumberDest.left - this.numberBB.width + numberPosCoef * numberLayerHalfSize.width + this.radiusPaddingFix.left / 2,\r\n\t\t\tright: bbNumberDest.right - 1 - numberPosCoef * numberLayerHalfSize.width - this.radiusPaddingFix.right / 2,\r\n\t\t\ttop: bbNumberDest.top - this.numberBB.height + numberPosCoef * numberLayerHalfSize.height + this.radiusPaddingFix.top / 2,\r\n\t\t\tbottom: bbNumberDest.bottom - 1 - numberPosCoef * numberLayerHalfSize.height - this.radiusPaddingFix.bottom / 2,\r\n\t\t};\r\n\r\n\t\tconst layerNumberDestRadius = getCssValFloat(numberDestEl, 'border-top-left-radius', 2);\r\n\t\tconst indention = layerNumberDestRadius + 4 + numberLayerHalfSize.width;\r\n\t\tif (enableIndentation) {\r\n\r\n\t\t\tpossiblePositionsLT = {\r\n\t\t\t\t...possiblePositionsLT,\r\n\t\t\t\tleftIndented: possiblePositionsLT.left + indention,\r\n\t\t\t\trightIndented: possiblePositionsLT.right - indention,\r\n\t\t\t\ttopIndented: possiblePositionsLT.top + indention,\r\n\t\t\t\tbottomIndented: possiblePositionsLT.bottom - indention,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet isInWindow = this.getIsPossibleNumberPositionsInBoardObject(possiblePositionsLT);\r\n\t\tconst maxAreaBB = this.isFixedPos ? this.winBB : this.docBB;\r\n\t\tif (enableIndentation) {\r\n\t\t\tisInWindow = {\r\n\t\t\t\t...isInWindow,\r\n\t\t\t\tleftIndented: possiblePositionsLT.leftIndented <= bbNumberDest.right - indention\r\n\t\t\t\t\t&& possiblePositionsLT.leftIndented >= this.winBB.left,\r\n\t\t\t\ttopIndented: possiblePositionsLT.topIndented <= bbNumberDest.bottom - indention\r\n\t\t\t\t\t&& possiblePositionsLT.topIndented >= this.winBB.top,\r\n\t\t\t\trightIndented: possiblePositionsLT.rightIndented + this.numberBB.width >= bbNumberDest.left + indention\r\n\t\t\t\t\t&& possiblePositionsLT.rightIndented <= maxAreaBB.right,\r\n\t\t\t\tbottomIndented: possiblePositionsLT.bottomIndented + this.numberBB.height >= bbNumberDest.top + indention\r\n\t\t\t\t\t&& possiblePositionsLT.bottomIndented <= maxAreaBB.bottom\r\n\t\t\t};\r\n\t\t}\r\n\r\n\r\n\r\n\t\tconst allowedPositionKeys = Object.keys(possiblePositionsLT).filter((position) => {\r\n\t\t\treturn isInWindow[position];\r\n\t\t});\r\n\r\n\r\n\t\tlet positionKeysY = ['top', 'bottom'];\r\n\t\tlet positionKeysX = ['left', 'right'];\r\n\r\n\r\n\t\tif (enableIndentation) {\r\n\t\t\tpositionKeysY = [...positionKeysY, 'topIndented', 'bottomIndented'];\r\n\t\t\tpositionKeysX = [...positionKeysX, 'leftIndented', 'rightIndented'];\r\n\t\t}\r\n\r\n\t\tlet finalPositions = [];\r\n\t\tpositionKeysY.forEach((posY, idxY) => {\r\n\t\t\tif (allowedPositionKeys.includes(posY)) {\r\n\t\t\t\tpositionKeysX.forEach((posX, idxX) => {\r\n\t\t\t\t\tif (allowedPositionKeys.includes(posX)) {\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlet score = 0;\r\n\t\t\t\t\t\t\tconst numberPositionType = { x: posX, y: posY };\r\n\r\n\t\t\t\t\t\t\t// indented\r\n\t\t\t\t\t\t\tif (idxY >= 2) score--;\r\n\t\t\t\t\t\t\tif (idxX >= 2) {\r\n\t\t\t\t\t\t\t\tif (posX === 'rightIndented') score -= 0.5; // prefer right indented\r\n\t\t\t\t\t\t\t\telse score--;\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\tconst intersection = this.getNumberIntersectionFeature(possiblePositionsLT, posX, posY, bbOther);\r\n\r\n\t\t\t\t\t\t\tif (intersection) {\r\n\t\t\t\t\t\t\t\tif (iterations === 1) return;\r\n\t\t\t\t\t\t\t\tscore--;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (desiredPosition.x === posX) score++;\r\n\t\t\t\t\t\t\t\tif (desiredPosition.y === posY) score++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfinalPositions.push({\r\n\t\t\t\t\t\t\t\ttype: numberPositionType,\r\n\t\t\t\t\t\t\t\tleft: possiblePositionsLT[posX],\r\n\t\t\t\t\t\t\t\ttop: possiblePositionsLT[posY],\r\n\t\t\t\t\t\t\t\tscore: score,\r\n\t\t\t\t\t\t\t\tisNumberCloseToTooltip: intersection !== null\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfinalPositions.sort((a, b) => {\r\n\t\t\treturn b.score - a.score;\r\n\t\t});\r\n\r\n\r\n\t\tif (finalPositions.length) {\r\n\t\t\tthis.currentNumberPos = finalPositions[0];\r\n\t\t\tthis.currentNumberPos.numberPosCoef = numberPosCoef;\r\n\t\t\tthis.currentNumberPos.indention = indention;\r\n\t\t\tthis.currentNumberPos.numberLayerHalfSize = numberLayerHalfSize;\r\n\r\n\t\t\tif (this.isFixedPos) {\r\n\t\t\t\tthis.currentNumberPos.top += document.documentElement.scrollTop;\r\n\t\t\t\tthis.currentNumberPos.left += document.documentElement.scrollLeft;\r\n\t\t\t}\r\n\r\n\t\t\t/*if (numberSizeCoefCssVar >= 1 && this.currentNumberPos.isNumberCloseToTooltip) {\r\n\t\t\t\tnumberSizeCoefCssVar = 0.9;\r\n\t\t\t\tif (this.options.dpDebugEn) console.log('[dpit] NUMBER POS: Too close to tooltip');\r\n\t\t\t\t//updateCssVar('--num-size-coef', numberSizeCoefCssVar);\r\n\t\t\t\tthis.actualizeNumberBB();\r\n\t\t\t}*/\r\n\r\n\t\t\tif (desiredPosition.onTooltip) {\r\n\t\t\t\tthis.numberEl.classList.add(CLASSES_CORE.number + MODIFIERS.onTooltip);\r\n\t\t\t}\r\n\r\n\t\t\t$(this.numberEl).offset({ top: this.currentNumberPos.top, left: this.currentNumberPos.left });\r\n\t\t\tthis.actualizeNumberBB();\r\n\t\t} else {\r\n\t\t\t// was not found\r\n\t\t\tconst nextRunParams = this.getPlaceNumberRepetitionParams(desiredPosition, iterations);\r\n\t\t\tif (iterations <= nextRunParams.maxIterations) {\r\n\t\t\t\tthis.placeNumber(targetBB, tooltipPos, nextRunParams.desiredPosition, useLastPosition, ++iterations, nextRunParams.enableIndentation);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.numberEl.classList.add(CLASSES_CORE.number + MODIFIERS.hidden);\r\n\t\t\t\tthis.currentNumberPos = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tisNumberCloseToTooltip(numberPositionType, numberBB, tooltipPosBase, isOnTooltip) {\r\n\r\n\t\tconst _tooltipPosBase = isOnTooltip ? getReverseBasePos(tooltipPosBase) : tooltipPosBase;\r\n\t\tif (_tooltipPosBase === numberPositionType.x) {\r\n\t\t\tif (isOnTooltip) {\r\n\t\t\t\tif (this.tooltipBB.top + numberBB.height > this.targetBB.top) return true;\r\n\t\t\t\telse if (this.tooltipBB.bottom - numberBB.height < this.targetBB.bottom) return true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (this.tooltipBB.top - numberBB.height < this.targetBB.top) return true;\r\n\t\t\t\telse if (this.tooltipBB.bottom + numberBB.height > this.targetBB.bottom) return true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (_tooltipPosBase === numberPositionType.y) {\r\n\t\t\tif (isOnTooltip) {\r\n\t\t\t\tif (this.tooltipBB.left + numberBB.width > this.targetBB.left) return true;\r\n\t\t\t\telse if (this.tooltipBB.right - numberBB.width < this.targetBB.right) return true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (this.tooltipBB.left - numberBB.width < this.targetBB.left) return true;\r\n\t\t\t\telse if (this.tooltipBB.right + numberBB.width > this.targetBB.right) return true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tadjustTooltipTopAfterHeightChange(oldTop, oldHeight, tooltipPos, tooltipEl, middleHeightCoef = 0.5) {\r\n\t\tthis.actualizeTooltipScrollBars();\r\n\t\tconst newHeight = $(tooltipEl).height();\r\n\t\tconst heightDiff = newHeight - oldHeight;\r\n\t\tlet newTop = null;\r\n\t\tif (newHeight !== oldHeight) {\r\n\r\n\t\t\tconst isLeftOrRight = ['left', 'right'].includes(tooltipPos.base);\r\n\t\t\tif (isLeftOrRight) {\r\n\t\t\t\tswitch (tooltipPos.align) {\r\n\t\t\t\t\tcase 'middle': newTop = oldTop - heightDiff * middleHeightCoef; break;\r\n\t\t\t\t\tcase 'bottom': newTop = oldTop - heightDiff; break;\r\n\t\t\t\t}\r\n\t\t\t} else if (['top', 'center'].includes(tooltipPos.base)) {\r\n\t\t\t\tnewTop = oldTop - heightDiff;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn newTop;\r\n\t}\r\n\r\n\r\n\r\n\tfixOverWinBoardTopForFixedElements(containerBB) {\r\n\t\tconst topBkp = getCssValFloat(this.tooltipEl, 'top');\r\n\t\tconst tooltipHeightBkp = $(this.tooltipEl).height();\r\n\t\tlet tooltipTextHeight = $(this.tooltipTextEl).height();\r\n\r\n\t\tconst textLayerMaxHeight = Math.floor(Math.max(tooltipTextHeight - (containerBB.top + 1 - this.tooltipBB.top), SIZE_LIMITS_PX.minTooltipContentHeightFixedPos));\r\n\t\tthis.tooltipTextEl.style.height = textLayerMaxHeight + 'px';\r\n\r\n\t\tconst newTop = this.adjustTooltipTopAfterHeightChange(topBkp, tooltipHeightBkp, this.tooltipPos, this.tooltipEl, 1);\r\n\t\tif (newTop) {\r\n\t\t\tthis.tooltipEl.style.top = newTop + 'px';\r\n\t\t\t//this.tooltipEl.style.top = Math.max(this.docBoardBB.top - this.targetBB.top + 1, newTop) + 'px';\r\n\t\t\tthis.actualizeTooltipScrollBars();\r\n\t\t}\r\n\t\tlet isOverTop = this.tooltipBB.top < containerBB.top;\r\n\t\t/*if (isOverTop) {\r\n\t\t\t$(this.tooltipEl).offset({ top: topBkp });\r\n\t\t\tthis.tooltipTextEl.style.height = '';\r\n\t\t\tthis.actualizeTooltipScrollBars();\r\n\t\t\tisOverTop = this.tooltipBB.top < containerBB.top;\r\n\t\t}*/\r\n\t\treturn isOverTop;\r\n\t}\r\n\r\n\r\n\tfixOverWinBoardBottomForFixedElements(containerBB) {\r\n\t\t//console.log('fix over BOTTOM (tooltip on BOTTOM)');\r\n\t\tconst tooltipTextHeight = $(this.tooltipTextEl).height();\r\n\t\tconst textLayerMaxHeight = Math.floor(Math.max(tooltipTextHeight - (this.tooltipBB.bottom - containerBB.bottom + 1), SIZE_LIMITS_PX.minTooltipContentHeightFixedPos));\r\n\r\n\r\n\r\n\t\tthis.tooltipTextEl.style.height = textLayerMaxHeight + 'px';\r\n\t\tthis.actualizeTooltipScrollBars();\r\n\t\tlet isOverBottom = this.tooltipBB.bottom > containerBB.bottom;\r\n\t\tif (isOverBottom) {\r\n\t\t\tthis.tooltipTextEl.style.height = '';\r\n\t\t\tthis.actualizeTooltipScrollBars();\r\n\t\t\tisOverBottom = this.tooltipBB.bottom > containerBB.bottom;\r\n\t\t}\r\n\t\treturn isOverBottom;\r\n\t}\r\n\r\n\tactualizeTextScrollbar() {\r\n\t\tif (hasElementScrollBarY(this.tooltipTextEl)) {\r\n\t\t\tthis.tooltipTextEl.classList.add(CLASSES_CORE.hasScrollBar);\r\n\t\t} else {\r\n\t\t\tthis.tooltipTextEl.classList.remove(CLASSES_CORE.hasScrollBar);\r\n\t\t}\r\n\t}\r\n\r\n\tactualizeTooltipScrollBars() {\r\n\t\tthis.actualizeBulletScrollBar(false);\r\n\t\tthis.actualizeTextScrollbar();\r\n\t\tthis.actualizeTooltipBB();\r\n\t}\r\n\r\n\tfixPositionOutOfTheBoard(boardBB) {\r\n\t\t//let res = false;\r\n\t\tif (this.tooltipBB.bottom > boardBB.bottom && ['bottom', 'left', 'right', 'center'].includes(this.tooltipPos.base)) { // add center\r\n\t\t\t/*res |= */this.fixOverWinBoardBottomForFixedElements(boardBB);\r\n\t\t}\r\n\t\tif (this.tooltipBB.top < boardBB.top && ['top', 'left', 'right', 'center'].includes(this.tooltipPos.base)) {  // add center\r\n\t\t\t/*res |= */this.fixOverWinBoardTopForFixedElements(boardBB);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tfixPositionOutOfTheWindowForNotFixedElements() {\r\n\t\tlet res = false;\r\n\t\tthis.actualizeFlier(true);\r\n\t\tif (this.flierBB) {\r\n\t\t\tif (this.flierBB.height > this.winBB.height) {\r\n\t\t\t\tconst topBkp = $(this.tooltipEl).offset().top;\r\n\t\t\t\tconst tooltipHeightBkp = $(this.tooltipEl).height();\r\n\t\t\t\t//console.log('fix over BOTTOM (tooltip on BOTTOM)');\r\n\t\t\t\tconst tooltipTextHeight = $(this.tooltipTextEl).height();\r\n\t\t\t\tif (tooltipTextHeight < SIZE_LIMITS_PX.minTooltipContentHeight) return;\r\n\t\t\t\tconst requiredHeightDiff = this.winBB.height - this.flierBB.height;\r\n\r\n\t\t\t\tconst textLayerMaxHeight = Math.max(tooltipTextHeight + requiredHeightDiff, SIZE_LIMITS_PX.minTooltipContentHeight);\r\n\r\n\t\t\t\tthis.tooltipTextEl.style.height = textLayerMaxHeight + 'px';\r\n\t\t\t\tconst newTop = this.adjustTooltipTopAfterHeightChange(topBkp, tooltipHeightBkp, this.tooltipPos, this.tooltipEl);\r\n\t\t\t\tif (newTop) {\r\n\t\t\t\t\t$(this.tooltipEl).offset({ top: Math.max(this.winBoardBB.top, newTop) });\r\n\t\t\t\t\tthis.actualizeTooltipScrollBars();\r\n\t\t\t\t}\r\n\t\t\t\tthis.actualizeFlier(true);\r\n\t\t\t}\r\n\t\t\tres = this.fixPositionOutOfTheBoard(this.docBoardBB);\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\r\n\tfixPositionOutOfTheWindow() {\r\n\t\tlet res = false;\r\n\t\tif (this.isFixedPos) res = this.fixPositionOutOfTheBoard(this.winBoardBB);\r\n\t\telse res = this.fixPositionOutOfTheWindowForNotFixedElements();\r\n\t\tthis.actualizeTextScrollbar();\r\n\t\treturn res;\r\n\t}\r\n\r\n\tgetDummyTooltipPosition() {\r\n\t\treturn { base: 'center', align: 'middle', width: this.tooltipBB.width };\r\n\t}\r\n\r\n\t/**\r\n\t\t * Determines the position of the tooltip based on the position precedence and availability\r\n\t\t * of screen space.\r\n\t\t *\r\n\t\t */\r\n\tdetermineTooltipPosition(targetItem, arrowSizes, isCrowdedPos) {\r\n\t\tif (this.isDummyMode()) return this.getDummyTooltipPosition();\r\n\t\tlet calculatedPosition = { base: 'bottom', align: 'middle', width: this.tooltipBB.width };\r\n\t\t//if (this.isStickyTheme()) return calculatedPosition;\r\n\t\tlet desiredTooltipPosition = targetItem.position;\r\n\r\n\t\tif (isCrowdedPos[desiredTooltipPosition]) {\r\n\t\t\tconst reversePosition = getReverseBasePos(desiredTooltipPosition);\r\n\t\t\tif (!isCrowdedPos[reversePosition])\r\n\t\t\t\tdesiredTooltipPosition = reversePosition;\r\n\t\t}\r\n\r\n\t\tconst possiblePositionsScoreInc = {};\r\n\t\tthis.options.positionPrecedence.forEach((position) => {\r\n\t\t\tpossiblePositionsScoreInc[position] = {\r\n\t\t\t\tscore: 0,\r\n\t\t\t\tdisabled: false\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tlet tooltipSizesArrowInc = {\r\n\t\t\twidth: this.tooltipBB.width + arrowSizes.width / 2 + this.options.tooltipDistanceFromTarget,\r\n\t\t\theight: this.tooltipBB.height + arrowSizes.height / 2 + this.options.tooltipDistanceFromTarget\r\n\t\t};\r\n\r\n\t\tlet newTooltipWidthArrowInc = {\r\n\t\t\tleft: tooltipSizesArrowInc.width,\r\n\t\t\tright: tooltipSizesArrowInc.width\r\n\t\t};\r\n\t\tlet newTooltipWidth = {\r\n\t\t\tleft: null,\r\n\t\t\tright: null\r\n\t\t};\r\n\r\n\t\tconst maxArea = this.isFixedPos ? this.winBoardBB : this.docBoardBB;\r\n\r\n\t\tconst rightWidthArrowInc = maxArea.right - this.targetBB.right;\r\n\t\tconst rightWidth = rightWidthArrowInc - arrowSizes.width / 2 - this.options.tooltipDistanceFromTarget;\r\n\t\tif (rightWidth > this.minTooltipWidth && rightWidth < this.tooltipBB.width) {\r\n\t\t\tnewTooltipWidthArrowInc.right = rightWidthArrowInc;\r\n\t\t\tnewTooltipWidth.right = rightWidth;\r\n\t\t}\r\n\r\n\t\tconst leftWidthArrowInc = this.targetBB.left - maxArea.left;\r\n\t\tconst leftWidth = leftWidthArrowInc - arrowSizes.width / 2 - this.options.tooltipDistanceFromTarget;\r\n\t\tif (leftWidth > this.minTooltipWidth && leftWidth < this.tooltipBB.width) {\r\n\t\t\tnewTooltipWidthArrowInc.left = leftWidthArrowInc;\r\n\t\t\tnewTooltipWidth.left = leftWidth;\r\n\t\t}\r\n\r\n\t\tconst minTargetCenterHeight = (desiredTooltipPosition === 'center') ? this.targetBB.height : this.targetBB.height / 2;\r\n\r\n\r\n\t\t// BOTTOM - check for space below\r\n\t\tlet bottomSpaceHardLimit = 0;\r\n\t\tif (this.isFixedPos) {\r\n\t\t\tbottomSpaceHardLimit = this.winBoardBB.bottom - (this.targetBB.bottom + SIZE_LIMITS_PX.minTooltipHeight); // height can be decreased for fixed to minimal height\r\n\t\t}\r\n\t\telse {\r\n\t\t\tbottomSpaceHardLimit = this.docBoardBB.bottom - (this.targetBB.bottom + tooltipSizesArrowInc.height);\r\n\t\t}\r\n\r\n\t\tpossiblePositionsScoreInc['bottom'].disabled = bottomSpaceHardLimit < 0;\r\n\r\n\t\t// Score (soft limit)\r\n\t\tif (isCrowdedPos.bottom) possiblePositionsScoreInc['bottom'].score -= 1;\r\n\t\telse {\r\n\t\t\tlet bottomSpaceSoftLimit = this.isFixedPos\r\n\t\t\t\t? (this.winBoardBB.bottom - (this.targetBB.bottom + tooltipSizesArrowInc.height))\r\n\t\t\t\t: bottomSpaceHardLimit;\r\n\t\t\tpossiblePositionsScoreInc['bottom'].score += bottomSpaceSoftLimit / this.winBoardBB.height;\r\n\t\t}\r\n\r\n\t\t// TOP - check for space above\r\n\t\tlet topSpaceHardLimit = 0;\r\n\t\tif (this.isFixedPos) {\r\n\t\t\ttopSpaceHardLimit = (this.targetBB.top - SIZE_LIMITS_PX.minTooltipHeight) - this.winBoardBB.top; // height can be decreased for fixed to minimal height\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttopSpaceHardLimit = (this.targetBB.top - tooltipSizesArrowInc.height) - this.docBoardBB.top;\r\n\t\t}\r\n\t\tpossiblePositionsScoreInc['top'].disabled = topSpaceHardLimit < 0;\r\n\r\n\t\t// Score (soft limit)\r\n\t\tif (isCrowdedPos.bottom) possiblePositionsScoreInc['top'].score -= 1;\r\n\t\telse {\r\n\t\t\tlet topSpaceSoftLimit = this.isFixedPos\r\n\t\t\t\t? ((this.targetBB.top - tooltipSizesArrowInc.height) - this.winBoardBB.top)\r\n\t\t\t\t: topSpaceHardLimit;\r\n\t\t\tpossiblePositionsScoreInc['top'].score += topSpaceSoftLimit / this.winBoardBB.height;\r\n\t\t}\r\n\r\n\r\n\t\t/*\r\n\t\tpossiblePositionsScoreInc['top'].disabled = ( !this.isFixedPos && this.targetBB.top - tooltipSizesArrowInc.height < maxArea.top);\r\n\t\tif (isCrowdedPos.top) possiblePositionsScoreInc['top'].score -= 1;\r\n\t\telse{\r\n\t\t\tlet topBottomScore = 0;\r\n\t\t\tif (this.isFixedPos){\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ttopBottomScore = (this.winBB.height - targetWithTooltipHeightTopBottom) / this.winBB.height;\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tpossiblePositionsScoreInc['top'].score += topBottomScore;\r\n\t\t}*/\r\n\r\n\t\t// Check for space to the right\r\n\t\tpossiblePositionsScoreInc['right'].disabled = (this.targetBB.right + newTooltipWidthArrowInc.right > maxArea.right + 1); // +1 i don't know why yet\r\n\t\tpossiblePositionsScoreInc['right'].score += (isCrowdedPos.right ? -1 : 1 - (newTooltipWidthArrowInc.right / (this.winBB.width - this.targetBB.right)));\r\n\r\n\t\t// Check for space to the left\r\n\t\tpossiblePositionsScoreInc['left'].disabled = (this.targetBB.left - newTooltipWidthArrowInc.left < maxArea.left);\r\n\t\tpossiblePositionsScoreInc['left'].score += (isCrowdedPos.left ? -1 : 1 - (newTooltipWidthArrowInc.left / this.targetBB.left));\r\n\r\n\t\t// Check for space inside\r\n\t\tpossiblePositionsScoreInc['center'].disabled = this.targetBB.width <= this.tooltipBB.width || minTargetCenterHeight <= this.tooltipBB.height;\r\n\t\tif (this.targetBB.width - this.tooltipBB.width < this.targetBB.height - this.tooltipBB.height) {\r\n\t\t\tpossiblePositionsScoreInc['center'].score += (this.targetBB.width - this.tooltipBB.width) / this.targetBB.width - 0.5;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpossiblePositionsScoreInc['center'].score += (this.targetBB.height - this.tooltipBB.height) / this.targetBB.height - 0.5;\r\n\t\t}\r\n\r\n\t\tconst possiblePositionsScoreIncArr = [];\r\n\t\tObject.keys(possiblePositionsScoreInc).forEach((pos) => {\r\n\t\t\tif (!possiblePositionsScoreInc[pos].disabled) {\r\n\t\t\t\tpossiblePositionsScoreIncArr.push({\r\n\t\t\t\t\tposition: pos,\r\n\t\t\t\t\tscore: possiblePositionsScoreInc[pos].score\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tpossiblePositionsScoreIncArr.sort((a, b) => {\r\n\t\t\treturn b.score - a.score;\r\n\t\t});\r\n\t\t//if (this.options.dpDebugEn) console.log(possiblePositionsScoreIncArr);\r\n\r\n\t\tconst possiblePositions = possiblePositionsScoreIncArr.map((val) => {\r\n\t\t\treturn val.position;\r\n\t\t});\r\n\t\t//if (this.options.dpDebugEn) console.log(possiblePositions);\r\n\r\n\t\t// @var {String}  ex: 'right-aligned'\r\n\t\tvar desiredAlignment = (function (pos) {\r\n\t\t\tvar hyphenIndex = pos.indexOf('-');\r\n\t\t\tif (hyphenIndex !== -1) {\r\n\t\t\t\t// has alignment\r\n\t\t\t\treturn pos.substr(hyphenIndex);\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t})(desiredTooltipPosition || '');\r\n\r\n\t\t// strip alignment from position\r\n\t\tif (desiredTooltipPosition) {\r\n\t\t\t// ex: \"bottom-right-aligned\"\r\n\t\t\t// should return 'bottom'\r\n\t\t\tdesiredTooltipPosition = desiredTooltipPosition.split('-')[0];\r\n\t\t}\r\n\r\n\r\n\r\n\t\tif (possiblePositions.length) {\r\n\r\n\t\t\tif (desiredTooltipPosition !== 'auto') {\r\n\t\t\t\tconst desiredPosIdx = possiblePositions.indexOf(desiredTooltipPosition);\r\n\t\t\t\tif (desiredPosIdx > -1\r\n\t\t\t\t\t&& (\r\n\t\t\t\t\t\tpossiblePositionsScoreIncArr[desiredPosIdx].score > 0\r\n\t\t\t\t\t\t|| possiblePositionsScoreIncArr[0].score < 0\r\n\t\t\t\t\t\t|| desiredTooltipPosition === 'center')\r\n\t\t\t\t) {\r\n\t\t\t\t\tcalculatedPosition.base = desiredTooltipPosition;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcalculatedPosition.base = possiblePositions[0];\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// Pick the first valid position, in order\r\n\t\t\t\tcalculatedPosition.base = possiblePositions[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// top and bottom alignments\r\n\t\tif (['top', 'bottom'].indexOf(calculatedPosition.base) !== -1) {\r\n\t\t\tcalculatedPosition.align = this.determineTooltipAlignmentX(\r\n\t\t\t\tthis.targetBB,\r\n\t\t\t\ttooltipSizesArrowInc.width,\r\n\t\t\t\tdesiredAlignment,\r\n\t\t\t\tmaxArea\r\n\t\t\t);\r\n\t\t}\r\n\t\t//  left and right positions alignments\r\n\t\telse if (['left', 'right'].indexOf(calculatedPosition.base) !== -1) {\r\n\t\t\tif (newTooltipWidth[calculatedPosition.base]) calculatedPosition.width = newTooltipWidth[calculatedPosition.base];\r\n\r\n\t\t\tcalculatedPosition.align = this.determineTooltipAlignmentY(\r\n\t\t\t\tthis.targetBB,\r\n\t\t\t\tMath.min(tooltipSizesArrowInc.height, SIZE_LIMITS_PX.minTooltipHeight),\r\n\t\t\t\tdesiredAlignment,\r\n\t\t\t\tmaxArea\r\n\t\t\t);\r\n\r\n\t\t}\r\n\t\telse if (calculatedPosition.base === 'center') {\r\n\t\t\tcalculatedPosition.align = 'middle';\r\n\t\t}\r\n\r\n\t\t//if (this.options.dpDebugEn) console.log(calculatedPosition);\r\n\r\n\t\treturn calculatedPosition;\r\n\t}\r\n\r\n\r\n\r\n\tdetermineTooltipAlignmentX = (targetBB, tooltipWidth, desiredAlignment, maxArea) => {\r\n\t\tconst calculateTooltipAlignmentScore = (tooltipLeft, tooltipWidth, maxArea) => {\r\n\t\t\tconst tooltipRight = tooltipLeft + tooltipWidth;\r\n\t\t\tconst overLeft = maxArea.left - tooltipLeft;\r\n\t\t\tconst overRight = tooltipRight - maxArea.right;\r\n\t\t\tconst overLeftCoef = overLeft > 0 ? 2 : 0.5;\r\n\t\t\tconst overRightCoef = overRight > 0 ? 2 : 0.5;\r\n\t\t\tconst score = 1 - (overLeft * overLeftCoef + overRight * overRightCoef) / maxArea.width;\r\n\t\t\treturn score;\r\n\t\t};\r\n\r\n\t\tconst targetCenterX = targetBB.left + targetBB.width / 2;\r\n\t\tconst possibleXAlignments = [\r\n\t\t\t{ id: 'center', score: calculateTooltipAlignmentScore(targetCenterX - 0.5 * tooltipWidth, tooltipWidth, maxArea) },\r\n\t\t\t{ id: 'left', score: calculateTooltipAlignmentScore(targetBB.left, tooltipWidth, maxArea) },\r\n\t\t\t{ id: 'right', score: calculateTooltipAlignmentScore(targetBB.right - tooltipWidth, tooltipWidth, maxArea) },\r\n\t\t];\r\n\r\n\t\tpossibleXAlignments.sort((a, b) => {\r\n\t\t\treturn b.score - a.score;\r\n\t\t});\r\n\t\tlet res = 'center';\r\n\t\tif (possibleXAlignments.length) {\r\n\r\n\t\t\tif (possibleXAlignments.indexOf(desiredAlignment) !== -1) {\r\n\t\t\t\t// the desired alignment is valid\r\n\t\t\t\tres = desiredAlignment;\r\n\t\t\t} else {\r\n\t\t\t\t// pick the first valid position, in order\r\n\t\t\t\tres = possibleXAlignments[0].id;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.options.dpDebugEn) console.log('[dpit] TOOLTIP X ALIGNMENT:', res, 'Data:', possibleXAlignments);\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tdetermineTooltipAlignmentY = (targetBB, tooltipHeight, desiredAlignment, maxArea) => {\r\n\t\tconst calculateTooltipAlignmentScore = (tooltipTop, tooltipHeight, maxArea) => {\r\n\t\t\tconst tooltipBottom = tooltipTop + tooltipHeight;\r\n\t\t\tconst overTop = maxArea.top - tooltipTop;\r\n\t\t\tconst overBottom = tooltipBottom - maxArea.bottom;\r\n\t\t\tconst overTopCoef = overTop > 0 ? 2 : 0.5;\r\n\t\t\tconst overBottomCoef = overBottom > 0 ? 2 : 0.5;\r\n\t\t\tconst score = 1 - (overTop * overTopCoef + overBottom * overBottomCoef) / maxArea.height;\r\n\t\t\treturn score;\r\n\t\t};\r\n\r\n\t\tconst targetCenterY = targetBB.top + targetBB.height / 2;\r\n\t\tconst possibleYAlignments = [\r\n\t\t\t{ id: 'middle', score: calculateTooltipAlignmentScore(targetCenterY - 0.5 * tooltipHeight, tooltipHeight, maxArea) },\r\n\t\t\t{ id: 'top', score: calculateTooltipAlignmentScore(targetBB.top, tooltipHeight, maxArea) },\r\n\t\t\t{ id: 'bottom', score: calculateTooltipAlignmentScore(targetBB.bottom - tooltipHeight, tooltipHeight, maxArea) },\r\n\t\t];\r\n\r\n\t\tpossibleYAlignments.sort((a, b) => {\r\n\t\t\treturn b.score - a.score;\r\n\t\t});\r\n\t\tlet res = 'middle';\r\n\t\tif (possibleYAlignments.length) {\r\n\r\n\t\t\tif (possibleYAlignments.indexOf(desiredAlignment) !== -1) {\r\n\t\t\t\t// the desired alignment is valid\r\n\t\t\t\tres = desiredAlignment;\r\n\t\t\t} else {\r\n\t\t\t\t// pick the first valid position, in order\r\n\t\t\t\tres = possibleYAlignments[0].id;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.options.dpDebugEn) console.log('[dpit] TOOLTIP Y ALIGNMENT:', res, 'Data:', possibleYAlignments);\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tactualizeOverSizeRadiuses(layerElement, baseLayerClass = CLASSES_CORE.highlight) {\r\n\t\tif (layerElement) {\r\n\t\t\tlayerElement.classList.remove(\r\n\t\t\t\tbaseLayerClass + MODIFIERS.overLeft,\r\n\t\t\t\tbaseLayerClass + MODIFIERS.overTop,\r\n\t\t\t\tbaseLayerClass + MODIFIERS.overRight,\r\n\t\t\t\tbaseLayerClass + MODIFIERS.overBottom,\r\n\t\t\t);\r\n\t\t\tif (this.targetBB.left <= 0) {\r\n\t\t\t\tlayerElement.classList.add(baseLayerClass + MODIFIERS.overLeft);\r\n\t\t\t}\r\n\t\t\tif (this.targetBB.top <= 0) {\r\n\t\t\t\tlayerElement.classList.add(baseLayerClass + MODIFIERS.overTop);\r\n\t\t\t}\r\n\t\t\tif (this.targetBB.right >= this.docBB.right) {\r\n\t\t\t\tlayerElement.classList.add(baseLayerClass + MODIFIERS.overRight);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.targetBB.bottom >= this.docBB.bottom) {\r\n\t\t\t\tlayerElement.classList.add(baseLayerClass + MODIFIERS.overBottom);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tmoveLayer2Target = (layer) => {\r\n\t\tif (layer) {\r\n\t\t\tif (this.isFixedPos) {\r\n\t\t\t\tlayer.classList.add(CLASSES_CORE.fixedPosition);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlayer.classList.remove(CLASSES_CORE.fixedPosition);\r\n\t\t\t}\r\n\t\t\tif (this.targetBB) DpitBB.toElement(layer, this.targetBB);\r\n\t\t}\r\n\t};\r\n\r\n\tplaceTargetPosBasedLayers(actualizeOverSizeRadiuses = true) {\r\n\t\tthis.moveLayer2Target(this.tooltipRefEl);\r\n\t\tthis.moveLayer2Target(this.highlightEl);\r\n\t\tif (actualizeOverSizeRadiuses) this.actualizeOverSizeRadiuses(this.highlightEl, CLASSES_CORE.highlight);\r\n\t}\r\n\r\n\tactualizeUserInteraction(stepItem) {\r\n\t\tif (this.userInteraction) {\r\n\t\t\tthis.userInteraction.updateDisableInteractionLayer(\r\n\t\t\t\tstepItem ? stepItem : this.stepItem, this.wrapEl,\r\n\t\t\t\tthis.moveLayer2Target\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tisUserInteractionEnabled() {\r\n\t\treturn !this.userInteraction?.disableInteractionLayer;\r\n\t}\r\n\r\n\tactualizeTargetItem = (stepItem, isInit = false) => {\r\n\t\tthis.isTargetInMobileMenu = false;\r\n\t\tthis.isTargetMobileAlt = false;\r\n\t\tif (stepItem) {\r\n\r\n\t\t\tthis.isTargetMobileAlt = this.isStepMobileAlt(stepItem);\r\n\t\t\t// Set stepItem.element\r\n\t\t\tif (this.isTargetMobileAlt) {\r\n\t\t\t\tstepItem.element = documentQuerySelectorSafe(stepItem.alt_mobile_selector);\r\n\t\t\t}\r\n\t\t\telse if (stepItem.selector) {\r\n\t\t\t\tstepItem.element = documentQuerySelectorSafe(stepItem.selector);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tstepItem.element = null;\r\n\t\t\t}\r\n\t\t\t// Skip not visible steps\r\n\t\t\tif (!isInit) {\r\n\t\t\t\tthis.isTargetInMobileMenu = this.isStepItemInMobileMenu(stepItem);\r\n\t\t\t\t//this.updateIterateAfter(stepItem);\r\n\t\t\t\tif (this.userInteraction) {\r\n\t\t\t\t\tthis.userInteraction.update(stepItem);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tclearMobileMenuTarget() {\r\n\t\tthis.isTargetInMobileMenu = false;\r\n\t\tthis.isTargetMobileAlt = false;\r\n\t}\r\n\r\n\tisStepMobileAlt(stepItem) {\r\n\t\treturn this.isMobileSize && stepItem.alt_mobile_selector;\r\n\t}\r\n\r\n\tisStepItemInMobileMenu(stepItem) {\r\n\t\treturn this.isStepMobileAlt(stepItem) && stepItem.is_in_mobile_menu === '1';\r\n\t}\r\n\r\n\tskipCurrentStep() {\r\n\t\t// skipping step\r\n\t\tif (!this.isBackward) {\r\n\t\t\t// skipping forward\r\n\t\t\tif (this.stepIdx < this.stepItems.length - 1) {\r\n\t\t\t\tif (this.stepIdx === 0) this.visibleFirstStepShouldBeEvaluated = true;\r\n\t\t\t\tthis.goToNextStep();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.visibleLastStepShouldBeEvaluated = true;\r\n\t\t\t\tthis.goToPrevStep();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// skipping backward\r\n\t\t\tif (this.stepIdx > 0) {\r\n\t\t\t\tif (this.stepIdx === this.stepItems.length - 1) this.visibleLastStepShouldBeEvaluated = true;\r\n\t\t\t\tthis.goToPrevStep();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.visibleFirstStepShouldBeEvaluated = true;\r\n\t\t\t\tthis.goToNextStep();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcheckTargetElValidity() {\r\n\t\t//const isElementVisible = isElementVisibleParentInc(this.stepItem.element);\r\n\r\n\t\tconst skipStep = this.shouldBeStepSkipped(this.stepItem, this.isTargetInMobileMenu, true);\r\n\t\tthis.setNotVisibleRefBullet(this.stepItem.step, skipStep);\r\n\t\tif (skipStep) {\r\n\t\t\tthis.skipCurrentStep();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.actualizeDummyMode();\r\n\r\n\t\tif (this.visibleLastStepShouldBeEvaluated) {\r\n\t\t\tthis.visibleLastStepIdx = this.stepIdx;\r\n\t\t\tthis.visibleLastStepShouldBeEvaluated = false;\r\n\t\t}\r\n\t\tif (this.visibleFirstStepShouldBeEvaluated) {\r\n\t\t\tthis.visibleFirstStepIdx = this.stepIdx;\r\n\t\t\tthis.visibleFirstStepShouldBeEvaluated = false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\thasTargetItemHiddenOverlay(item) {\r\n\t\tif (item) {\r\n\t\t\treturn item\r\n\t\t\t\t&& item.element\r\n\t\t\t\t&& item.enable_interaction.val == '1'\r\n\t\t\t\t&& !this.isDummyMode()\r\n\t\t\t\t&& item.enable_interaction.ext?.hide_overlay == '1';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tisHideNextByCurrentStepMeta() {\r\n\t\treturn this.stepItem\r\n\t\t\t&& this.stepItem.element\r\n\t\t\t&& this.stepItem.enable_interaction.val == '1'\r\n\t\t\t//&& !this.this.stepItem.isDummyElement\r\n\t\t\t&& this.stepItem.enable_interaction.ext?.hide_next_btn == '1';\r\n\t}\r\n\r\n\r\n\tgetIsMobileSize(breakPointOverride = null, winBB = this.winBB) {\r\n\t\treturn this.mainCfg.mobile_break_points && (winBB.width <= (breakPointOverride ? breakPointOverride : this.mainCfg.mobile_break_points.mobile));\r\n\t}\r\n\r\n\tenableStepSkippingWhenNotFoundRefEl() {\r\n\t\tthis.disabledStepSkippingWhenNotFoundRefEl = false;\r\n\t}\r\n\r\n\tdisableStepSkippingWhenNotFoundRefEl() {\r\n\t\tthis.disabledStepSkippingWhenNotFoundRefEl = true;\r\n\t}\r\n\r\n\tshouldBeStepSkipped(stepItem, isTargetInMobileMenu, isElementVisible = true) {\r\n\t\tlet skipStep = false;\r\n\t\tif (this.options.skip_absent_ref_el && !this.disabledStepSkippingWhenNotFoundRefEl\r\n\r\n\t\t\t&& (stepItem.selector || isTargetInMobileMenu)\r\n\t\t\t&& (!stepItem.element || (!isElementVisible && !isTargetInMobileMenu))\r\n\t\t) {\r\n\t\t\tskipStep = true;\r\n\t\t}\r\n\t\treturn skipStep;\r\n\r\n\t}\r\n\r\n\tisElementInsideDocBoard(element) {\r\n\t\tif (this.docBB && element) {\r\n\t\t\tconst bb = DpitBB.fromElement(element);\r\n\t\t\treturn DpitBB.intersect(bb, this.docBB) !== null;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgetHighlightLayerClassName() {\r\n\t\tconst res = [CLASSES_CORE.highlight];\r\n\t\tif (typeof (this.options.highlightClass) === 'string' && this.options.highlightClass) {\r\n\t\t\tres.push(this.options.highlightClass);\r\n\t\t}\r\n\t\treturn res.join(' ');\r\n\t}\r\n\r\n\tgetStartStepIdx() {\r\n\t\tif (this.visibleFirstStepIdx) return this.visibleFirstStepIdx;\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tgetEndStepIdx() {\r\n\t\tif (this.visibleLastStepIdx) return this.visibleLastStepIdx;\r\n\t\treturn this.stepItems.length - 1;\r\n\t}\r\n\r\n\tgetStepContent(stepItem) {\r\n\r\n\t\t/*return this.tooltipTextEl.innerHTML = `What is Lorem Ipsum?\r\n\t\tLorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.\r\n\t\tWhy do we use it?\r\n\t\tIt is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters, as opposed to using 'Content here, content here', making it look like readable English. Many desktop publishing packages and web page editors now use Lorem Ipsum as their default model text, and a search for 'lorem ipsum' will uncover many web sites still in their infancy. Various versions have evolved over the years, sometimes by accident, sometimes on purpose (injected humour and the like).\r\n\t\tWhere does it come from?\r\n\t\tContrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of \"de Finibus Bonorum et Malorum\" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, \"Lorem ipsum dolor sit amet..\", comes from a line in section 1.10.32.\r\n\t\tThe standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from \"de Finibus Bonorum et Malorum\" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.\r\n\t\tWhere can I get some?\r\n\t\tThere are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of text. All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.`;\r\n*/\r\n\t\treturn stepItem ? stepItem.intro_proc || stepItem.intro : '';\r\n\t}\r\n\r\n\tsetTooltipContent(stepItem) {\r\n\t\tthis.tooltipTextEl.innerHTML = this.getStepContent(stepItem);\r\n\t}\r\n\r\n\r\n\tactualizeButtonFocus = (isFirstStep, isLastStep) => {\r\n\t\tif (this.options.controlsAutoFocusEnable) {\r\n\t\t\tlet elementToFocusOn = this.isBackward ? this.buttonPrevEl : this.buttonNextEl;\r\n\t\t\tif (isLastStep) elementToFocusOn = this.buttonCancelEl;\r\n\t\t\telse if (isFirstStep && this.stepItems.length > 1) elementToFocusOn = this.buttonNextEl;\r\n\r\n\t\t\tif (elementToFocusOn && elementToFocusOn !== document.activeElement) {\r\n\t\t\t\telementToFocusOn.focus({ preventScroll: true, focusVisible: false });\r\n\t\t\t\tif (this.options.dpDebugEn) {\r\n\t\t\t\t\tconst $buttonTextEl = $(elementToFocusOn).children('.' + CLASSES_CHILD.buttonText);\r\n\t\t\t\t\tif ($buttonTextEl.length)\r\n\r\n\t\t\t\t\t\tconsole.log('[dpit] AUTO FOCUS: ' + $buttonTextEl.text(), elementToFocusOn);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tactivateBullet(idx) {\r\n\t\t$(this.bulletsLayer).find('li.active').removeClass('active');\r\n\t\t$(this.bulletsLayer).find(`li[data-step-number=\"${idx}\"]`).addClass('active').attr('aria-selected', 'true');\r\n\t}\r\n\r\n\tsetNotVisibleRefBullet(idx, notVisible = true) {\r\n\t\tif (notVisible) $(this.bulletsLayer).find(`li[data-step-number=\"${idx}\"]`).addClass('not-visible-ref');\r\n\t\telse {\r\n\t\t\t$(this.bulletsLayer).find(`li[data-step-number=\"${idx}\"]`).removeClass('not-visible-ref');\r\n\t\t\tif (this.visibleLastStepIdx && idx > this.visibleLastStepIdx) {\r\n\t\t\t\tthis.visibleLastStepIdx = idx;\r\n\t\t\t}\r\n\t\t\tif (this.visibleFirstStepIdx && idx < this.visibleFirstStepIdx) {\r\n\t\t\t\tthis.visibleFirstStepIdx = idx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetNotVisibleStepCnt() {\r\n\t\treturn $(this.bulletsLayer).find('li.not-visible-ref').length;\r\n\t}\r\n\r\n\tactualizeProgressBar() {\r\n\t\tconst isProgressBarEnabled = this.isProgressBarEnabled();\r\n\t\tif (isProgressBarEnabled) {\r\n\t\t\tshowElement(this.progressLayer);\r\n\t\t\tconst progressVal = this.getProgressInPercent();\r\n\t\t\tthis.progressBarLayer.style.cssText = 'width:' + progressVal + '%;';\r\n\t\t\tthis.progressBarLayer.setAttribute('aria-valuenow', progressVal);\r\n\t\t}\r\n\t\tthis.actualizeLayer(isProgressBarEnabled, this.progressLayer);\r\n\t}\r\n\r\n\tisBulletNavig() {\r\n\t\treturn this.options.showBullets && this.stepItems.length > 1;\r\n\t}\r\n\r\n\tactualizeBulletsNavigActiveItem() {\r\n\r\n\t\tif (this.options.disable_navigation_by_bullets) $(this.bulletsLayer).addClass(CLASSES_CORE.bullets + '--disabled');\r\n\t\telse $(this.bulletsLayer).removeClass(CLASSES_CORE.bullets + '--disabled');\r\n\r\n\t\tconst isBulletsNavigEnabled = this.isBulletNavig();\r\n\t\tif (isBulletsNavigEnabled) {\r\n\t\t\t// Adjusting bullets - skipped steps\r\n\t\t\tif (this.visibleLastStepIdx) {\r\n\t\t\t\tfor (let i = this.visibleLastStepIdx + 1; i < this.stepItems.length; i++) {\r\n\t\t\t\t\tthis.setNotVisibleRefBullet(i + 1, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.visibleFirstStepIdx) {\r\n\t\t\t\tfor (let i = this.visibleFirstStepIdx - 1; i >= 0; i--) {\r\n\t\t\t\t\tthis.setNotVisibleRefBullet(i + 1, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//change active bullet\r\n\t\t\tif (this.stepItem) this.activateBullet(this.stepItem.step);\r\n\t\t}\r\n\t\tthis.actualizeLayer(isBulletsNavigEnabled, this.bulletsLayer);\r\n\t}\r\n\r\n\tactualizeBulletScrollBar(autoScroll = true) {\r\n\t\tlet res = false;\r\n\t\tif (this.listInBulletsNavigLayer) {\r\n\t\t\tif (hasElementScrollBarX(this.listInBulletsNavigLayer)) {\r\n\t\t\t\tif (!this.listInBulletsNavigLayer.classList.contains(CLASSES_CORE.hasScrollBar)) {\r\n\t\t\t\t\tres = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.listInBulletsNavigLayer.classList.add(CLASSES_CORE.hasScrollBar);\r\n\t\t\t\tif (autoScroll) {\r\n\t\t\t\t\tconst activeEl = this.listInBulletsNavigLayer.querySelector('li.active');\r\n\t\t\t\t\tif (activeEl) {\r\n\t\t\t\t\t\tscrollIntoView(activeEl, {\r\n\t\t\t\t\t\t\tvalidTarget: target => target === this.listInBulletsNavigLayer,\r\n\t\t\t\t\t\t\ttime: 300\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (this.listInBulletsNavigLayer.classList.contains(CLASSES_CORE.hasScrollBar)) {\r\n\t\t\t\t\tres = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.listInBulletsNavigLayer.classList.remove(CLASSES_CORE.hasScrollBar);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tactualizeSkipButton(buttonSkipLabel) {\r\n\t\t//this.buttonCancelEl.setAttribute('title', '');\r\n\t\tthis.buttonSkipTextLayer.innerHTML = buttonSkipLabel;\r\n\t}\r\n\r\n\tactualizeButtons() {\r\n\t\t// Buttons\r\n\t\tlet isHideNextByCurrentStepMeta = this.isHideNextByCurrentStepMeta(this.step);\r\n\t\tconst isLastStep = this.stepIdx >= this.getEndStepIdx();\r\n\t\tconst isFirstStep = this.stepIdx <= this.getStartStepIdx();\r\n\r\n\r\n\t\tconst buttonPrevClass = classNames({\r\n\t\t\t[this.options.buttonClass]: true,\r\n\t\t\t[CLASSES_CORE.buttonPrev]: true,\r\n\t\t\t[CLASSES_CORE.hiddenHard]: this.options.hide_previous_step_button,\r\n\t\t\t[CLASSES_CORE.disabled]: isFirstStep,\r\n\t\t\t[CLASSES_CORE.noTrans]: true,\r\n\t\t});\r\n\t\tconst buttonNextClass = classNames({\r\n\t\t\t[this.options.buttonClass]: true,\r\n\t\t\t[CLASSES_CORE.buttonNext]: true,\r\n\t\t\t[this.options.buttonClass + MODIFIERS.full]: this.options.hide_previous_step_button,\r\n\t\t\t[CLASSES_CORE.disabled]: isLastStep || isHideNextByCurrentStepMeta,\r\n\t\t\t[CLASSES_CORE.noTrans]: true,\r\n\t\t});\r\n\t\tconst buttonSkipClass = classNames({\r\n\t\t\t[this.options.buttonClass]: true,\r\n\t\t\t[CLASSES_CORE.buttonSkip]: true,\r\n\t\t\t[CLASSES_CORE.hiddenHard]: this.options.hide_skip_button && !isLastStep,\r\n\t\t\t[CLASSES_CORE.buttonDone]: isLastStep,\r\n\t\t\t[CLASSES_CORE.noTrans]: true,\r\n\t\t});\r\n\t\tconst buttonSkipLabel = isLastStep ? this.options.labeling.doneLabel : this.options.labeling.skipLabel;\r\n\r\n\t\tif (this.buttonPrevEl) {\r\n\t\t\tthis.buttonPrevEl.className = buttonPrevClass;\r\n\t\t}\r\n\r\n\t\tif (this.buttonNextEl) {\r\n\t\t\tthis.buttonNextEl.className = buttonNextClass;\r\n\t\t}\r\n\r\n\t\tif (this.buttonCancelEl && this.buttonSkipTextLayer) {\r\n\t\t\tthis.buttonCancelEl.className = buttonSkipClass;\r\n\t\t\tthis.actualizeSkipButton(buttonSkipLabel, isLastStep);\r\n\t\t}\r\n\t\t$(`.${CLASSES_CORE.button}`).removeClass(CLASSES_CORE.noTrans);\r\n\t\tthis.actualizeButtonFocus(isFirstStep, isLastStep);\r\n\t}\r\n\r\n\r\n\tonNavigBulletClick(event) {\r\n\t\tif (event && event.target && !this.options.disable_navigation_by_bullets) {\r\n\t\t\tthis.goToStepByStepLabel(event.target.closest('li').getAttribute('data-step-number'));\r\n\t\t}\r\n\t}\r\n\r\n\tcreateButtonContent(textContent) {\r\n\t\tlet buttonContentLayer = document.createElement('div');\r\n\t\tbuttonContentLayer.className = CLASSES_CHILD.buttonText;\r\n\t\tbuttonContentLayer.innerHTML = textContent;\r\n\t\treturn buttonContentLayer;\r\n\t}\r\n\r\n\tloadIcons() {\r\n\t\tthis.loadArrowButtonIcons(this.options.labeling.button_arrows);\r\n\t\tthis.loadCancelButtonIcons(this.options.labeling.button_cancel_ico);\r\n\t}\r\n\r\n\tloadArrowButtonIcons(iconOption) {\r\n\t\tswitch (iconOption) {\r\n\t\t\tcase 'vector': {\r\n\r\n\t\t\t\tif (!this.arrowIcoWrapData) {\r\n\t\t\t\t\tthis.arrowIcoWrapData = this.appendIcoSpacerToPrevNextButtons(CLASSES_CHILD.buttonIcoWrap);\r\n\t\t\t\t\timport(/* webpackChunkName: \"dpitButtonIcoPrevNext\" */ './dpitButtonIcoPrevNext').then(svgLoader => {\r\n\t\t\t\t\t\tconst svgStringPrevNext = svgLoader.default(CLASSES_CHILD.buttonIco);\r\n\t\t\t\t\t\tif (svgStringPrevNext) {\r\n\t\t\t\t\t\t\t$(svgStringPrevNext).appendTo(this.arrowIcoWrapData.next);\r\n\t\t\t\t\t\t\t$(svgStringPrevNext).prependTo(this.arrowIcoWrapData.prev);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showLayers(this.arrowIcoWrapData?.prev, this.arrowIcoWrapData?.next);\r\n\t\t\t\t\thideElement(this.arrowButtonSpacersData?.prev, false);\r\n\t\t\t\t\thideElement(this.arrowButtonSpacersData?.next, false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'text': {\r\n\t\t\t\tconst textInButtonClass = CLASSES_CHILD.buttonIcoWrap;\r\n\t\t\t\tconst textIconClass = textInButtonClass + ' ' + textInButtonClass + MODIFIERS.symbol;\r\n\t\t\t\t$('<span class=\"' + textIconClass + '\">&rarr;</span>').appendTo(this.buttonNextEl);\r\n\t\t\t\t$('<span class=\"' + textIconClass + '\">&larr;</span>').prependTo(this.buttonPrevEl);\r\n\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: {\r\n\t\t\t\tif (!this.arrowButtonSpacersData) {\r\n\t\t\t\t\tthis.arrowButtonSpacersData = this.appendIcoSpacerToPrevNextButtons(CLASSES_CHILD.buttonSpacer);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showLayers(this.arrowButtonSpacersData?.prev, this.arrowButtonSpacersData?.next);\r\n\t\t\t\t}\r\n\t\t\t\thideElement(this.arrowIcoWrapData?.prev, false);\r\n\t\t\t\thideElement(this.arrowIcoWrapData?.next, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tloadCancelButtonIcons(iconOption) {\r\n\t\tswitch (iconOption) {\r\n\t\t\tcase 'vector': {\r\n\t\t\t\thideElement(this.cancelButtonSpacerEl, false);\r\n\t\t\t\tif (!this.cancelButtonIcoWrapEl) {\r\n\t\t\t\t\tthis.cancelButtonIcoWrapEl = this.appendIcoSpacerToCancelButton(CLASSES_CHILD.buttonIcoWrap);\r\n\t\t\t\t\timport(/* webpackChunkName: \"dpitButtonIcoCancel\" */ './dpitButtonIcoCancel').then(svgLoader => {\r\n\t\t\t\t\t\tconst svgStringCancel = svgLoader.default(CLASSES_CHILD.buttonIco);\r\n\t\t\t\t\t\tif (svgStringCancel) {\r\n\t\t\t\t\t\t\t$(svgStringCancel).appendTo(this.cancelButtonIcoWrapEl);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tshowElement(this.cancelButtonIcoWrapEl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'text': {\r\n\t\t\t\tconst textIconClass = CLASSES_CHILD.buttonIcoWrap + ' ' + CLASSES_CHILD.buttonIcoWrap + MODIFIERS.symbol;\r\n\t\t\t\t$('<span class=\"' + textIconClass + '\">&#9932;</span>').prependTo(this.buttonCancelEl);\r\n\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: {\r\n\t\t\t\thideElement(this.cancelButtonIcoWrapEl, false);\r\n\t\t\t\tif (!this.cancelButtonSpacerEl) {\r\n\t\t\t\t\tthis.cancelButtonSpacerEl = this.appendIcoSpacerToCancelButton(CLASSES_CHILD.buttonSpacer);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshowElement(this.cancelButtonSpacerEl);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tappendIcoSpacerToPrevNextButtons(spacerClass) {\r\n\t\tconst buttonSpacers = {\r\n\t\t\tnext: document.createElement('div'),\r\n\t\t\tprev: document.createElement('div')\r\n\t\t};\r\n\t\tbuttonSpacers.next.className = spacerClass;\r\n\t\t$(buttonSpacers.next).appendTo(this.buttonNextEl);\r\n\r\n\t\tbuttonSpacers.prev.className = spacerClass;\r\n\t\t$(buttonSpacers.prev).prependTo(this.buttonPrevEl);\r\n\r\n\t\treturn buttonSpacers;\r\n\t}\r\n\r\n\tappendIcoSpacerToCancelButton(spacerClass) {\r\n\t\tconst cancelButtonSpacer = document.createElement('div');\r\n\t\tcancelButtonSpacer.className = spacerClass;\r\n\t\t$(cancelButtonSpacer).prependTo(this.buttonCancelEl);\r\n\t\treturn cancelButtonSpacer;\r\n\t}\r\n\r\n\r\n\r\n\t// SECTION INIT\r\n\tinit() {\r\n\t\tif (!this.initialized) {\r\n\t\t\tthis.initialized = true;\r\n\t\t\tthis.createLayers();\r\n\t\t\tthis.actualizeNumberBB(true);\r\n\t\t\tthis.actualizeStepNumber();\r\n\t\t\tthis.actualizeProgressBar();\r\n\t\t\tthis.actualizeTooltipMaxWidth();\r\n\t\t\tthis.actualizeBulletsNavigActiveItem();\r\n\t\t\tthis.loadIcons();\r\n\t\t\tthis.initUserInteraction();\r\n\t\t\tthis.connectListeners();\r\n\t\t\tthis.doAction(EVENTS.onInit);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n * Setting anchors to behave like buttons\r\n *\r\n * @api private\r\n * @method _setAsButton\r\n*/\r\n\tsetAsButton(anchor, label, tabIndex = 0) {\r\n\t\tanchor.setAttribute('role', 'button');\r\n\t\tif (label && typeof label === 'string') anchor.setAttribute('aria-label', label);\r\n\t\tif (tabIndex >= 0) {\r\n\t\t\tanchor.tabIndex = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tcreateBullet(step, roleLinkList = true, isActive = false, onClickCallback = null) {\r\n\t\tvar innerLi = document.createElement('li');\r\n\t\tif (roleLinkList) {\r\n\t\t\tinnerLi.setAttribute('role', 'tab');\r\n\t\t\tinnerLi.tabIndex = 0;\r\n\t\t\tinnerLi.title = i18n('step', this.mainCfg.i18n) + ' ' + step;\r\n\t\t}\r\n\r\n\t\tif (onClickCallback) innerLi.onclick = onClickCallback;\r\n\r\n\t\tif (isActive) {\r\n\t\t\tinnerLi.className = 'active';\r\n\t\t\tinnerLi.setAttribute('aria-selected', 'true');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinnerLi.setAttribute('aria-selected', 'false');\r\n\t\t}\r\n\r\n\t\tif (roleLinkList) {\r\n\t\t\tinnerLi.setAttribute('data-step-number', step);\r\n\t\t}\r\n\r\n\t\tvar innerNumber = document.createElement('div');\r\n\t\tinnerNumber.innerHTML = step;\r\n\t\tinnerLi.appendChild(innerNumber);\r\n\r\n\t\treturn innerLi;\r\n\t}\r\n\r\n\tcreateNavigBullets(className = CLASSES_CORE.bullets, roleLinkList = true, activeIdx = 0, onClickCallback = null) {\r\n\t\tconst bulletsLayer = document.createElement('div');\r\n\t\t$(bulletsLayer).addClass(className);\r\n\t\tthis.listInBulletsNavigLayer = document.createElement('ul');\r\n\t\tthis.listInBulletsNavigLayer.className = classNames([CLASSES_CORE.dpitScrollBar, CLASSES_CORE.dpitScrollBar + '--x']);\r\n\t\tif (roleLinkList) this.listInBulletsNavigLayer.setAttribute('role', 'tablist');\r\n\r\n\r\n\t\tthis.stepItems.forEach((item, i) => {\r\n\t\t\tthis.listInBulletsNavigLayer.appendChild(this.createBullet(item.step, roleLinkList, i === activeIdx, onClickCallback));\r\n\t\t});\r\n\t\tbulletsLayer.appendChild(this.listInBulletsNavigLayer);\r\n\t\treturn bulletsLayer;\r\n\t}\r\n\r\n\tcreateNumberLayer(modifier = '') {\r\n\t\tconst numberEl = document.createElement('div');\r\n\t\tnumberEl.className = CLASSES_CORE.number;\r\n\t\tif (modifier) numberEl.classList.add(CLASSES_CORE.number + modifier);\r\n\r\n\t\tnumberEl.setAttribute('aria-label', i18n('aria-main', this.mainCfg.i18n) + ' - ' + i18n('aria-step-num', this.mainCfg.i18n));\r\n\t\tconst numberTextEl = document.createElement('div');\r\n\t\tnumberTextEl.className = CLASSES_CHILD.numberText;\r\n\t\tnumberEl.appendChild(numberTextEl);\r\n\t\treturn numberEl;\r\n\t}\r\n\r\n\tcreateDummyLayer() {\r\n\t\tconst targetDummyEl = document.createElement('div');\r\n\t\ttargetDummyEl.className = CLASSES_CORE.targetDummy;\r\n\t\ttargetDummyEl.setAttribute('aria-hidden', 'true');\r\n\t\t//$(targetDummyEl).on('click', this.onOverlayClick.bind(this));\r\n\t\treturn targetDummyEl;\r\n\t}\r\n\r\n\tcreateLayers() {\r\n\r\n\t\t// Flier\r\n\t\tthis.flierEl = document.createElement('div');\r\n\t\tthis.flierEl.className = CLASSES_CORE.flier;\r\n\t\tthis.wrapEl.appendChild(this.flierEl);\r\n\r\n\t\t// Highlight\r\n\t\tthis.highlightEl = document.createElement('div');\r\n\r\n\t\tthis.highlightEl.className = classNames(this.getHighlightLayerClassName(), CLASSES_CORE.hidden);\r\n\t\tthis.highlightEl.setAttribute('role', 'presentation');\r\n\t\tthis.inHighlightLayerAnimation = new BulletsAnimation(\r\n\t\t\tthis.highlightEl,\r\n\t\t\tCLASSES_CORE.rbAnim + MODIFIERS.inHighlight,\r\n\t\t\t70,\r\n\t\t\t10,\r\n\t\t\t4,\r\n\t\t\t3\r\n\t\t);\r\n\r\n\t\tthis.wrapEl.appendChild(this.highlightEl);\r\n\r\n\t\t// Tooltip ref.\r\n\t\tthis.tooltipRefEl = document.createElement('div');\r\n\t\tthis.tooltipRefEl.className = classNames(CLASSES_CORE.tooltipReference, CLASSES_CORE.hidden);\r\n\t\tthis.tooltipRefEl.setAttribute('role', 'presentation');\r\n\t\tthis.wrapEl.appendChild(this.tooltipRefEl);\r\n\r\n\t\t// Tooltip\r\n\t\tthis.tooltipEl = document.createElement('div');\r\n\t\tthis.tooltipEl.className = CLASSES_CORE.tooltip;\r\n\t\tthis.tooltipEl.setAttribute('aria-label', i18n('aria-main', this.mainCfg.i18n));\r\n\t\tthis.tooltipEl.setAttribute('aria-hidden', 'false');\r\n\t\tthis.tooltipEl.setAttribute('role', 'dialog');\r\n\t\tthis.tooltipEl.setAttribute('aria-describedby', CLASSES_CORE.tooltipText);\r\n\t\tthis.tooltipRefEl.appendChild(this.tooltipEl);\r\n\r\n\t\t// Tooltip border radius padding compensation\r\n\t\tthis.tooltipRadiusPaddingEl = document.createElement('div');\r\n\t\tthis.tooltipRadiusPaddingEl.className = CLASSES_CORE.tooltipRadiusPadding;\r\n\t\tthis.tooltipEl.appendChild(this.tooltipRadiusPaddingEl);\r\n\r\n\t\t// Tooltip text\r\n\t\tthis.tooltipTextEl = document.createElement('div');\r\n\t\tthis.tooltipTextEl.className = classNames([CLASSES_CORE.tooltipText, CLASSES_CORE.dpitScrollBar]);\r\n\t\tthis.tooltipTextEl.setAttribute('id', CLASSES_CORE.tooltipText);\r\n\t\tthis.tooltipRadiusPaddingEl.appendChild(this.tooltipTextEl);\r\n\r\n\t\t// Tooltip arrow\r\n\t\tthis.arrowEl = document.createElement('div');\r\n\t\tthis.arrowEl.className = CLASSES_CORE.arrow;\r\n\t\tthis.arrowEl.setAttribute('role', 'presentation');\r\n\t\tthis.tooltipRefEl.appendChild(this.arrowEl);\r\n\r\n\t\t// Progress bar\r\n\t\tthis.progressLayer = document.createElement('div');\r\n\t\tthis.progressLayer.className = CLASSES_CORE.progress;\r\n\r\n\t\tthis.progressBarLayer = document.createElement('div');\r\n\t\tthis.progressBarLayer.className = CLASSES_CORE.progressBar;\r\n\t\tthis.progressBarLayer.setAttribute('role', 'progress');\r\n\t\tthis.progressBarLayer.setAttribute('aria-valuemin', 0);\r\n\t\tthis.progressBarLayer.setAttribute('aria-valuemax', 100);\r\n\t\tthis.progressBarLayer.setAttribute('aria-valuenow', this.getProgressInPercent());\r\n\t\tthis.progressBarLayer.style.cssText = 'width:' + this.getProgressInPercent() + '%;';\r\n\t\tthis.progressLayer.appendChild(this.progressBarLayer);\r\n\t\tthis.tooltipRadiusPaddingEl.appendChild(this.progressLayer);\r\n\r\n\t\t// Tooltip bullets\r\n\t\tthis.bulletsLayer = this.createNavigBullets(\r\n\t\t\tCLASSES_CORE.bullets,\r\n\t\t\ttrue,\r\n\t\t\t0,\r\n\t\t\tthis.onNavigBulletClick.bind(this)\r\n\t\t);\r\n\t\tthis.tooltipRadiusPaddingEl.appendChild(this.bulletsLayer);\r\n\r\n\t\t// Tooltip buttons\r\n\t\tthis.tooltipButtonsEl = document.createElement('div');\r\n\t\tthis.tooltipButtonsEl.className = CLASSES_CORE.tooltipButtons;\r\n\t\tthis.tooltipButtonsEl.setAttribute('role', 'navigation');\r\n\t\tthis.tooltipButtonsEl.setAttribute('aria-label', i18n('aria-main', this.mainCfg.i18n));\r\n\t\tthis.tooltipRadiusPaddingEl.appendChild(this.tooltipButtonsEl);\r\n\r\n\t\t//Tooltip number\r\n\t\tthis.numberEl = this.createNumberLayer();\r\n\t\tthis.tooltipRefEl.appendChild(this.numberEl);\r\n\r\n\t\t// Number on sticky tooltip\r\n\r\n\r\n\r\n\t\t//next button\r\n\t\tthis.buttonNextEl = document.createElement('div');\r\n\t\tthis.buttonNextEl.className = classNames([CLASSES_CORE.button, CLASSES_CORE.buttonNext]);\r\n\t\tthis.setAsButton(this.buttonNextEl, this.options.labeling.nextLabel);\r\n\t\tthis.buttonNextEl.appendChild(this.createButtonContent(this.options.labeling.nextLabel));\r\n\r\n\t\t//previous button\r\n\t\tthis.buttonPrevEl = document.createElement('div');\r\n\t\tthis.buttonPrevEl.className = classNames([CLASSES_CORE.button, CLASSES_CORE.buttonPrev]);\r\n\t\tthis.setAsButton(this.buttonPrevEl, this.options.labeling.prevLabel);\r\n\t\tthis.buttonPrevEl.appendChild(this.createButtonContent(this.options.labeling.prevLabel));\r\n\r\n\t\t//skip button\r\n\t\tthis.buttonCancelEl = document.createElement('div');\r\n\t\tthis.buttonCancelEl.className = classNames([CLASSES_CORE.button, CLASSES_CORE.buttonSkip]);\r\n\t\tthis.setAsButton(this.buttonCancelEl, this.options.labeling.skipLabel);\r\n\t\tthis.buttonSkipTextLayer = this.createButtonContent(this.options.labeling.skipLabel);\r\n\t\tthis.buttonCancelEl.appendChild(this.buttonSkipTextLayer);\r\n\t\tthis.tooltipButtonsEl.appendChild(this.buttonCancelEl);\r\n\r\n\t\t//in order to prevent displaying next/previous button always\r\n\t\tif (this.stepItems.length >= 1) {\r\n\t\t\tthis.buttonPrevNextWrapEl = document.createElement('div');\r\n\t\t\tthis.buttonPrevNextWrapEl.className = CLASSES_CORE.buttonPrevNextWrap;\r\n\t\t\tthis.tooltipButtonsEl.appendChild(this.buttonPrevNextWrapEl);\r\n\t\t\tthis.buttonPrevNextWrapEl.appendChild(this.buttonPrevEl);\r\n\t\t\tthis.buttonPrevNextWrapEl.appendChild(this.buttonNextEl);\r\n\t\t}\r\n\t\tthis.initBGOverlayLayer();\r\n\t}\r\n\r\n\r\n\treInitLayers(regularStepChange = true) {\r\n\t\t// Init\r\n\t\tif (regularStepChange) {\r\n\t\t\tthis.highlightEl.className = this.getHighlightLayerClassName();\r\n\r\n\t\t\t// Hide\r\n\t\t\tif (!IS_DEBUG) this.hideIntroLayers();\r\n\t\t}\r\n\t\t//this.numberEl?.classList.remove(CLASSES_CORE.number + MODIFIERS.onTooltip);\r\n\t\tthis.clearFlier();\r\n\t}\r\n\r\n\t// !SECTION INIT\r\n\r\n\r\n\tstopAutoScrollWhenUserAction() {\r\n\t\tthis.isUserScrolling = true;\r\n\t\tif (this.userInteractTimeout) clearTimeout(this.userInteractTimeout);\r\n\t\tthis.userInteractTimeout = setTimeout(() => {\r\n\t\t\tthis.isUserScrolling = false;\r\n\t\t}, TIMING.userScrolling);\r\n\t}\r\n\r\n\r\n\r\n\tgetFlierBB(targetBB, numberBB, tooltipBB) {\r\n\t\tlet res = null;\r\n\r\n\t\tif (this.options.scrollTo === 'element') {\r\n\t\t\tres = DpitBB.merge(targetBB, numberBB);\r\n\t\t}\r\n\t\telse if (this.options.scrollTo === 'tooltip') {\r\n\t\t\tres = tooltipBB;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tres = DpitBB.merge(targetBB, tooltipBB, numberBB);\r\n\t\t}\r\n\t\tif (res) {\r\n\t\t\tif (res.height > this.winBB.height && ['left', 'right', 'center'].includes(this.tooltipPos.base)\r\n\t\t\t/*|| res.width > this.winBB.width && ['top', 'bottom'].includes(this.tooltipPos.base)*/) {\r\n\t\t\t\tres = tooltipBB;\r\n\t\t\t}\r\n\t\t\tres = DpitBB.extendByMarginBB(res, this.isFixedPos ? this.windowMargin : this.docMargin);\r\n\t\t\t//res = DpitBB.intersect(DpitBB.extendByMarginBB(res, this.isFixedPos ? this.windowMargin : this.docMargin), this.docBB);\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\r\n\r\n\r\n\r\n\tfinalizeStepChange() {\r\n\t\tif (this.options.finalizeStepChangeEn\r\n\t\t\t&& this.finalizeRefreshCounter < 2\r\n\t\t\t&& this.flierBB\r\n\t\t\t&& !this.isFixedPos\r\n\t\t\t&& this.flierBB.height < this.winBoardBB.height\r\n\t\t\t&& this.flierBB.width < this.winBoardBB.width\r\n\t\t) {\r\n\r\n\t\t\tthis.actualizeFlier();\r\n\t\t\tif (!this.isBoundingBoxInsideViewPort(this.flierBB, this.isFixedPos, false, 0.9)) {\r\n\t\t\t\tthis.finalizeRefreshCounter++;\r\n\r\n\t\t\t\tthis.hardRefresh(REFRESH_REASONS.finalize, { useLastTooltipPos: true, useLastNumberPos: false });\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tresetTargetElement = () => {\r\n\t\tif (this.targetBranch) {\r\n\t\t\tthis.targetBranch.stickyPosElements.forEach(stickyElement => {\r\n\t\t\t\tstickyElement.removeEventListener(DpitStickyEvents.CHANGE, this.onStickyEvent);\r\n\t\t\t});\r\n\t\t\tthis.targetBranch.destroy();\r\n\t\t\tthis.targetBranch = null;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tprocessTargetBranchAndFixedPosState() {\r\n\t\tif (this.targetBranch) this.targetBranch.destroy();\r\n\r\n\t\tif (this.stepItem?.element && !this.isDummyMode()) {\r\n\t\t\tthis.targetBranch = new DpitTargetBranch(this.stepItem.element, this.options.dpDebugEn);\r\n\t\t\tthis.targetBranch.process();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.targetBranch = null;\r\n\t\t}\r\n\t\tthis.actualizeFixedAndStickyPos(this.stepItem);\r\n\t}\r\n\r\n\tdisableStickyEvents = () => {\r\n\t\tif (this.stickyEvents) {\r\n\t\t\tthis.stickyEvents.disableEvents(false);\r\n\t\t\tthis.stickyEvents = null;\r\n\t\t}\r\n\t};\r\n\r\n\tsetFixedMode(isFixedPos, dbgEnWhenFalse = false, dbgInfo) {\r\n\t\tthis.isFixedPos = isFixedPos;\r\n\t\tif (this.options.dpDebugEn && (isFixedPos || dbgEnWhenFalse)) console.log('[dpit] Fixed mode:', isFixedPos, dbgInfo);\r\n\t}\r\n\r\n\tclearFixedMode() {\r\n\t\tthis.isFixedPos = false;\r\n\t\tthis.disableStickyEvents();\r\n\t\tthis.targetElForSticky = null;\r\n\t}\r\n\r\n\tcontainsFixedPos() {\r\n\t\tif (this.isDummyMode()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (this.targetBranch) {\r\n\t\t\treturn this.targetBranch.containsFixed();\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tactualizeFixedAndStickyPos = (stepItem) => {\r\n\t\tconst targetElement = stepItem.element;\r\n\t\tif (!targetElement || this.targetElForSticky === targetElement) return false;\r\n\t\tconst containsFixedPosRes = this.containsFixedPos();\r\n\t\tthis.setFixedMode(containsFixedPosRes, false, 'Fixed target or it\\'s parent');\r\n\t\tif (!containsFixedPosRes && this.targetBranch && this.targetBranch.containsSticky()) {\r\n\t\t\tconst stickyDetLabel = REFRESH_REASONS.stickyDetector.toUpperCase();\r\n\t\t\tif (this.options.dpDebugEn) console.log(`[dpit] ${stickyDetLabel}: Activated`);\r\n\t\t\tthis.stickyEvents = new DpitStickyEvents();\r\n\t\t\tthis.targetElForSticky = targetElement;\r\n\t\t\tthis.stickyEvents.addStickies(this.targetBranch.stickyPosElements);\r\n\r\n\t\t\tthis.targetBranch.stickyPosElements.forEach(stickyElement => {\r\n\t\t\t\tstickyElement.addEventListener(DpitStickyEvents.CHANGE, this.onStickyEvent);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tonStickyEvent = (event) => {\r\n\t\t//if (stepItem === this.stepItem) {\r\n\t\tconst prevIsFixedPos = this.isFixedPos;\r\n\t\tconst isFixedPos = event.detail.isSticky ? true : this.stickyEvents.isSomeSticky();\r\n\t\tif (prevIsFixedPos !== isFixedPos) {\r\n\t\t\tconst stickyDetLabel = REFRESH_REASONS.stickyDetector.toUpperCase();\r\n\t\t\tthis.setFixedMode(isFixedPos, false, `${stickyDetLabel}: Element > `, this.targetElForSticky, event.detail);\r\n\t\t\tthis.softRefresh(REFRESH_REASONS.stickyDetector);\r\n\t\t}\r\n\t\t//}\r\n\t};\r\n\r\n\r\n\t// targetElm can be body\r\n\tinitBGOverlayLayer(hidden = true) {\r\n\r\n\t\tif (!this.overlayContainer) {\r\n\r\n\t\t\tthis.overlayContainer = document.createElement('div');\r\n\t\t\tthis.overlayContainer.className = CLASSES_CORE.overlayContainer;\r\n\t\t\tif (hidden) this.overlayContainer.classList.add(CLASSES_CORE.hiddenKeepEvents);\r\n\r\n\t\t\tthis.overlayEl = document.createElement('div');\r\n\t\t\tthis.overlayEl.className = CLASSES_CORE.overlay;\r\n\r\n\t\t\tthis.overlayContainer.appendChild(this.overlayEl);\r\n\t\t\tthis.overlayContainer.setAttribute('aria-hidden', 'true');\r\n\t\t\tthis.wrapEl.appendChild(this.overlayContainer);\r\n\r\n\t\t\tthis.overlayContainerTransitionDelayMs = getTransitionDurationMs(this.overlayContainer);\r\n\r\n\t\t\tthis.initBulletsAnimation(this.overlayContainer);\r\n\t\t}\r\n\t}\r\n\r\n\tinitBulletsAnimation(bulletRootElement) {\r\n\t\tthis.bulletsAnimation = new BulletsAnimation(bulletRootElement);\r\n\t}\r\n\r\n\tclearFlier() {\r\n\t\thideElement(this.flierEl, false);\r\n\t\tthis.flierBB = null;\r\n\t}\r\n\r\n\tactualizeFlier(omitNumberEl = false) {\r\n\t\tlet numberBB = null;\r\n\t\tif (this.options.showStepNumbers === true && !omitNumberEl) {\r\n\t\t\tnumberBB = this.numberBB;\r\n\t\t}\r\n\r\n\t\tthis.flierBB = this.getFlierBB(this.targetBB, numberBB, this.tooltipBB);\r\n\t\tif (this.flierBB) {\r\n\t\t\tDpitBB.toElement(this.flierEl, this.flierBB);\r\n\t\t\tshowElement(this.flierEl);\r\n\t\t}\r\n\t}\r\n\r\n\tcalculateScrollTimeToTarget() {\r\n\t\tlet res = 300;\r\n\t\tif (!this.isFixedPos && this.stepItem?.element) {\r\n\t\t\tconst targetOffset = $(this.stepItem.element).offset();\r\n\t\t\tconst startOffset = { left: $(window).scrollLeft(), top: $(window).scrollTop() };\r\n\t\t\tconst diff = Math.max(\r\n\t\t\t\tMath.abs(startOffset.left - targetOffset.left),\r\n\t\t\t\tMath.abs(startOffset.top - targetOffset.top)\r\n\t\t\t);\r\n\t\t\tres = Math.round(Math.min(\r\n\t\t\t\tthis.options.maxScrollSpeedPerPageMs,\r\n\t\t\t\tMath.max(350, (diff / this.winBB.height) * this.options.scrollSpeedPerPageMs)\r\n\t\t\t));\r\n\t\t\tif (this.options.dpDebugEn) console.log('[dpit] SCROLL', {\r\n\t\t\t\t'Scroll time': res + ' ms',\r\n\t\t\t\tmaxScrollSpeedPerPageMs: this.options.maxScrollSpeedPerPageMs,\r\n\t\t\t\tscrollSpeedPerPageMs: this.options.scrollSpeedPerPageMs\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tgetScrollSpeedOptions(scrollSpeedOption) {\r\n\t\tconst scrollSpeedOptionSanitized = Math.max(Math.min(scrollSpeedOption, 100), 0);\r\n\t\tconst scrollSpeedPerPageMs = scrollSpeedOptionSanitized === 100\r\n\t\t\t? 0\r\n\t\t\t: SCROLL_SPEED.logCoef * Math.log(scrollSpeedOptionSanitized) + SCROLL_SPEED.constant;\r\n\r\n\t\treturn {\r\n\t\t\tscrollSpeedPerPageMs: scrollSpeedPerPageMs,\r\n\t\t\tmaxScrollSpeedPerPageMs: scrollSpeedPerPageMs * SCROLL_SPEED.maxCoef\r\n\t\t};\r\n\t}\r\n\r\n\tactualizeScrollSpeedOptions(scrollSpeedOption) {\r\n\t\tthis.setOptions(this.getScrollSpeedOptions(scrollSpeedOption));\r\n\t}\r\n\r\n\tforceScrollTopOffset() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetScrollFlierOptions(scrollTimeMs = 500) {\r\n\r\n\t\tconst getFlierPureWidth = () => this.flierBB.width - this.docMargin.left - this.docMargin.right;\r\n\t\tconst getFlierPureHeight = () => this.flierBB.height - this.docMargin.top - this.docMargin.bottom;\r\n\t\tconst res = {\r\n\t\t\talign: {\r\n\t\t\t\ttop: 0.5,\r\n\t\t\t\tleft: 0.5,\r\n\t\t\t\tlockX: !isElementScrollableX(document.documentElement)\r\n\t\t\t},\r\n\t\t\ttime: scrollTimeMs\r\n\t\t};\r\n\r\n\t\tif (this.flierBB) {\r\n\t\t\tif (this.flierBB.height > this.winBoardBB.height || this.forceScrollTopOffset()) {\r\n\t\t\t\tswitch (this.tooltipPos.base) {\r\n\t\t\t\t\tcase 'top': res.align.top = 0; break;\r\n\t\t\t\t\tcase 'bottom':\r\n\t\t\t\t\t\tres.align.top = 0;\r\n\t\t\t\t\t\tres.align.topOffset = this.winBoardBB.height - getFlierPureHeight();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.flierBB.width > this.winBoardBB.width) {\r\n\t\t\t\tswitch (this.tooltipPos.base) {\r\n\t\t\t\t\tcase 'left': res.align.left = 0; break;\r\n\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\tres.align.left = 0;\r\n\t\t\t\t\t\tres.align.leftOffset = this.winBoardBB.width - getFlierPureWidth();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tasync scrollFlierIntoView(backward, onlyWhenNeeded = true, scrollTimeMs = TIMING.defaultFlierScroll) {\r\n\t\tthis.actualizeFlier();\r\n\t\tif (!this.isFixedPos\r\n\t\t\t&& this.flierEl\r\n\t\t\t&& (!onlyWhenNeeded || !this.isBoundingBoxInsideViewPort(this.flierBB, this.isFixedPos, true))) {\r\n\t\t\tconst scrollOptions = this.getScrollFlierOptions(scrollTimeMs);\r\n\t\t\tthis.isAutoScrolling = true;\r\n\t\t\tthis.initScrollFlierTime = Date.now;\r\n\t\t\t/*const res = */await scrollIntoView(this.flierEl, scrollOptions);\r\n\t\t\tthis.isAutoScrolling = false;\r\n\t\t\tthis.onFlierScrolledInView(backward, this.initScrollFlierTime);\r\n\t\t\t//return res;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.afterStepChanged(backward);\r\n\t\t\t//return Promise.resolve(false);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tgetScrollTargetOptions(scrollTimeMs) {\r\n\t\tconst firstScrollableChildFromClosestFixedParent = this.targetBranch?.getFirstScrollableChildFromClosestFixedParent();\r\n\t\treturn {\r\n\t\t\ttime: scrollTimeMs,\r\n\t\t\tvalidTarget: (target) => {\r\n\t\t\t\tconst res = !firstScrollableChildFromClosestFixedParent\r\n\t\t\t\t\t|| firstScrollableChildFromClosestFixedParent === target\r\n\t\t\t\t\t|| $(firstScrollableChildFromClosestFixedParent).find(target).length;\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tscrollTargetIntoView(scrollTimeMs = TIMING.defaultTargetScroll) {\r\n\t\tif (this.stepItem?.element && this.targetBranch?.containsScrollable()) {\r\n\t\t\t//this.softenOverlayOpacity();\r\n\t\t\t//const res = \r\n\t\t\t//this.resumeFullOverlayOpacity();\r\n\t\t\treturn scrollIntoView(this.stepItem.element, this.getScrollTargetOptions(scrollTimeMs));\r\n\t\t}\r\n\t\treturn Promise.resolve(false);\r\n\t}\r\n\r\n\tgetProgressInPercent() {\r\n\t\t// Steps are 0 indexed\r\n\t\tconst currentStep = parseInt((this.stepIdx + 1), 10);\r\n\t\treturn ((currentStep / (this.stepItems.length - this.getNotVisibleStepCnt())) * 100);\r\n\t}\r\n\r\n\tafterStepChanged(backward) {\r\n\t\tif (this.debugVisualizer) {\r\n\t\t\tthis.debugVisualizer.visualizeStepData(this.targetBB, this.flierBB, this.isFixedPos);\r\n\t\t}\r\n\t\tthis.fireAfterStepChangeEvent(backward);\r\n\t}\r\n\r\n\tonFlierScrolledInView(backward, initScrollTime) {\r\n\t\tlet willBeRefreshed = false;\r\n\t\tif (/* is not another step */ initScrollTime === this.initScrollFlierTime) {\r\n\t\t\twillBeRefreshed = this.finalizeStepChange();\r\n\t\t\tthis.initScrollFlierTime = null;\r\n\t\t}\r\n\t\tif (!this.ending && !willBeRefreshed) {\r\n\t\t\tthis.afterStepChanged(backward);\r\n\t\t}\r\n\t}\r\n\r\n\tfireAfterStepChangeEvent(backward) {\r\n\t\tthis.doAction(EVENTS.afterStepChange, {\r\n\t\t\tbackward: backward,\r\n\t\t\tcurrentStepObj: this.stepObject4Hooks(this.stepItem)\r\n\t\t});\r\n\t}\r\n\r\n\r\n\tgetMinimalTooltipWidth() {\r\n\t\tconst minWidth = $(this.buttonCancelEl).outerWidth()\r\n\t\t\t+ $(this.buttonPrevNextWrapEl).outerWidth(true)\r\n\t\t\t+ this.tooltipPadding.left\r\n\t\t\t+ this.tooltipPadding.right\r\n\t\t\t+ this.radiusPaddingFix?.left || 0\r\n\t\t\t+ this.radiusPaddingFix?.right || 0;\r\n\t\treturn isNaN(minWidth) ? 300 /* Default 300px*/ : minWidth;\r\n\t}\r\n\r\n\tactualizeButtonsTextVisibility(hideText = false) {\r\n\t\tconst buttonNoTextClass = CLASSES_CORE.button + MODIFIERS.noText;\r\n\t\tif (!hideText) {\r\n\r\n\t\t\tif (this.buttonPrevEl.classList.contains(buttonNoTextClass)\r\n\t\t\t\t|| this.buttonNextEl.classList.contains(buttonNoTextClass)) {\r\n\t\t\t\tif (this.options.labeling.button_arrows === 'none') {\r\n\t\t\t\t\tthis.loadArrowButtonIcons('none');\r\n\t\t\t\t}\r\n\t\t\t\tthis.buttonNextEl.classList.remove(buttonNoTextClass);\r\n\t\t\t\tthis.buttonPrevEl.classList.remove(buttonNoTextClass);\r\n\t\t\t}\r\n\t\t\tif (this.buttonCancelEl.classList.contains(buttonNoTextClass)) {\r\n\t\t\t\tif (this.options.labeling.button_cancel_ico === 'none') {\r\n\t\t\t\t\tthis.loadCancelButtonIcons('none');\r\n\t\t\t\t}\r\n\t\t\t\tthis.buttonCancelEl.classList.remove(buttonNoTextClass);\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!this.buttonPrevEl.classList.contains(buttonNoTextClass)) {\r\n\t\t\t\tthis.buttonPrevEl.classList.add(buttonNoTextClass);\r\n\t\t\t\tif (this.options.labeling.button_arrows === 'none') {\r\n\t\t\t\t\tthis.loadArrowButtonIcons('vector');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this.buttonNextEl.classList.contains(buttonNoTextClass)) {\r\n\t\t\t\tthis.buttonNextEl.classList.add(buttonNoTextClass);\r\n\t\t\t\tif (this.options.labeling.button_arrows === 'none') {\r\n\t\t\t\t\tthis.loadArrowButtonIcons('vector');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this.buttonCancelEl.classList.contains(buttonNoTextClass)) {\r\n\t\t\t\tthis.buttonCancelEl.classList.add(buttonNoTextClass);\r\n\t\t\t\tif (this.options.labeling.button_cancel_ico === 'none') {\r\n\t\t\t\t\tthis.loadCancelButtonIcons('vector');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tgetMaximalTooltipWidth() {\r\n\t\treturn Math.max(this.winBoardBB.width - 20, 20); // number on tooltip etc.\r\n\t}\r\n\r\n\r\n\tactualizeTooltipMinWidth() {\r\n\t\tif (this.buttonPrevNextWrapEl) {\r\n\t\t\tthis.buttonPrevNextWrapEl.classList.remove(CLASSES_CORE.buttonPrevNextWrap + MODIFIERS.vert);\r\n\t\t\tthis.actualizeButtonsTextVisibility(false);\r\n\r\n\t\t\tthis.minTooltipWidth = this.getMinimalTooltipWidth();\r\n\t\t\tconst maxTooltipWidth = this.getMaximalTooltipWidth();\r\n\t\t\tif (this.minTooltipWidth > maxTooltipWidth) {\r\n\r\n\t\t\t\tthis.actualizeButtonsTextVisibility(true);\r\n\t\t\t\tthis.minTooltipWidth = this.getMinimalTooltipWidth();\r\n\t\t\t\tif (this.minTooltipWidth <= maxTooltipWidth) {\r\n\t\t\t\t\tupdateCssVar('--dpit-min-tooltip-width', round1dec(this.minTooltipWidth) + 'px');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.buttonPrevNextWrapEl.classList.add(CLASSES_CORE.buttonPrevNextWrap + MODIFIERS.vert);\r\n\t\t\t\tthis.minTooltipWidth = this.getMinimalTooltipWidth();\r\n\t\t\t\tupdateCssVar('--dpit-min-tooltip-width', round1dec(Math.min(this.minTooltipWidth, maxTooltipWidth)) + 'px');\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tupdateCssVar('--dpit-min-tooltip-width', round1dec(this.minTooltipWidth) + 'px');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tactualizeTooltipMaxWidth() {\r\n\t\tif (this.tooltipEl) {\r\n\t\t\tconst maxTooltipWidth = this.getMaximalTooltipWidth();\r\n\t\t\tif (this.options.max_tooltip_width\r\n\t\t\t\t&& !isNaN(this.options.max_tooltip_width)\r\n\t\t\t\t&& (!this.winBoardBB || this.options.max_tooltip_width < maxTooltipWidth)\r\n\t\t\t) {\r\n\t\t\t\tthis.tooltipEl.style.maxWidth = this.options.max_tooltip_width + 'px';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.tooltipEl.style.maxWidth = '';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync tryUnlockActualizeTarget(processFce, processImmediatelyWhenReady = false) {\r\n\t\tlet res = RES_PROCESS_ASYNC.abort;\r\n\t\tif (!this.actualizeTargetLock) {\r\n\t\t\tif (processFce) {\r\n\t\t\t\tthis.lockActualizeTarget();\r\n\t\t\t\tres = await processFce();\r\n\t\t\t\tthis.unlockActualizeTarget();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (processImmediatelyWhenReady) {\r\n\t\t\t\tres = RES_PROCESS_ASYNC.deferred;\r\n\t\t\t\tthis.processFceToRun = processFce;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tunlockActualizeTarget() {\r\n\t\tthis.actualizeTargetLock = false;\r\n\t\tif (this.processFceToRun) {\r\n\t\t\tconst fceBkp = this.processFceToRun;\r\n\t\t\tthis.processFceToRun = null;\r\n\t\t\tthis.tryUnlockActualizeTarget(fceBkp, false);\r\n\t\t}\r\n\t}\r\n\r\n\tlockActualizeTarget() {\r\n\t\tthis.actualizeTargetLock = true;\r\n\t}\r\n\r\n\tprocessOnBeforeShowStep() {\r\n\t\tif (this.onBeforeShowStepCallback instanceof Function && this.stepItem) {\r\n\t\t\treturn this.onBeforeShowStepCallback(this.stepItem);\r\n\t\t}\r\n\t\treturn Promise.resolve(RES_PROCESS_ASYNC.continue);\r\n\t}\r\n\r\n\tprintDbgStepInfo(reason, dbgInfo) {\r\n\t\tif (this.options.dpDebugEn) console.log(`[dpit] ====== STEP ${this.stepItem.step} - ${reason.toUpperCase()}`, dbgInfo, 'Step item {', this.stepItem, '}');\r\n\t}\r\n\r\n\tisFlierOnScreen() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\r\n\tisBoundingBoxInsideViewPort(bbToTest, isFixed, useBoardSize = false, thresholdRatio = 1) {\r\n\t\tconst containerBB = useBoardSize ? this.winBoardBB : this.winBB;\r\n\t\treturn isBoundingBoxInsideContainer(bbToTest, containerBB, isFixed, thresholdRatio);\r\n\t}\r\n\r\n\tfinalizeFollowTarget(reason = REFRESH_REASONS.followTarget) {\r\n\t\tthis.isFollowTargetInAction = false;\r\n\t\tthis.actualizeNumberBB();\r\n\t\tif (this.options.dpDebugEn) console.log('[dpit] FOLLOW TARGET: Stopped - target BB:', this.targetBB);\r\n\t\tif (this.didOrientationChanged) {\r\n\t\t\t/* Window orientation has changed during follow */\r\n\t\t\t// is refreshed by resize refresh alg\r\n\t\t\t//this.hardRefresh(reason);\r\n\t\t} else if (!this.isBoundingBoxInsideViewPort(this.flierBB, this.isFixedPos, false, 0.98) && !this.isUserScrolling) {\r\n\t\t\tthis.placeTooltip(false, true);\r\n\t\t\tif (!this.isBoundingBoxInsideViewPort(this.flierBB, this.isFixedPos, false, 0.98)) {\r\n\t\t\t\tthis.hardRefresh(reason);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.options.showStepNumbers && this.numberBB && !this.isBoundingBoxInsideViewPort(this.numberBB, this.isFixedPos, false, 0.98)) {\r\n\t\t\tthis.initTooltip();\r\n\t\t\tthis.placeTooltip();\r\n\t\t} else {\r\n\t\t\tthis.hardRefresh(reason);\r\n\t\t}\r\n\t\tthis.restartFollowTarget();// restart with lower interval time to avoid high CPU load\r\n\r\n\r\n\r\n\t}\r\n\r\n\r\n\tfinalizeSoftRefresh(reason, mode = {}) {\r\n\t\tconst startStepIdx = this.stepIdx;\r\n\t\tif (this.softRefreshTimer) clearTimeout(this.softRefreshTimer);\r\n\t\tthis.softRefreshTimer = setTimeout(() => {\r\n\t\t\tif (startStepIdx === this.stepIdx) {\r\n\t\t\t\tswitch (reason) {\r\n\t\t\t\t\tcase REFRESH_REASONS.resize:\r\n\t\t\t\t\t\tif (this.options.dpDebugEn) console.log('[dpit] SOFT RESIZE: Ended');\r\n\t\t\t\t\t\tthis.hardRefresh(reason, mode);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase REFRESH_REASONS.followTarget:\r\n\t\t\t\t\t\tif (!this.resizeTimeout) {\r\n\t\t\t\t\t\t\tthis.finalizeFollowTarget();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, TIMING.finalizeSoftRefresh);\r\n\t}\r\n\r\n\tshowStep(mode = {}, dbgInfo = '') {\r\n\t\t//this.resetCore(false);\r\n\t\treturn this.regularStepChange(REFRESH_REASONS.regular, mode, dbgInfo);\r\n\t}\r\n\r\n\tplaceTooltipInSoftRefresh() {\r\n\t\tif (!DpitBB.isInside(this.tooltipBB, this.docBoardBB)) {\r\n\t\t\tthis.placeTooltip();\r\n\t\t} else {\r\n\t\t\tthis.placeTooltip(true, true); // do not iterate tooltip position\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tasync softRefresh(reason = REFRESH_REASONS.unknown, mode = {}) {\r\n\t\tif (!this.stepItem) return RES_PROCESS_ASYNC.noData;\r\n\t\treturn await this.tryUnlockActualizeTarget(() => {\r\n\t\t\tthis.pauseFollowTarget();\r\n\t\t\tthis.calculateTargetBBs();\r\n\t\t\tthis.actualizeUserInteraction(this.stepItem);\r\n\t\t\tthis.placeTargetPosBasedLayers();\r\n\t\t\tif (this.userInteraction) {\r\n\t\t\t\tthis.userInteraction.update(this.stepItem);\r\n\t\t\t}\r\n\t\t\tthis.initTooltip(false);\r\n\t\t\tthis.placeTooltipInSoftRefresh();\r\n\t\t\tthis.finalizeSoftRefresh(reason, mode);\r\n\t\t\tthis.restoreFollowTarget();\r\n\t\t\treturn RES_PROCESS_ASYNC.done;\r\n\t\t}, false);\r\n\t}\r\n\r\n\r\n\r\n\tasync hardRefresh(reason = REFRESH_REASONS.unknown, mode = {}, dbgInfo = '') {\r\n\t\tif (!this.stepItem) return RES_PROCESS_ASYNC.noData;\r\n\r\n\t\treturn await this.tryUnlockActualizeTarget(async () => {\r\n\t\t\t//this.restoreFollowTarget();\r\n\t\t\tconst doNotScroll = mode?.resizeType && [\r\n\t\t\t\tRESIZE_TYPE.minorAreaChange,\r\n\t\t\t\tRESIZE_TYPE.mobUrlBarVisibilityToggle\r\n\t\t\t].includes(mode.resizeType);\r\n\t\t\tthis.actualizeTargetItem(this.stepItem);\r\n\t\t\tthis.resumeFullOverlayOpacity();\r\n\t\t\tif (await this.processOnBeforeShowStep() === RES_PROCESS_ASYNC.abort) {\r\n\t\t\t\treturn RES_PROCESS_ASYNC.abort;\r\n\t\t\t}\r\n\t\t\tif (!this.checkTargetElValidity()) return RES_PROCESS_ASYNC.skip;\r\n\t\t\tthis.resetCore(false, false, true);\r\n\t\t\t//this.pauseFollowTarget();\r\n\t\t\tthis.printDbgStepInfo(reason, dbgInfo);\r\n\t\t\tthis.processTargetBranchAndFixedPosState();\r\n\t\t\tthis.reInitLayers(false);\r\n\t\t\tlet scrollTimeMs = TIMING.defaultFlierScroll;\r\n\t\t\tif (!doNotScroll) {\r\n\t\t\t\tscrollTimeMs = this.calculateScrollTimeToTarget();\r\n\t\t\t\tawait this.scrollTargetIntoView(Math.min(scrollTimeMs, SCROLL_SPEED.maxParentScrollTimeMs));\r\n\t\t\t}\r\n\r\n\t\t\tthis.actualizeShadowOverlay();\r\n\t\t\tthis.calculateTargetBBs();\r\n\t\t\tthis.actualizeUserInteraction(this.stepItem);\r\n\t\t\tthis.placeTargetPosBasedLayers();\r\n\t\t\tthis.initTooltip(true);\r\n\t\t\tthis.placeTooltip(mode.useLastTooltipPos, mode.useLastNumberPos);\r\n\t\t\tthis.showIntroLayers();\r\n\t\t\tif (!doNotScroll) this.scrollFlierIntoView(this.isBackward, mode.scrollOnlyWhenNeeded, scrollTimeMs);\r\n\t\t\tthis.restoreFollowTarget();\r\n\t\t\t//this.restoreRefreshers();\r\n\t\t\treturn RES_PROCESS_ASYNC.done;\r\n\t\t}, true);\r\n\t}\r\n\r\n\tasync regularStepChange(reason = REFRESH_REASONS.regular, mode = {}, dbgInfo = '') {\r\n\r\n\t\tif (!this.stepItem) return RES_PROCESS_ASYNC.noData;\r\n\t\tmode = { ...mode, scrollOnlyWhenNeeded: false };\r\n\t\tconst stepItem = this.stepItem;\r\n\t\treturn await this.tryUnlockActualizeTarget(async () => {\r\n\t\t\tthis.resetTargetElement();\r\n\t\t\tthis.actualizeTargetItem(stepItem);\r\n\t\t\tthis.resumeFullOverlayOpacity();\r\n\t\t\tif (await this.processOnBeforeShowStep() === RES_PROCESS_ASYNC.abort) {\r\n\t\t\t\treturn RES_PROCESS_ASYNC.abort;\r\n\t\t\t}\r\n\t\t\tif (!this.checkTargetElValidity()) return RES_PROCESS_ASYNC.skip;\r\n\t\t\tthis.resetCore(false);\r\n\t\t\tthis.printDbgStepInfo(reason, dbgInfo);\r\n\r\n\t\t\tthis.processTargetBranchAndFixedPosState();\r\n\t\t\tthis.reInitLayers();\r\n\t\t\tconst scrollTimeMs = this.calculateScrollTimeToTarget();\r\n\t\t\tawait this.scrollTargetIntoView(Math.min(scrollTimeMs, SCROLL_SPEED.maxParentScrollTimeMs));\r\n\t\t\tthis.actualizeShadowOverlay();\r\n\t\t\tthis.actualizeStepNumber();\r\n\t\t\tthis.calculateTargetBBs();\r\n\t\t\tthis.actualizeUserInteraction(stepItem);\r\n\t\t\tthis.setTooltipContent(stepItem);\r\n\t\t\tthis.placeTargetPosBasedLayers();\r\n\r\n\t\t\tthis.actualizeButtons();\r\n\t\t\tthis.actualizeProgressBar();\r\n\t\t\tthis.actualizeTooltipRadiusPadding();\r\n\t\t\tthis.actualizeTooltipMinWidth();\r\n\r\n\t\t\tthis.actualizeBulletsNavigActiveItem();\r\n\r\n\t\t\t//this.actualizeTooltipBB();\r\n\r\n\t\t\tthis.initTooltip(true);\r\n\t\t\tthis.placeTooltip(mode.useLastTooltipPos, mode.useLastNumberPos);\r\n\r\n\t\t\tthis.showIntroLayers();\r\n\t\t\tthis.scrollFlierIntoView(this.isBackward, mode.scrollOnlyWhenNeeded, scrollTimeMs);\r\n\t\t\t// set intersection observer to check target is on screen\r\n\t\t\t//this.restoreRefreshers();\r\n\t\t\tthis.startRefreshers();\r\n\r\n\t\t\treturn RES_PROCESS_ASYNC.done;\r\n\r\n\t\t}, true);\r\n\r\n\t}\r\n\r\n}\r\n","import { ceil1dec, floor1dec, round1dec } from '../../../../../includes/assets/js/modules/dpitUtilsInc';\r\nimport { getCssValFloat } from '../dpitUtilsPublic';\r\nimport DpitBB from './DpitBB';\r\n\r\n\r\nconst calculateSpaceAroundFeature = (tooltipBB, maxScreenBB, isLeftOrRight) => {\r\n\t// Calculate features\r\n\tlet spaceAroundRatio = {\r\n\t\twidth: tooltipBB.width / maxScreenBB.width,\r\n\t\theight: tooltipBB.height / maxScreenBB.height\r\n\t};\r\n\treturn isLeftOrRight ? spaceAroundRatio.width - spaceAroundRatio.height : spaceAroundRatio.height - spaceAroundRatio.width;\r\n};\r\n\r\nconst determineGoldenIncrement = (spaceAroundFeature, isOverHeight, isLeftOrRight, maxDocBB, tooltipBB, closerToTargetBB, tooltipPos) => {\r\n\tlet moveCloserToWinBorder = Math.sign(spaceAroundFeature) < 0;\r\n\r\n\tif (isOverHeight) moveCloserToWinBorder = isLeftOrRight;\r\n\tlet range = [0, 0];\r\n\tswitch (tooltipPos.base) {\r\n\t\tcase 'left': range = moveCloserToWinBorder ? [maxDocBB.left, tooltipBB.left] : [tooltipBB.left, closerToTargetBB.left]; break;\r\n\t\tcase 'right': range = moveCloserToWinBorder ? [tooltipBB.right, maxDocBB.right] : [closerToTargetBB.right, tooltipBB.right]; break;\r\n\t\tcase 'top': range = moveCloserToWinBorder ? [maxDocBB.top, tooltipBB.top] : [tooltipBB.top, closerToTargetBB.top]; break;\r\n\t\tcase 'bottom': range = moveCloserToWinBorder ? [tooltipBB.bottom, maxDocBB.bottom] : [closerToTargetBB.bottom, tooltipBB.bottom]; break;\r\n\t}\r\n\treturn Math.floor((moveCloserToWinBorder ? -1 : 1) * (range[1] - range[0]) / 2);\r\n};\r\n\r\nconst modifyTooltipPosition = (increment, targetBB, tooltipEl, tooltipBB, tooltipPos, isLeftOrRight, tooltipMinWidth) => {\r\n\tif (isLeftOrRight) {\r\n\t\tif (tooltipBB.width - increment < tooltipMinWidth) return false;\r\n\t\tconst bkpTooltipBB = { ...tooltipBB };\r\n\r\n\t\ttooltipEl.style.width = round1dec(tooltipBB.width - increment) + 'px';\r\n\r\n\t\tif (tooltipPos.base === 'left') {\r\n\r\n\t\t\tconst newWidth = $(tooltipEl).outerWidth(false);\r\n\t\t\tif (newWidth !== bkpTooltipBB.width) {\r\n\t\t\t\ttooltipEl.style.left = ceil1dec(tooltipBB.left - (newWidth - bkpTooltipBB.width) - targetBB.left) + 'px';\r\n\t\t\t}\r\n\t\t}\r\n\t\tswitch (tooltipPos.align) {\r\n\t\t\tcase 'middle': {\r\n\t\t\t\tconst newHeight = $(tooltipEl).outerHeight(false);\r\n\t\t\t\tif (newHeight !== bkpTooltipBB.height) {\r\n\t\t\t\t\ttooltipEl.style.top = floor1dec((targetBB.height - newHeight) / 2) + 'px';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'bottom': {\r\n\t\t\t\tconst newHeight = $(tooltipEl).outerHeight(false);\r\n\t\t\t\tif (newHeight !== bkpTooltipBB.height) {\r\n\t\t\t\t\ttooltipEl.style.top = floor1dec(tooltipBB.bottom - newHeight + 1 - targetBB.top) + 'px';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\telse {\r\n\t\t// adjusting height doesn't automatically change a width ... so changing width instead\r\n\t\tif (tooltipBB.width + increment < tooltipMinWidth) return false;\r\n\t\tconst bkpTooltipHeight = tooltipBB.height;\r\n\t\tconst bkpTooltipWidth = tooltipBB.width;\r\n\t\tconst currentLeft = getCssValFloat(tooltipEl, 'left', 0);\r\n\t\ttooltipEl.style.width = round1dec(tooltipBB.width + increment) + 'px';\r\n\t\tconst newWidth = $(tooltipEl).outerWidth(false);\r\n\t\tconst appliedIncrement = newWidth - bkpTooltipWidth;\r\n\t\tif (bkpTooltipWidth !== newWidth) {\r\n\t\t\tif (tooltipPos.align === 'center') {\r\n\t\t\t\ttooltipEl.style.left = round1dec(currentLeft - (appliedIncrement / 2)) + 'px';\r\n\t\t\t}\r\n\t\t\telse if (tooltipPos.align === 'right') {\r\n\t\t\t\ttooltipEl.style.left = round1dec(tooltipBB.left - appliedIncrement - targetBB.left) + 'px';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (tooltipPos.base === 'top') {\r\n\t\t\tconst newHeight = $(tooltipEl).outerHeight(false);\r\n\t\t\tif (newHeight !== bkpTooltipHeight) {\r\n\t\t\t\ttooltipEl.style.top = floor1dec(tooltipBB.top - (newHeight - bkpTooltipHeight) - targetBB.top) + 'px';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\treturn true;\r\n};\r\n\r\n\r\nconst returnResult = (isOverHeight, wasPosAdjusted, iterations, dpDebugEn, dbgFailedReason) => {\r\n\tif (dpDebugEn) {\r\n\t\tif (wasPosAdjusted) {\r\n\t\t\tconsole.log('[dpit] GOLDEN RATIO:', `success (by ${iterations} iterations)`);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(`[dpit] GOLDEN RATIO: ${dbgFailedReason}`, `iterations: ${iterations}`);\r\n\t\t}\r\n\t}\r\n\treturn {\r\n\t\twasPosAdjusted,\r\n\t\tisOverHeight\r\n\t};\r\n};\r\n\r\n\r\nconst revertLastModificationAndReturn = (lastTooltipInlineStyle, tooltipEl, lastIsOverHeight, iterations, dpDebugEn, dbgFailedReason) => {\r\n\ttooltipEl.setAttribute('style', lastTooltipInlineStyle);\r\n\titerations--;\r\n\treturn returnResult(lastIsOverHeight, iterations > 0, iterations, dpDebugEn, dbgFailedReason);\r\n};\r\n\r\nconst getInlineStyleOfElement = (tooltipEl) => {\r\n\tlet inlineStyle = tooltipEl.getAttribute('style');\r\n\tif (inlineStyle === null) return false;\r\n\tif (typeof inlineStyle === 'object') inlineStyle = inlineStyle.cssText;\r\n\treturn inlineStyle;\r\n};\r\n\r\n\r\nexport default (targetBB, initTooltipBB, tooltipEl, tooltipPos, maxWinBB, maxDocBB, isFixedPos, tooltipMinWidth, dpDebugEn, maxIterations = 10) => {\r\n\tconst initIsOverHeight = initTooltipBB.height > maxWinBB.height;\r\n\tconst isLeftOrRight = ['left', 'right'].includes(tooltipPos.base);\r\n\r\n\tlet iterations = 0;\r\n\r\n\tlet lastTooltipInlineStyle = getInlineStyleOfElement(tooltipEl);\r\n\r\n\r\n\tlet tooltipBB = { ...initTooltipBB };\r\n\tlet lastTooltipBB = null;\r\n\tlet isOverHeight = initIsOverHeight;\r\n\tlet lastIsOverHeight = null;\r\n\tlet lastFeatureSpaceAround = null;\r\n\r\n\t// Calculate the space around feature\r\n\tlet featureSpaceAround = calculateSpaceAroundFeature(tooltipBB, maxWinBB, isLeftOrRight);\r\n\r\n\twhile (iterations < maxIterations) {\r\n\r\n\t\t// Was algorithm successful so finish ?\r\n\t\tlet isBestPosFound = false;\r\n\t\tif (!isOverHeight) {\r\n\t\t\tif (lastFeatureSpaceAround) {\r\n\t\t\t\tconst featureSpaceAroundDerivation = Math.abs(lastFeatureSpaceAround) - Math.abs(featureSpaceAround);\r\n\t\t\t\tisBestPosFound = Math.abs(featureSpaceAround) <= 0.1 || featureSpaceAroundDerivation <= 0.05;\r\n\t\t\t} else {\r\n\t\t\t\tisBestPosFound = Math.abs(featureSpaceAround) <= 0.03;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (isBestPosFound) return returnResult(isOverHeight, iterations > 0, iterations, dpDebugEn, 'was not needed');\r\n\r\n\t\t// Determine size/position increment by golden ratio\r\n\t\tconst increment = determineGoldenIncrement(\r\n\t\t\tfeatureSpaceAround,\r\n\t\t\tisOverHeight,\r\n\t\t\tisLeftOrRight,\r\n\t\t\tmaxDocBB,\r\n\t\t\ttooltipBB,\r\n\t\t\titerations === 0 ? targetBB : tooltipBB,\r\n\t\t\ttooltipPos\r\n\t\t);\r\n\r\n\t\titerations++;\r\n\t\tlet wasPositionChange = false;\r\n\t\t// Change to new size/position\r\n\t\tif (increment && modifyTooltipPosition(\r\n\t\t\tincrement,\r\n\t\t\ttargetBB,\r\n\t\t\ttooltipEl,\r\n\t\t\ttooltipBB,\r\n\t\t\ttooltipPos,\r\n\t\t\tisLeftOrRight,\r\n\t\t\ttooltipMinWidth,\r\n\t\t\tisFixedPos\r\n\t\t)) {\r\n\t\t\ttooltipBB = DpitBB.fromElement(tooltipEl, isFixedPos);\r\n\t\t\tconst maxArea = maxWinBB;// isFixedPos ? maxWinBB : maxDocBB;\r\n\t\t\tif (tooltipBB && tooltipBB.left >= maxArea.left - 1 && tooltipBB.right <= maxArea.right + 1) {\r\n\t\t\t\twasPositionChange = true;\r\n\t\t\t} else {\r\n\t\t\t\treturn revertLastModificationAndReturn(\r\n\t\t\t\t\tlastTooltipInlineStyle,\r\n\t\t\t\t\ttooltipEl,\r\n\t\t\t\t\tlastIsOverHeight ?? initIsOverHeight,\r\n\t\t\t\t\titerations,\r\n\t\t\t\t\tdpDebugEn,\r\n\t\t\t\t\t'out of win'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (!wasPositionChange || (lastTooltipBB && DpitBB.isEqual(lastTooltipBB, tooltipBB))) {\r\n\t\t\treturn revertLastModificationAndReturn(\r\n\t\t\t\tlastTooltipInlineStyle,\r\n\t\t\t\ttooltipEl,\r\n\t\t\t\tlastIsOverHeight ?? initIsOverHeight,\r\n\t\t\t\titerations,\r\n\t\t\t\tdpDebugEn,\r\n\t\t\t\t'no effect'\r\n\t\t\t);\r\n\t\t}\r\n\t\t// Check over height\r\n\t\tisOverHeight = tooltipBB.height > maxWinBB.height;\r\n\t\tlastFeatureSpaceAround = featureSpaceAround;\r\n\t\tfeatureSpaceAround = calculateSpaceAroundFeature(tooltipBB, maxWinBB, isLeftOrRight);\r\n\t\t// Check not a beneficial golden iteration direction\r\n\t\tif (lastFeatureSpaceAround && !isOverHeight && Math.abs(featureSpaceAround) > Math.abs(lastFeatureSpaceAround)) {\r\n\t\t\treturn revertLastModificationAndReturn(\r\n\t\t\t\tlastTooltipInlineStyle,\r\n\t\t\t\ttooltipEl,\r\n\t\t\t\tlastIsOverHeight ?? initIsOverHeight,\r\n\t\t\t\titerations,\r\n\t\t\t\tdpDebugEn,\r\n\t\t\t\t'worse feature'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlastTooltipInlineStyle = getInlineStyleOfElement(tooltipEl);\r\n\t\tlastTooltipBB = { ...tooltipBB };\r\n\t\tlastIsOverHeight = isOverHeight;\r\n\t}\r\n\treturn returnResult(initIsOverHeight, false, iterations, dpDebugEn, 'too many iterations');\r\n};","\r\nimport { } from '../dpitUtilsPublic';\r\nimport DpitTarget from './DpitTarget';\r\nimport DpitTargetParent from './DpitTargetParent';\r\n\r\n\r\nexport default class DpitTargetBranch {\r\n\tconstructor(targetElement, dpDebugEn) {\r\n\t\tthis.dpDebugEn = dpDebugEn;\r\n\t\t//this.initProcessData();\r\n\t\tthis.initBranch(targetElement, dpDebugEn);\r\n\t}\r\n\r\n\tinitProcessData() {\r\n\t\tthis.isZIdxFixParent = false;\r\n\t\tthis.closestFixedPosItem = null;\r\n\t\tthis.fixedPosElements = [];\r\n\t\tthis.stickyPosElements = [];\r\n\t\tthis.scrollableElements = [];\r\n\t}\r\n\r\n\r\n\tinitBranch(targetElement) {\r\n\t\tthis.branchItems = [];\r\n\t\tif (targetElement) {\r\n\t\t\tlet element = targetElement;\r\n\t\t\tlet distance = 0;\r\n\t\t\tdo {\r\n\t\t\t\tswitch (distance) {\r\n\t\t\t\t\tcase 0: this.branchItems.push(new DpitTarget(element)); break;\r\n\t\t\t\t\tdefault: this.branchItems.push(new DpitTargetParent(element)); break;\r\n\t\t\t\t}\r\n\t\t\t\telement = element.parentNode;\r\n\t\t\t\tdistance++;\r\n\t\t\t\tif (!element.tagName || element.tagName.toLowerCase() === 'body') break;\r\n\t\t\t} while (element !== null);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tgetTargetItem() {\r\n\t\treturn this.branchItems[0];\r\n\t}\r\n\r\n\tcontainsFixed() {\r\n\t\treturn this.fixedPosElements?.length > 0;\r\n\t}\r\n\r\n\tcontainsFixedParent() {\r\n\t\treturn this.closestFixedPosItem?.element !== null;\r\n\t}\r\n\r\n\tgetClosestFixedParent() {\r\n\t\treturn this.closestFixedPosItem?.element;\r\n\t}\r\n\r\n\tgetFirstScrollableChildFromClosestFixedParent() {\r\n\t\tif (!this.closestFixedPosItem?.element || !this.branchItems) return null;\r\n\t\tconst closestFixedPosItemIdx = this.branchItems.indexOf(this.closestFixedPosItem, 1);\r\n\t\tif (closestFixedPosItemIdx > 0) {\r\n\t\t\tfor (let distanceFromTarget = closestFixedPosItemIdx; distanceFromTarget > 0; distanceFromTarget--) {\r\n\t\t\t\tconst item = this.branchItems[distanceFromTarget];\r\n\t\t\t\tif (item.analysis.isScrollable) {\r\n\t\t\t\t\treturn item.element;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcontainsSticky() {\r\n\t\treturn this.stickyPosElements?.length > 0;\r\n\t}\r\n\r\n\tcontainsScrollable() {\r\n\t\treturn this.scrollableElements?.length > 0;\r\n\t}\r\n\r\n\tprocess() {\r\n\t\tthis.initProcessData();\r\n\t\tthis.branchItems.forEach(item => {\r\n\t\t\titem.process(this.isZIdxFixParent);\r\n\t\t\tif (!this.isZIdxFixParent && item.needsZIndexFix) this.isZIdxFixParent = true;\r\n\r\n\t\t\tif (item.analysis.isFixed) {\r\n\t\t\t\tthis.fixedPosElements.push(item.element);\r\n\t\t\t\tif (item !== this.getTargetItem()) {\r\n\t\t\t\t\tthis.closestFixedPosItem = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (item.analysis.isSticky) this.stickyPosElements.push(item.element);\r\n\t\t\tif (item.analysis.isScrollable) this.scrollableElements.push(item.element);\r\n\t\t});\r\n\t\tif (this.dpDebugEn) console.log('[dpit] Branch analysis:', this.branchItems, this);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.branchItems.forEach(item => {\r\n\t\t\titem.destroy();\r\n\t\t});\r\n\t}\r\n\r\n\r\n}","import { showElement } from '../../../../../includes/assets/js/modules/dpitHidden';\r\nimport { getParentsAndChildrenLinkElements } from '../dpitUtilsPublic';\r\nimport { MODIFIERS, TIMING, CLASSES_CORE } from './constants';\r\nimport EventListeners from './EventListeners';\r\nimport ExclusiveClickListener from './ExclusiveClickListener';\r\n\r\n\r\nexport default class DpitUserInteraction {\r\n\r\n\tconstructor(options, tooltipRefEl, animation, onIterateStep, onIterateStepInProgress, onBeforeUnloadByLinkClick) {\r\n\t\tif (options.debugEn) console.log('[dpit] INIT DpitUserInteraction');\r\n\t\tthis.onBeforeUnloadByLinkClick = onBeforeUnloadByLinkClick;\r\n\t\tthis.tooltipRefEl = tooltipRefEl;\r\n\t\tthis.options = options;\r\n\t\tthis.animation = animation;\r\n\t\tthis.onIterateStep = onIterateStep;\r\n\t\tthis.onIterateStepInProgress = onIterateStepInProgress;\r\n\t\tthis.isIterateStepInAction = false;\r\n\t\tthis.hoverListeners = new EventListeners();\r\n\t\tthis.linkClickListener = new ExclusiveClickListener(this.processTargetLinkClick.bind(this), true, false, false, true);\r\n\t\tthis.iterateClickListener = new ExclusiveClickListener(this.iterateStepAfterUserAction.bind(this));\r\n\t\tthis.blockClickListener = new ExclusiveClickListener();\r\n\t}\r\n\r\n\tupdate(stepItem) {\r\n\t\tthis.destroy();\r\n\t\tthis.stepItem = { ...stepItem };\r\n\t\tthis.element = stepItem?.element;\r\n\t\tthis.updateIterateAfterClick();\r\n\t\tthis.updateIterateAfterHover();\r\n\t\tthis.updateLinkClick();\r\n\t}\r\n\r\n\r\n\tdestroy() {\r\n\t\tthis.clearIterateAfterClick();\r\n\t\tthis.clearIterateAfterHover();\r\n\t\tthis.clearTargetLinkClickAdjustment();\r\n\t\tthis.iterateClickListener.clear(true);\r\n\t\tthis.blockClickListener.clear(true);\r\n\t\tthis.hoverListeners.removeAll();\r\n\t}\r\n\r\n\r\n\r\n\tupdateDisableInteractionLayer(stepItem, wrapEl, moveLayer2TargetFce) {\r\n\t\tif (stepItem && stepItem.enable_interaction.val != '1') {\r\n\t\t\tthis.insertDisableInteractionLayer(wrapEl, moveLayer2TargetFce);\r\n\t\t} else {\r\n\t\t\tthis.removeDisableInteractionLayer();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tinsertDisableInteractionLayer(wrapEl, moveLayer2TargetFce) {\r\n\t\tif (!this.disableInteractionLayer && this.tooltipRefEl) {\r\n\t\t\tthis.disableInteractionLayer = document.createElement('div');\r\n\t\t\tthis.disableInteractionLayer.className = CLASSES_CORE.disableInteraction;\r\n\t\t\twrapEl.insertBefore(this.disableInteractionLayer, this.tooltipRefEl);\r\n\t\t}\r\n\t\tif (moveLayer2TargetFce instanceof Function) moveLayer2TargetFce(this.disableInteractionLayer);\r\n\t}\r\n\r\n\tremoveDisableInteractionLayer() {\r\n\t\tif (this.disableInteractionLayer) {\r\n\t\t\tthis.disableInteractionLayer.parentNode.removeChild(this.disableInteractionLayer);\r\n\t\t\tthis.disableInteractionLayer = null;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateLinkClick() {\r\n\t\tif (this.stepItem?.element && !this.isBlockClicks() && !this.isIterateAfterClick(this.stepItem)) {\r\n\t\t\tthis.startTargetLinkClickAdjustment();\r\n\t\t} else {\r\n\t\t\tthis.clearTargetLinkClickAdjustment();\r\n\t\t}\r\n\t}\r\n\r\n\tstartTargetLinkClickAdjustment() {\r\n\t\tthis.linkClickListener.clear(true);\r\n\t\tconst allElementsToBlock = getParentsAndChildrenLinkElements(this.stepItem?.element, true);\r\n\t\tif (allElementsToBlock) {\r\n\t\t\tthis.linkClickListener.addElements(allElementsToBlock);\r\n\t\t}\r\n\t}\r\n\r\n\tclearTargetLinkClickAdjustment() {\r\n\t\tthis.linkClickListener.clear(true);\r\n\t}\r\n\r\n\t/**\r\n\t * Force to open link element in new tab\r\n\t * @param {Event} event click event\r\n\t * @param {Element} linkElement element where event occurs\r\n\t */\r\n\tprocessTargetLinkClick(event, linkElement) {\r\n\r\n\t\tif (this.disabled && this.userInteractionTryWhenDisabledFce) {\r\n\t\t\tthis.userInteractionTryWhenDisabledFce();\r\n\t\t}\r\n\t\tconst isBlockClicks = this.isBlockClicks();\r\n\r\n\t\tif (!this.isIterateStepInAction && !this.disabled && linkElement && !isBlockClicks && !this.isIterateAfterClick(this.stepItem)) {\r\n\t\t\tconst hrefAttribute = linkElement.getAttribute('href');\r\n\r\n\t\t\tif (hrefAttribute && event) {\r\n\t\t\t\tconst targetAttribute = linkElement.getAttribute('target');\r\n\t\t\t\tif (targetAttribute === '_blank' || this.isOpenTargetLinkClicksInNewTab()) {\r\n\t\t\t\t\tif (this.options.dpDebugEn) console.log('[dpit] TARGET CLICK: <a> element inside a target was clicked and opened in new tab.');\r\n\t\t\t\t\tif (!event.defaultPrevented) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\twindow.open(hrefAttribute, '_blank');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t} catch (exception) {\r\n\t\t\t\t\t\t\tconsole.error(exception);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this.onBeforeUnloadByLinkClick instanceof Function) {\r\n\t\t\t\t\tthis.onBeforeUnloadByLinkClick(hrefAttribute);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (event && isBlockClicks) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tclearIterateAfterClick() {\r\n\t\tif (this.element) {\r\n\t\t\tthis.element.classList.remove(\r\n\t\t\t\tCLASSES_CORE.target + MODIFIERS.click,\r\n\t\t\t\tCLASSES_CORE.target + MODIFIERS.blockClick\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateIterateAfterClick() {\r\n\t\tif (this.element) {\r\n\t\t\tthis.iterateClickListener.clear(true);\r\n\t\t\tif (this.isIterateAfterClick(this.stepItem)) {\r\n\t\t\t\tthis.iterateClickListener.addElement(this.element);\r\n\t\t\t\tthis.element.classList.add(CLASSES_CORE.target + MODIFIERS.click);\r\n\t\t\t}\r\n\t\t\telse if (this.isBlockClicks(this.stepItem)) {\r\n\t\t\t\tthis.blockClickListener.addElement(this.element);\r\n\t\t\t\tthis.element.classList.add(CLASSES_CORE.target + MODIFIERS.blockClick);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdisable(userInteractionTryWhenDisabledFce) {\r\n\t\tthis.disabled = true;\r\n\t\tthis.userInteractionTryWhenDisabledFce = userInteractionTryWhenDisabledFce;\r\n\t}\r\n\r\n\tenable() {\r\n\t\tthis.disabled = false;\r\n\t\tthis.userInteractionTryWhenDisabledFce = null;\r\n\t}\r\n\r\n\r\n\titerateStepAfterUserAction() {\r\n\r\n\t\tif (this.disabled && this.userInteractionTryWhenDisabledFce) this.userInteractionTryWhenDisabledFce();\r\n\r\n\t\tif (!this.isIterateStepInAction && !this.disabled && this.stepItem) {\r\n\t\t\tthis.isIterateStepInAction = true;\r\n\t\t\tlet delay = this.stepItem.enable_interaction?.ext?.iterate_after_click_delay_ms ?? TIMING.defaultIterateAfterClick;\r\n\t\t\tthis.animation.start();\r\n\t\t\t//hideElement(this.stepItem?.element);\r\n\t\t\tif (this.onIterateStepInProgress instanceof Function) {\r\n\t\t\t\tthis.onIterateStepInProgress(true);\r\n\t\t\t}\r\n\t\t\tthis.destroy();\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.animation.stop();\r\n\t\t\t\tshowElement(this.stepItem?.element);\r\n\t\t\t\tif (this.onIterateStepInProgress instanceof Function) {\r\n\t\t\t\t\tthis.onIterateStepInProgress(false);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.onIterateStep instanceof Function) {\r\n\t\t\t\t\tthis.onIterateStep();\r\n\t\t\t\t}\r\n\t\t\t\tthis.isIterateStepInAction = false;\r\n\t\t\t}, delay);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tisInteractionFeatureEnabled(featureId) {\r\n\t\treturn this.stepItem\r\n\t\t\t&& this.stepItem.element\r\n\t\t\t&& this.stepItem.enable_interaction.val == '1'\r\n\t\t\t&& this.stepItem.enable_interaction.ext\r\n\t\t\t&& this.stepItem.enable_interaction.ext[featureId] == '1';\r\n\t}\r\n\r\n\tisIterateAfterClick() {\r\n\t\treturn this.isInteractionFeatureEnabled('iterate_after_click');\r\n\t}\r\n\r\n\tisOpenTargetLinkClicksInNewTab() {\r\n\t\treturn this.isInteractionFeatureEnabled('open_target_link_clicks_in_new_tab');\r\n\t}\r\n\r\n\tisBlockClicks() {\r\n\t\treturn this.isInteractionFeatureEnabled('iterate_after_click_stop_propagation');\r\n\t}\r\n\r\n\r\n\tupdateIterateAfterHover() {\r\n\t\tif (this.element) {\r\n\t\t\tif (this.isIterateAfterHover(this.stepItem)) {\r\n\t\t\t\tthis.hoverListeners.add(this.element, 'mouseenter', this.iterateStepAfterUserAction.bind(this));\r\n\t\t\t\tthis.element.classList.add(CLASSES_CORE.target + MODIFIERS.hover);\r\n\t\t\t} else {\r\n\t\t\t\tthis.clearIterateAfterHover();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclearIterateAfterHover() {\r\n\t\tif (this.element) {\r\n\t\t\tthis.element.classList.remove(CLASSES_CORE.target + MODIFIERS.hover);\r\n\t\t}\r\n\t}\r\n\r\n\tisIterateAfterHover() {\r\n\t\treturn this.stepItem\r\n\t\t\t&& this.stepItem.element\r\n\t\t\t&& this.stepItem.enable_interaction.val == '1'\r\n\t\t\t//&& !this.stepItem.isDummyElement\r\n\t\t\t&& this.stepItem.enable_interaction.ext?.iterate_after_hover == '1';\r\n\t}\r\n\r\n}\r\n","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}"],"sourceRoot":""}