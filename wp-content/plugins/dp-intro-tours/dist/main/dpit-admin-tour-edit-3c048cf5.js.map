{"version":3,"sources":["webpack:///./includes/assets/js/modules/dpitHidden.js","webpack:///./admin/assets/js/modules/DpitMultiStateAnimBtn.js","webpack:///./admin/assets/js/modules/DpitMultiStateBtn.js","webpack:///./includes/assets/js/modules/DpitHooks.js","webpack:///./node_modules/autosize/dist/autosize.js","webpack:///./admin/assets/js/modules/AcfTippy.js","webpack:///./admin/assets/js/modules/AcfTableHtmlComps.js","webpack:///./admin/assets/js/modules/ContainerDragger.js","webpack:///./admin/assets/js/modules/AcfTableField.js","webpack:///./admin/assets/js/modules/DpitAdminTourEdit.js","webpack:///./admin/assets/js/modules/DPProPromoButton.js","webpack:///./admin/assets/js/modules/DPAcfAdjust.js","webpack:///./admin/assets/js/dpit-admin-tour-edit.js","webpack:///./admin/assets/js/modules/dp-admin-utils.js","webpack:///./includes/assets/js/modules/BulletsAnimation.js","webpack:///./admin/assets/js/modules/DpitAdminToolbar.js","webpack:///./includes/assets/js/modules/DpTinyMceDialog.js","webpack:///./includes/assets/js/modules/DpWpLinkQuery.js","webpack:///./includes/assets/js/modules/DpWpLinkRiver.js","webpack:///./includes/assets/js/modules/DpWpLink.js"],"names":["hideElement","element","byOpacity","arguments","length","undefined","noSpace","noTransition","transitionBkp","style","transition","classList","add","setTimeout","showElement","remove","DpitMultiStateAnimBtn","constructor","onClickCB","statesOptions","initState","bemRootClass","additionalClasses","inactive","id","htmlTag","_defineProperty","event","this","bulletsAnimation","isRunning","stopPropagation","preventDefault","Function","state","currentState","button","document","createElement","setAttribute","className","classNames","addEventListener","onClickHandler","btnBemClass","initStates","setOnlyState","deactivate","activate","removeStateClass","addStateClass","renderContent","stateEl","stateContent","HTMLElement","appendChild","innerHTML","stateOptions","stateKeys","Object","keys","forEach","contentBemClassBase","stateOption","newStateOption","content","getButtonElement","destroy","_this$element","removeEventListener","deactivateAll","clearActiveClasses","activeMod","activeClass","setActiveClasses","setOnlyStateTemporarily","followingState","timeout","key","_this$stateOptions$ke","display","super","BulletsAnimation","startAnimation","backward","loops","loopsPassedCb","isAnimated","start","onAnimationEnded","setProperty","stopAnimation","stop","removeProperty","hideStateItems","opacity","showStateItems","window","DpitHooks","actions","filters","init","dpDebugEn","console","log","addAction","tag","callback","priority","push","addFilter","removeAction","filter","i","splice","removeFilter","doAction","args","hook","hooks","applyFilters","value","res","module","exports","values","map","Map","has","indexOf","get","set","delete","index","createEvent","name","Event","bubbles","e","evt","initEvent","assign","ta","nodeName","heightOffset","clientWidth","cachedHeight","pageResize","update","bind","height","resize","overflowY","overflowX","wordWrap","getComputedStyle","boxSizing","parseFloat","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","isNaN","changeOverflow","width","offsetWidth","scrollHeight","overflows","el","arr","parentNode","Element","scrollTop","node","getParentOverflows","docTop","documentElement","styleHeight","Math","round","computed","actualHeight","offsetHeight","dispatchEvent","err","methods","autosize","options","Array","prototype","call","x","default","AcfTippy","config","onInitialized","$","each","idx","jDescElement","find","jAcfField","closest","jMsgElement","descText","html","text","iconClass","hasClass","addClass","append","getInfoIconHtml","children","hide","stepDefinitions","data","hint","title","replace","interactive","theme","tippy","reference","getAttribute","animation","allowHTML","zIndex","_document$getElementB","getElementById","acfRootElId","firstInfoIcon","querySelector","load","urlJoin","assetsUrl","onInfoIconLoaded","$allIconsEls","show","onInitializedCb","reloadInfoIcons","firstFilledInfoIconEl","AcfTableHtmlComps","btn_small","btn_very_small","btn_very_very_small","btn_add_row","btn_remove_row","htmlButtons","add_row","concat","classes","remove_row","add_link","remove_link","body_row","top_cell","table","isEmptyObject","text_styles","header_cell","label","extraClass","join","body_cell","extraSettings","extraSettingsHtml","extra_data","idAttrStr","body_cell_link","firstLinkClass","items","split","i18n","tour_starts_at","item","body_cell_link_sub_item","EVERYWHERE","body_cell_checkbox","checked","checkedAttr","body_cell_select","optionCfg","valLabel","val","selected","visible","jQuery","esWrapperClass","_item$val2","type","_item$val","minAttr","min","maxAttr","max","stepAttr","step","def","ContainerDragger","containerElement","handlerSelector","excludedSelectors","minDragPositionChangePx","stopImmediatePropagation","dragData","left","target","containerEl","$containerEl","isContainerScrollable","isContainerScrollableFce","$dragAndDropHandler","not","setDraggingInProcess","on","onMouseDown","onMouseMove","onMouseUp","onContainerResize","isDragging","isDraggingConfirmed","adjustCursor","refresh","off","_this$dragData","cursor","containerWidth","paddingLeft","parseInt","paddingRight","paddingX","scrollWidth","isExcludedSelector","targetElement","is","scrollLeft","clientX","onBlockClickTimeout","clearTimeout","unblockClick","abs","blockClick","stopClickPropagation","_this$dragData2","_this$dragData3","dx","require","AcfTableField","onFirstStepUrlChanged","onRowAdded","jBody","onFirstStepUrlChangedCb","var","ajax","columIds","current_cell_obj","cell_editor_last_keycode","version","dpWpLink","DpWpLink","open","tableHtml","that","parent","jExtraCont","removeClass","rebuild_table_data","activeLinkCell","triggerChangeEventOnAcfTableRoot","linkAttrs","getAttrs","href","jSubEl","isFirstStep","row","jUl","urlVarExamples","simpleObjectToStr","returnValue","trigger","isChange","each_table","table_add_row_event","table_remove_row","table_add_link","table_remove_link","simple_cell_editor","link_editor","tmce_cell_editor","prevent_cell_links","sortable_row","ui_event_ajax","editor_custom_style","ajaxComplete","ui_init_drag_to_scroll","containerDraggers","_","p","obj_root","data_get","data_default","field_options_get","table_render","misc_render","b","c","field_options","parseJSON","decodeURIComponent","use_header","field_context","data_defaults","acftf","v","o","uh","ca","h","extend","obj_table","obj_top_row","obj_top_insert","obj_header_row","obj_header_insert","obj_bottom_row","obj_bottom_insert","before","table_top_labels","_this$config$stepDefi","definitionId","trim","headerCellLabels","includes","definition","allowedColumnsIdx","Number","fadeIn","body_rows","row_i","row_insert","cellData","get_column_html","colIdx","rowIdx","jRow","_this$config$stepDefi2","_dataVal$ext","_dataVal$ext$build_wi","columnId","stepDef","titleAttr","extraClasses","extClassStr","dataVal","decodeStepParamAdvancedVal","ext","build_with_wp_editor","init_option_use_header","init_option_caption","obj_use_header","update_table_data_field","use_caption","obj_caption","table_add_col","that_index","obj_col","parents","after","table_build_json","obj_row","table_add_row","table_add_first_row","_this$containerDragge","wasRemoved","col_amount","body_cells_html","obj_wrap","obj_table_rows","size","stepIdx","cellContent","_this$config$stepDefi3","_p$obj_table_rows","prevFirstStepLinkCellEl","outerHTML","next","table_left_labels","table_remove_first_row","_this$config$stepDefi4","firstStepLinkCellEl","_obj_table$find$get","secondStepLinkEl","rows_count","obj_rows","openWpLinkModal","letter_i_1","charCodeAt","letter_i_2","use_2","string","String","fromCharCode","getTableBodyCellContValAtomic","jContItem","_jContItem$find$","contItemSelector","resArr","jLi","n","clone","end","getStepExtCfg","_this$config$stepDefi5","getTableBodyCellContVal","_this$config$stepDefi6","extCfg","mainVal","extVal","attr","encodeStepParamAdvancedVal","i2","element_row","update_table_data_version","JSON","stringify","encodeURIComponent","field_changed","tmce","DpTinyMceDialog","currentRow","prop","jTargetContentEl","getStepIdx","_this$config","setTextStyles","getWinBB","$sourceEl","initialLinkText","urlVarExamplesStr","strToSimpleObject","isUrlVariableProcessingEnabled","sysUrlVars","openDpWpLink","$cell","cell_editor_save","cell_editor_add_editor","jTarget","that_val","cell_editor_is_open","htmleditor","focus","textAreaElement","setSelectionRange","get_next_table_cell","next_cell","first","get_prev_table_cell","no_header","prev_cell","prev","row_selectors","last","root","cell_editor","cell_editor_textarea","cell_editor_val","fadeOut","sortable_fix_width","ui","fixVerticalScrollTop","childEl","param","axis","containment","handle","helper","cancel","columnIdx","firstUrlOfFirstStep","newFirstStepLinkCellEl","_newFirstStepLinkCell","textContent","sortable","change","sort_cols","header_row","header_row_children","end_index","start_index","body_row_children","IDS","CLASSES","TRIGGER_IDX","SELECTORS","DPProPromoButton","appendAfterSelector","toInsertAfterEl","promoBtn","onClick","proCTAText","filledContainerEl","wrapElementByContainer","proDemoLink","DPAcfAdjust","ready","dpIntroToursAdminTourEditConfig","printModuleName","preInit","initAcfActions","acf","initSubModules","runAfterInitActions","deactivateLoader","adminToolBar","stopPrimaryBtnAnimation","firstStepUrl","tourStartPageUrl","postRootEl","publishBtnOrigEl","initTriggers","initStepBuilder","initAcfPageLinkLongTouch","initLoader","renderStartUrlAndTourId","renderBuilderStepsButton","renderTriggerButton","startButtonsClickAbilityAutoUpdate","startTriggerSelectorLabelAutoUpdate","startIsChangeCheck","render","actualizeToolbar","isReady","scrollToOriginElementByUrlAndAnimate","queryParamsDefs","align","top","topOffset","lockX","scrollToStoredScrollTop","tourId","activateLoader","hidePostContent","delay","loaderEl","loaderTitleEl","showPostContent","afterInitCb","stepsTable","acfTable","actualize","onNewTableRowAdded","acfTippy","DpitAdminToolbar","onRedirectingFromToolbar","buttonId","actionTitle","beforeRedirecting","initTrigger","triggerIdx","groupEl","getTriggerAcfGroupName","triggersData","startUrlOptionEl","getStartUrlOptionEl","stepsTableEl","slugBoxEl","permalinkStrongTagEl","innerText","permalink_title","tourIdEl","tour_id","actualizeAllTourStartUrlLinks","startUrlHref","startUrlLabel","$adminBarViewEl","$AdminBarViewTourBtnLinkEl","$PermalinkEl","startUrlHrefAbs","sanitizePossibleRelativeUrl","siteUrl","builderStepsBtn","obBtnClick","TargetType","STEP","getBtnState","configure_steps_visually","createOrSetManuallyElement","or_set_man_table","triggerData","triggerGroupEl","toInsertBeforeEl","TRIGGER","set_visually","btnWrapEl","or_set_man","targetType","originId","originSubIdx","scrollToStartUrl","redirectQueryString","getRedirectUrlQueryString","Origin","ADMIN","isUnsavedChange","storingChanges","setTransientAndPressPrimaryButton","loadingFB","redirectToFirstStepUrl","error","firstStepLink","getFirstStepLink","url","redirectUrl","location","beforeUnload","storeCurrentScrollTop","_this$adminToolBar","setIsChange","actualizeButtonsState","showButtons","BTN_ID","preview","view","hideButtons","_this$triggersData$TR","_this$triggersData$TR2","useLastStartUrl","actualizeCore","getStepUrlLabel","actualizeTriggerSelectorLabel","triggerSelectorLabelEl","_groupEl$querySelecto","Model","events","onChange","triggerCfg","modeEl","relativeUrl","HOME_PAGE","activeLabel","set_first_step_url_FREE","ids","getAcfFieldVal","postAjaxData","fields","getFields","loaderLabel","onComplete","ajaxSetTransient","pressPrimaryButton","stack","scrollToElementAndAnimate","route","dataToPost","restApiUrl","headers","nonces","wp_rest","transientName","postId","expirationS","transientData","isGlobalStartAtAllPagesSet","async","animationClass","originIdKey","canceledKey","highlightClass","currentUrl","URL","getDpUrlParam","scrollIntoView","Promise","resolve","builderMode","originArea","params","dp_qpb_builder_mode","dp_qpb_builder_origin","dp_qpb_origin_el_id","dp_qp_tour_id","dp_qp_run_always_on_load","dp_qp_trigger_id","buildDpQueryString","getActualVisibleNoticesHeight","outerHeight","rootSelectorOrElement","tickMs","totalSize","visibleSize","activeSize","symmetrical","activeBulletClass","bemRoot","inactiveClass","getModifiedClass","activeHalfSize","floor","getRootElement","modifier","rootElement","preventScroll","bulletsLayer","createBullets","startReloadingSpinnerBack","startReloadingSpinner","getLoopTimeMs","count","bulletElements","bulletEl","activateBullet","activeIdx","distanceFromActive","distanceFromActiveAbs","stopAfterLoopEnd","loopEndCallback","finishAfterLoopEnd","finishAfterLoopEndCallback","_this$bulletsLayer","_this$rootElement","clearBulletActiveStates","stopReloadSpinner","blur","_this$bulletElements","spinnerInterval","clearInterval","bulletHideTimeout","setInterval","checkAfterLoopEnd","finishLoop","primary","draft","renderNow","previewButtonEnabled","onRedirectBtnClick","autoScrollToLastScrollTop","scrollTimeMs","wpCookies","adminBarEl","insertAfterEl","initStopWhenInvalidFormSubmitted","buttons","wrapEl","primaryBtn","_len","btnIdsToHide","_key","btnIdToHide","_this$buttons$btnIdTo","_this$buttons$btnIdTo2","_len2","_key2","_this$buttons$btnIdTo3","_this$buttons$btnIdTo4","showOnlyButton","btnIdToShowOnly","btnId","_this$buttons$btnId","activeOnLoad","renderButtons","propagateButtonClick","localId","_this$buttons$localId","sourceEl","click","getToolbarItemModifiedClass","storeButtonData","duplicatedEl","animateAndPropagateClick","ANIM_DBG","checkUnsavedAnimateAndRedirectPropagateClick","primaryButtonEl","draftButtonEl","draftBtn","previewButtonEl","childNodes","nodeType","Node","TEXT_NODE","previewBtn","viewPostButtonEl","viewBtn","redirecting","clearCurrentScrollTopCookie","deleteCookie","setCookie","storedScrollTopCookie","getCookie","storedScrollTop","animate","MCE_FLOATING_PANELS_SELECTORS","onTmceSaved","onTmceCancel","htmlContent","tinyMCE","activeEditor","getContent","forceTargetBlank","close","keydown","containsShortCode","shortCodes","match","modalOpened","keyCode","showOverlay","hideOverlay","stepIdxOneBased","getNthStr","hadDpitRelPos","updateCssVar","body","editor","setContent","format","selection","select","getBody","collapse","enableMceFloatPanels","disableMceFloatPanels","wasCanceled","DpWpLinkQuery","search","page","allLoaded","querying","self","query","action","_dp_wplink_nonce","post","ajaxUrl","r","DpWpLinkRiver","ul","contentHeight","waiting","delayedCallback","func","timeoutTriggered","funcTriggered","funcArgs","funcContext","apply","posts","deselect","li","liHeight","elHeight","liTop","elTop","position","to","minRiverAJAXDuration","inputs","response","results","process","_search","list","alt","firstPage","printPostTypeItem","keepPreviousStepUrl","permalink","info","variableLink","infoLong","keepPreviousStepUrlLngInfo","keepCurrentUrl","keepCurrentUrlLngInfo","allowedPostTypes","allowedPostTypesInPagePostURL","loadAllPostTypes","toLowerCase","disabledPostTypes","noMatchesFound","additionalClass","startsWith","urlParts","port","startUrlNoPort","toString","noTitle","maybeLoad","bottom","riverBottomThreshold","newTop","newBottom","timeToTriggerRiver","scroll","varId","tagName","currentVal","insertAt","charAt","slice","rivers","recent","unifiedSiteUrl","unifyUrl","wrap","dialog","backdrop","submit","urlVarButton","urlVarBackButton","nonce","elements","queryNotice","queryNoticeTextDefault","queryNoticeTextHint","keyup","updateFields","searchTimer","searchInternalLinks","updateAfterUrlChanged","correctURL","loadTippy","isVariableTypingInProcess","updateVariableUrlsGUI","cancelVariableTypingInProcess","sanitizeUrl","removeTrailingSlashes","regExp","isAbsolute","test","isUrlAtOurSite","activateSubmitButtonSpinner","sanitizedUrl","correctedURL","_ref","_document$documentEle","_document","_document$documentEle2","_document2","_document2$body","openHidden","closeAfterSubmit","enableUrlVarExamples","_$$offset","startScrollTop","modalOpen","offset","urlVars","sysUrlVarsTmp","setUrlExamples","setDefaultValues","force","getUrlExamples","htmlUpdate","attrs","parser","protocol","updateSubmitButton","isOnTypingEvent","isVariableUrl","renderUrlVarExTimeout","renderUrlVarItems","nonActiveUrlVarExamples","varIds","getUrlVarIdsFromUrl","excludeSysVars","regex","matches","exec","vars","sysUrlVarsLength","unshift","onUrlVarClick","isSystemVar","idAndVal","jUrlVarItem","getUrlVarExampleHtml","jNextItem","getCustomVariables","urlExamples","isSystem","itemClass","beginIsEnough","lastIndexOf","lastOpen","substring","save","minInputLength","lastSearch","shiftKey","activeElement","fn","keyInterval","keySensitivity"],"mappings":"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","file":"main/dpit-admin-tour-edit-3c048cf5.js","sourcesContent":["/**\r\n * @param {Element} element element to hide\r\n */\r\nexport const hideElement = (element, byOpacity = true, noSpace = false, noTransition = false) => {\r\n\tif (element) {\r\n\t\tlet transitionBkp = '';\r\n\t\tif (noTransition) {\r\n\t\t\ttransitionBkp = element.style.transition;\r\n\t\t\telement.style.transition = 'unset';\r\n\t\t}\r\n\r\n\t\telement.classList.add('dpit-hidden');\r\n\t\tif (!byOpacity) element.classList.add('dpit-hidden--by-disp');\r\n\t\tif (noSpace) element.classList.add('dpit-hidden--no-space');\r\n\r\n\t\tif (noTransition) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\telement.style.transition = transitionBkp;\r\n\t\t\t}, 50);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @param {Element} element element to hide\r\n */\r\nexport const hideElementImmediately = (element, byOpacity = true, noSpace = false) => {\r\n\thideElement(element, byOpacity, noSpace, true);\r\n};\r\n\r\n/**\r\n * @param {Element} element element to hide\r\n */\r\nexport const showElement = (element) => {\r\n\tif (element) {\r\n\t\telement.classList.remove('dpit-hidden', 'dpit-hidden--no-space', 'dpit-hidden--by-disp', 'dpit-hidden-keep-events');\r\n\t}\r\n};","import DpitMultiStateBtn from './DpitMultiStateBtn';\r\nimport BulletsAnimation from '../../../../includes/assets/js/modules/BulletsAnimation';\r\n\r\nexport default class DpitMultiStateAnimBtn extends DpitMultiStateBtn {\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @param {Function} onClickCB\r\n\t * @param {object} statesOptions \r\n\t * {'default': { content: 'Default state label', isActive: true },\r\n\t * \t'success': { content: 'Success message', isActive: true },\r\n\t * \t'error': { content: 'Error message', isActive: true }}\r\n\t * @param {string} initState\r\n\t * @param {string} bemRootClass\r\n\t * @param {Array|string} additionalClasses\r\n\t * @param {string} id\r\n\t * @param {string} htmlTag\r\n\t */\r\n\tconstructor(onClickCB, statesOptions = {}, initState = 'default', bemRootClass = 'dpit-admin-btn', additionalClasses = [], inactive = false, id = '', htmlTag = 'div') {\r\n\t\tsuper(onClickCB, statesOptions, initState, bemRootClass, additionalClasses, inactive, id, htmlTag);\r\n\t\t// Animation\r\n\t\tthis.bulletsAnimation = new BulletsAnimation(this.element, bemRootClass + '__anim', 90, 12, 5, 3);\r\n\t}\r\n\r\n\tstartAnimation(backward = false, loops = -1, loopsPassedCb = null) {\r\n\t\tthis.isAnimated = true;\r\n\t\tthis.bulletsAnimation.start(backward, loops, () => this.onAnimationEnded(loopsPassedCb));\r\n\t\tthis.element.style.setProperty('pointer-events', 'none');\r\n\t\tthis.element.style.setProperty('cursor', 'default');\r\n\t\tthis.addStateClass('anim');\r\n\t}\r\n\r\n\tstopAnimation() {\r\n\t\tthis.bulletsAnimation.stop();\r\n\t\tthis.element.style.removeProperty('pointer-events');\r\n\t\tthis.element.style.removeProperty('cursor');\r\n\t\tthis.removeStateClass('anim');\r\n\t\tthis.isAnimated = false;\r\n\t}\r\n\r\n\tonAnimationEnded(loopsPassedCb = null) {\r\n\t\tthis.stopAnimation();\r\n\t\tif (loopsPassedCb) loopsPassedCb();\r\n\t}\r\n\r\n\thideStateItems() {\r\n\t\tthis.stateKeys.forEach(state => {\r\n\t\t\tconst stateEl = this.stateOptions[state].element;\r\n\t\t\tif (stateEl) {\r\n\t\t\t\tstateEl.style.opacity = 0;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tshowStateItems() {\r\n\t\tthis.stateKeys.forEach(state => {\r\n\t\t\tconst stateEl = this.stateOptions[state].element;\r\n\t\t\tif (stateEl) {\r\n\t\t\t\tstateEl.style.opacity = '';\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import classNames from 'classnames';\r\n\r\n\r\n\r\nexport default class DpitMultiStateBtn {\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @param {Function} onClickCB\r\n\t * @param {object} statesOptions \r\n\t * { 'default': 'Default state label', 'success': 'Success message', 'error':'Error message' }\r\n\t * @param {string} initState\r\n\t * @param {string} bemRootClass\r\n\t * @param {Array|string} additionalClasses\r\n\t * @param {string} id\r\n\t * @param {string} htmlTag\r\n\t */\r\n\tconstructor(onClickCB, statesOptions = {}, initState = 'default', bemRootClass = 'dpit-btn', additionalClasses = [], inactive = false, id = '', htmlTag = 'div') {\r\n\t\tthis.element = document.createElement(htmlTag);\r\n\t\tif (id) this.element.id = id;\r\n\t\tthis.element.setAttribute('role', 'button');\r\n\t\tif (typeof additionalClasses === 'string') this.element.className = classNames([bemRootClass, additionalClasses]);\r\n\t\telse this.element.className = classNames([bemRootClass, [...additionalClasses]]);\r\n\r\n\t\tthis.element.addEventListener('click', this.onClickHandler);\r\n\t\tthis.btnBemClass = bemRootClass;\r\n\t\tthis.initStates(statesOptions, bemRootClass);\r\n\t\tthis.setOnlyState(initState);\r\n\t\tthis.onClickCB = onClickCB;\r\n\t\tif (inactive) this.deactivate();\r\n\t}\r\n\r\n\tactivate() {\r\n\t\tthis.removeStateClass('inactive');\r\n\t}\r\n\r\n\tdeactivate() {\r\n\t\tthis.addStateClass('inactive');\r\n\t}\r\n\r\n\r\n\trenderContent(stateEl, stateContent) {\r\n\t\tif (stateContent !== null && stateContent !== undefined) {\r\n\t\t\tif (stateContent instanceof HTMLElement) { stateEl.appendChild(stateContent); return true; }\r\n\t\t\telse if (typeof stateContent === 'string') { stateEl.innerHTML = stateContent; return true; }\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tinitStates(statesOptions, btnBemClass) {\r\n\t\tthis.stateOptions = {};\r\n\t\tthis.stateKeys = Object.keys(statesOptions);\r\n\t\tthis.stateKeys.forEach(state => {\r\n\t\t\tconst stateEl = document.createElement('div');\r\n\t\t\tconst contentBemClassBase = btnBemClass + '__content';\r\n\t\t\tstateEl.classList.add(contentBemClassBase);\r\n\t\t\tstateEl.classList.add(contentBemClassBase + '--' + state);\r\n\r\n\t\t\tconst stateOption = statesOptions[state];\r\n\t\t\tif (stateOption) {\r\n\r\n\t\t\t\tlet stateContent = null;\r\n\t\t\t\tlet newStateOption = null;\r\n\t\t\t\tif (typeof stateOption === 'object') {\r\n\t\t\t\t\tstateContent = stateOption.content;\r\n\t\t\t\t\tnewStateOption = { ...stateOption, element: stateEl };\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tstateContent = stateOption;\r\n\t\t\t\t\tnewStateOption = { content: stateOption, element: stateEl };\r\n\t\t\t\t}\r\n\t\t\t\tif (this.renderContent(stateEl, stateContent)) {\r\n\r\n\t\t\t\t\tthis.element.appendChild(stateEl);\r\n\t\t\t\t\tthis.stateOptions[state] = newStateOption;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetButtonElement() {\r\n\t\treturn this.element;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.element?.removeEventListener('click', this.onClickHandler);\r\n\t}\r\n\r\n\tdeactivateAll() {\r\n\t\tthis.setOnlyState();\r\n\t}\r\n\r\n\r\n\tclearActiveClasses(state) {\r\n\t\tif (state) {\r\n\t\t\tconst stateOption = this.stateOptions[state];\r\n\t\t\tthis.removeStateClass(stateOption.activeMod);\r\n\t\t\tif (stateOption?.activeClass) this.element.classList.remove(stateOption.activeClass);\r\n\t\t}\r\n\t}\r\n\r\n\tsetActiveClasses(state) {\r\n\t\tconst stateOption = this.stateOptions[state];\r\n\t\tif (stateOption) {\r\n\t\t\tthis.addStateClass(stateOption.activeMod);\r\n\t\t\tif (stateOption?.activeClass) this.element.classList.add(stateOption.activeClass);\r\n\t\t}\r\n\t}\r\n\r\n\tremoveStateClass(state) {\r\n\t\tif (state) this.element.classList.remove(this.btnBemClass + '--' + state);\r\n\t}\r\n\r\n\taddStateClass(state) {\r\n\t\tif (state) this.element.classList.add(this.btnBemClass + '--' + state);\r\n\t}\r\n\r\n\tsetOnlyStateTemporarily(state, followingState = '', timeout = 3000) {\r\n\t\tfollowingState = followingState ? followingState : this.currentState;\r\n\t\tthis.setOnlyState(state);\r\n\t\tif (followingState) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.setOnlyState(followingState);\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t}\r\n\r\n\tsetOnlyState(state = '') {  // '' => deactivate\r\n\t\tthis.removeStateClass(this.currentState);\r\n\t\tthis.clearActiveClasses(this.currentState);\r\n\t\tthis.stateKeys.forEach(key => {\r\n\t\t\tif (this.stateOptions[key]?.element) {\r\n\t\t\t\tif (state === key) {\r\n\t\t\t\t\tthis.addStateClass(key);\r\n\t\t\t\t\tthis.setActiveClasses(key);\r\n\t\t\t\t}\r\n\t\t\t\tthis.stateOptions[key].element.style.display = state === key ? '' : 'none';\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.currentState = state;\r\n\t}\r\n\r\n\tonClickHandler = (event) => {\r\n\t\tif (this.bulletsAnimation.isRunning) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse if (this.onClickCB instanceof Function) {\r\n\t\t\tthis.onClickCB({ state: this.currentState, button: this });\r\n\t\t}\r\n\t};\r\n\r\n}","\r\n/**\r\n * DpitHooks object\r\n *\r\n * This object needs to be declared early so that it can be used in code.\r\n * Preferably at a global scope.\r\n */\r\nif (!window.DpitHooks) window.DpitHooks = {};\r\n//DpitHooks = window.DpitHooks || {}; // Extend Hooks if exists or create new Hooks object.\r\nDpitHooks.actions = DpitHooks.actions || {}; // Registered actions\r\nDpitHooks.filters = DpitHooks.filters || {}; // Registered filters\r\n\r\n\r\nDpitHooks.init = function (dpDebugEn) {\r\n\tDpitHooks.dpDebugEn = dpDebugEn;\r\n\tif (dpDebugEn) console.log('[dpit] INIT DpitHooks');\r\n};\r\n/**\r\n  * Add a new Action callback to DpitHooks.actions\r\n  *\r\n  * @param tag The tag specified by doAction()\r\n  * @param callback The callback function to call when do_action() is called\r\n  * @param priority The order in which to call the callbacks. Default: 10 (like WordPress)\r\n  */\r\nDpitHooks.addAction = function (tag, callback, priority) {\r\n\tif (typeof priority === 'undefined') {\r\n\t\tpriority = 10;\r\n\t}\r\n\r\n\t// If the tag doesn't exist, create it.\r\n\tDpitHooks.actions[tag] = DpitHooks.actions[tag] || [];\r\n\tDpitHooks.actions[tag].push({ priority, callback });\r\n};\r\n\r\n/**\r\n  * Add a new Filter callback to DpitHooks.filters\r\n  *\r\n  * @param tag The tag specified by applyFilters()\r\n  * @param callback The callback function to call when apply_filters() is called\r\n  * @param priority Priority of filter to apply. Default: 10 (like WordPress)\r\n  */\r\nDpitHooks.addFilter = function (tag, callback, priority) {\r\n\tif (typeof priority === 'undefined') {\r\n\t\tpriority = 10;\r\n\t}\r\n\r\n\t// If the tag doesn't exist, create it.\r\n\tDpitHooks.filters[tag] = DpitHooks.filters[tag] || [];\r\n\tDpitHooks.filters[tag].push({ priority, callback });\r\n};\r\n\r\n/**\r\n  * Remove an Action callback from DpitHooks.actions\r\n  *\r\n  * Must be the exact same callback signature.\r\n  * Warning: Anonymous functions can not be removed.\r\n  * @param tag The tag specified by doAction()\r\n  * @param callback The callback function to remove\r\n  */\r\nDpitHooks.removeAction = function (tag, callback) {\r\n\tDpitHooks.actions[tag] = DpitHooks.actions[tag] || [];\r\n\r\n\tDpitHooks.actions[tag].forEach((filter, i) => {\r\n\t\tif (filter.callback === callback) {\r\n\t\t\tDpitHooks.actions[tag].splice(i, 1);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/**\r\n  * Remove a Filter callback from DpitHooks.filters\r\n  *\r\n  * Must be the exact same callback signature.\r\n  * Warning: Anonymous functions can not be removed.\r\n  * @param tag The tag specified by applyFilters()\r\n  * @param callback The callback function to remove\r\n  */\r\nDpitHooks.removeFilter = function (tag, callback) {\r\n\tDpitHooks.filters[tag] = DpitHooks.filters[tag] || [];\r\n\r\n\tDpitHooks.filters[tag].forEach((filter, i) => {\r\n\t\tif (filter.callback === callback) {\r\n\t\t\tDpitHooks.filters[tag].splice(i, 1);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/**\r\n  * Calls actions that are stored in DpitHooks.actions for a specific tag or nothing\r\n  * if there are no actions to call.\r\n  *\r\n  * @param tag A registered tag in DpitHooks.actions\r\n  * @param args Optional JavaScript object to pass to the callbacks\r\n  */\r\nDpitHooks.doAction = function (tag, args) {\r\n\tconst actions = [];\r\n\tif (DpitHooks.dpDebugEn) console.log('[dpit] API Action > Tag:', tag, ', Subscribed:', DpitHooks.actions[tag] ? DpitHooks.actions[tag].length : 0, ', Args:', args);\r\n\tif (typeof DpitHooks.actions[tag] !== 'undefined' && DpitHooks.actions[tag].length > 0) {\r\n\t\tDpitHooks.actions[tag].forEach((hook) => {\r\n\t\t\tactions[hook.priority] = actions[hook.priority] || [];\r\n\t\t\tactions[hook.priority].push(hook.callback);\r\n\t\t});\r\n\r\n\t\tactions.forEach((hooks) => {\r\n\t\t\thooks.forEach((callback) => {\r\n\r\n\t\t\t\tcallback(args);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n  * Calls filters that are stored in DpitHooks.filters for a specific tag or return\r\n  * original value if no filters exist.\r\n  *\r\n  * @param tag A registered tag in DpitHooks.filters\r\n  * @param args Optional JavaScript object to pass to the callbacks\r\n  */\r\nDpitHooks.applyFilters = function (tag, value, args) {\r\n\tconst filters = [];\r\n\tlet res = value;\r\n\tif (DpitHooks.dpDebugEn) console.log('[dpit] API Filter > Tag:', tag, ', Subscribed count:', DpitHooks.filters[tag] ? DpitHooks.filters[tag].length : 0, ', Args:', args);\r\n\tif (typeof DpitHooks.filters[tag] !== 'undefined' && DpitHooks.filters[tag].length > 0) {\r\n\t\tDpitHooks.filters[tag].forEach((hook) => {\r\n\t\t\tfilters[hook.priority] = filters[hook.priority] || [];\r\n\t\t\tfilters[hook.priority].push(hook.callback);\r\n\t\t});\r\n\r\n\t\tfilters.forEach((hooks) => {\r\n\t\t\thooks.forEach((callback) => {\r\n\t\t\t\tres = callback(res, args);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn res;\r\n};\r\n\r\nexport default DpitHooks;\r\n","/*!\n\tautosize 4.0.4\n\tlicense: MIT\n\thttp://www.jacklmoore.com/autosize\n*/(function(global,factory){if(typeof define===\"function\"&&define.amd){define(['module','exports'],factory);}else if(typeof exports!==\"undefined\"){factory(module,exports);}else{var mod={exports:{}};factory(mod,mod.exports);global.autosize=mod.exports;}})(this,function(module,exports){'use strict';var map=typeof Map===\"function\"?new Map():function(){var keys=[];var values=[];return{has:function has(key){return keys.indexOf(key)>-1;},get:function get(key){return values[keys.indexOf(key)];},set:function set(key,value){if(keys.indexOf(key)===-1){keys.push(key);values.push(value);}},delete:function _delete(key){var index=keys.indexOf(key);if(index>-1){keys.splice(index,1);values.splice(index,1);}}};}();var createEvent=function createEvent(name){return new Event(name,{bubbles:true});};try{new Event('test');}catch(e){// IE does not support `new Event()`\ncreateEvent=function createEvent(name){var evt=document.createEvent('Event');evt.initEvent(name,true,false);return evt;};}function assign(ta){if(!ta||!ta.nodeName||ta.nodeName!=='TEXTAREA'||map.has(ta))return;var heightOffset=null;var clientWidth=null;var cachedHeight=null;function init(){var style=window.getComputedStyle(ta,null);if(style.resize==='vertical'){ta.style.resize='none';}else if(style.resize==='both'){ta.style.resize='horizontal';}if(style.boxSizing==='content-box'){heightOffset=-(parseFloat(style.paddingTop)+parseFloat(style.paddingBottom));}else{heightOffset=parseFloat(style.borderTopWidth)+parseFloat(style.borderBottomWidth);}// Fix when a textarea is not on document body and heightOffset is Not a Number\nif(isNaN(heightOffset)){heightOffset=0;}update();}function changeOverflow(value){{// Chrome/Safari-specific fix:\n// When the textarea y-overflow is hidden, Chrome/Safari do not reflow the text to account for the space\n// made available by removing the scrollbar. The following forces the necessary text reflow.\nvar width=ta.style.width;ta.style.width='0px';// Force reflow:\n/* jshint ignore:start */ta.offsetWidth;/* jshint ignore:end */ta.style.width=width;}ta.style.overflowY=value;}function getParentOverflows(el){var arr=[];while(el&&el.parentNode&&el.parentNode instanceof Element){if(el.parentNode.scrollTop){arr.push({node:el.parentNode,scrollTop:el.parentNode.scrollTop});}el=el.parentNode;}return arr;}function resize(){if(ta.scrollHeight===0){// If the scrollHeight is 0, then the element probably has display:none or is detached from the DOM.\nreturn;}var overflows=getParentOverflows(ta);var docTop=document.documentElement&&document.documentElement.scrollTop;// Needed for Mobile IE (ticket #240)\nta.style.height='';ta.style.height=ta.scrollHeight+heightOffset+'px';// used to check if an update is actually necessary on window.resize\nclientWidth=ta.clientWidth;// prevents scroll-position jumping\noverflows.forEach(function(el){el.node.scrollTop=el.scrollTop;});if(docTop){document.documentElement.scrollTop=docTop;}}function update(){resize();var styleHeight=Math.round(parseFloat(ta.style.height));var computed=window.getComputedStyle(ta,null);// Using offsetHeight as a replacement for computed.height in IE, because IE does not account use of border-box\nvar actualHeight=computed.boxSizing==='content-box'?Math.round(parseFloat(computed.height)):ta.offsetHeight;// The actual height not matching the style height (set via the resize method) indicates that \n// the max-height has been exceeded, in which case the overflow should be allowed.\nif(actualHeight<styleHeight){if(computed.overflowY==='hidden'){changeOverflow('scroll');resize();actualHeight=computed.boxSizing==='content-box'?Math.round(parseFloat(window.getComputedStyle(ta,null).height)):ta.offsetHeight;}}else{// Normally keep overflow set to hidden, to avoid flash of scrollbar as the textarea expands.\nif(computed.overflowY!=='hidden'){changeOverflow('hidden');resize();actualHeight=computed.boxSizing==='content-box'?Math.round(parseFloat(window.getComputedStyle(ta,null).height)):ta.offsetHeight;}}if(cachedHeight!==actualHeight){cachedHeight=actualHeight;var evt=createEvent('autosize:resized');try{ta.dispatchEvent(evt);}catch(err){// Firefox will throw an error on dispatchEvent for a detached element\n// https://bugzilla.mozilla.org/show_bug.cgi?id=889376\n}}}var pageResize=function pageResize(){if(ta.clientWidth!==clientWidth){update();}};var destroy=function(style){window.removeEventListener('resize',pageResize,false);ta.removeEventListener('input',update,false);ta.removeEventListener('keyup',update,false);ta.removeEventListener('autosize:destroy',destroy,false);ta.removeEventListener('autosize:update',update,false);Object.keys(style).forEach(function(key){ta.style[key]=style[key];});map.delete(ta);}.bind(ta,{height:ta.style.height,resize:ta.style.resize,overflowY:ta.style.overflowY,overflowX:ta.style.overflowX,wordWrap:ta.style.wordWrap});ta.addEventListener('autosize:destroy',destroy,false);// IE9 does not fire onpropertychange or oninput for deletions,\n// so binding to onkeyup to catch most of those events.\n// There is no way that I know of to detect something like 'cut' in IE9.\nif('onpropertychange'in ta&&'oninput'in ta){ta.addEventListener('keyup',update,false);}window.addEventListener('resize',pageResize,false);ta.addEventListener('input',update,false);ta.addEventListener('autosize:update',update,false);ta.style.overflowX='hidden';ta.style.wordWrap='break-word';map.set(ta,{destroy:destroy,update:update});init();}function destroy(ta){var methods=map.get(ta);if(methods){methods.destroy();}}function update(ta){var methods=map.get(ta);if(methods){methods.update();}}var autosize=null;// Do nothing in Node.js environment and IE8 (or lower)\nif(typeof window==='undefined'||typeof window.getComputedStyle!=='function'){autosize=function autosize(el){return el;};autosize.destroy=function(el){return el;};autosize.update=function(el){return el;};}else{autosize=function autosize(el,options){if(el){Array.prototype.forEach.call(el.length?el:[el],function(x){return assign(x,options);});}return el;};autosize.destroy=function(el){if(el){Array.prototype.forEach.call(el.length?el:[el],destroy);}return el;};autosize.update=function(el){if(el){Array.prototype.forEach.call(el.length?el:[el],update);}return el;};}exports.default=autosize;module.exports=exports['default'];});","\r\nimport tippy from 'tippy.js';\r\nimport urlJoin from 'url-join';\r\nimport 'tippy.js/dist/tippy.css';\r\nimport 'tippy.js/themes/material.css';\r\nimport 'tippy.js/themes/light-border.css';\r\nimport 'tippy.js/animations/scale.css';\r\nimport { getInfoIconHtml } from '../../../../includes/assets/js/modules/dpitUtilsInc';\r\n\r\nexport default class AcfTippy {\r\n\r\n\tconstructor(config, onInitialized = null) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT AcfTippy');\r\n\t\tthis.onInitializedCb = onInitialized;\r\n\t\tthis.init(config);\r\n\t}\r\n\r\n\tinit = (config) => {\r\n\r\n\t\t$('#post-body-content .acf-field:not(.acf-field-group):not(.acf-field--no-info-icon) .acf-label').each((idx, element) => {\r\n\t\t\tconst jDescElement = $(element).find('.description');\r\n\t\t\tconst jAcfField = $(element).closest('.acf-field');\r\n\t\t\tconst jMsgElement = jAcfField.find('span.message');\r\n\t\t\tlet descText = jDescElement.html();\r\n\t\t\tlet text = jMsgElement.html() || '';\r\n\t\t\tif (text && descText) text += '<br>';\r\n\t\t\ttext += jDescElement.html() || '';\r\n\t\t\tif (text.length) {\r\n\t\t\t\tconst iconClass = jAcfField.hasClass('acf-field--ia') ? 'dpit-info-icon dpit-info-icon--ia' : 'dpit-info-icon';\r\n\t\t\t\t$(element).addClass('acf-label--with-info-icon').append(getInfoIconHtml(iconClass, text, $(element).children('label').text()));\r\n\t\t\t\tjDescElement.add(jMsgElement).hide();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (config.stepDefinitions) {\r\n\r\n\t\t\tObject.keys(config.stepDefinitions).forEach((key) => {\r\n\t\t\t\tconst data = config.stepDefinitions[key];\r\n\t\t\t\tif (data.hint) {\r\n\t\t\t\t\t$('#acf-t-header-' + key).addClass('acf-table-header-cell--with-info-icon').append(getInfoIconHtml('dpit-info-icon dpit-info-icon--in-table-header', data.hint, data.title.replace(/(<([^>]+)>)/gi, '')));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t//\ttheme: \r\n\t\t$('.dpit-info-icon').each((idx, element) => {\r\n\t\t\tconst interactive = $(element).hasClass('dpit-info-icon--ia');\r\n\t\t\tconst theme = $(element).hasClass('dpit-info-icon--modal') ? 'light-border' : 'material';\r\n\t\t\ttippy(element, {\r\n\t\t\t\tcontent: (reference) => reference.getAttribute('data-info-text'),\r\n\t\t\t\tanimation: 'scale',\r\n\t\t\t\ttheme: theme,\r\n\t\t\t\tallowHTML: true,\r\n\t\t\t\tinteractive: interactive,\r\n\t\t\t\tzIndex: 100000003\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tdocument.getElementById(config.acfRootElId)?.classList.add('dpit-acf-tippy');\r\n\r\n\t\t\tconst firstInfoIcon = document.querySelector('.dpit-info-icon');\r\n\t\t\tif (firstInfoIcon) {\r\n\t\t\t\t$(firstInfoIcon).load(\r\n\t\t\t\t\turlJoin(config.assetsUrl, '../../includes/assets/icons/info-circle-solid.svg'),\r\n\t\t\t\t\t() => this.onInfoIconLoaded(firstInfoIcon)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}, 300);\r\n\t};\r\n\r\n\treloadInfoIcons() {\r\n\t\tconst firstFilledInfoIconEl = document.querySelector('.dpit-info-icon--loaded');\r\n\t\tif (firstFilledInfoIconEl) {\r\n\t\t\tconst $allNotLoadedIconsEls = $('.dpit-info-icon:not(.dpit-info-icon--loaded)');\r\n\t\t\t$allNotLoadedIconsEls.html(firstFilledInfoIconEl.innerHTML);\r\n\t\t}\r\n\t}\r\n\r\n\tonInfoIconLoaded = (firstInfoIcon) => {\r\n\t\tconst $allIconsEls = $('.dpit-info-icon');\r\n\t\t$allIconsEls.html(firstInfoIcon.innerHTML);\r\n\t\t$allIconsEls.addClass('dpit-info-icon--loaded');\r\n\t\t$allIconsEls.show();\r\n\t\tif (this.onInitializedCb instanceof Function) this.onInitializedCb();\r\n\t};\r\n}","import classNames from 'classnames';\r\nimport { getInfoIconHtml } from '../../../../includes/assets/js/modules/dpitUtilsInc';\r\n\r\nexport default class AcfTableHtmlComps {\r\n\tclasses = {\r\n\t\tbtn_small: 'acf-icon acf-icon--s',\r\n\t\tbtn_very_small: 'acf-icon acf-icon--xs',\r\n\t\tbtn_very_very_small: 'acf-icon acf-icon--xxs',\r\n\t\tbtn_add_row: 'acf-icon-plus -plus',\r\n\t\tbtn_remove_row: 'acf-icon-minus -minus',\r\n\t};\r\n\thtmleditor = (\r\n\t\t'<div class=\"acf-table-cell-editor\">'\r\n\t\t+ '<textarea name=\"acf-table-cell-editor-textarea\" class=\"acf-table-cell-editor-textarea\"></textarea>'\r\n\t\t+ '</div>');\r\n\r\n\tconstructor(config) {\r\n\t\tthis.config = config;\r\n\t\tthis.htmlButtons = {\r\n\t\t\tadd_row: `<a href=\"#\" class=\"acf-table-add-row no-drag ${this.classes.btn_small} ${this.classes.btn_add_row}\"></a>`,\r\n\t\t\tremove_row: `<a href=\"#\" class=\"acf-table-remove-row ${this.classes.btn_small} ${this.classes.btn_remove_row}\"></a>`,\r\n\t\t\tadd_link: `<a href=\"#\" class=\"acf-table-add-link no-drag ${this.classes.btn_small} ${this.classes.btn_add_row}\"></a>`,\r\n\t\t\tremove_link: `<a href=\"#\" class=\"acf-table-remove-link no-drag ${this.classes.btn_very_very_small} ${this.classes.btn_remove_row}\"></a>`,\r\n\t\t};\r\n\r\n\t\tthis.body_row = `${'<div class=\"acf-table-body-row\">'\r\n\t\t\t+ '<div class=\"acf-table-body-left\">'}${this.htmlButtons.add_row}<div class=\"acf-table-body-left-wrap\">`\r\n\t\t\t+ '<div class=\"acf-table-body-cont\"><!--ph--></div>'\r\n\t\t\t+ '<div class=\"acf-table-sort-row-icon\"></div>'\r\n\t\t\t+ '</div>'\r\n\t\t\t+ '</div>'\r\n\t\t\t+ `<div class=\"acf-table-body-right\">${this.htmlButtons.remove_row\r\n\t\t\t}</div>`\r\n\t\t\t+ '</div>';\r\n\r\n\t\tthis.top_cell = '<div class=\"acf-table-top-cell\" data-colparam=\"\"><div class=\"acf-table-top-cont\"><!--ph--></div>'\r\n\t\t\t+ '</div>';\r\n\r\n\r\n\r\n\t\tthis.table = `<div class=\"acf-table-wrap${!$.isEmptyObject(config.text_styles) ? ' acf-table-wrap--cs dpit-scrollbar' : ''}\">`\r\n\t\t\t+ '<div class=\"acf-table-table\">'\r\n\t\t\t+ '<div class=\"acf-table-top-row\">'\r\n\t\t\t+ '<div class=\"acf-table-top-left\"></div>'\r\n\t\t\t+ '<div class=\"acf-table-top-right\"></div>'\r\n\t\t\t+ '</div>'\r\n\t\t\t+ '<div class=\"acf-table-header-row acf-table-header-hide-off\">'\r\n\t\t\t+ '<div class=\"acf-table-header-left\">' + this.htmlButtons.add_row + '</div>'\r\n\t\t\t+ '<div class=\"acf-table-header-right\"></div>'\r\n\t\t\t+ '</div>'\r\n\t\t\t+ '<div class=\"acf-table-bottom-row\">'\r\n\t\t\t+ '<div class=\"acf-table-bottom-left\"></div>'\r\n\t\t\t+ '<div class=\"acf-table-bottom-right\"></div>'\r\n\t\t\t+ '</div>'\r\n\t\t\t+ '</div>'\r\n\t\t\t+ '</div>';\r\n\r\n\t}\r\n\r\n\theader_cell(label, extraClass, value) {\r\n\t\tconst classes = ['acf-table-header-cell'];\r\n\t\tif (extraClass) classes.push(extraClass);\r\n\t\treturn (\r\n\t\t\t`<div class=\"${classes.join(' ')}\"${value ? ` id=\"acf-t-header-${value}\"` : ''}>\r\n\t\t\t\t<div class=\"acf-table-header-cont\" data-val=\"${value}\">${label}</div>\r\n\t\t\t</div>`\r\n\t\t);\r\n\t}\r\n\r\n\tbody_cell(value = '', extraClass = null, extraSettings = null, id = null, title = '') {\r\n\t\tlet extraSettingsHtml = this.extra_data(extraSettings, true);\r\n\t\tconst idAttrStr = id ? ' id=\"' + id + '\"' : '';\r\n\t\tconst classes = ['acf-table-body-cell'];\r\n\t\tif (extraClass) classes.push(extraClass);\r\n\t\treturn `<div${idAttrStr} class=\"${classNames(classes)}\" title=\"${title}\">`\r\n\t\t\t+ `<div class=\"acf-table-body-cont\">${value}${extraSettingsHtml}</div>`\r\n\t\t\t+ '</div>';\r\n\t}\r\n\r\n\tbody_cell_link(value = '', extraClass = null, extraSettings = null, row = 0, title = '') {\r\n\t\tlet firstLinkClass = null;\r\n\t\tlet id = '';\r\n\t\tif (row === 0) {\r\n\r\n\t\t\tfirstLinkClass = 'acf-table-body-cell--link-multi';\r\n\t\t\tid = 'dpit-admin-first-step-link-cell';\r\n\t\t\tconst items = value.split(',').filter(i => i);\r\n\r\n\t\t\tvalue = '<div class=\"acf-table-body-cell__title\">';\r\n\t\t\tvalue += this.config.i18n.tour_starts_at;\r\n\t\t\tvalue += '</div>';\r\n\t\t\tvalue += '<ul>';\r\n\t\t\tif (items && items.length) {\r\n\t\t\t\titems.forEach(item => {\r\n\t\t\t\t\tvalue += this.body_cell_link_sub_item(item);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tvalue += '</ul>';\r\n\t\t\tvalue += this.htmlButtons.add_link;\r\n\t\t\tvalue += '<div id=\"dpit-admin-step-link-cell-everywhere\">';\r\n\t\t\tvalue += this.config.i18n.EVERYWHERE;\r\n\t\t\tvalue += '</div>';\r\n\t\t}\r\n\t\tif (extraClass) extraClass += ' ';\r\n\t\treturn this.body_cell(value, classNames([extraClass, firstLinkClass]), extraSettings, id, title);\r\n\t}\r\n\r\n\tbody_cell_link_sub_item(value = '') {\r\n\t\treturn `<li class=\"acf-table-body-cont-li\"><span>${value}</span>${this.htmlButtons.remove_link}</li>`;\r\n\t}\r\n\r\n\tbody_cell_checkbox(checked = false, extraClass = null, extraSettings = null, title) {\r\n\t\tlet extraSettingsHtml = this.extra_data(extraSettings, checked);\r\n\r\n\t\tconst classes = ['acf-table-body-cell'];\r\n\t\tif (extraClass) classes.push(extraClass);\r\n\t\tconst checkedAttr = checked ? ' checked' : '';\r\n\t\treturn `<div class=\"${classes.join(' ')}\" title=\"${title}\">`\r\n\t\t\t+ '<div class=\"acf-table-body-cont acf-table-body-cont--checkbox\">'\r\n\t\t\t+ `<input type=\"checkbox\" class=\"acf-table-body-cont-sub\"${checkedAttr}>`\r\n\t\t\t+ extraSettingsHtml\r\n\t\t\t+ '</div>'\r\n\t\t\t+ '</div>';\r\n\t}\r\n\r\n\tbody_cell_select(options, value, extraClass, /*extraSettings = null, */title = '') {\r\n\t\tconst classes = ['acf-table-body-cont-sub'];\r\n\t\tif (extraClass) classes.push(extraClass);\r\n\t\treturn `<div class=\"acf-table-body-cell\" title=\"${title}\">`\r\n\t\t\t+ '<div class=\"acf-table-body-cont acf-table-body-cont--select\">'\r\n\t\t\t+ `<select class=\"${classes.join(' ')}\">`\r\n\t\t\t+ options.map((optionCfg) => {\r\n\t\t\t\tconst valLabel = optionCfg.split(':');\r\n\t\t\t\tconst val = valLabel[0];\r\n\t\t\t\tconst label = valLabel.length > 1 ? valLabel[1] : valLabel[0];\r\n\t\t\t\tconst selected = (val == value) ? ' selected=\"selected\"' : '';\r\n\t\t\t\treturn `<option value=\"${val}\"${selected}>${label}</option>`;\r\n\t\t\t}).join('')\r\n\t\t\t+ '</select>'\r\n\t\t\t//+ this.extra_data(extraSettings, checked);\r\n\t\t\t+ '</div>'\r\n\t\t\t+ '</div>';\r\n\t}\r\n\r\n\textra_data(extraSettings, visible) {\r\n\t\tlet extraSettingsHtml = '';\r\n\t\tif (extraSettings && !jQuery.isEmptyObject(extraSettings)) {\r\n\t\t\tconst esWrapperClass = classNames({\r\n\t\t\t\t['acf-table-cell-ec']: true,\r\n\t\t\t\t['acf-table-cell-ec--hidden']: !visible\r\n\t\t\t});\r\n\t\t\textraSettingsHtml += `<div class=\"${esWrapperClass}\">`;\r\n\t\t\tObject.keys(extraSettings).forEach(id => {\r\n\t\t\t\tconst item = extraSettings[id];\r\n\r\n\t\t\t\tif (item.title) extraSettingsHtml += `<div class=\"acf-cell-eci-wrap\" data-id=\"${id}\">`;\r\n\t\t\t\tswitch (item.type) {\r\n\t\t\t\t\tcase 'checkbox': extraSettingsHtml += `<input type=\"checkbox\" class=\"acf-table-body-cont-sub\"${item.val == 1 ? ' checked' : ''}>`; break;\r\n\t\t\t\t\tcase 'number':\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst minAttr = item.min !== undefined && item.min !== null ? ` min=\"${item.min}\"` : '';\r\n\t\t\t\t\t\t\tconst maxAttr = item.max !== undefined && item.max !== null ? ` max=\"${item.max}\"` : '';\r\n\t\t\t\t\t\t\tconst stepAttr = item.step !== undefined && item.step !== null ? ` step=\"${item.step}\"` : '';\r\n\t\t\t\t\t\t\textraSettingsHtml += `<input type=\"number\"${minAttr}${maxAttr}${stepAttr} class=\"acf-table-body-cont-sub\" value=\"${item.val ?? item.def}\">`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault: extraSettingsHtml += `<input type=\"text\" class=\"acf-table-body-cont-sub\" value=\"${item.val ?? item.def}\">`; break;\r\n\t\t\t\t}\r\n\t\t\t\tif (item.title) extraSettingsHtml += `<span>${item.title}</span>`;\r\n\t\t\t\tif (item.hint || item.title) extraSettingsHtml += getInfoIconHtml('dpit-info-icon dpit-info-icon--modal dpit-info-icon--interaction', item.hint, item.title, false);\r\n\t\t\t\textraSettingsHtml += '</div>';\r\n\t\t\t});\r\n\t\t\textraSettingsHtml += '</div>';\r\n\t\t}\r\n\t\treturn extraSettingsHtml;\r\n\t}\r\n\r\n}","export default class ContainerDragger {\r\n\tconstructor(containerElement, handlerSelector, excludedSelectors = [], minDragPositionChangePx = 10) {\r\n\t\tthis.dragData = {\r\n\t\t\tx: null,\r\n\t\t\tleft: null,\r\n\t\t\ttarget: null,\r\n\t\t};\r\n\t\tthis.minDragPositionChangePx = minDragPositionChangePx;\r\n\t\tthis.excludedSelectors = excludedSelectors.join(',');\r\n\t\tthis.handlerSelector = handlerSelector;\r\n\r\n\t\tthis.containerEl = containerElement;\r\n\r\n\t\tthis.$containerEl = $(containerElement);\r\n\t\tthis.isContainerScrollable = this.isContainerScrollableFce();\r\n\r\n\t\tthis.$dragAndDropHandler = this.$containerEl.find(handlerSelector).not(this.excludedSelectors);\r\n\r\n\t\tthis.setDraggingInProcess(false);\r\n\r\n\t\tthis.$dragAndDropHandler.on('mousedown', this.onMouseDown.bind(this));\r\n\t\tdocument.addEventListener('mousemove', this.onMouseMove.bind(this));\r\n\t\tdocument.addEventListener('mouseup', this.onMouseUp.bind(this));\r\n\t\t$(window).on('resize', this.onContainerResize.bind(this));\r\n\r\n\t}\r\n\r\n\tsetDraggingInProcess(val) {\r\n\r\n\t\tthis.isDragging = this.isContainerScrollable ? val : false;\r\n\t\tthis.isDraggingConfirmed = false;\r\n\t\tthis.adjustCursor();\r\n\t}\r\n\r\n\trefresh() {\r\n\t\tthis.$dragAndDropHandler.off('mousedown', this.onMouseDown);\r\n\t\tthis.$dragAndDropHandler = this.$containerEl.find(this.handlerSelector).not(this.excludedSelectors);\r\n\t\tthis.setDraggingInProcess(false);\r\n\t\tthis.$dragAndDropHandler.on('mousedown', this.onMouseDown.bind(this));\r\n\t}\r\n\r\n\r\n\r\n\tadjustCursor() {\r\n\t\tif (this.dragData?.target) {\r\n\t\t\tif (this.isContainerScrollable && this.isDragging) {\r\n\t\t\t\tthis.dragData.target.style.cursor = 'grabbing';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.dragData.target.style.cursor = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonContainerResize() {\r\n\t\tthis.setDraggingInProcess(false);\r\n\t}\r\n\r\n\tisContainerScrollableFce() {\r\n\t\tconst containerWidth = this.$containerEl.width();\r\n\t\tconst paddingLeft = parseInt(window.getComputedStyle(this.containerEl)['padding-left'], 10);\r\n\t\tconst paddingRight = parseInt(window.getComputedStyle(this.containerEl)['padding-right'], 10);\r\n\t\tlet paddingX = 0;\r\n\t\tif (!isNaN(paddingLeft)) paddingX += paddingLeft;\r\n\t\tif (!isNaN(paddingRight)) paddingX += paddingRight;\r\n\t\treturn (this.containerEl.scrollWidth - paddingX - 1) > containerWidth;\r\n\t}\r\n\r\n\tisExcludedSelector(targetElement) {\r\n\t\treturn $(targetElement).is(this.excludedSelectors) || $(targetElement).closest(this.excludedSelectors).length > 0;\r\n\t}\r\n\r\n\tonMouseDown(e) {\r\n\r\n\t\tif (!this.isExcludedSelector(e.target)) {\r\n\t\t\tthis.dragData = {\r\n\t\t\t\tleft: this.containerEl.scrollLeft,\r\n\t\t\t\tx: e.clientX,\r\n\t\t\t\ttarget: e.target,\r\n\t\t\t};\r\n\t\t\tthis.setDraggingInProcess(true);\r\n\t\t\tif (this.onBlockClickTimeout) clearTimeout();\r\n\t\t\tthis.unblockClick();\r\n\t\t}\r\n\t\telse return true;\r\n\r\n\t}\r\n\r\n\r\n\tonMouseUp(e) {\r\n\t\tif (this.isDragging) {\r\n\t\t\tthis.setDraggingInProcess(false);\r\n\t\t\tconst dx = Math.abs(e.clientX - this.dragData.x);\r\n\t\t\tif (dx > this.minDragPositionChangePx) {\r\n\t\t\t\tthis.blockClick();\r\n\t\t\t\tif (this.onBlockClickTimeout) clearTimeout();\r\n\t\t\t\tthis.onBlockClickTimeout = setTimeout(() => {\r\n\t\t\t\t\tthis.unblockClick();\r\n\t\t\t\t}, 200);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.unblockClick();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.unblockClick();\r\n\t\t}\r\n\t}\r\n\r\n\tblockClick() {\r\n\t\tif (this.dragData) {\r\n\t\t\t$(this.dragData.target).on('mousedown', this.stopClickPropagation);\r\n\t\t\t$(this.dragData.target).on('click', this.stopClickPropagation);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tunblockClick() {\r\n\t\tif (this.dragData) {\r\n\r\n\t\t\t$(this.dragData?.target).off('mousedown', this.stopClickPropagation);\r\n\t\t\t$(this.dragData?.target).off('click', this.stopClickPropagation);\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseMove(e) {\r\n\t\tif (this.isDragging) {\r\n\t\t\tif (this.isExcludedSelector(e.target)) return;\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\t// How far the mouse has been moved\r\n\t\t\tconst dx = e.clientX - this.dragData.x;\r\n\t\t\t// Scroll the element\r\n\t\t\tthis.containerEl.scrollLeft = this.dragData.left - dx;\r\n\t\t\tif (dx > this.minDragPositionChangePx) {\r\n\r\n\t\t\t\tthis.blockClick();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tstopClickPropagation = (event) => {\r\n\t\tif (event) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\r\n\r\n}","import urlJoin from 'url-join';\r\nimport {\r\n\tsimpleObjectToStr,\r\n\tdecodeStepParamAdvancedVal,\r\n\tencodeStepParamAdvancedVal,\r\n\tsetTextStyles,\r\n\tstrToSimpleObject\r\n} from '../../../../includes/assets/js/modules/dpitUtilsInc';\r\nimport DpTinyMceDialog from '../../../../includes/assets/js/modules/DpTinyMceDialog';\r\n\r\nimport {\r\n\tisUrlVariableProcessingEnabled,\r\n} from './dp-admin-utils';\r\n\r\nimport DpWpLink from '../../../../includes/assets/js/modules/DpWpLink';\r\nimport AcfTableHtmlComps from './AcfTableHtmlComps';\r\nimport ContainerDragger from './ContainerDragger';\r\nimport { getWinBB } from '../../../../public/assets/js/modules/dpitUtilsPublic';\r\nconst autosize = require('autosize');\r\n\r\n\r\nexport default class AcfTableField {\r\n\tallowedColumnsIdx = [];\r\n\r\n\tconstructor(config, onFirstStepUrlChanged, onRowAdded) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT ACFTableField config:', config);\r\n\t\tthis.config = config;\r\n\t\tthis.jBody = $('body');\r\n\t\tthis.onFirstStepUrlChangedCb = onFirstStepUrlChanged;\r\n\t\tthis.onRowAdded = onRowAdded;\r\n\t\tthis.var = {\r\n\t\t\tajax: false,\r\n\t\t\tcolumIds: [],\r\n\t\t};\r\n\t\tthis.state = {\r\n\t\t\tcurrent_cell_obj: false,\r\n\t\t\tcell_editor_last_keycode: false\r\n\t\t};\r\n\r\n\t\tthis.version = config.version ? config.version : '1.4.0';\r\n\t\tif (config.dpWpLink) {\r\n\t\t\tthis.dpWpLink = new DpWpLink(config.dpWpLink);\r\n\t\t\tthis.dpWpLink.open(null, null, true);\r\n\t\t}\r\n\r\n\r\n\t\tthis.tableHtml = new AcfTableHtmlComps(this.config);\r\n\r\n\r\n\t\tthis.jBody.on('click blur', '.acf-table-body-cont--checkbox .acf-table-body-cont-sub', (e) => {\r\n\t\t\tconst that = $(e.target).closest('.acf-table-body-cont--checkbox .acf-table-body-cont-sub');\r\n\t\t\tthis.state.current_cell_obj = $(that.closest('.acf-table-body-cell')[0]) || false;\r\n\t\t\tif (!that.parent('.acf-cell-eci-wrap').length) {\r\n\t\t\t\tconst jExtraCont = this.state.current_cell_obj.find('.acf-table-cell-ec');\r\n\t\t\t\tif ($(that[0]).is(':checked')) jExtraCont.removeClass('acf-table-cell-ec--hidden');\r\n\t\t\t\telse jExtraCont.addClass('acf-table-cell-ec--hidden');\r\n\t\t\t}\r\n\t\t\tthis.rebuild_table_data(that);\r\n\t\t});\r\n\r\n\r\n\t\t$('body').on('click', '#dp_wp-link-submit', (e) => {\r\n\t\t\tif (this.state.current_cell_obj && this.dpWpLink) {\r\n\r\n\t\t\t\tconst activeLinkCell = this.state.current_cell_obj.find('.acf-table-body-cont')[0];\r\n\t\t\t\tif (activeLinkCell) {\r\n\t\t\t\t\tthis.triggerChangeEventOnAcfTableRoot(activeLinkCell);\r\n\t\t\t\t\tconst linkAttrs = this.dpWpLink.getAttrs();\r\n\t\t\t\t\tconst { href, jSubEl, isFirstStep } = linkAttrs;\r\n\t\t\t\t\tconst row = this.state.current_cell_obj.closest('.acf-table-body-row').find('.acf-table-body-left .acf-table-body-cont').text();\r\n\r\n\t\t\t\t\tif (jSubEl && jSubEl.length) jSubEl.text(href || '');\r\n\t\t\t\t\telse if (isFirstStep) {\r\n\t\t\t\t\t\tconst jUl = this.state.current_cell_obj.find('.acf-table-body-cont').find('ul');\r\n\t\t\t\t\t\tif (jUl.length) {\r\n\t\t\t\t\t\t\tjUl.append(this.tableHtml.body_cell_link_sub_item(href));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else $(activeLinkCell).text(href || '');\r\n\r\n\t\t\t\t\tif (row == '1') {\r\n\t\t\t\t\t\tif (linkAttrs.urlVarExamples) {\r\n\t\t\t\t\t\t\t$('.acf-field[data-name=\"url_vars_examples\"] textarea').val(simpleObjectToStr(linkAttrs.urlVarExamples, '\\n'));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this.onFirstStepUrlChangedCb instanceof Function) this.onFirstStepUrlChangedCb();\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tthis.rebuild_table_data(activeLinkCell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// trap any events\r\n\t\t\te.preventDefault ? e.preventDefault() : e.returnValue = false;\r\n\t\t\te.stopPropagation();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tthis.jBody.on('click', '.acf-table-body-cont--select .acf-table-body-cont-sub', (e) => {\r\n\t\t\tconst that = $(e.target).closest('.acf-table-body-cont--select .acf-table-body-cont-sub');\r\n\t\t\tthis.state.current_cell_obj = $(that.closest('.acf-table-body-cell')[0]) || false;\r\n\t\t\tthis.rebuild_table_data(that);\r\n\t\t});\r\n\t\tthis.init();\r\n\t}\r\n\r\n\ttriggerChangeEventOnAcfTableRoot(targetElement) {\r\n\t\t$(targetElement).closest('.acf-field-table').trigger('change');\r\n\t\tthis.isChange = true;\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.each_table();\r\n\t\tthis.table_add_row_event();\r\n\t\tthis.table_remove_row();\r\n\t\tthis.table_add_link();\r\n\t\tthis.table_remove_link();\r\n\t\tthis.simple_cell_editor();\r\n\t\tthis.link_editor();\r\n\t\tthis.tmce_cell_editor();\r\n\r\n\t\tthis.prevent_cell_links();\r\n\t\tthis.sortable_row();\r\n\t\tthis.ui_event_ajax();\r\n\t\tthis.editor_custom_style();\r\n\t}\r\n\r\n\tui_event_ajax() {\r\n\t\t$(document).ajaxComplete(() => {\r\n\t\t\tthis.each_table();\r\n\t\t});\r\n\t}\r\n\r\n\tui_init_drag_to_scroll() {\r\n\t\tthis.containerDraggers = {};\r\n\t\t$('.acf-table-wrap').each((_, element) => {\r\n\t\t\tthis.containerDraggers[element] = new ContainerDragger(\r\n\t\t\t\telement,\r\n\t\t\t\t'.acf-table-header-cell,.acf-table-body-cell',\r\n\t\t\t\t['input', 'textarea', '.dpit-info-icon', '.dpit-table-pro-link', '.acf-table-body-cell:not(.acf-table-body-cell--checkbox) .acf-table-body-cont']\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\teach_table() {\r\n\t\t$('.acf-field-table .acf-table-root').not('.acf-table-rendered').each((_, element) => {\r\n\t\t\tconst p = {};\r\n\t\t\tp.obj_root = $(element);\r\n\t\t\tconst table = p.obj_root.find('.acf-table-wrap');\r\n\r\n\t\t\tif (table.length > 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tp.obj_root.addClass('acf-table-rendered');\r\n\r\n\t\t\tthis.data_get(p);\r\n\r\n\t\t\tthis.data_default(p);\r\n\r\n\t\t\tthis.field_options_get(p);\r\n\r\n\t\t\tthis.table_render(p);\r\n\r\n\t\t\tthis.misc_render(p);\r\n\r\n\t\t\tif (typeof p.data.b[1] === 'undefined' && typeof p.data.b[0][1] === 'undefined' && p.data.b[0][0].c === '') {\r\n\t\t\t\tp.obj_root.find('.acf-table-remove-col').hide();\r\n\t\t\t\tp.obj_root.find('.acf-table-remove-row').hide();\r\n\t\t\t}\r\n\t\t\tif (this.containerDraggers && this.containerDraggers[element]) {\r\n\t\t\t\tthis.containerDraggers[element].refresh();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfield_options_get(p) {\r\n\t\ttry {\r\n\t\t\tp.field_options = $.parseJSON(decodeURIComponent(p.obj_root.find('[data-field-options]').data('field-options')));\r\n\t\t} catch (e) {\r\n\t\t\tp.field_options = {\r\n\t\t\t\tuse_header: 2,\r\n\t\t\t};\r\n\r\n\t\t\tconsole.log('The tablefield options value is not a valid JSON string:', decodeURIComponent(p.obj_root.find('[data-field-options]').data('field-options')));\r\n\t\t\tconsole.log('The parsing error:', e);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tdata_get(p) {\r\n\t\t// DATA FROM FIELD {\r\n\r\n\t\tconst val = p.obj_root.find('input.table').val();\r\n\r\n\t\tp.data = false;\r\n\r\n\t\t// CHECK FIELD CONTEXT {\r\n\r\n\t\tif (p.obj_root.closest('.acf-fields').hasClass('acf-block-fields')) {\r\n\t\t\tp.field_context = 'block';\r\n\t\t} else {\r\n\t\t\tp.field_context = 'box';\r\n\t\t}\r\n\r\n\t\t// }\r\n\r\n\t\tif (val !== '') {\r\n\t\t\ttry {\r\n\t\t\t\tif (p.field_context === 'box') {\r\n\t\t\t\t\tp.data = $.parseJSON(decodeURIComponent(val.replace(/\\+/g, '%20')));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (p.field_context === 'block') {\r\n\t\t\t\t\tp.data = $.parseJSON(decodeURIComponent(val.replace(/\\+/g, '%20')));\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tif (p.field_context === 'box') {\r\n\t\t\t\t\tconsole.log('The parsing error:', e);\r\n\t\t\t\t\tconsole.log('The tablefield value is not a valid JSON string:', decodeURIComponent(val.replace(/\\+/g, '%20')));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (p.field_context === 'block') {\r\n\t\t\t\t\tconsole.log('The parsing error:', e);\r\n\t\t\t\t\tconsole.log('The tablefield value is not a valid JSON string:', decodeURIComponent(val.replace(/\\+/g, '%20')));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof p.data.p !== 'object') {\r\n\t\t\t\tconsole.log('The tablefield value is not a tablefield JSON string:', p.data);\r\n\r\n\t\t\t\tp.data = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn p.data;\r\n\r\n\t\t// }\r\n\t}\r\n\r\n\tdata_default(p) {\r\n\t\t// DEFINE DEFAULT DATA {\r\n\r\n\t\tp.data_defaults = {\r\n\r\n\t\t\tacftf: {\r\n\t\t\t\tv: this.version,\r\n\t\t\t},\r\n\r\n\t\t\tp: {\r\n\t\t\t\to: {\r\n\t\t\t\t\tuh: 0, // use header\r\n\t\t\t\t},\r\n\t\t\t\tca: '', // caption content\r\n\t\t\t},\r\n\r\n\t\t\t// from data-colparam\r\n\r\n\t\t\tc: [\r\n\t\t\t\t{\r\n\t\t\t\t\tc: '',\r\n\t\t\t\t},\r\n\t\t\t],\r\n\r\n\t\t\t// header\r\n\r\n\t\t\th: [\r\n\t\t\t\t{\r\n\t\t\t\t\tc: '',\r\n\t\t\t\t},\r\n\t\t\t],\r\n\r\n\t\t\t// body\r\n\r\n\t\t\tb: [\r\n\t\t\t\t[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tc: '',\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t],\r\n\t\t};\r\n\r\n\t\t// }\r\n\r\n\t\t// MERGE DEFAULT DATA {\r\n\r\n\t\tif (p.data) {\r\n\t\t\tconst typePDB = typeof p.data.b;\r\n\t\t\tif (typePDB === 'array') {\r\n\t\t\t\t$.extend(true, p.data, p.data_defaults);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tp.data = p.data_defaults;\r\n\t\t}\r\n\r\n\t\t// }\r\n\t}\r\n\r\n\ttable_render(p) {\r\n\t\t// TABLE HTML MAIN {\r\n\r\n\t\tp.obj_root.find('.acf-table-wrap').remove();\r\n\t\tp.obj_root.append(this.tableHtml.table);\r\n\r\n\t\t// }\r\n\r\n\t\t// TABLE GET OBJECTS {\r\n\r\n\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\t\tp.obj_top_row = p.obj_root.find('.acf-table-top-row');\r\n\t\tp.obj_top_insert = p.obj_top_row.find('.acf-table-top-right');\r\n\t\tp.obj_header_row = p.obj_root.find('.acf-table-header-row');\r\n\t\tp.obj_header_insert = p.obj_header_row.find('.acf-table-header-right');\r\n\t\tp.obj_bottom_row = p.obj_root.find('.acf-table-bottom-row');\r\n\t\tp.obj_bottom_insert = p.obj_bottom_row.find('.acf-table-bottom-right');\r\n\r\n\t\t// }\r\n\r\n\t\t// TOP CELLS {\r\n\r\n\t\tif (p.data.c) {\r\n\t\t\tfor (var i in p.data.c) {\r\n\t\t\t\tp.obj_top_insert.before(this.tableHtml.top_cell);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.table_top_labels(p);\r\n\r\n\t\t// }\r\n\r\n\t\t// HEADER CELLS {\r\n\r\n\t\tif (p.data.h) {\r\n\t\t\tfor (i in p.data.h) {\r\n\t\t\t\tconst definitionId = p.data.h[i].v.replace(/xxx&quot/g, '\"').trim();\r\n\t\t\t\tlet headerCellLabels = p.data.h[i].c.replace(/xxx&quot/g, '\"').trim();\r\n\t\t\t\tthis.var.columIds.push(definitionId);\r\n\t\t\t\tlet extraClass = '';\r\n\r\n\t\t\t\tif (Object.keys(this.config.stepDefinitions).includes(definitionId) && !this.config.stepDefinitions[definitionId]?.hide) {\r\n\t\t\t\t\tconst definition = this.config.stepDefinitions[definitionId];\r\n\t\t\t\t\tif (definition) {\r\n\t\t\t\t\t\tthis.allowedColumnsIdx.push(Number(i));\r\n\t\t\t\t\t\theaderCellLabels = definition.title;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\textraClass = 'dp-hidden';\r\n\t\t\t\t}\r\n\t\t\t\tp.obj_header_insert.before(this.tableHtml.header_cell(headerCellLabels, extraClass, definitionId));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// }\r\n\r\n\t\t// BODY ROWS {\r\n\r\n\t\tif (p.data.b) {\r\n\t\t\tfor (i in p.data.b) {\r\n\t\t\t\tp.obj_bottom_row.before(this.tableHtml.body_row.replace('<!--ph-->', parseInt(i) + 1));\r\n\t\t\t}\r\n\t\t\t$('.acf-table-sort-row-icon').load(urlJoin(this.config.assetsUrl, '/icons/arrows-alt-v-solid.svg')).addClass('acf-table-sort-row-icon--loaded').fadeIn(700);\r\n\t\t}\r\n\r\n\t\t// }\r\n\r\n\t\t// BODY ROWS CELLS {\r\n\r\n\t\tconst body_rows = p.obj_root.find('.acf-table-body-row');\r\n\t\tlet row_i = 0;\r\n\r\n\t\tif (body_rows) {\r\n\t\t\tbody_rows.each((_, element) => {\r\n\t\t\t\tconst body_row = $(element);\r\n\t\t\t\tconst row_insert = body_row.find('.acf-table-body-right');\r\n\r\n\t\t\t\tfor (i in p.data.b[row_i]) {\r\n\t\t\t\t\tlet cellData = p.data.b[row_i][i].c;\r\n\t\t\t\t\tif (cellData) cellData = p.data.b[row_i][i].c.replace(/xxx&quot/g, '\"');\r\n\t\t\t\t\trow_insert.before(this.get_column_html(Number(i), cellData, row_i, body_row));\r\n\t\t\t\t}\r\n\r\n\t\t\t\trow_i += 1;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// }\r\n\t}\r\n\r\n\tget_column_html(colIdx, data, rowIdx, jRow) {\r\n\t\tconst columnId = this.var.columIds[colIdx];\r\n\t\tconst stepDef = this.config.stepDefinitions?.[columnId];\r\n\t\tconst type = stepDef ? stepDef.type : '';\r\n\t\tconst titleAttr = stepDef ? stepDef.title : '';\r\n\t\tlet extraClasses = [];\r\n\t\tif (!this.allowedColumnsIdx.includes(colIdx)) {\r\n\t\t\textraClasses.push('dp-hidden');\r\n\t\t}\r\n\t\textraClasses.push(`acf-table-body-cell--${type}`);\r\n\t\tconst extClassStr = extraClasses.join(' ');\r\n\r\n\t\tconst dataVal = decodeStepParamAdvancedVal(data, columnId, this.config.stepDefinitions, false);\r\n\r\n\r\n\t\tif (columnId === 'hidden_meta' && dataVal?.ext?.build_with_wp_editor?.val === '1') {\r\n\t\t\t// set white spacing class\r\n\t\t\tif (jRow) jRow.find('.acf-table-body-cell--text_wp_edit .acf-table-body-cont').addClass('acf-table-body-cont--wsn');\r\n\t\t}\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase 'link': return this.tableHtml.body_cell_link(dataVal.val, extClassStr, dataVal.ext, rowIdx, titleAttr);\r\n\t\t\tcase 'select': return this.tableHtml.body_cell_select(stepDef.options, dataVal.val, extClassStr, /*dataVal.ext,*/ titleAttr);\r\n\t\t\tcase 'checkbox': return this.tableHtml.body_cell_checkbox(dataVal.val === true || dataVal.val == 1, extClassStr, dataVal.ext, titleAttr);\r\n\t\t\tdefault: return this.tableHtml.body_cell(dataVal.val, extClassStr, dataVal.ext, null, titleAttr);\r\n\t\t}\r\n\t}\r\n\r\n\tmisc_render(p) {\r\n\t\tthis.init_option_use_header(p);\r\n\t\tthis.init_option_caption(p);\r\n\t}\r\n\r\n\tinit_option_use_header(p) {\r\n\t\t// VARS {\r\n\r\n\t\tconst v = {};\r\n\r\n\t\tv.obj_use_header = p.obj_root.find('.acf-table-fc-opt-use-header');\r\n\r\n\t\t// }\r\n\r\n\t\t// HEADER {\r\n\r\n\t\t// HEADER: FIELD OPTIONS, THAT AFFECTS DATA {\r\n\r\n\t\t// HEADER IS NOT ALLOWED\r\n\r\n\t\tif (p.field_options.use_header === 2) {\r\n\t\t\tp.obj_table.addClass('acf-table-hide-header');\r\n\r\n\t\t\tp.data.p.o.uh = 0;\r\n\t\t\tthis.update_table_data_field(p);\r\n\t\t}\r\n\r\n\t\t// HEADER IS REQUIRED\r\n\r\n\t\tif (p.field_options.use_header === 1) {\r\n\t\t\tp.data.p.o.uh = 1;\r\n\t\t\tthis.update_table_data_field(p);\r\n\t\t}\r\n\r\n\t\t// }\r\n\r\n\t\t// HEADER: SET CHECKBOX STATUS {\r\n\r\n\t\tif (p.data.p.o.uh === 1) {\r\n\t\t\tv.obj_use_header.val('1');\r\n\t\t}\r\n\r\n\t\tif (p.data.p.o.uh === 0) {\r\n\t\t\tv.obj_use_header.val('0');\r\n\t\t}\r\n\r\n\t\t// }\r\n\r\n\t\t// HEADER: SET HEADER VISIBILITY {\r\n\r\n\t\tif (p.data.p.o.uh === 1) {\r\n\t\t\tp.obj_table.removeClass('acf-table-hide-header');\r\n\t\t}\r\n\r\n\t\tif (p.data.p.o.uh === 0) {\r\n\t\t\tp.obj_table.addClass('acf-table-hide-header');\r\n\t\t}\r\n\r\n\t\t// }\r\n\r\n\t\t// }\r\n\t}\r\n\r\n\tinit_option_caption(p) {\r\n\t\tif (\r\n\t\t\ttypeof p.field_options.use_caption !== 'number'\r\n\t\t\t|| p.field_options.use_caption === 2\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// VARS {\r\n\r\n\t\tconst v = {};\r\n\r\n\t\tv.obj_caption = p.obj_root.find('.acf-table-fc-opt-caption');\r\n\r\n\t\t// }\r\n\r\n\t\t// SET CAPTION VALUE {\r\n\r\n\t\tv.obj_caption.val(p.data.p.ca);\r\n\r\n\t\t// }\r\n\t}\r\n\r\n\r\n\ttable_add_col(p) {\r\n\t\t// requires\r\n\t\t// p.obj_col\r\n\r\n\t\tconst that_index = p.obj_col.index();\r\n\r\n\t\tp.obj_root = p.obj_col.parents('.acf-table-root');\r\n\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\r\n\t\t$(p.obj_table.find('.acf-table-top-row').children()[that_index]).after(this.tableHtml.top_cell.replace('<!--ph-->', ''));\r\n\r\n\t\t$(p.obj_table.find('.acf-table-header-row').children()[that_index]).after(this.tableHtml.header_cell(''));\r\n\r\n\t\tp.obj_table.find('.acf-table-body-row').each((_, element) => {\r\n\t\t\t$($(element).children()[that_index]).after(this.tableHtml.body_cell());\r\n\t\t});\r\n\r\n\t\tthis.table_top_labels(p);\r\n\r\n\t\tp.obj_table.find('.acf-table-remove-col').show();\r\n\t\tp.obj_table.find('.acf-table-remove-row').show();\r\n\r\n\t\tthis.table_build_json(p);\r\n\t}\r\n\r\n\ttable_add_row_event() {\r\n\t\tthis.jBody.on('mouseup', '.acf-table-add-row', (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tconst that = $(e.target).closest('.acf-table-add-row');\r\n\t\t\tconst p = {};\r\n\r\n\t\t\tp.obj_row = that.parent().parent();\r\n\r\n\t\t\tthis.table_add_row(p);\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\ttable_add_first_row() {\r\n\r\n\t}\r\n\r\n\r\n\r\n\ttable_add_row(p, wasRemoved = false) {\r\n\t\t// requires\r\n\t\t// p.obj_row\r\n\r\n\t\tlet that_index = 0;\r\n\t\tlet col_amount = 0;\r\n\t\tlet body_cells_html = '';\r\n\r\n\t\tp.obj_root = p.obj_row.parents('.acf-table-root');\r\n\t\tp.obj_wrap = p.obj_root.find('.acf-table-wrap');\r\n\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\t\tp.obj_table_rows = p.obj_table.children();\r\n\t\tcol_amount = p.obj_table.find('.acf-table-top-cell').size();\r\n\t\tthat_index = p.obj_row.index();\r\n\t\tconst stepIdx = that_index - 1;\r\n\r\n\t\tfor (let i = 0; i < col_amount; i++) {\r\n\t\t\tlet cellContent = null;\r\n\t\t\tconst columnId = this.var.columIds[i];\r\n\r\n\t\t\tif (columnId) {\r\n\t\t\t\tconst stepDef = this.config.stepDefinitions?.[columnId];\r\n\t\t\t\tcellContent = this.config.stepDefinitions[columnId] ? this.config.stepDefinitions[columnId].def : '';\r\n\t\t\t\tif (stepDef && stepDef.type === 'link') {\r\n\t\t\t\t\tif (stepIdx == 0 && !wasRemoved) {\r\n\t\t\t\t\t\tif ((stepIdx + 2) < p.obj_table_rows?.length) {\r\n\t\t\t\t\t\t\tconst prevFirstStepLinkCellEl = $('#dpit-admin-first-step-link-cell').get(0);\r\n\t\t\t\t\t\t\tif (prevFirstStepLinkCellEl) {\r\n\t\t\t\t\t\t\t\tbody_cells_html += prevFirstStepLinkCellEl.outerHTML;\r\n\t\t\t\t\t\t\t\tprevFirstStepLinkCellEl.outerHTML = this.get_column_html(Number(i), '$keep-prev-step-url', stepIdx + 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbody_cells_html += this.get_column_html(Number(i), wasRemoved ? cellContent : cellContent || '$keep-prev-step-url', stepIdx);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbody_cells_html += this.get_column_html(Number(i), cellContent, stepIdx);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(p.obj_table_rows[that_index])\r\n\t\t\t.after(this.tableHtml.body_row)\r\n\t\t\t.next()\r\n\t\t\t.find('.acf-table-body-left')\r\n\t\t\t.after(body_cells_html);\r\n\r\n\t\tthis.table_left_labels(p);\r\n\r\n\t\tp.obj_table.find('.acf-table-remove-col').show();\r\n\t\tp.obj_table.find('.acf-table-remove-row').show();\r\n\r\n\t\tthis.table_build_json(p);\r\n\r\n\t\tthis.containerDraggers[p.obj_wrap.get(0)]?.refresh();\r\n\r\n\t\t$('.acf-table-sort-row-icon:not(.acf-table-sort-row-icon--loaded)')\r\n\t\t\t.load(urlJoin(this.config.assetsUrl, '/icons/arrows-alt-v-solid.svg'))\r\n\t\t\t.addClass('acf-table-sort-row-icon--loaded').fadeIn(700);\r\n\t\tif (this.onRowAdded instanceof Function) this.onRowAdded();\r\n\t}\r\n\r\n\ttable_remove_first_row(obj_table) {\r\n\t\tconst col_amount = obj_table.find('.acf-table-top-cell').size();\r\n\t\tfor (let i = 0; i < col_amount; i++) {\r\n\t\t\tconst columnId = this.var.columIds[i];\r\n\t\t\tif (columnId) {\r\n\t\t\t\tconst stepDef = this.config.stepDefinitions?.[columnId];\r\n\r\n\t\t\t\tif (stepDef && stepDef.type === 'link') {\r\n\t\t\t\t\tconst firstStepLinkCellEl = $('#dpit-admin-first-step-link-cell').get(0);\r\n\t\t\t\t\tif (firstStepLinkCellEl) {\r\n\t\t\t\t\t\tconst secondStepLinkEl = obj_table.find('.acf-table-body-row').get(1)?.querySelector('.acf-table-body-cell--link');\r\n\t\t\t\t\t\tif (secondStepLinkEl) {\r\n\t\t\t\t\t\t\tsecondStepLinkEl.outerHTML = firstStepLinkCellEl.outerHTML;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttable_remove_row() {\r\n\t\tthis.jBody.on('click', '.acf-table-remove-row', (e) => {\r\n\t\t\te.preventDefault();\r\n\r\n\r\n\t\t\tconst that = $(e.target).closest('.acf-table-remove-row');\r\n\t\t\tlet rows_count = false;\r\n\r\n\t\t\tconst p = {};\r\n\t\t\tp.obj_row = that.parent().parent();\r\n\t\t\tp.obj_root = that.parents('.acf-table-root');\r\n\t\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\t\t\tp.obj_rows = p.obj_root.find('.acf-table-body-row');\r\n\t\t\tconst stepIdx = p.obj_row.index() - 2;\r\n\t\t\trows_count = p.obj_rows.length;\r\n\r\n\t\t\tif (stepIdx === 0) {\r\n\t\t\t\tthis.table_remove_first_row(p.obj_table);\r\n\t\t\t}\r\n\r\n\t\t\tthat.parent().parent().remove();\r\n\t\t\tp.obj_table_rows = p.obj_table.children();\r\n\t\t\tif (rows_count == 1) {\r\n\r\n\t\t\t\tthis.table_add_row({\r\n\t\t\t\t\tobj_row: p.obj_table.find('.acf-table-header-row'),\r\n\t\t\t\t}, true);\r\n\r\n\t\t\t\tp.obj_table.find('.acf-table-remove-row').hide();\r\n\t\t\t}\r\n\r\n\r\n\t\t\tthis.table_left_labels(p);\r\n\r\n\t\t\tthis.table_build_json(p);\r\n\t\t});\r\n\t}\r\n\r\n\ttable_add_link() {\r\n\t\tthis.jBody.on('click', '.acf-table-add-link', (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.state.current_cell_obj = $(e.target).closest('.acf-table-body-cell--link');\r\n\t\t\tthis.openWpLinkModal();\r\n\t\t});\r\n\t}\r\n\r\n\ttable_remove_link() {\r\n\t\tthis.jBody.on('click', '.acf-table-remove-link', (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.triggerChangeEventOnAcfTableRoot(e.target);\r\n\t\t\tconst p = {};\r\n\t\t\tconst that = $(e.target).closest('.acf-table-remove-link');\r\n\t\t\tp.obj_root = that.parents('.acf-table-root');\r\n\t\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\t\t\tp.obj_rows = p.obj_root.find('.acf-table-body-row');\r\n\t\t\t$(e.target).closest('li').remove();\r\n\t\t\tthis.table_build_json(p);\r\n\t\t\tif (this.onFirstStepUrlChangedCb) this.onFirstStepUrlChangedCb();\r\n\t\t});\r\n\t}\r\n\r\n\r\n\ttable_top_labels(p) {\r\n\t\tlet letter_i_1 = 'A'.charCodeAt(0);\r\n\t\tlet letter_i_2 = 'A'.charCodeAt(0);\r\n\t\tlet use_2 = false;\r\n\r\n\t\tp.obj_table.find('.acf-table-top-cont').each((_, element) => {\r\n\t\t\tlet string = '';\r\n\r\n\t\t\tif (!use_2) {\r\n\t\t\t\tstring = String.fromCharCode(letter_i_1);\r\n\r\n\t\t\t\tif (letter_i_1 === 'Z'.charCodeAt(0)) {\r\n\t\t\t\t\tletter_i_1 = 'A'.charCodeAt(0);\r\n\t\t\t\t\tuse_2 = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tletter_i_1 += 1;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tstring = String.fromCharCode(letter_i_1) + String.fromCharCode(letter_i_2);\r\n\r\n\t\t\t\tif (letter_i_2 === 'Z'.charCodeAt(0)) {\r\n\t\t\t\t\tletter_i_1 += 1;\r\n\t\t\t\t\tletter_i_2 = 'A'.charCodeAt(0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tletter_i_2 += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$(element).text(string);\r\n\t\t});\r\n\t}\r\n\r\n\ttable_left_labels(p) {\r\n\t\tlet i = 0;\r\n\r\n\t\tp.obj_table.find('.acf-table-body-left').each((_, element) => {\r\n\t\t\ti += 1;\r\n\r\n\t\t\t$(element).find('.acf-table-body-cont').text(i);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\tgetTableBodyCellContValAtomic(type, jContItem, contItemSelector = '.acf-table-body-cont-sub') {\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase 'checkbox': return jContItem.find(contItemSelector)[0]?.checked ? '1' : '0';\r\n\t\t\tcase 'number': return $(jContItem.find(contItemSelector)[0]).val();\r\n\t\t\tcase 'select': return $(jContItem.find(contItemSelector)[0]).val();\r\n\t\t\tcase 'link': {\r\n\t\t\t\tif (jContItem.parent().hasClass('acf-table-body-cell--link-multi')) {\r\n\t\t\t\t\tlet resArr = [];\r\n\t\t\t\t\tconst jLi = $(jContItem[0]).find('.acf-table-body-cont-li');\r\n\t\t\t\t\tif (jLi.length) {\r\n\t\t\t\t\t\tjLi.each((_, element) => {\r\n\t\t\t\t\t\t\tresArr.push($(element).find('span').text());\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn resArr.filter(n => n).join(',');\r\n\t\t\t\t}\r\n\t\t\t\telse return jContItem.html();\r\n\t\t\t}\r\n\t\t\tcase 'ext_only': return '';\r\n\t\t\tdefault: {\r\n\t\t\t\tlet html = jContItem.clone()    //clone the element\r\n\t\t\t\t\t.children('.acf-table-cell-ec') //select all the children with extended data\r\n\t\t\t\t\t.remove()   //remove all the children\r\n\t\t\t\t\t.end()  //again go back to selected element\r\n\t\t\t\t\t.html();\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tgetStepExtCfg(columnId) {\r\n\t\treturn columnId && this.config.stepDefinitions[columnId] ? this.config.stepDefinitions[columnId]?.ext : null;\r\n\t}\r\n\r\n\tgetTableBodyCellContVal(columnId, jContItem) {\r\n\t\tlet res = {};\r\n\t\tconst stepDef = this.config.stepDefinitions?.[columnId];\r\n\t\tconst extCfg = this.getStepExtCfg(columnId);\r\n\t\tif (stepDef) {\r\n\t\t\tlet mainVal = this.getTableBodyCellContValAtomic(stepDef.type, jContItem);\r\n\t\t\tif (extCfg) {\r\n\t\t\t\tconst extVal = {};\r\n\t\t\t\tjContItem.find('.acf-cell-eci-wrap').each((_, element) => {\r\n\t\t\t\t\tconst id = $(element).attr('data-id');\r\n\t\t\t\t\tif (id && extCfg[id]) {\r\n\t\t\t\t\t\tconst type = extCfg[id].type;\r\n\t\t\t\t\t\tif (type) {\r\n\t\t\t\t\t\t\textVal[id] = this.getTableBodyCellContValAtomic(type, $(element));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tmainVal = encodeStepParamAdvancedVal({ val: mainVal, ext: extVal }, columnId, this.config.stepDefinitions);\r\n\t\t\t}\r\n\t\t\tres = mainVal;\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\r\n\r\n\ttable_build_json(p) {\r\n\t\tlet i = 0;\r\n\t\tlet i2 = 0;\r\n\r\n\t\tp.data = this.data_get(p);\r\n\t\tthis.data_default(p);\r\n\r\n\t\tp.data.c = [];\r\n\t\tp.data.h = [];\r\n\t\tp.data.b = [];\r\n\r\n\t\t// TOP {\r\n\r\n\t\ti = 0;\r\n\r\n\t\tp.obj_table.find('.acf-table-top-cont').each((_, element) => {\r\n\t\t\tp.data.c[i] = {};\r\n\t\t\tp.data.c[i].p = $(element).parent().data('colparam');\r\n\r\n\t\t\ti += 1;\r\n\t\t});\r\n\r\n\t\t// }\r\n\r\n\t\t// HEADER {\r\n\r\n\t\ti = 0;\r\n\r\n\t\tp.obj_table.find('.acf-table-header-cont').each((_, element) => {\r\n\t\t\tp.data.h[i] = {};\r\n\t\t\tp.data.h[i].c = $(element).html();\r\n\t\t\tp.data.h[i].v = $(element).data('val');\r\n\r\n\t\t\ti += 1;\r\n\t\t});\r\n\r\n\t\t// }\r\n\r\n\t\t// BODY {\r\n\r\n\t\ti = 0;\r\n\t\ti2 = 0;\r\n\r\n\t\tp.obj_table.find('.acf-table-body-row').each((_, element_row) => {\r\n\t\t\tp.data.b[i] = [];\r\n\r\n\t\t\t$(element_row).find('.acf-table-body-cell .acf-table-body-cont').each((_, element) => {\r\n\t\t\t\tp.data.b[i][i2] = {};\r\n\t\t\t\tconst columnId = this.var.columIds[i2];\r\n\t\t\t\tif (columnId) {\r\n\t\t\t\t\tp.data.b[i][i2].c = this.getTableBodyCellContVal(columnId, $(element));\r\n\t\t\t\t}\r\n\t\t\t\ti2 += 1;\r\n\t\t\t});\r\n\r\n\t\t\ti2 = 0;\r\n\t\t\ti += 1;\r\n\t\t});\r\n\r\n\t\t// }\r\n\r\n\t\t// UPDATE INPUT WITH NEW DATA {\r\n\r\n\t\tthis.update_table_data_field(p);\r\n\r\n\t\t// }\r\n\t}\r\n\r\n\tupdate_table_data_field(p) {\r\n\t\t// UPDATE INPUT WITH NEW DATA {\r\n\r\n\t\tp.data = this.update_table_data_version(p.data);\r\n\r\n\t\t// makes json string from data object\r\n\t\tlet data = JSON.stringify(p.data);\r\n\r\n\t\t// adds backslash to all \\\" in JSON string because encodeURIComponent() strippes backslashes\r\n\t\tdata.replace(/\\\\\"/g, '\\\\\"');\r\n\r\n\t\t// encodes the JSON string to URI component, the format, the JSON string is saved to the database\r\n\t\tdata = encodeURIComponent(data);\r\n\r\n\t\tp.obj_root.find('input.table').val(data);\r\n\r\n\t\tthis.field_changed(p);\r\n\r\n\t\t// }\r\n\t}\r\n\r\n\tupdate_table_data_version(data) {\r\n\t\tif (typeof data.acftf === 'undefined') {\r\n\t\t\tdata.acftf = {};\r\n\t\t}\r\n\r\n\t\tdata.acftf.v = this.version;\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\r\n\ttmce_cell_editor() {\r\n\t\tthis.tmce = new DpTinyMceDialog(this.config.tmce, (target, content) => {\r\n\t\t\tif (target) {\r\n\r\n\t\t\t\ttarget.html(content);\r\n\t\t\t\tconst p = {};\r\n\t\t\t\tp.obj_root = target.parents('.acf-table-root');\r\n\t\t\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\t\t\t\tp.obj_rows = p.obj_root.find('.acf-table-body-row');\r\n\t\t\t\tconst currentRow = target.closest('.acf-table-body-row');\r\n\t\t\t\tcurrentRow.find('.acf-cell-eci-wrap[data-id=\"build_with_wp_editor\"] input').prop('checked', true);\r\n\t\t\t\tcurrentRow.find('.acf-table-body-cell--text_wp_edit .acf-table-body-cont').addClass('acf-table-body-cont--rt');\r\n\r\n\t\t\t\tthis.table_build_json(p);\r\n\t\t\t\tthis.triggerChangeEventOnAcfTableRoot(target);\r\n\t\t\t}\r\n\t\t}, false, this.config.dpDebugEn);\r\n\t\tthis.jBody.on('click', '.acf-table-body-cell--text_wp_edit', (e) => {\r\n\r\n\t\t\tlet jTargetContentEl = ($(e.target).hasClass('acf-table-body-cont')) ? $(e.target) : $(e.target).find('.acf-table-body-cont');\r\n\t\t\tif (!jTargetContentEl.length) jTargetContentEl = $(e.target).closest('.acf-table-body-cont');\r\n\t\t\t//console.log($(e.target), jTargetContentEl, jTargetContentEl.html());\r\n\t\t\tthis.tmce.open(jTargetContentEl, jTargetContentEl.html(), this.getStepIdx($(e.target)));\r\n\t\t});\r\n\t}\r\n\r\n\teditor_custom_style() {\r\n\r\n\t\tsetTextStyles(this.config?.text_styles, getWinBB());\r\n\t\t/*if (!$.isEmptyObject(this.config?.text_styles)) {\r\n\t\t\tthis.jBody.addClass();\r\n\t\t}*/\r\n\r\n\t}\r\n\r\n\topenWpLinkModal($sourceEl = null, initialLinkText = '') {\r\n\t\tif (this.dpWpLink) {\r\n\t\t\tlet text = initialLinkText;\r\n\t\t\tconst stepIdx = $sourceEl ? this.getStepIdx($sourceEl) : 1;\r\n\t\t\tconst urlVarExamplesStr = $('.acf-field[data-name=\"url_vars_examples\"] textarea').val();\r\n\t\t\tlet urlVarExamples = null;\r\n\t\t\tif (urlVarExamplesStr) {\r\n\t\t\t\turlVarExamples = strToSimpleObject(urlVarExamplesStr, '\\n');\r\n\t\t\t}\r\n\t\t\tthis.dpWpLink.open(text, null, false, true, stepIdx, isUrlVariableProcessingEnabled(), urlVarExamples, this.config.sysUrlVars, $sourceEl);\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tlink_editor() {\r\n\t\tthis.jBody.on('click', '.acf-table-body-cell--link', (e) => {\r\n\t\t\tif (this.dpWpLink) {\r\n\t\t\t\tconst that = $(e.target).closest('.acf-table-body-cell--link');\r\n\t\t\t\tthis.state.current_cell_obj = that;\r\n\t\t\t\tlet openDpWpLink = true;\r\n\t\t\t\tlet text = '';\r\n\t\t\t\tlet jSubEl = null;\r\n\t\t\t\tconst content = that.find('.acf-table-body-cont');\r\n\t\t\t\tif (content.length) {\r\n\t\t\t\t\tconst jLi = $(e.target).closest('.acf-table-body-cont-li');\r\n\t\t\t\t\tif (jLi.length) {\r\n\t\t\t\t\t\tjSubEl = $(jLi[0]).find('span');\r\n\t\t\t\t\t\tif (jSubEl.length) text = $(jSubEl[0]).text();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (!content.find('ul').length) {\r\n\t\t\t\t\t\ttext = $(content[0]).text();\r\n\t\t\t\t\t\tjSubEl = $(content);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\topenDpWpLink = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (openDpWpLink) {\r\n\t\t\t\t\tthis.openWpLinkModal(jSubEl, text);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsimple_cell_editor() {\r\n\t\tthis.jBody.on('click', '.acf-table-body-cell--text', (e) => {\r\n\t\t\tconst $cell = $(e.target).closest('.acf-table-body-cell--text');\r\n\t\t\tconst isInEditMode = $cell.find('.acf-table-cell-editor').length > 0;\r\n\t\t\tif (!isInEditMode) {\r\n\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\tif (!$(e.target).closest('.acf-table-cell-ec').length) {\r\n\t\t\t\t\tthis.cell_editor_save();\r\n\t\t\t\t\tthis.cell_editor_add_editor({ that: $cell });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.jBody.on('click', '.acf-table-cell-editor-textarea', (e) => {\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t});\r\n\r\n\t\tthis.jBody.on('click', () => {\r\n\t\t\tthis.cell_editor_save();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\r\n\tgetStepIdx(jTarget) {\r\n\t\treturn Number(jTarget.closest('.acf-table-body-row').find('.acf-table-body-left .acf-table-body-cont').text());\r\n\t}\r\n\r\n\tcell_editor_add_editor(p) {\r\n\t\tconst defaults = {\r\n\t\t\tthat: false,\r\n\t\t};\r\n\r\n\t\tp = $.extend(true, defaults, p);\r\n\r\n\t\tif (p.that) {\r\n\t\t\tthis.state.current_cell_obj = p.that;\r\n\r\n\t\t\tif (p.that.hasClass('acf-table-body-cell--text')) {\r\n\t\t\t\tconst that_val = p.that.find('.acf-table-body-cont, .acf-table-header-cont').html();\r\n\t\t\t\tthis.state.cell_editor_is_open = true;\r\n\r\n\t\t\t\tp.that.append(this.tableHtml.htmleditor).find('.acf-table-cell-editor-textarea').html(that_val).focus();\r\n\t\t\t\t$('.acf-table-cell-editor').fadeIn();\r\n\t\t\t\tp.that.find('.acf-table-body-cont').addClass('dpit-hidden-hard');\r\n\t\t\t\tconst textAreaElement = $('.acf-table-cell-editor-textarea')[0];\r\n\t\t\t\tautosize(textAreaElement);\r\n\t\t\t\ttextAreaElement.focus();\r\n\t\t\t\ttextAreaElement.setSelectionRange(textAreaElement.value.length, textAreaElement.value.length);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget_next_table_cell() {\r\n\t\t// next cell of current row\r\n\t\tlet next_cell = this.state.current_cell_obj\r\n\t\t\t.next('.acf-table-body-cell, .acf-table-header-cell');\r\n\r\n\t\t// else if get next row\r\n\t\tif (next_cell.length === 0) {\r\n\t\t\tnext_cell = this.state.current_cell_obj\r\n\t\t\t\t.parent()\r\n\t\t\t\t.next('.acf-table-body-row')\r\n\t\t\t\t.find('.acf-table-body-cell')\r\n\t\t\t\t.first();\r\n\t\t}\r\n\r\n\t\t// if next row, get first cell of that row\r\n\t\tif (next_cell.length !== 0) {\r\n\t\t\tthis.state.current_cell_obj = next_cell;\r\n\t\t} else {\r\n\t\t\tthis.state.current_cell_obj = false;\r\n\t\t}\r\n\t}\r\n\r\n\tget_prev_table_cell() {\r\n\r\n\t\t// prev cell of current row\r\n\t\tconst table_obj = this.state.current_cell_obj.closest('.acf-table-table');\r\n\t\tconst no_header = table_obj.hasClass('acf-table-hide-header');\r\n\t\tlet prev_cell = this.state.current_cell_obj\r\n\t\t\t.prev('.acf-table-body-cell, .acf-table-header-cell');\r\n\r\n\t\t// else if get prev row\r\n\t\tif (prev_cell.length === 0) {\r\n\t\t\tconst row_selectors = ['.acf-table-body-row'];\r\n\r\n\t\t\t// prevents going to header cell if table header is hidden\r\n\t\t\tif (no_header === false) {\r\n\t\t\t\trow_selectors.push('.acf-table-header-row');\r\n\t\t\t}\r\n\r\n\t\t\tprev_cell = this.state.current_cell_obj\r\n\t\t\t\t.parent()\r\n\t\t\t\t.prev(row_selectors.join(','))\r\n\t\t\t\t.find('.acf-table-body-cell, .acf-table-header-cell')\r\n\t\t\t\t.last();\r\n\t\t}\r\n\r\n\t\t// if next row, get first cell of that row\r\n\t\tif (prev_cell.length !== 0) {\r\n\t\t\tthis.state.current_cell_obj = prev_cell;\r\n\t\t} else {\r\n\t\t\tthis.state.current_cell_obj = false;\r\n\t\t}\r\n\t}\r\n\r\n\trebuild_table_data(trigger) {\r\n\t\tconst root = $(trigger).parents('.acf-table-root');\r\n\t\tconst p = {\r\n\r\n\t\t\tobj_root: root,\r\n\t\t\tobj_table: root.find('.acf-table-table'),\r\n\t\t};\r\n\t\tthis.table_build_json(p);\r\n\t}\r\n\r\n\tcell_editor_save() {\r\n\t\tconst cell_editor = this.jBody.find('.acf-table-cell-editor');\r\n\t\tconst cell_editor_textarea = cell_editor.find('.acf-table-cell-editor-textarea');\r\n\t\tconst p = {};\r\n\t\tvar cell_editor_val = '';\r\n\t\t$(cell_editor.prev()).removeClass('dpit-hidden-hard');\r\n\t\tif (typeof cell_editor_textarea.val() !== 'undefined') {\r\n\t\t\tp.obj_root = cell_editor.parents('.acf-table-root');\r\n\t\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\r\n\t\t\tcell_editor_val = cell_editor_textarea.val();\r\n\r\n\t\t\t// prevent XSS injection\r\n\t\t\tcell_editor_val = cell_editor_val.replace(/<(script)/ig, '&#060;$1');\r\n\t\t\tcell_editor_val = cell_editor_val.replace(/<\\/(script)/ig, '&#060;/$1');\r\n\r\n\t\t\tcell_editor.prev().html(cell_editor_val);\r\n\r\n\t\t\tthis.table_build_json(p);\r\n\r\n\t\t\tcell_editor.remove();\r\n\t\t\tthis.state.cell_editor_is_open = false;\r\n\r\n\t\t\tp.obj_root.find('.acf-table-remove-col').show(), p.obj_root.find('.acf-table-remove-row').show();\r\n\t\t}\r\n\r\n\t\t$('.acf-table-cell-editor').fadeOut();\r\n\t}\r\n\r\n\tprevent_cell_links() {\r\n\t\tthis.jBody.on('click', '.acf-table-body-cont a, .acf-table-header-cont a:not(.dpit-table-pro-link)', (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\t}\r\n\r\n\tsortable_fix_width(e, ui) {\r\n\t\tui.children().each((_, element) => {\r\n\t\t\tconst that = $(element);\r\n\r\n\t\t\tthat.width(that.width());\r\n\t\t});\r\n\r\n\t\treturn ui;\r\n\t}\r\n\r\n\tfixVerticalScrollTop(childEl) {\r\n\t\tif (childEl) {\r\n\t\t\tconst tableWrap = childEl.closest('.acf-table-wrap');\r\n\t\t\ttableWrap.scrollTop = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tsortable_row() {\r\n\t\tconst that = this;\r\n\t\tconst param = {\r\n\t\t\taxis: 'y',\r\n\t\t\titems: '> .acf-table-body-row',\r\n\t\t\tcontainment: 'parent',\r\n\t\t\thandle: '.acf-table-body-left', // .acf-table-body-cont',\r\n\t\t\thelper: this.sortable_fix_width,\r\n\t\t\tcancel: '.no-drag',\r\n\t\t\tupdate(event, ui) {\r\n\t\t\t\t// console.log(event);\r\n\t\t\t\tconst p = {};\r\n\r\n\t\t\t\tp.obj_root = ui.item.parents('.acf-table-root');\r\n\t\t\t\tp.obj_table = p.obj_root.find('.acf-table-table');\r\n\t\t\t\tthat.table_left_labels(p);\r\n\r\n\t\t\t\tthat.fixVerticalScrollTop(ui.item.get(0));\r\n\r\n\r\n\t\t\t\tconst that_index = ui.item.index();\r\n\t\t\t\tconst stepIdx = that_index - 1;\r\n\t\t\t\tlet prevFirstStepLinkCellEl = ui.item.find('#dpit-admin-first-step-link-cell').get(0);\r\n\t\t\t\tif (!prevFirstStepLinkCellEl) prevFirstStepLinkCellEl = $('#dpit-admin-first-step-link-cell').get(0);\r\n\t\t\t\tif (prevFirstStepLinkCellEl) {\r\n\t\t\t\t\tconst columnIdx = that.var.columIds.indexOf('url');\r\n\t\t\t\t\tconst firstUrlOfFirstStep = $(prevFirstStepLinkCellEl).find('.acf-table-body-cont-li').first().find('span').text();\r\n\t\t\t\t\tprevFirstStepLinkCellEl.outerHTML = that.get_column_html(columnIdx, firstUrlOfFirstStep || '$keep-prev-step-url', stepIdx);\r\n\r\n\r\n\t\t\t\t\tconst newFirstStepLinkCellEl = p.obj_table.find('.acf-table-body-row').first().find('.acf-table-body-cell--link').get(0);\r\n\t\t\t\t\tif (newFirstStepLinkCellEl) {\r\n\t\t\t\t\t\tlet textContent = newFirstStepLinkCellEl.querySelector('.acf-table-body-cont')?.textContent;\r\n\t\t\t\t\t\tif (textContent === '$keep-prev-step-url' || textContent === '$keep-current-url') textContent = '';\r\n\t\t\t\t\t\tnewFirstStepLinkCellEl.outerHTML = that.get_column_html(columnIdx, textContent, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (that.onRowAdded instanceof Function) that.onRowAdded();\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tthat.table_build_json(p);\r\n\t\t\t},\r\n\t\t};\r\n\t\t$('.acf-table-table').sortable(param);\r\n\t}\r\n\r\n\r\n\r\n\tfield_changed(p) {\r\n\t\tif (p.field_context === 'block') {\r\n\t\t\tp.obj_root.change();\r\n\t\t}\r\n\t}\r\n\r\n\tsort_cols(p) {\r\n\t\tp.obj_table.find('.acf-table-header-row').each((_, element) => {\r\n\t\t\tp.header_row = $(element);\r\n\t\t\tp.header_row_children = p.header_row.children();\r\n\r\n\t\t\tif (p.end_index < p.start_index) {\r\n\t\t\t\t$(p.header_row_children[p.end_index]).before($(p.header_row_children[p.start_index]));\r\n\t\t\t}\r\n\r\n\t\t\tif (p.end_index > p.start_index) {\r\n\t\t\t\t$(p.header_row_children[p.end_index]).after($(p.header_row_children[p.start_index]));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tp.obj_table.find('.acf-table-body-row').each((_, element) => {\r\n\t\t\tp.body_row = $(element), p.body_row_children = p.body_row.children();\r\n\r\n\t\t\tif (p.end_index < p.start_index) {\r\n\t\t\t\t$(p.body_row_children[p.end_index]).before($(p.body_row_children[p.start_index]));\r\n\t\t\t}\r\n\r\n\t\t\tif (p.end_index > p.start_index) {\r\n\t\t\t\t$(p.body_row_children[p.end_index]).after($(p.body_row_children[p.start_index]));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import urlJoin from 'url-join';\r\nimport AcfTippy from './AcfTippy';\r\nimport AcfTableField from './AcfTableField';\r\nimport DpitMultiStateAnimBtn from './DpitMultiStateAnimBtn';\r\n\r\nimport DpitHooks from '../../../../includes/assets/js/modules/DpitHooks';\r\nimport {\r\n\tgetRedirectUrlQueryString,\r\n\tscrollToOriginElementByUrlAndAnimate,\r\n\tcreateOrSetManuallyElement\r\n} from './dp-admin-utils';\r\n\r\nimport {\r\n\twrapElementByContainer,\r\n\tscrollToElementAndAnimate,\r\n\tsanitizePossibleRelativeUrl\r\n} from '../../../../includes/assets/js/modules/dpitUtilsInc';\r\n\r\nimport DpitAdminToolbar, { BTN_ID } from './DpitAdminToolbar';\r\nimport { Origin, TargetType } from '../../../../public/assets/js/apps/TourStepEditor/store/appMode';\r\n\r\n\r\n\r\nexport const IDS = {\r\n\tstepTable: 'dpit-step-table',\r\n\tstepBuilderBtn: 'dpit-step-builder-btn',\r\n\ttriggerGroupPrefix: 'dpit-trigger-group-',\r\n\ttriggerBtnPrefix: 'dpit-trigger-btn-',\r\n\tpostBodyContent: 'wpbody-content',\r\n\tslugBox: 'edit-slug-box',\r\n\tloader: 'dpit-admin-tour-edit-loader',\r\n};\r\n\r\nexport const CLASSES = {\r\n\tadminBtn: 'dpit-admin-btn',\r\n\tadminBtnWrap: 'dpit-admin-btn-wrap',\r\n\torSetManually: 'dpit-or-set-manually',\r\n\ttourIdLabel: 'dpit-tour-id',\r\n\tloaderTitle: 'dpit-loader__title',\r\n\tloader: 'dpit-loader',\r\n\tanimPulse: 'dpit-admin-pulse-anim'\r\n};\r\n\r\nexport const TRIGGER_IDX = {\r\n\tregular: 0,\r\n\tadditional: 1\r\n};\r\n\r\nexport const SELECTORS = {\r\n\tstepsTable: '.acf-field-table[data-name=\"intro_steps\"] .acf-table-table',\r\n\tacfPageLinkRemoveChoice: '.select2-selection__choice__remove',\r\n\tacfTriggerMode: '.acf-field[data-name=\"trigger_mode\"]',\r\n};\r\n\r\n\r\nexport default class DpitAdminTourEdit {\r\n\r\n\t/* SECTION INIT */\r\n\r\n\tconstructor(config) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT ' + this.printModuleName());\r\n\t\tthis.config = config;\r\n\t\tthis.preInit();\r\n\t\tthis.initAcfActions();\r\n\r\n\r\n\t}\r\n\r\n\tinitAcfActions() {\r\n\t\twindow.acf.addAction('load', () => {\r\n\t\t\tthis.initSubModules(() => {\r\n\t\t\t\tif (this.init()) {\r\n\t\t\t\t\tthis.runAfterInitActions();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\twindow.acf.addAction('invalid_field', () => {\r\n\t\t\tthis.deactivateLoader();\r\n\t\t\tif (this.adminToolBar) this.adminToolBar.stopPrimaryBtnAnimation();\r\n\t\t});\r\n\t}\r\n\r\n\tpreInit() {\r\n\t\tthis.firstStepUrl = this.config.tourStartPageUrl;\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.postRootEl = document.getElementById(IDS.postBodyContent);\r\n\t\tthis.publishBtnOrigEl = document.getElementById('publish');\r\n\t\tif (this.postRootEl) {\r\n\t\t\tthis.initTriggers();\r\n\t\t\tthis.initStepBuilder();\r\n\t\t\tthis.initAcfPageLinkLongTouch();\r\n\t\t\tthis.initLoader();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tasync runAfterInitActions() {\r\n\t\tthis.renderStartUrlAndTourId();\r\n\t\tthis.renderBuilderStepsButton();\r\n\t\tthis.renderTriggerButton(TRIGGER_IDX.regular);\r\n\t\tthis.startButtonsClickAbilityAutoUpdate();\r\n\t\tthis.startTriggerSelectorLabelAutoUpdate();\r\n\t\tthis.startIsChangeCheck();\r\n\t\tthis.adminToolBar.render(false);\r\n\t\tthis.actualizeToolbar(this.isReady);\r\n\r\n\t\tthis.deactivateLoader();\r\n\r\n\t\tconst isScrolling = await scrollToOriginElementByUrlAndAnimate(\r\n\t\t\tthis.config.queryParamsDefs,\r\n\t\t\tCLASSES.animPulse,\r\n\t\t\t{ align: { top: 0, topOffset: 40, lockX: true } }\r\n\t\t);\r\n\t\tif (!isScrolling) {\r\n\t\t\tif (!this.adminToolBar.scrollToStoredScrollTop()) {\r\n\t\t\t\t$(document.documentElement).scrollTop(0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tDpitHooks.doAction('adminEditTourLoaded', { tourId: this.config.tourId });\r\n\r\n\t}\r\n\r\n\r\n\r\n\tactivateLoader(label = null, hidePostContent = true, delay = 500) {\r\n\t\tif (this.loaderEl) {\r\n\t\t\tif (label) {\r\n\t\t\t\tconst loaderTitleEl = this.loaderEl.querySelector('.' + CLASSES.loaderTitle);\r\n\t\t\t\tif (loaderTitleEl) loaderTitleEl.innerHTML = label;\r\n\t\t\t}\r\n\t\t\tif (delay > 0) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.loaderEl.classList.remove(CLASSES.loader + '--inactive');\r\n\t\t\t\t\tif (hidePostContent) {\r\n\t\t\t\t\t\tthis.hidePostContent();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, delay);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.loaderEl.classList.remove(CLASSES.loader + '--inactive');\r\n\t\t\t\tif (hidePostContent) {\r\n\t\t\t\t\tthis.hidePostContent();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tdeactivateLoader(showPostContent = true) {\r\n\t\tif (this.loaderEl) {\r\n\t\t\tthis.loaderEl.classList.add(CLASSES.loader + '--inactive');\r\n\t\t\tif (showPostContent) this.showPostContent();\r\n\t\t}\r\n\t}\r\n\r\n\tinitLoader() {\r\n\t\tthis.loaderEl = document.getElementById(IDS.loader);\r\n\t}\r\n\r\n\tshowPostContent() {\r\n\t\tif (this.postRootEl) this.postRootEl.style.opacity = 1;\r\n\t}\r\n\r\n\thidePostContent() {\r\n\t\tif (this.postRootEl) this.postRootEl.style.opacity = 0;\r\n\t}\r\n\r\n\tinitSubModules(afterInitCb) {\r\n\t\tthis.stepsTable = new AcfTableField({\r\n\t\t\t...this.config.acfTable,\r\n\t\t\ti18n: this.config.i18n,\r\n\t\t\tstepDefinitions: this.config.stepDefinitions\r\n\t\t}, this.actualize.bind(this), this.onNewTableRowAdded.bind(this));\r\n\t\tthis.acfTippy = new AcfTippy(this.config, () => {\r\n\t\t\tthis.stepsTable.ui_init_drag_to_scroll();\r\n\t\t\tafterInitCb();\r\n\t\t});\r\n\t\tthis.adminToolBar = new DpitAdminToolbar(this.config, false, false, this.onRedirectingFromToolbar.bind(this), false);\r\n\t}\r\n\r\n\tonRedirectingFromToolbar(buttonId, actionTitle = '') {\r\n\t\tthis.beforeRedirecting();\r\n\t\tthis.activateLoader(actionTitle + ' ...');\r\n\t}\r\n\r\n\tonNewTableRowAdded() {\r\n\t\tif (this.acfTippy) this.acfTippy.reloadInfoIcons();\r\n\t\tthis.actualize();\r\n\t}\r\n\r\n\tinitTrigger(triggerIdx = TRIGGER_IDX.regular) {\r\n\t\tconst groupEl = this.postRootEl.querySelector(`.acf-field[data-name=\"${this.getTriggerAcfGroupName(triggerIdx)}\"]`);\r\n\t\tif (groupEl) {\r\n\t\t\tgroupEl.id = IDS.triggerGroupPrefix + triggerIdx;\r\n\t\t\tthis.triggersData.push({\r\n\t\t\t\tgroupEl\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tinitStepBuilder() {\r\n\t\tthis.startUrlOptionEl = this.getStartUrlOptionEl();\r\n\t\tthis.stepsTableEl = this.postRootEl.querySelector(SELECTORS.stepsTable);\r\n\t}\r\n\r\n\tinitTriggers() {\r\n\t\tthis.triggersData = [];\r\n\t\tthis.initTrigger(TRIGGER_IDX.regular);\r\n\t}\r\n\r\n\tinitAcfPageLinkLongTouch() {\r\n\t\t// to do\r\n\t\t$(SELECTORS.acfPageLinkRemoveChoice).on('touchstart click', (event) => {\r\n\t\t\tconst jLi = $(event.target).closest('li');\r\n\t\t\tif (jLi.length) {\r\n\t\t\t\t$(jLi[0]).remove();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/* !SECTION INIT */\r\n\r\n\r\n\t/* SECTION RENDER*/\r\n\r\n\trenderStartUrlAndTourId() {\r\n\t\tthis.slugBoxEl = this.postRootEl.querySelector('#' + IDS.slugBox);\r\n\t\tif (this.slugBoxEl) {\r\n\t\t\tconst permalinkStrongTagEl = this.slugBoxEl.querySelector('strong');\r\n\t\t\tif (permalinkStrongTagEl) {\r\n\t\t\t\tpermalinkStrongTagEl.innerText = this.config.i18n.permalink_title;\r\n\t\t\t}\r\n\r\n\t\t\tconst tourIdEl = document.createElement('span');\r\n\t\t\ttourIdEl.className = 'dpit-tour-id';\r\n\t\t\ttourIdEl.innerText = this.config.i18n.tour_id + ' : ' + this.config.tourId;\r\n\t\t\tthis.slugBoxEl.appendChild(tourIdEl);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tactualizeAllTourStartUrlLinks(isReady, startUrlHref = '', startUrlLabel = '') {\r\n\t\tconst $adminBarViewEl = $('.updated.notice');\r\n\t\tif (isReady) {\r\n\t\t\tconst $AdminBarViewTourBtnLinkEl = $('#wp-admin-bar-view a, .updated.notice > p > a');\r\n\t\t\tconst $PermalinkEl = $(this.slugBoxEl).find('#sample-permalink');\r\n\r\n\t\t\tif (startUrlHref) {\r\n\t\t\t\tconst startUrlHrefAbs = sanitizePossibleRelativeUrl(startUrlHref, this.config.siteUrl);\r\n\r\n\t\t\t\t$PermalinkEl.attr('href', startUrlHrefAbs);\r\n\t\t\t\t$AdminBarViewTourBtnLinkEl.attr('href', startUrlHrefAbs);\r\n\t\t\t}\r\n\t\t\tif (startUrlLabel) {\r\n\t\t\t\t$PermalinkEl.text(startUrlLabel);\r\n\t\t\t}\r\n\r\n\t\t\t$adminBarViewEl.show();\r\n\t\t\t$(this.slugBoxEl).show();\r\n\t\t} else {\r\n\t\t\t$adminBarViewEl.hide();\r\n\t\t\t$(this.slugBoxEl).hide();\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\trenderBuilderStepsButton() {\r\n\t\tconst toInsertAfterEl = document.querySelector('.acf-field-table[data-name=\"intro_steps\"] .acf-label');\r\n\t\tif (toInsertAfterEl) {\r\n\t\t\tthis.builderStepsBtn = new DpitMultiStateAnimBtn(\r\n\t\t\t\targs => this.obBtnClick(args, TargetType.STEP, IDS.stepTable),\r\n\t\t\t\tthis.getBtnState(this.config.i18n.configure_steps_visually),\r\n\t\t\t\t'default',\r\n\t\t\t\tCLASSES.adminBtn,\r\n\t\t\t\t['button-primary', CLASSES.adminBtn + '--xl'],\r\n\t\t\t\tfalse,\r\n\t\t\t\tIDS.stepBuilderBtn,\r\n\t\t\t);\r\n\r\n\t\t\tconst filledContainerEl = wrapElementByContainer(\r\n\t\t\t\tthis.builderStepsBtn.getButtonElement(),\r\n\t\t\t\tCLASSES.adminBtnWrap,\r\n\t\t\t\t'',\r\n\t\t\t\tcreateOrSetManuallyElement(this.config.i18n.or_set_man_table, CLASSES.orSetManually)\r\n\t\t\t);\r\n\t\t\ttoInsertAfterEl.after(filledContainerEl);\r\n\t\t}\r\n\t}\r\n\r\n\trenderTriggerButton(triggerIdx) {\r\n\t\tconst triggerData = this.triggersData[triggerIdx];\r\n\t\tif (triggerData) {\r\n\t\t\tconst triggerGroupEl = triggerData.groupEl;\r\n\t\t\tif (triggerGroupEl) {\r\n\t\t\t\tconst toInsertBeforeEl = triggerGroupEl.querySelector('.acf-field[data-name=\"intro_trigger_selector\"] .acf-input');\r\n\t\t\t\tif (toInsertBeforeEl) {\r\n\r\n\t\t\t\t\ttriggerData.button = new DpitMultiStateAnimBtn(\r\n\t\t\t\t\t\targs => this.obBtnClick(args, TargetType.TRIGGER, 'dpit-trigger-selector-' + triggerIdx, triggerIdx),\r\n\t\t\t\t\t\tthis.getBtnState(this.config.i18n.set_visually),\r\n\t\t\t\t\t\t'default',\r\n\t\t\t\t\t\tCLASSES.adminBtn,\r\n\t\t\t\t\t\t['button-primary', CLASSES.adminBtn + '--xl'],\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\tIDS.triggerBtnPrefix + triggerIdx,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\ttriggerData.btnWrapEl = wrapElementByContainer(\r\n\t\t\t\t\t\ttriggerData.button.getButtonElement(),\r\n\t\t\t\t\t\tCLASSES.adminBtnWrap,\r\n\t\t\t\t\t\t'',\r\n\r\n\t\t\t\t\t\tcreateOrSetManuallyElement(this.config.i18n.or_set_man, CLASSES.orSetManually)\r\n\t\t\t\t\t);\r\n\t\t\t\t\ttoInsertBeforeEl.before(triggerData.btnWrapEl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/* !SECTION RENDER*/\r\n\r\n\r\n\t/* SECTION EVENTS */\r\n\r\n\tobBtnClick(args, targetType, originId, originSubIdx = null) {\r\n\t\tswitch (args.state) {\r\n\t\t\tcase 'undef-start': this.scrollToStartUrl(); break;\r\n\t\t\tcase 'default':\r\n\t\t\t\t{\r\n\t\t\t\t\tconst button = args.button;\r\n\t\t\t\t\tbutton.startAnimation();\r\n\t\t\t\t\tthis.adminToolBar.deactivate();\r\n\t\t\t\t\tthis.beforeRedirecting();\r\n\r\n\t\t\t\t\tconst redirectQueryString = getRedirectUrlQueryString(this.config.queryParamsDefs, this.config.tourId, targetType, originId, Origin.ADMIN, originSubIdx);\r\n\t\t\t\t\tif (this.isUnsavedChange) {\r\n\t\t\t\t\t\tthis.activateLoader(this.config.i18n.storingChanges, true, 1000);\r\n\t\t\t\t\t\tthis.setTransientAndPressPrimaryButton(redirectQueryString, this.config.i18n.loadingFB, () => {\r\n\t\t\t\t\t\t\tbutton.stopAnimation();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.activateLoader(this.config.i18n.loadingFB, true, 1000);\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tthis.redirectToFirstStepUrl(redirectQueryString);\r\n\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tasync redirectToFirstStepUrl(redirectQueryString) {\r\n\t\tconst firstStepLink = await this.getFirstStepLink();\r\n\t\tif (firstStepLink?.url) {\r\n\t\t\tconst redirectUrl = urlJoin(this.config.siteUrl, firstStepLink.url, redirectQueryString);\r\n\t\t\twindow.location.href = redirectUrl;\r\n\t\t}\r\n\t}\r\n\r\n\tbeforeRedirecting() {\r\n\r\n\t}\r\n\r\n\tbeforeUnload() {\r\n\t\tif (!this.isUnsavedChange) {\r\n\t\t\tthis.adminToolBar.storeCurrentScrollTop();\r\n\t\t}\r\n\t}\r\n\r\n\t/* !SECTION EVENTS */\r\n\r\n\r\n\t/* SECTION STATES */\r\n\r\n\tstartIsChangeCheck() {\r\n\t\twindow.addEventListener('beforeunload', this.beforeUnload.bind(this));\r\n\t\t$('.acf-field').on('change', () => {\r\n\t\t\tthis.isUnsavedChange = true;\r\n\t\t\tthis.adminToolBar?.setIsChange();\r\n\t\t});\r\n\t}\r\n\r\n\tactualizeButtonsState(state) {\r\n\t\tthis.builderStepsBtn.setOnlyState(state);\r\n\t\tthis.triggersData.forEach(triggerData => {\r\n\t\t\ttriggerData?.button.setOnlyState(state);\r\n\t\t});\r\n\t}\r\n\r\n\tactualizeToolbar(isReady) {\r\n\t\tif (!isReady) {\r\n\t\t\tthis.adminToolBar.hideButtons(BTN_ID.preview, BTN_ID.view);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.adminToolBar.showButtons(BTN_ID.preview, BTN_ID.view);\r\n\t\t}\r\n\t}\r\n\r\n\tasync actualize(useLastStartUrl = true) {\r\n\t\tthis.actualizeCore(this.triggersData[TRIGGER_IDX.regular]?.groupEl?.querySelector(\r\n\t\t\t'.acf-field[data-name=\"intro_related_posts\"] ul.select2-selection__rendered li:not(.select2-search--inline)'\r\n\t\t) !== null);\r\n\t\ttry {\r\n\t\t\tif (useLastStartUrl && this.firstStepUrl) {\r\n\t\t\t\tthis.actualizeCore(this.firstStepUrl !== null, this.firstStepUrl);\r\n\t\t\t} else {\r\n\t\t\t\tconst firstStepLink = await this.getFirstStepLink();\r\n\t\t\t\tthis.firstStepUrl = firstStepLink?.url;\r\n\t\t\t\tif (this.firstStepUrl) {\r\n\t\t\t\t\tthis.actualizeCore(this.firstStepUrl !== null, this.firstStepUrl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(error);\r\n\t\t}\r\n\t}\r\n\r\n\tactualizeCore(isReady, firstStepUrl = null) {\r\n\t\tthis.isReady = isReady;\r\n\t\tthis.actualizeToolbar(isReady);\r\n\t\tthis.actualizeAllTourStartUrlLinks(isReady);\r\n\t\tthis.actualizeButtonsState(isReady ? 'default' : 'undef-start');\r\n\t\tif (isReady && firstStepUrl) {\r\n\t\t\tthis.actualizeAllTourStartUrlLinks(\r\n\t\t\t\ttrue,\r\n\t\t\t\tfirstStepUrl,\r\n\t\t\t\tthis.getStepUrlLabel(firstStepUrl)\r\n\t\t\t);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.actualizeAllTourStartUrlLinks(false);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\r\n\tactualizeTriggerSelectorLabel(groupEl) {\r\n\t\tconst triggerSelectorLabelEl = groupEl.querySelector('.acf-field[data-name=\"intro_trigger_selector\"]>.acf-label>label');\r\n\t\tif (triggerSelectorLabelEl) {\r\n\t\t\tconst value = groupEl.querySelector('input:checked')?.value;\r\n\t\t\tif (value === 'button') {\r\n\t\t\t\ttriggerSelectorLabelEl.innerHTML = this.config.i18n.button;\r\n\t\t\t} else {\r\n\t\t\t\ttriggerSelectorLabelEl.innerHTML = this.config.i18n.element;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tstartButtonsClickAbilityAutoUpdate() {\r\n\t\tthis.actualize();\r\n\t\tnew window.acf.Model({\r\n\t\t\tevents: {\r\n\t\t\t\t'change .acf-field-page-link': 'onChange',\r\n\t\t\t},\r\n\t\t\tonChange: () => this.actualize(false)\r\n\t\t});\r\n\t}\r\n\r\n\tstartTriggerSelectorLabelAutoUpdate() {\r\n\t\tthis.triggersData.forEach(triggerCfg => {\r\n\t\t\tconst modeEl = triggerCfg.groupEl.querySelector(SELECTORS.acfTriggerMode);\r\n\t\t\tif (modeEl) {\r\n\t\t\t\tmodeEl.addEventListener(\r\n\t\t\t\t\t'change',\r\n\t\t\t\t\t() => this.actualizeTriggerSelectorLabel(triggerCfg.groupEl)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/* !SECTION STATES */\r\n\r\n\r\n\t/* SECTION UTILS */\r\n\r\n\tprintModuleName() {\r\n\t\treturn 'DpitAdminTourEdit';\r\n\t}\r\n\r\n\tgetStepUrlLabel(relativeUrl) {\r\n\t\treturn relativeUrl === '/' ? this.config.i18n.HOME_PAGE : relativeUrl;\r\n\t}\r\n\r\n\r\n\tgetBtnState(activeLabel) {\r\n\t\treturn {\r\n\t\t\t'default': activeLabel,\r\n\t\t\t'undef-start': { content: this.config.i18n.set_first_step_url_FREE, activeMod: 'undef' }\r\n\t\t};\r\n\t}\r\n\r\n\tasync getFirstStepLink() {\r\n\t\tconst ids = this.getAcfFieldVal('intro_related_posts');\r\n\t\tif (ids) {\r\n\t\t\tconst id = ids[0];\r\n\t\t\tconst url = await this.postAjaxData(\r\n\t\t\t\t'get-permalink',\r\n\t\t\t\t{ id }\r\n\t\t\t);\r\n\t\t\treturn {\r\n\t\t\t\turl: url,\r\n\t\t\t\tlabel: url\r\n\t\t\t};\r\n\t\t} else return null;\r\n\t}\r\n\r\n\tgetAcfFieldVal(name, def = null) {\r\n\t\tconst fields = window.acf.getFields({ name });\r\n\t\tif (fields) {\r\n\t\t\treturn fields[0].val();\r\n\t\t}\r\n\t\treturn def;\r\n\t}\r\n\r\n\r\n\r\n\tasync setTransientAndPressPrimaryButton(redirectQueryString, loaderLabel, onComplete = null) {\r\n\t\ttry {\r\n\t\t\tawait this.ajaxSetTransient('dpit_builder_transient', redirectQueryString, this.config.tourId, 30);\r\n\t\t\tthis.activateLoader(loaderLabel, true, 1000);\r\n\t\t\tthis.pressPrimaryButton();\r\n\t\t\tif (onComplete instanceof Function) onComplete(true);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(err, err?.stack);\r\n\t\t\tif (onComplete instanceof Function) onComplete(false);\r\n\t\t}\r\n\t}\r\n\r\n\tgetStartUrlOptionEl() {\r\n\t\treturn this.postRootEl.querySelector('.acf-field[data-name=\"intro_trigger\"] .acf-field[data-name=\"intro_related_posts\"]');\r\n\t}\r\n\r\n\tasync scrollToStartUrl() {\r\n\t\treturn await scrollToElementAndAnimate(this.startUrlOptionEl);\r\n\t}\r\n\r\n\tpostAjaxData(route, dataToPost) {\r\n\t\treturn $.ajax({\r\n\t\t\turl: urlJoin(this.config.restApiUrl, 'dpintrotours/v1/', route),\r\n\t\t\ttype: 'post',\r\n\t\t\tdata: dataToPost,\r\n\t\t\theaders: { 'X-WP-Nonce': this.config.nonces.wp_rest },\r\n\t\t});\r\n\t}\r\n\r\n\tasync ajaxSetTransient(transientName, redirectQueryString, postId, expirationS) {\r\n\t\treturn await this.postAjaxData(\r\n\t\t\t'set-transient',\r\n\t\t\t{\r\n\t\t\t\tname: transientName,\r\n\t\t\t\texpirationS: expirationS,\r\n\t\t\t\ttransientData: {\r\n\t\t\t\t\tpostId: postId,\r\n\t\t\t\t\tredirectQueryString: redirectQueryString,\r\n\t\t\t\t\tisGlobalStartAtAllPagesSet: this.isGlobalStartAtAllPagesSet() ? 1 : 0\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tpressPrimaryButton() {\r\n\t\t$(this.publishBtnOrigEl).trigger('click');\r\n\t}\r\n\r\n\tgetTriggerAcfGroupName(triggerIdx) {\r\n\t\treturn triggerIdx === TRIGGER_IDX.regular ? 'intro_trigger' : 'intro_trigger_2';\r\n\t}\r\n\r\n\tisGlobalStartAtAllPagesSet() {\r\n\t\treturn $('.acf-field[data-name=\"global_start_at_all_pages\"] .acf-switch').hasClass('-on');\r\n\t}\r\n\t/* !SECTION UTILS */\r\n}","import DpitMultiStateAnimBtn from './DpitMultiStateAnimBtn';\r\nimport {\r\n\twrapElementByContainer\r\n} from '../../../../includes/assets/js/modules/dpitUtilsInc';\r\n\r\nexport const CLASSES = {\r\n\tadminBtn: 'dpit-admin-btn',\r\n\tadminBtnWrap: 'dpit-admin-btn-wrap'\r\n};\r\n\r\nexport const IDS = {\r\n\tpromoBtnWrap: 'dpit-promo-btn-wrap'\r\n};\r\n\r\nexport default class DPProPromoButton {\r\n\tconstructor(config) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT DPProPromoButton');\r\n\t\tthis.config = config;\r\n\t\tconst appendAfterSelectors = ['.acf-field[data-name=\"intro_enabled\"', '.acf-field-group[data-name=\"intro_url_variables\"]>.acf-label'];\r\n\t\tappendAfterSelectors.forEach((appendAfterSelector, idx) => {\r\n\t\t\tconst toInsertAfterEl = document.querySelector(appendAfterSelector);\r\n\t\t\tif (toInsertAfterEl) {\r\n\t\t\t\tconst promoBtn = new DpitMultiStateAnimBtn(\r\n\t\t\t\t\tthis.onClick.bind(this),\r\n\t\t\t\t\t{ default: config.proCTAText },\r\n\t\t\t\t\t'default',\r\n\t\t\t\t\tCLASSES.adminBtn,\r\n\t\t\t\t\t[CLASSES.adminBtn + '--cta', CLASSES.adminBtn + '--xl']\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst filledContainerEl = wrapElementByContainer(\r\n\t\t\t\t\tpromoBtn.getButtonElement(),\r\n\t\t\t\t\tCLASSES.adminBtnWrap,\r\n\t\t\t\t\tIDS.promoBtnWrap + '-' + (idx + 1)\r\n\r\n\t\t\t\t);\r\n\t\t\t\ttoInsertAfterEl.append(filledContainerEl);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tonClick(args) {\r\n\t\targs.button.startAnimation(false, 1, () => {\r\n\t\t\twindow.open(this.config.proDemoLink, '_blank');\r\n\t\t});\r\n\r\n\t}\r\n}","export default class DPAcfAdjust {\r\n\tconstructor(config) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT DPAcfAdjust');\r\n\r\n\t\t$(document).on(\r\n\t\t\t'tap',\r\n\t\t\t'.acf-icon',\r\n\t\t\t(event) => {\r\n\t\t\t\t$(event.target).trigger('click');\r\n\t\t\t},\r\n\t\t);\r\n\t\t$(document).on(\r\n\t\t\t'mousedown',\r\n\t\t\t'.acf-field-relationship .values-list .acf-rel-item .acf-icon[data-name=\"remove_item\"]',\r\n\t\t\t(event) => {\r\n\t\t\t\tconsole.log('mouseDown');\r\n\t\t\t\t$(event.target).trigger('click');\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n}\r\n","import DpitAdminTourEdit from './modules/DpitAdminTourEdit';\r\nimport DPProPromoButton from './modules/DPProPromoButton';\r\nimport DPAcfAdjust from './modules/DPAcfAdjust';\r\n\r\n\r\njQuery(document).ready(($) => {\r\n\twindow.$ = $;\r\n\tif (window.dpIntroToursAdminTourEditConfig.dpDebugEn) console.log('[dpit] INIT Admin Tour Edit Config:', window.dpIntroToursAdminTourEditConfig);\r\n\tnew DPAcfAdjust(window.dpIntroToursAdminTourEditConfig);\r\n\tnew DPProPromoButton(window.dpIntroToursAdminTourEditConfig);\r\n});\r\n\r\nnew DpitAdminTourEdit(window.dpIntroToursAdminTourEditConfig);\r\n","import {\r\n\tgetDpUrlParam,\r\n\tbuildDpQueryString,\r\n\tscrollIntoView,\r\n\tscrollToElementAndAnimate\r\n} from '../../../../includes/assets/js/modules/dpitUtilsInc';\r\nimport { Origin, TargetType } from '../../../../public/assets/js/apps/TourStepEditor/store/appMode';\r\n\r\n/**\r\n * \r\n * @param {Object} queryParamsDefs Query param definition object for DPIT\r\n * @param {string} animationClass\r\n * @param {options} options scrollIntoView options see https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView\r\n * @param {string} defaultOriginId \r\n * @param {String} originIdKey\r\n * @param {String} canceledKey\r\n * @param {string} highlightClass\r\n */\r\nexport const scrollToOriginElementByUrlAndAnimate = async (\r\n\tqueryParamsDefs,\r\n\tanimationClass = 'dpit-admin-pulse-anim',\r\n\toptions = { align: { top: 0.5, left: 0.5 } },\r\n\toriginIdKey = 'dp_qpb_origin_el_id',\r\n\tcanceledKey = 'dp_qpb_canceled',\r\n\thighlightClass = ''\r\n) => {\r\n\tconst currentUrl = new URL(window.location);\r\n\tlet originId = getDpUrlParam(originIdKey, queryParamsDefs, currentUrl);\r\n\tif (originId) {\r\n\t\tconst element = document.getElementById(originId);\r\n\t\tif (element) {\r\n\t\t\tconst canceled = getDpUrlParam(canceledKey, queryParamsDefs, currentUrl);\r\n\r\n\t\t\tif (canceled === '1') return scrollIntoView(element, options);\r\n\t\t\telse {\r\n\t\t\t\tscrollToElementAndAnimate(element, animationClass, 1000, options, true, '', highlightClass);\r\n\t\t\t\tPromise.resolve(true);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Promise.resolve(false);\r\n\t}\r\n\treturn Promise.resolve(false);\r\n};\r\n\r\n\r\nexport const getRedirectUrlQueryString = (queryParamsDefs, tourId, builderMode = TargetType.STEP,\r\n\toriginId = '', originArea = Origin.ADMIN, triggerIdx = null) => {\r\n\t// dp_to_check\r\n\tconst params = {\r\n\t\tdp_qpb_builder_mode: builderMode,\r\n\t\tdp_qpb_builder_origin: originArea,\r\n\t\tdp_qpb_origin_el_id: originId,\r\n\t\tdp_qp_tour_id: tourId,\r\n\t\tdp_qp_run_always_on_load: '1',\r\n\t\tdp_qp_trigger_id: triggerIdx\r\n\t};\r\n\treturn buildDpQueryString(params, queryParamsDefs, '?');\r\n};\r\n\r\n\r\nexport const isUrlVariableProcessingEnabled = () => $('.acf-field[data-name=\"url_vars_enabled\"] .acf-switch').hasClass('-on');\r\n\r\nexport const getActualVisibleNoticesHeight = () => {\r\n\tlet res = 0;\r\n\t$('.notice:visible').each(function () {\r\n\t\tres += $(this).outerHeight(true);\r\n\t});\r\n\treturn res;\r\n};\r\n\r\n\r\nexport const createOrSetManuallyElement = (text, className = '') => {\r\n\tconst element = document.createElement('div');\r\n\telement.className = className;\r\n\telement.innerText = '~ ' + text + ' ~';\r\n\treturn element;\r\n};\r\n\r\n","import classNames from 'classnames';\r\n\r\nexport default class BulletsAnimation {\r\n\t/**\r\n\t * Insert animation and highlight class to the element specified by rootSelectorOrElement\r\n\t * @param {Element|String} rootSelectorOrElement\r\n\t * @param {Array|String} additionalClasses\r\n\t * @param {string} removeHighlightClickChildSelector\r\n\t * @param {Number} tickMs\r\n\t * @param {Int} totalSize \r\n\t * @param {Int} visibleSize \r\n\t * @param {Int} activeSize \r\n\t * @param {Bool} symmetrical \r\n\t * @param {string} id\r\n\t * @param {string} activeBulletClass\r\n\t */\r\n\tconstructor(rootSelectorOrElement, additionalClasses = '', tickMs = 70, totalSize = 15, visibleSize = 6, activeSize = 4, symmetrical = true, id = '', activeBulletClass = 'dpit-on') {\r\n\r\n\t\tthis.rootSelectorOrElement = rootSelectorOrElement;\r\n\t\tthis.bemRoot = 'dpit-anim-rb';\r\n\t\tthis.additionalClasses = classNames([additionalClasses, 'dpit-anim-rb']);\r\n\t\tthis.inactiveClass = BulletsAnimation.getModifiedClass(this.bemRoot, 'off');\r\n\t\tthis.activeClass = activeBulletClass;\r\n\t\tthis.id = id;\r\n\t\tthis.visibleSize = visibleSize;\r\n\t\tthis.totalSize = totalSize;\r\n\t\tthis.tickMs = tickMs;\r\n\t\tthis.activeSize = activeSize;\r\n\t\tthis.activeHalfSize = Math.floor(activeSize / 2);\r\n\t\tthis.symmetrical = symmetrical;\r\n\t}\r\n\r\n\tgetRootElement() {\r\n\t\treturn this.rootSelectorOrElement instanceof HTMLElement\r\n\t\t\t? this.rootSelectorOrElement\r\n\t\t\t: document.querySelector(this.rootSelectorOrElement);\r\n\t}\r\n\r\n\tstatic getModifiedClass(bemRoot, modifier) {\r\n\t\tlet res = '';\r\n\t\tif (bemRoot) res = bemRoot + '--';\r\n\t\tres += modifier;\r\n\t\treturn res;\r\n\t}\r\n\r\n\tstart(backward = false, loops = -1, loopsPassedCb = null) {\r\n\t\tthis.backward = backward;\r\n\t\tthis.rootElement = this.getRootElement();\r\n\t\tif (this.rootElement) {\r\n\t\t\tthis.rootElement.focus({ preventScroll: true });\r\n\t\t\tthis.isRunning = true;\r\n\t\t\tif (!this.bulletsLayer) {\r\n\t\t\t\tthis.createBullets(this.visibleSize, this.rootElement);\r\n\t\t\t} else {\r\n\t\t\t\tthis.bulletsLayer.classList.remove(this.inactiveClass);\r\n\t\t\t}\r\n\r\n\t\t\tif (backward) this.startReloadingSpinnerBack(loops, loopsPassedCb);\r\n\t\t\telse this.startReloadingSpinner(loops, loopsPassedCb);\r\n\t\t}\r\n\t}\r\n\r\n\tgetLoopTimeMs() {\r\n\t\treturn this.totalSize * this.tickMs;\r\n\t}\r\n\r\n\tcreateBullets(count, rootElement) {\r\n\r\n\t\tthis.bulletsLayer = document.createElement('div');\r\n\t\tthis.bulletsLayer.className = classNames([this.bemRoot, this.additionalClasses]);\r\n\t\tthis.bulletsLayer.setAttribute('aria-hidden', 'true');\r\n\t\tthis.bulletsLayer.id = this.id;\r\n\t\tthis.bulletsLayer.style.opacity = 0;\r\n\t\tthis.bulletsLayer.style.display = 'block';\r\n\t\tthis.bulletElements = [];\r\n\t\tconst containerEl = document.createElement('div');\r\n\t\tcontainerEl.classList.add(this.bemRoot + '__wrap');\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tconst bulletEl = document.createElement('div');\r\n\t\t\tthis.bulletElements.push(bulletEl);\r\n\t\t\tcontainerEl.appendChild(bulletEl);\r\n\t\t}\r\n\t\tthis.bulletsLayer.appendChild(containerEl);\r\n\t\tthis.bulletsLayer.style.opacity = 1;\r\n\t\trootElement.appendChild(this.bulletsLayer);\r\n\t}\r\n\r\n\r\n\r\n\tactivateBullet(activeIdx) {\r\n\t\tthis.bulletElements.forEach((element, idx) => {\r\n\t\t\tlet className = '';\r\n\t\t\tconst distanceFromActive = activeIdx - idx;\r\n\t\t\tif (distanceFromActive === 0) {\r\n\t\t\t\tclassName = this.activeClass;\r\n\t\t\t} else {\r\n\t\t\t\tconst distanceFromActiveAbs = Math.abs(distanceFromActive);\r\n\t\t\t\tif (this.symmetrical) {\r\n\t\t\t\t\tif (distanceFromActiveAbs <= this.activeHalfSize) {\r\n\t\t\t\t\t\tclassName = this.activeClass + '--' + distanceFromActiveAbs;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (distanceFromActiveAbs < this.activeSize) {\r\n\t\t\t\t\tif (distanceFromActive > 0 && !this.backward) {\r\n\t\t\t\t\t\tclassName = this.activeClass + '--' + distanceFromActiveAbs;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (distanceFromActive < 0 && this.backward) {\r\n\t\t\t\t\t\tclassName = this.activeClass + '--' + distanceFromActiveAbs;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telement.className = className;\r\n\t\t});\r\n\t}\r\n\r\n\tstopAfterLoopEnd(loopEndCallback = null) {\r\n\t\tthis.finishAfterLoopEnd = true;\r\n\t\tthis.finishAfterLoopEndCallback = loopEndCallback;\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis.bulletsLayer?.classList.add(this.inactiveClass);\r\n\t\tthis.clearBulletActiveStates();\r\n\t\tthis.stopReloadSpinner();\r\n\t\tthis.rootElement?.blur();\r\n\t}\r\n\r\n\tclearBulletActiveStates() {\r\n\t\tthis.bulletElements?.forEach(element => {\r\n\t\t\telement.className = '';\r\n\t\t});\r\n\t}\r\n\r\n\tstopReloadSpinner() {\r\n\t\tif (this.spinnerInterval) clearInterval(this.spinnerInterval);\r\n\t\tthis.spinnerInterval = null;\r\n\t\tthis.isRunning = false;\r\n\t}\r\n\r\n\tstartReloadingSpinner(loops, loopsPassedCb) {\r\n\t\tlet idx = this.symmetrical ? - this.activeHalfSize : 0;\r\n\t\tif (this.spinnerInterval) clearInterval(this.spinnerInterval);\r\n\t\tif (this.bulletHideTimeout) clearTimeout(this.bulletHideTimeout);\r\n\t\tthis.spinnerInterval = setInterval(() => {\r\n\t\t\tthis.activateBullet(idx, idx - 1);\r\n\t\t\tidx++;\r\n\t\t\tif (idx > this.totalSize) {\r\n\t\t\t\tidx = this.symmetrical ? - this.activeHalfSize : 0;\r\n\t\t\t\tthis.checkAfterLoopEnd();\r\n\t\t\t\tif (loops > 0) {\r\n\t\t\t\t\tloops = this.finishLoop(loops, loopsPassedCb);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}, this.tickMs);\r\n\t}\r\n\r\n\tstartReloadingSpinnerBack(loops, loopsPassedCb) {\r\n\t\tif (this.spinnerInterval) clearInterval(this.spinnerInterval);\r\n\t\tif (this.bulletHideTimeout) clearTimeout(this.bulletHideTimeout);\r\n\t\tlet idx = this.symmetrical ? this.visibleSize + this.activeHalfSize : this.visibleSize;\r\n\t\tthis.spinnerInterval = setInterval(() => {\r\n\t\t\tthis.activateBullet(idx);\r\n\t\t\tidx--;\r\n\t\t\tif (idx < this.visibleSize - this.totalSize) {\r\n\t\t\t\tidx = this.symmetrical ? this.visibleSize + this.activeHalfSize : this.visibleSize;\r\n\t\t\t\tthis.checkAfterLoopEnd();\r\n\t\t\t\tif (loops > 0) {\r\n\t\t\t\t\tloops = this.finishLoop(loops, loopsPassedCb);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}, this.tickMs);\r\n\t}\r\n\r\n\tcheckAfterLoopEnd() {\r\n\t\tif (this.finishAfterLoopEnd) {\r\n\t\t\tthis.finishAfterLoopEnd = false;\r\n\t\t\tthis.stop();\r\n\t\t\tif (this.finishAfterLoopEndCallback instanceof Function) this.finishAfterLoopEndCallback();\r\n\t\t\tthis.finishAfterLoopEndCallback = null;\r\n\t\t}\r\n\t}\r\n\r\n\tfinishLoop(loops, loopsPassedCb) {\r\n\t\tif (loops > 0) {\r\n\t\t\tloops--;\r\n\t\t\tif (loops === 0) {\r\n\t\t\t\tthis.stop();\r\n\t\t\t\tif (loopsPassedCb && loopsPassedCb instanceof Function) loopsPassedCb();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn loops;\r\n\t}\r\n\r\n}\r\n","import classNames from 'classnames';\r\nimport DpitMultiStateAnimBtn from './DpitMultiStateAnimBtn';\r\n\r\nimport {\r\n\tgetActualVisibleNoticesHeight\r\n} from './dp-admin-utils';\r\n\r\nimport {\r\n\tgetCookie,\r\n\tsetCookie,\r\n\tdeleteCookie\r\n} from '../../../../includes/assets/js/modules/dpitUtilsInc';\r\nimport { ANIM_DBG } from '../../../../public/assets/js/modules/core/constants';\r\n\r\n\r\nexport const CLASSES = {\r\n\trootWrap: 'dpit-tool-bar',\r\n\tbutton: 'dpit-admin-btn',\r\n\ttoolbarItem: 'dpit-tool-bar__item',\r\n\tbuttonPrimary: 'button-primary',\r\n\tbuttonSecondary: 'button-secondary'\r\n};\r\n\r\n\r\nexport const IDS = {\r\n\tmain: 'dpit-tool-bar',\r\n\tinsertAfterEl: 'wp-admin-bar-top-secondary',\r\n\twpAdminBar: 'wpadminbar'\r\n};\r\n\r\nexport const BTN_ID = {\r\n\tprimary: 'primary',\r\n\tdraft: 'draft',\r\n\tview: 'view',\r\n\tpreview: 'preview'\r\n};\r\n\r\nexport default class DpitAdminToolbar {\r\n\r\n\tconstructor(config, renderNow = true, previewButtonEnabled = true, onRedirectBtnClick = null, autoScrollToLastScrollTop = false, scrollTimeMs = 0) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT DpitAdminToolbar');\r\n\t\twindow.wpCookies = window.wpCookies || {};\r\n\t\tthis.config = config;\r\n\t\tthis.config.previewButtonEnabled = previewButtonEnabled;\r\n\t\tthis.onRedirectBtnClick = onRedirectBtnClick;\r\n\t\tthis.init(config);\r\n\t\tif (autoScrollToLastScrollTop) this.scrollToStoredScrollTop(scrollTimeMs);\r\n\t\tif (renderNow) this.render();\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.adminBarEl = document.getElementById(IDS.wpAdminBar);\r\n\t\tif (this.adminBarEl) {\r\n\t\t\tthis.insertAfterEl = this.adminBarEl.querySelector('#' + IDS.insertAfterEl);\r\n\t\t\tthis.initStopWhenInvalidFormSubmitted();\r\n\t\t}\r\n\t\tthis.buttons = {};\r\n\t}\r\n\r\n\tinitStopWhenInvalidFormSubmitted() {\r\n\t\t$('#wpbody-content input').on('invalid', () => {\r\n\t\t\tthis.stopPrimaryBtnAnimation();\r\n\t\t});\r\n\t}\r\n\r\n\tsetIsChange() {\r\n\t\tthis.isUnsavedChange = true;\r\n\t}\r\n\r\n\tactivate() {\r\n\t\tthis.wrapEl.classList.remove(CLASSES.rootWrap + '--inactive');\r\n\t}\r\n\r\n\tdeactivate() {\r\n\t\tthis.wrapEl.classList.add(CLASSES.rootWrap + '--inactive');\r\n\t}\r\n\r\n\tstopPrimaryBtnAnimation() {\r\n\t\tif (this.primaryBtn) this.primaryBtn.stopAnimation();\r\n\t}\r\n\r\n\thideButtons(...btnIdsToHide) {\r\n\t\tif (btnIdsToHide) {\r\n\t\t\tbtnIdsToHide.forEach(btnIdToHide => {\r\n\t\t\t\tif (this.buttons[btnIdToHide]?.element) {\r\n\t\t\t\t\tthis.buttons[btnIdToHide]?.element.classList.add(CLASSES.toolbarItem + '--inactive');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tshowButtons(...btnIdsToHide) {\r\n\t\tif (btnIdsToHide) {\r\n\t\t\tbtnIdsToHide.forEach(btnIdToHide => {\r\n\t\t\t\tif (this.buttons[btnIdToHide]?.element) {\r\n\t\t\t\t\tthis.buttons[btnIdToHide]?.element.classList.remove(CLASSES.toolbarItem + '--inactive');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tshowOnlyButton(btnIdToShowOnly) {\r\n\t\tObject.keys(this.buttons).forEach(btnId => {\r\n\t\t\tif (btnId !== btnIdToShowOnly && this.buttons[btnId]?.element) {\r\n\t\t\t\tthis.buttons[btnId].element.classList.add(CLASSES.toolbarItem + '--inactive');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\trender(activeOnLoad = true) {\r\n\t\tif (!this.wrapEl && this.insertAfterEl) {\r\n\t\t\tthis.wrapEl = document.createElement('div');\r\n\t\t\tthis.wrapEl.id = IDS.main;\r\n\t\t\tthis.wrapEl.className = classNames([CLASSES.rootWrap, 'ab-top-secondary ab-top-menu']);\r\n\t\t\tthis.renderButtons(this.wrapEl);\r\n\r\n\t\t\tthis.insertAfterEl.after(this.wrapEl);\r\n\t\t\t// animate slide left\r\n\t\t\tif (activeOnLoad) addEventListener('load', this.activate.bind(this));\r\n\t\t\telse setTimeout(() => { this.activate(); }, 100);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpropagateButtonClick(localId) {\r\n\t\tif (this.buttons[localId]?.sourceEl) {\r\n\t\t\tthis.buttons[localId].sourceEl.click();\r\n\t\t}\r\n\t}\r\n\r\n\tgetToolbarItemModifiedClass(buttonId) {\r\n\t\treturn CLASSES.toolbarItem + '--' + buttonId;\r\n\t}\r\n\r\n\r\n\tstoreButtonData(buttonId, sourceEl, duplicatedEl) {\r\n\t\tthis.buttons[buttonId] = {\r\n\t\t\telement: duplicatedEl,\r\n\t\t\tsourceEl: sourceEl\r\n\t\t};\r\n\t}\r\n\r\n\tanimateAndPropagateClick(buttonId, button, actionTitle = '') {\r\n\t\tif (button) button.startAnimation();\r\n\t\tthis.showOnlyButton(buttonId);\r\n\t\tthis.storeCurrentScrollTop();\r\n\t\tif (this.onRedirectBtnClick) this.onRedirectBtnClick(buttonId, actionTitle);\r\n\t\tif (!ANIM_DBG) this.propagateButtonClick(buttonId);\r\n\t}\r\n\r\n\tcheckUnsavedAnimateAndRedirectPropagateClick(buttonId, button, actionTitle = '') {\r\n\t\tif (!this.isUnsavedChange) {\r\n\t\t\tthis.animateAndPropagateClick(buttonId, button, actionTitle);\r\n\t\t} else {\r\n\t\t\tthis.storeCurrentScrollTop();\r\n\t\t\tthis.propagateButtonClick(buttonId);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\trenderButtons(wrapEl) {\r\n\t\t// primary button\r\n\t\tconst primaryButtonEl = document.querySelector('#wpbody-content .wrap input[type=\"submit\"].button-primary:not(.find-box input, .widget-control-save, #screen-options-wrap input, #bulk_edit)');\r\n\t\tif (primaryButtonEl) {\r\n\t\t\tthis.primaryBtn = new DpitMultiStateAnimBtn(\r\n\t\t\t\t(args) => this.animateAndPropagateClick(BTN_ID.primary, args?.button, this.config.i18n.storingChanges),\r\n\t\t\t\t{ 'default': primaryButtonEl.value },\r\n\t\t\t\t'default',\r\n\t\t\t\tCLASSES.button,\r\n\t\t\t\t[CLASSES.toolbarItem, CLASSES.buttonPrimary]\r\n\t\t\t);\r\n\t\t\tif (this.primaryBtn) {\r\n\t\t\t\tthis.storeButtonData(\r\n\t\t\t\t\tBTN_ID.primary,\r\n\t\t\t\t\tprimaryButtonEl,\r\n\t\t\t\t\tthis.primaryBtn.element\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// draft button\r\n\t\tconst draftButtonEl = $('#wpbody-content .wrap input[type=\"submit\"]#save-post:visible:not(.find-box input)').get(0); // jquery becaluse of :visible:not(.find-box input)\r\n\t\tif (draftButtonEl) {\r\n\t\t\tthis.draftBtn = new DpitMultiStateAnimBtn(\r\n\t\t\t\t(args) => this.animateAndPropagateClick(BTN_ID.draft, args?.button, this.config.i18n.storingChanges),\r\n\t\t\t\t{ 'default': draftButtonEl.value },\r\n\t\t\t\t'default',\r\n\t\t\t\tCLASSES.button,\r\n\t\t\t\t[CLASSES.toolbarItem, CLASSES.buttonSecondary]\r\n\t\t\t);\r\n\t\t\tif (this.draftBtn) {\r\n\t\t\t\tthis.storeButtonData(\r\n\t\t\t\t\tBTN_ID.draft,\r\n\t\t\t\t\tdraftButtonEl,\r\n\t\t\t\t\tthis.draftBtn.element\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.config.previewButtonEnabled) {\r\n\r\n\t\t\t// preview post button\r\n\t\t\tconst previewButtonEl = document.getElementById('post-preview');\r\n\t\t\tif (previewButtonEl) {\r\n\t\t\t\tlet label = '';\r\n\t\t\t\tfor (var i = 0; i < previewButtonEl.childNodes.length; ++i) {\r\n\t\t\t\t\tif (previewButtonEl.childNodes[i].nodeType === Node.TEXT_NODE) {\r\n\t\t\t\t\t\tlabel += previewButtonEl.childNodes[i].textContent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.previewBtn = new DpitMultiStateAnimBtn(\r\n\t\t\t\t\t() => this.propagateButtonClick(BTN_ID.preview),\r\n\t\t\t\t\t{ 'default': label },\r\n\t\t\t\t\t'default',\r\n\t\t\t\t\tCLASSES.button,\r\n\t\t\t\t\t[CLASSES.toolbarItem, CLASSES.buttonSecondary]\r\n\t\t\t\t);\r\n\t\t\t\tif (this.previewBtn) {\r\n\t\t\t\t\tthis.storeButtonData(\r\n\t\t\t\t\t\tBTN_ID.preview,\r\n\t\t\t\t\t\tpreviewButtonEl,\r\n\t\t\t\t\t\tthis.previewBtn.element\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// view post button\r\n\t\tconst viewPostButtonEl = document.querySelector('#wp-admin-bar-view a');\r\n\t\tif (viewPostButtonEl) {\r\n\t\t\tthis.viewBtn = new DpitMultiStateAnimBtn(\r\n\t\t\t\t(args) => this.checkUnsavedAnimateAndRedirectPropagateClick(BTN_ID.view, args?.button, this.config.i18n.redirecting),\r\n\t\t\t\t{ 'default': viewPostButtonEl.textContent },\r\n\t\t\t\t'default',\r\n\t\t\t\tCLASSES.button,\r\n\t\t\t\t[CLASSES.toolbarItem, CLASSES.buttonSecondary]\r\n\t\t\t);\r\n\t\t\tif (this.viewBtn) {\r\n\t\t\t\tthis.storeButtonData(\r\n\t\t\t\t\tBTN_ID.view,\r\n\t\t\t\t\tviewPostButtonEl,\r\n\t\t\t\t\tthis.viewBtn.element\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tObject.keys(this.buttons).forEach(btnId => {\r\n\t\t\tif (this.buttons[btnId]) {\r\n\t\t\t\twrapEl.appendChild(this.buttons[btnId].element);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\r\n\tclearCurrentScrollTopCookie() {\r\n\t\tdeleteCookie('dpit-admin-edit-st');\r\n\t}\r\n\r\n\tstoreCurrentScrollTop() {\r\n\t\tsetCookie('dpit-admin-edit-st', document.documentElement.scrollTop - getActualVisibleNoticesHeight(), 60);\r\n\t\tconsole.log('storeCurrentScrollTop');\r\n\t}\r\n\r\n\tscrollToStoredScrollTop(scrollTimeMs = 0) {\r\n\t\tconst storedScrollTopCookie = getCookie('dpit-admin-edit-st');\r\n\t\tif (storedScrollTopCookie) {\r\n\t\t\tlet storedScrollTop = parseInt(storedScrollTopCookie, 10);\r\n\t\t\tif (!isNaN(storedScrollTop)) {\r\n\t\t\t\tstoredScrollTop += getActualVisibleNoticesHeight();\r\n\t\t\t\tif (scrollTimeMs > 0) $(document.documentElement).animate({ scrollTop: storedScrollTop }, scrollTimeMs);\r\n\t\t\t\telse $(document.documentElement).scrollTop(storedScrollTop);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis.clearCurrentScrollTopCookie();\r\n\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n","import { hideElement, showElement } from './dpitHidden';\r\nimport { getNthStr, updateCssVar } from './dpitUtilsInc';\r\n\r\n\r\nconst MCE_FLOATING_PANELS_SELECTORS = '.mce-inline-toolbar-grp, .mce-floatpanel, #mce-modal-block, #wp-link-backdrop, #wp-link-wrap, #__wp-uploader-id-2, #mla-terms-search-overlay';\r\n\r\nexport default class DpTinyMceDialog {\r\n\tconstructor(config, onTmceSaved, onTmceCancel, dpDebugEn) {\r\n\t\tthis.config = config;\r\n\t\tthis.onTmceCancel = onTmceCancel;\r\n\t\tif (dpDebugEn) console.log('[dpit] INIT DpTinyMceDialog');\r\n\t\t$('#dp-step-content-edit .button-primary').on('click', () => {\r\n\t\t\tif (onTmceSaved) {\r\n\t\t\t\t$('#dp-tmce-editor-tmce').trigger('click');\r\n\t\t\t\tlet htmlContent = window.tinyMCE.activeEditor.getContent();\r\n\t\t\t\thtmlContent = this.forceTargetBlank(htmlContent);\r\n\t\t\t\thtmlContent = htmlContent.replace(/<a(?! target=\"_blank\")/g, '<a target=\"_blank\"');\r\n\t\t\t\tonTmceSaved(this.target, htmlContent);\r\n\r\n\t\t\t\tthis.close(false);\r\n\t\t\t\t/*\r\n\t\t\t\tif (!this.containsShortCode(htmlContent)) {\r\n\t\t\t\t\tonTmceSaved(this.target, htmlContent);\r\n\t\t\t\t\tthis.close(false);\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// ajax\r\n\t\t\t\t}*/\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.close(false);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#dpit-mce-dialog-close, #dp-step-content-edit__backdrop').on('click', () => {\r\n\t\t\tthis.close();\r\n\t\t});\r\n\t\tdocument.addEventListener('keydown', this.keydown.bind(this));\r\n\t}\r\n\r\n\tforceTargetBlank(htmlContent) {\r\n\r\n\t\treturn htmlContent;\r\n\t}\r\n\r\n\tcontainsShortCode(htmlContent) {\r\n\t\tif (!htmlContent) return false;\r\n\t\tconst shortCodes = htmlContent.match(/\\[[^[]*[^\\]]*\\]/ig);\r\n\t\treturn shortCodes ? shortCodes.length > 0 : false;\r\n\t}\r\n\r\n\tkeydown(event) {\r\n\r\n\t\t// Escape key.\r\n\t\tif (this.modalOpened && event.keyCode === 27) {\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tshowOverlay() {\r\n\t\t$('#dp-step-content-edit__backdrop').addClass('dpit-active');\r\n\t}\r\n\r\n\thideOverlay() {\r\n\t\t$('#dp-step-content-edit__backdrop').removeClass('dpit-active');\r\n\t}\r\n\r\n\topen(target, data, stepIdxOneBased) {\r\n\t\tthis.modalOpened = true;\r\n\t\tif (stepIdxOneBased !== false && !isNaN(stepIdxOneBased)) {\r\n\t\t\tconst step = getNthStr(stepIdxOneBased);\r\n\t\t\t$('#dp-step-content-edit .dpit-modal__title').html(this.config.title.replace('%s', step));\r\n\t\t}\r\n\r\n\t\t$('#dp-step-content-edit').addClass('dpit-active');\r\n\t\tthis.showOverlay();\r\n\t\tthis.hadDpitRelPos = $('body').hasClass('dpit-relative-position');\r\n\t\tif (this.hadDpitRelPos) {\r\n\t\t\t$('body').removeClass('dpit-relative-position');\r\n\t\t}\r\n\t\tupdateCssVar('--dpit-scroll-top', (document.documentElement.scrollTop || document.body.scrollTop) + 'px');\r\n\t\t$('body').addClass('dpit-no-scroll');\r\n\r\n\t\tthis.target = target;\r\n\t\t$('#dp-tmce-editor-tmce').trigger('click');\r\n\t\tthis.editor = window.tinyMCE.get('dp-tmce-editor');\r\n\t\tthis.editor.setContent(data ?? '', { format: 'html' });\r\n\t\tif (this.editor.selection) {\r\n\t\t\tthis.editor.selection.select(this.editor.getBody(), true);\r\n\t\t\tthis.editor.selection.collapse(false);\r\n\t\t}\r\n\t\tthis.enableMceFloatPanels();\r\n\t\tthis.editor.focus();\r\n\t}\r\n\r\n\r\n\r\n\tenableMceFloatPanels() {\r\n\t\t$(MCE_FLOATING_PANELS_SELECTORS).each((_, element) => {\r\n\t\t\tshowElement(element);\r\n\t\t});\r\n\t}\r\n\tdisableMceFloatPanels() {\r\n\t\t$(MCE_FLOATING_PANELS_SELECTORS).each((_, element) => {\r\n\t\t\thideElement(element);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\tclose(wasCanceled = true) {\r\n\t\tthis.target = null;\r\n\t\tthis.modalOpened = false;\r\n\t\tthis.disableMceFloatPanels();\r\n\r\n\t\t$('#dp-step-content-edit').removeClass('dpit-active');\r\n\t\tthis.hideOverlay();\r\n\t\t$('body').removeClass('dpit-no-scroll');\r\n\t\tif (wasCanceled && this.onTmceCancel) this.onTmceCancel();\r\n\t\tif (this.hadDpitRelPos) {\r\n\t\t\t$('body').addClass('dpit-relative-position');\r\n\t\t}\r\n\t}\r\n}","\r\nexport default class DpWpLinkQuery {\r\n\tconstructor(search, config) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT DpWpLinkQuery');\r\n\t\tthis.config = config;\r\n\t\tthis.page = 1;\r\n\t\tthis.allLoaded = false;\r\n\t\tthis.querying = false;\r\n\t\tthis.search = search;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit() {\r\n\t\t$.extend(DpWpLinkQuery.prototype, {\r\n\t\t\tready() {\r\n\t\t\t\treturn !(this.querying || this.allLoaded);\r\n\t\t\t},\r\n\t\t\tajax(callback) {\r\n\t\t\t\tconst self = this;\r\n\t\t\t\tconst query = {\r\n\t\t\t\t\taction: 'dp-wp-link-ajax',\r\n\t\t\t\t\tpage: this.page,\r\n\t\t\t\t\t_dp_wplink_nonce: this.config._dp_wplink_nonce,\r\n\t\t\t\t};\r\n\t\t\t\tif (this.search) query.search = this.search;\r\n\r\n\t\t\t\tthis.querying = true;\r\n\r\n\t\t\t\t$.post(this.config.ajaxUrl, query, (r) => {\r\n\t\t\t\t\tself.page++;\r\n\t\t\t\t\tself.querying = false;\r\n\t\t\t\t\tself.allLoaded = !r;\r\n\t\t\t\t\tcallback(r, query);\r\n\t\t\t\t}, 'json');\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}","\r\nimport DpWpLinkQuery from './DpWpLinkQuery';\r\n\r\n\r\n\r\n\r\nexport default class DpWpLinkRiver {\r\n\ttimeToTriggerRiver = 150;\r\n\tminRiverAJAXDuration = 200;\r\n\triverBottomThreshold = 5;\r\n\tposts = {};\r\n\r\n\tconstructor(element, dpWpLink) {\r\n\t\tif (dpWpLink.config.dpDebugEn) console.log('[dpit] INIT DpWpLinkRiver');\r\n\t\tthis.dpWpLink = dpWpLink;\r\n\t\tthis.config = dpWpLink.config;\r\n\t\tthis.element = element;\r\n\t\tthis.ul = element.children('ul');\r\n\t\tthis.contentHeight = element.children('#dp_link-selector-height');\r\n\t\tthis.waiting = element.find('.river-waiting');\r\n\t\tthis.init();\r\n\t}\r\n\r\n\r\n\tdelayedCallback(func, delay) {\r\n\t\tlet timeoutTriggered; let funcTriggered; let funcArgs; let\r\n\t\t\tfuncContext;\r\n\r\n\t\tif (!delay) return func;\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (funcTriggered) return func.apply(funcContext, funcArgs);\r\n\t\t\t// Otherwise, wait.\r\n\t\t\ttimeoutTriggered = true;\r\n\t\t}, delay);\r\n\r\n\t\treturn function () {\r\n\t\t\tif (timeoutTriggered) return func.apply(this, arguments);\r\n\t\t\t// Otherwise, wait.\r\n\t\t\tfuncArgs = arguments;\r\n\t\t\tfuncContext = this;\r\n\t\t\tfuncTriggered = true;\r\n\t\t};\r\n\t}\r\n\r\n\r\n\tinit() {\r\n\r\n\t\t$.extend(DpWpLinkRiver.prototype, {\r\n\t\t\tposts: {},\r\n\t\t\trefresh() {\r\n\t\t\t\tthis.deselect();\r\n\t\t\t\tthis.visible = this.element.is(':visible');\r\n\t\t\t},\r\n\t\t\tshow() {\r\n\t\t\t\tif (!this.visible) {\r\n\t\t\t\t\tthis.deselect();\r\n\t\t\t\t\tthis.element.show();\r\n\t\t\t\t\tthis.visible = true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\thide() {\r\n\t\t\t\tthis.element.hide();\r\n\t\t\t\tthis.visible = false;\r\n\t\t\t},\r\n\t\t\t// Selects a list item and triggers the river-select event.\r\n\t\t\tselect(li, event) {\r\n\t\t\t\tlet liHeight; let elHeight; let liTop; let\r\n\t\t\t\t\telTop;\r\n\r\n\t\t\t\tif (li.hasClass('unselectable') || li == this.selected) return;\r\n\r\n\t\t\t\tthis.deselect();\r\n\t\t\t\tthis.selected = li.addClass('selected');\r\n\t\t\t\t// Make sure the element is visible.\r\n\t\t\t\tliHeight = li.outerHeight();\r\n\t\t\t\telHeight = this.element.height();\r\n\t\t\t\tliTop = li.position().top;\r\n\t\t\t\telTop = this.element.scrollTop();\r\n\r\n\t\t\t\tif (liTop < 0) // Make first visible element.\r\n\t\t\t\t{ this.element.scrollTop(elTop + liTop); } else if (liTop + liHeight > elHeight) // Make last visible element.\r\n\t\t\t\t{ this.element.scrollTop(elTop + liTop - elHeight + liHeight); }\r\n\r\n\t\t\t\t// Trigger the river-select event.\r\n\t\t\t\tthis.element.trigger('river-select', [li, event, this]);\r\n\t\t\t},\r\n\t\t\tdeselect() {\r\n\t\t\t\tif (this.selected) this.selected.removeClass('selected');\r\n\t\t\t\tthis.selected = false;\r\n\t\t\t},\r\n\t\t\tprev() {\r\n\t\t\t\tif (!this.visible) return;\r\n\r\n\t\t\t\tlet to;\r\n\t\t\t\tif (this.selected) {\r\n\t\t\t\t\tto = this.selected.prev('li');\r\n\t\t\t\t\tif (to.length) this.select(to);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnext() {\r\n\t\t\t\tif (!this.visible) return;\r\n\r\n\t\t\t\tconst to = this.selected ? this.selected.next('li') : $('li:not(.unselectable):first', this.element);\r\n\t\t\t\tif (to.length) this.select(to);\r\n\t\t\t},\r\n\t\t\tajax(callback) {\r\n\t\t\t\tconst self = this;\r\n\t\t\t\tconst delay = this.query && this.query.page == 1 ? 0 : this.minRiverAJAXDuration;\r\n\t\t\t\tconst waiting = this.dpWpLink.inputs.search.parent().find('.spinner').addClass('is-active');\r\n\t\t\t\tconst response = this.delayedCallback((results, params) => {\r\n\t\t\t\t\tself.process(results, params);\r\n\t\t\t\t\twaiting.removeClass('is-active');\r\n\t\t\t\t\tif (callback) callback(results, params);\r\n\t\t\t\t}, delay);\r\n\t\t\t\tif (this.query) this.query.ajax(response);\r\n\t\t\t},\r\n\t\t\tchange(search) {\r\n\t\t\t\tif (this.query && this._search == search) return;\r\n\t\t\t\tthis.posts = {};\r\n\t\t\t\tthis._search = search;\r\n\t\t\t\tthis.query = new DpWpLinkQuery(search, this.config);\r\n\t\t\t\tthis.element.scrollTop(0);\r\n\t\t\t},\r\n\t\t\tprocess(results, params) {\r\n\t\t\t\tlet list = ''; let alt = true;\r\n\t\t\t\tconst firstPage = params.page == 1;\r\n\r\n\t\t\t\tif (!results) {\r\n\t\t\t\t\tif (firstPage) {\r\n\t\t\t\t\t\tlist += `<li class=\"unselectable no-matches-found\"><span class=\"item-title\"><em>${this.config.noMatchesFound}</em></span></li>`;\r\n\t\t\t\t\t\tthis.ul.html(list);\r\n\t\t\t\t\t} else this.ul.append(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst addClass = (!this.dpWpLink.isFirstStep) ? 'dpit-special-link' : 'dpit-special-link dpit-special-link--hidden';\r\n\t\t\t\t\tlist += this.printPostTypeItem({\r\n\t\t\t\t\t\ttitle: this.config.keepPreviousStepUrl,\r\n\t\t\t\t\t\tpermalink: '$keep-prev-step-url',\r\n\t\t\t\t\t\tinfo: this.config.variableLink,\r\n\t\t\t\t\t\tinfoLong: this.config.keepPreviousStepUrlLngInfo,\r\n\t\t\t\t\t}, true, addClass);\r\n\t\t\t\t\tlist += this.printPostTypeItem({\r\n\t\t\t\t\t\ttitle: this.config.keepCurrentUrl,\r\n\t\t\t\t\t\tpermalink: '$keep-current-url',\r\n\t\t\t\t\t\tinfo: this.config.variableLink,\r\n\t\t\t\t\t\tinfoLong: this.config.keepCurrentUrlLngInfo,\r\n\t\t\t\t\t}, true, addClass);\r\n\r\n\t\t\t\t\tconst posts = {};\r\n\t\t\t\t\tconst allowedPostTypes = this.config.allowedPostTypesInPagePostURL;\r\n\t\t\t\t\tconst loadAllPostTypes = allowedPostTypes.includes('all_post_types');\r\n\t\t\t\t\t$.each(results, function () {\r\n\t\t\t\t\t\tif (this.info) {\r\n\t\t\t\t\t\t\tlet type = this.info.toLowerCase();\r\n\t\t\t\t\t\t\tconst isPost = !isNaN(parseInt(type[0]));\r\n\t\t\t\t\t\t\tif (isPost) type = 'post';\r\n\t\t\t\t\t\t\tconst isAllowed = allowedPostTypes.includes(type);\r\n\t\t\t\t\t\t\tif (isAllowed || loadAllPostTypes) {\r\n\t\t\t\t\t\t\t\tif (!posts[type]) posts[type] = [];\r\n\t\t\t\t\t\t\t\tposts[type].push(this);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tObject.keys(posts).forEach((type) => {\r\n\t\t\t\t\t\tif (this.posts[type]) this.posts[type] = [...posts[type], ...this.posts[type]];\r\n\t\t\t\t\t\telse this.posts[type] = posts[type];\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tallowedPostTypes.forEach((type) => {\r\n\t\t\t\t\t\tif (type !== 'all_post_types') {\r\n\t\t\t\t\t\t\tif (this.posts[type]) {\r\n\t\t\t\t\t\t\t\tthis.posts[type].forEach((item) => {\r\n\t\t\t\t\t\t\t\t\tlist += this.printPostTypeItem(item, alt);\r\n\t\t\t\t\t\t\t\t\talt = !alt;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tObject.keys(this.posts).forEach((type) => {\r\n\t\t\t\t\t\t\t\tif (!allowedPostTypes.includes(type) && !this.config.disabledPostTypes.includes(type)) {\r\n\t\t\t\t\t\t\t\t\tthis.posts[type].forEach((item) => {\r\n\t\t\t\t\t\t\t\t\t\tlist += this.printPostTypeItem(item, alt);\r\n\t\t\t\t\t\t\t\t\t\talt = !alt;\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tthis.ul.html(list);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tprintPostTypeItem(item, alt, additionalClass = null) {\r\n\t\t\t\tlet res = '';\r\n\t\t\t\tlet classes = [];\r\n\t\t\t\tif (alt) classes.push('alternate');\r\n\t\t\t\tif (additionalClass) classes.push(additionalClass);\r\n\t\t\t\tif (!item.title) classes.push('no-title');\r\n\r\n\t\t\t\tlet { permalink } = item;\r\n\r\n\t\t\t\tif (this.config.siteUrl && !permalink.startsWith(this.config.siteUrl)) {\r\n\t\t\t\t\t// not regenerated permalinks (eg. local host debug with port 3000)\r\n\t\t\t\t\tconst urlParts = new URL(this.config.siteUrl);\r\n\t\t\t\t\turlParts.port = ''; // set port to empty string\r\n\t\t\t\t\tconst startUrlNoPort = urlParts.toString().replace(/^\\/+|\\/+$/g, '');\r\n\t\t\t\t\tif (permalink.startsWith(startUrlNoPort)) {\r\n\t\t\t\t\t\tpermalink = permalink.replace(startUrlNoPort, this.config.siteUrl);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclasses = classes.join(' ');\r\n\r\n\t\t\t\tres += classes ? `<li class=\"${classes}\">` : '<li>';\r\n\t\t\t\tres += `<input type=\"hidden\" class=\"item-permalink\" value=\"${permalink}\" />`;\r\n\t\t\t\tres += '<span class=\"item-title\">';\r\n\t\t\t\tres += item.title ? item.title : this.config.noTitle;\r\n\t\t\t\tres += '</span>';\r\n\t\t\t\tres += `<span class=\"item-info\">${item.info}</span>`;\r\n\t\t\t\tif (item.infoLong) {\r\n\t\t\t\t\tres += `<div class=\"item-long-info\">${item.infoLong}</div>`;\r\n\t\t\t\t}\r\n\t\t\t\tres += '</li>';\r\n\t\t\t\treturn res;\r\n\t\t\t},\r\n\t\t\tmaybeLoad() {\r\n\t\t\t\tconst self = this;\r\n\t\t\t\tconst el = this.element;\r\n\t\t\t\tconst bottom = el.scrollTop() + el.height();\r\n\r\n\t\t\t\tif (!this.query.ready() || bottom < this.contentHeight.height() - this.riverBottomThreshold) return;\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tconst newTop = el.scrollTop();\r\n\t\t\t\t\tconst newBottom = newTop + el.height();\r\n\r\n\t\t\t\t\tif (!self.query.ready() || newBottom < self.contentHeight.height() - this.riverBottomThreshold) return;\r\n\r\n\t\t\t\t\tself.waiting.addClass('is-active');\r\n\t\t\t\t\tel.scrollTop(newTop + self.waiting.outerHeight());\r\n\r\n\t\t\t\t\tself.ajax(() => {\r\n\t\t\t\t\t\tself.waiting.removeClass('is-active');\r\n\t\t\t\t\t});\r\n\t\t\t\t}, this.timeToTriggerRiver);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.refresh();\r\n\r\n\t\t$('#dp_wp-link .query-results, #dp_wp-link #dp_link-selector').scroll(this.maybeLoad.bind(this));\r\n\t\tthis.element.on('click', 'li', (event) => {\r\n\t\t\tthis.select($(event.target).closest('li'), event);\r\n\t\t});\r\n\r\n\t\tthis.change('');\r\n\t}\r\n\r\n\r\n}","import classNames from 'classnames';\r\nimport tippy from 'tippy.js';\r\nimport 'tippy.js/dist/tippy.css';\r\nimport urlJoin from 'url-join';\r\nimport 'tippy.js/themes/material.css';\r\nimport 'tippy.js/themes/light-border.css';\r\nimport 'tippy.js/animations/scale.css';\r\nimport {\r\n\tunifyUrl,\r\n\tgetNthStr,\r\n\tupdateCssVar,\r\n\tisUrlAtOurSite\r\n} from './dpitUtilsInc';\r\nimport DpWpLinkRiver from './DpWpLinkRiver';\r\n\r\nexport default class DpWpLink {\r\n\r\n\r\n\tkeySensitivity = 200;\r\n\tlastSearch = '';\r\n\tmodalOpen = false;\r\n\r\n\tstartScrollTop = 0;\r\n\tinputs = {};\r\n\trivers = {};\r\n\r\n\tconstructor(config) {\r\n\t\tif (config.dpDebugEn) console.log('[dpit] INIT DpWpLink');\r\n\t\tthis.config = config;\r\n\t\tthis.unifiedSiteUrl = unifyUrl(config.siteUrl, true, true, true, true);\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit() {\r\n\r\n\t\tthis.inputs.wrap = $('#dp_wp-link-wrap');\r\n\t\tthis.inputs.dialog = $('#dp_wp-link');\r\n\t\tthis.inputs.backdrop = $('#dp_wp-link-backdrop');\r\n\t\tthis.inputs.submit = $('#dp_wp-link-submit');\r\n\t\tthis.urlVarButton = $('#dpit-url-var-btn');\r\n\t\tthis.urlVarBackButton = $('#dpit-url-var-back-btn');\r\n\r\n\t\t// Input.\r\n\t\tthis.inputs.text = $('#wp-link-text');\r\n\t\tthis.inputs.url = $('#dp_wp-link-url');\r\n\t\tthis.inputs.nonce = $('#_ajax_linking_nonce');\r\n\t\tthis.inputs.search = $('#dp_wp-link-search');\r\n\t\tthis.inputs.search.focus();\r\n\r\n\t\t// Build rivers.\r\n\t\tthis.rivers.search = new DpWpLinkRiver($('#dp_search-results'), this);\r\n\t\tthis.rivers.recent = new DpWpLinkRiver($('#dp_most-recent-results'), this);\r\n\t\tthis.rivers.elements = this.inputs.dialog.find('.query-results');\r\n\r\n\t\t// Get search notice text.\r\n\t\tthis.inputs.queryNotice = $('#query-notice-message');\r\n\t\tthis.inputs.queryNoticeTextDefault = this.inputs.queryNotice.find('.query-notice-default');\r\n\t\tthis.inputs.queryNoticeTextHint = this.inputs.queryNotice.find('.query-notice-hint');\r\n\r\n\t\t// Bind event handlers.\r\n\t\tthis.inputs.dialog.keydown(this.keydown.bind(this));\r\n\t\tthis.inputs.dialog.keyup(this.keyup.bind(this));\r\n\t\tthis.inputs.submit.click((event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.update();\r\n\t\t});\r\n\r\n\t\tthis.inputs.backdrop.add('#dpit-wp-link-cancel').click((event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.close();\r\n\t\t});\r\n\r\n\t\tthis.rivers.elements.on('river-select', this.updateFields.bind(this));\r\n\r\n\t\t// Display 'hint' message when search field or 'query-results' box are focused.\r\n\t\tthis.inputs.search.on('focus.this', () => {\r\n\t\t\tthis.inputs.queryNoticeTextDefault.hide();\r\n\t\t\tthis.inputs.queryNoticeTextHint.removeClass('screen-reader-text').show();\r\n\t\t}).on('blur.this', () => {\r\n\t\t\tthis.inputs.queryNoticeTextDefault.show();\r\n\t\t\tthis.inputs.queryNoticeTextHint.addClass('screen-reader-text').hide();\r\n\t\t});\r\n\r\n\t\tthis.inputs.search.on('keyup input', () => {\r\n\t\t\twindow.clearTimeout(this.searchTimer);\r\n\t\t\tthis.searchTimer = window.setTimeout(() => {\r\n\t\t\t\tthis.searchInternalLinks();\r\n\t\t\t}, 500);\r\n\t\t});\r\n\r\n\t\tthis.inputs.url.on('input', () => {\r\n\t\t\tthis.updateAfterUrlChanged(true);\r\n\t\t});\r\n\r\n\t\tthis.inputs.url.on('paste', () => {\r\n\t\t\tsetTimeout(this.correctURL.bind(this), 0);\r\n\t\t});\r\n\r\n\t\tthis.inputs.url.on('blur', () => { this.correctURL(false); });\r\n\r\n\r\n\t\tif (this.config.loadTippy === true) {\r\n\t\t\t$('.dpit-info-icon').load(urlJoin(this.config.assetsUrl, 'icons/info-circle-solid.svg'));\r\n\t\t\t$('.dpit-info-icon').each((idx, element) => {\r\n\t\t\t\tconst interactive = $(element).hasClass('dpit-info-icon--ia');\r\n\t\t\t\tconst theme = $(element).hasClass('dpit-info-icon--modal') ? 'light-border' : 'material';\r\n\t\t\t\ttippy(element, {\r\n\t\t\t\t\tcontent: (reference) => reference.getAttribute('data-info-text'),\r\n\t\t\t\t\tanimation: 'scale',\r\n\t\t\t\t\ttheme: theme,\r\n\t\t\t\t\tallowHTML: true,\r\n\t\t\t\t\tinteractive,\r\n\t\t\t\t\tzIndex: 100000003,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.inputs.url.on('blur', () => { this.correctURL(false); });\r\n\r\n\t\tthis.urlVarButton.on('click', () => {\r\n\t\t\tthis.correctURL(false);\r\n\t\t\tconst currentUrl = this.inputs.url.val();\r\n\t\t\tif (!this.isVariableTypingInProcess(currentUrl)) {\r\n\t\t\t\tthis.inputs.url.val(currentUrl + '{');\r\n\t\t\t\tthis.updateVariableUrlsGUI(false);\r\n\t\t\t\tthis.inputs.url.focus();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.urlVarBackButton.on('click', () => {\r\n\t\t\tthis.cancelVariableTypingInProcess();\r\n\t\t\tthis.updateVariableUrlsGUI(false);\r\n\t\t});\r\n\r\n\r\n\r\n\r\n\t\tthis.updateAfterUrlChanged();\r\n\t}\r\n\r\n\tsanitizeUrl(url, removeTrailingSlashes = false) {\r\n\t\tif (!url.startsWith('$')) {\r\n\t\t\tlet regExp = /^\\/+|\\/+$/g;\r\n\t\t\tif (!removeTrailingSlashes) {\r\n\t\t\t\tregExp = /^\\/+/g;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('/')) {\r\n\t\t\t\t// check multiple leading slashes\r\n\t\t\t\turl = `/${url.replace(regExp, '')}`;\r\n\t\t\t}\r\n\t\t\tconst isAbsolute = /^((http|https|ftp):\\/\\/)/.test(url) || url.startsWith('www.');\r\n\r\n\r\n\t\t\tif (isAbsolute && !isUrlAtOurSite(url, this.config.siteUrl)) {\r\n\t\t\t\treturn url;\r\n\t\t\t}\r\n\t\t\turl = unifyUrl(url, false, true, removeTrailingSlashes, true);\r\n\t\t\t// is absolute starting with site url?\r\n\t\t\tif (url.startsWith(this.unifiedSiteUrl)) {\r\n\t\t\t\turl = url.replace(this.unifiedSiteUrl, '');\r\n\t\t\t\tif (!url) url = '/';\r\n\t\t\t} else {\r\n\t\t\t\t// is not absolute?\r\n\t\t\t\tif (!isAbsolute) {\r\n\t\t\t\t\t// is relative without leading slash\r\n\t\t\t\t\turl = `/${url.replace(regExp, '')}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\r\n\tactivateSubmitButtonSpinner(activate = true) {\r\n\t\tif (activate) {\r\n\t\t\t$('#dp_wp-link-update .spinner').addClass('is-active');\r\n\t\t\t// $('#dp_wp-link-update #dp_wp-link-submit').fadeOut(700);\r\n\t\t\t$('.dp_wp-link-wrap').addClass('no-pointer-events');\r\n\t\t\t$('#dp_wp-link-update #dp_wp-link-submit').addClass('spinner-bg');\r\n\t\t} else {\r\n\t\t\t$('#dp_wp-link-update .spinner').removeClass('is-active');\r\n\t\t\t$('#dp_wp-link-update #dp_wp-link-submit').removeClass('spinner-bg');\r\n\t\t\t$('.dp_wp-link-wrap').removeClass('no-pointer-events');\r\n\t\t\t// $('#dp_wp-link-update #dp_wp-link-submit').fadeIn(700);\r\n\t\t}\r\n\t}\r\n\r\n\t// If URL wasn't corrected last time and doesn't start with http:, https:, ? # or /, prepend site url.\r\n\tcorrectURL(removeTrailingSlashes = false) {\r\n\t\tconst url = $.trim(this.inputs.url.val());\r\n\t\tif (url/* && this.correctedURL !== url*/) {\r\n\t\t\tconst sanitizedUrl = this.sanitizeUrl(url, removeTrailingSlashes);\r\n\t\t\tthis.inputs.url.val(sanitizedUrl);\r\n\t\t\tthis.correctedURL = sanitizedUrl;\r\n\t\t}\r\n\t\tthis.updateAfterUrlChanged();\r\n\t}\r\n\r\n\tshowOverlay() {\r\n\t\tthis.inputs.backdrop.addClass('dpit-active');\r\n\t}\r\n\r\n\thideOverlay() {\r\n\t\tthis.inputs.backdrop.removeClass('dpit-active');\r\n\t}\r\n\r\n\topen(url, text, openHidden = false, closeAfterSubmit = true, stepIdxOneBased = false, enableUrlVarExamples = false, urlVarExamples = null, sysUrlVars = null, jSubEl = null) {\r\n\t\tthis.closeAfterSubmit = closeAfterSubmit;\r\n\t\tthis.isFirstStep = stepIdxOneBased === 1;\r\n\t\tthis.enableUrlVarExamples = enableUrlVarExamples;\r\n\t\tthis.sysUrlVars = sysUrlVars;\r\n\t\tthis.jSubEl = jSubEl;\r\n\r\n\t\tif (stepIdxOneBased !== false && !isNaN(stepIdxOneBased)) {\r\n\t\t\tlet step = getNthStr(stepIdxOneBased);\r\n\t\t\t$('#dpit-wp-link-title').html(this.config.title.replace('%s', step));\r\n\t\t}\r\n\r\n\t\tthis.startScrollTop = document?.documentElement?.scrollTop ?? document?.body?.scrollTop ?? 0;\r\n\r\n\t\tthis.modalOpen = true;\r\n\r\n\t\tif (openHidden) {\r\n\t\t\tthis.inputs.wrap.removeClass('dpit-active');\r\n\t\t\tthis.hideOverlay();\r\n\r\n\r\n\t\t} else {\r\n\t\t\tthis.inputs.wrap.addClass('dpit-active');\r\n\t\t\tthis.showOverlay();\r\n\t\t\tupdateCssVar('--dpit-scroll-top', - ($('body #wpbody-content').offset()?.top) + 'px');\r\n\t\t\t$('body').addClass('dpit-no-scroll');\r\n\t\t}\r\n\r\n\t\tif (!this.isFirstStep) {\r\n\t\t\tthis.urlVars = {};\r\n\t\t\tif (urlVarExamples) {\r\n\t\t\t\tvar sysUrlVarsTmp = sysUrlVars || {};\r\n\t\t\t\tObject.keys(urlVarExamples).forEach((key) => {\r\n\t\t\t\t\tif (!(key in sysUrlVarsTmp)) {\r\n\t\t\t\t\t\tthis.urlVars[key] = urlVarExamples[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// this.urlVars = urlVarExamples;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.refresh(url, text);\r\n\t\tif (urlVarExamples) {\r\n\t\t\tthis.setUrlExamples(urlVarExamples);\r\n\t\t}\r\n\r\n\t\tif (!this.isFirstStep) {\r\n\t\t\t$('.dpit-special-link').removeClass('dpit-special-link--hidden');\r\n\t\t\t$('#dpwplink-url-vars-1st-step').hide();\r\n\t\t\t$('#dpwplink-url-vars-other-step').show();\r\n\t\t} else {\r\n\t\t\t$('.dpit-special-link').addClass('dpit-special-link--hidden');\r\n\t\t\t$('#dpwplink-url-vars-1st-step').show();\r\n\t\t\t$('#dpwplink-url-vars-other-step').hide();\r\n\t\t}\r\n\t\t$(document).trigger('wplink-open', this.inputs.wrap);\r\n\r\n\r\n\t}\r\n\r\n\trefresh(url, text) {\r\n\t\t// Refresh rivers (clear links, check visibility).\r\n\t\tthis.rivers.search.refresh();\r\n\t\tthis.rivers.recent.refresh();\r\n\r\n\t\t// For the Text editor the \"Link text\" field is always shown.\r\n\t\tif (!this.inputs.wrap.hasClass('has-text-field')) {\r\n\t\t\tthis.inputs.wrap.addClass('has-text-field');\r\n\t\t}\r\n\r\n\t\tthis.inputs.text.val(text);\r\n\t\tthis.setDefaultValues();\r\n\t\tif (url) {\r\n\t\t\tthis.inputs.url.val(url);\r\n\t\t}\r\n\r\n\t\twindow.setTimeout(() => {\r\n\t\t\tif (this.inputs.search && this.inputs.search.length) {\r\n\t\t\t\tthis.inputs.search[0].select();\r\n\t\t\t\tthis.inputs.search.focus();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Load the most recent results if this is the first time opening the panel.\r\n\t\tif (!this.rivers.recent.ul.children().length) {\r\n\t\t\tthis.rivers.recent.ajax();\r\n\t\t}\r\n\t\tvar val = this.inputs.url.val();\r\n\t\tthis.correctedURL = val ? this.inputs.url.val().replace(/^http:\\/\\//, '') : '';\r\n\t\tthis.updateAfterUrlChanged();\r\n\t}\r\n\r\n\tclose(wasSubmited = false, force = false) {\r\n\t\tif (!wasSubmited || this.closeAfterSubmit || force) {\r\n\t\t\tthis.activateSubmitButtonSpinner(false);\r\n\t\t\tdocument.documentElement.scrollTop = this.startScrollTop;\r\n\t\t\t$('body').removeClass('dpit-no-scroll');\r\n\t\t\t// $( document.body ).removeClass( 'modal-open' );\r\n\t\t\tthis.modalOpen = false;\r\n\r\n\t\t\tthis.inputs.backdrop.removeClass('dpit-active');\r\n\t\t\tthis.inputs.wrap.removeClass('dpit-active');\r\n\r\n\t\t\tthis.correctedURL = false;\r\n\r\n\t\t\t$(document).trigger('wplink-close', this.inputs.wrap);\r\n\t\t}\r\n\t}\r\n\r\n\tgetAttrs() {\r\n\t\tthis.correctURL(true);\r\n\t\treturn {\r\n\t\t\thref: $.trim(this.inputs.url.val()),\r\n\t\t\turlVarExamples: this.getUrlExamples(),\r\n\t\t\tjSubEl: this.jSubEl,\r\n\t\t\tisFirstStep: this.isFirstStep\r\n\t\t};\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tthis.htmlUpdate();\r\n\t}\r\n\r\n\thtmlUpdate() {\r\n\t\tlet attrs;\r\n\t\tattrs = this.getAttrs();\r\n\t\tconst parser = document.createElement('a');\r\n\t\tparser.href = attrs.href;\r\n\r\n\t\tif (parser.protocol === 'javascript:' || parser.protocol === 'data:') { // jshint ignore:line\r\n\t\t\tattrs.href = '';\r\n\t\t}\r\n\r\n\t\t// If there's no href, return.\r\n\t\tif (!attrs.href) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.close(true);\r\n\t}\r\n\tupdateSubmitButton() {\r\n\t\tif (!this.inputs.url.val()) $('#dp_wp-link-submit').addClass('disabled');\r\n\t\telse $('#dp_wp-link-submit').removeClass('disabled');\r\n\t}\r\n\tupdateVariableUrlsGUI(isOnTypingEvent) {\r\n\t\tconst url = this.inputs.url.val();\r\n\t\tif (this.isVariableTypingInProcess(url)) {\r\n\t\t\tthis.urlVarButton.hide();\r\n\t\t\tthis.urlVarBackButton.show();\r\n\t\t} else {\r\n\t\t\tthis.urlVarButton.show();\r\n\t\t\tthis.urlVarBackButton.hide();\r\n\t\t}\r\n\t\tif (this.isVariableUrl(url, true) && this.enableUrlVarExamples) {\r\n\t\t\t$('#search-panel,#wplink-link-existing-content').addClass('dpwplink-inactive-el');\r\n\t\t\t$('#dpwplink-url-vars-wrap').removeClass('dpwplink-inactive-el');\r\n\r\n\t\t\tif (isOnTypingEvent) {\r\n\t\t\t\tif (this.renderUrlVarExTimeout) clearTimeout(this.renderUrlVarExTimeout);\r\n\t\t\t\tthis.renderUrlVarExTimeout = setTimeout(() => {\r\n\t\t\t\t\tthis.renderUrlVarItems(url, this.isFirstStep);\r\n\t\t\t\t}, 10);\r\n\t\t\t} else {\r\n\t\t\t\tthis.renderUrlVarItems(url, this.isFirstStep);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.isFirstStep && this.isVariableUrl(url)) {\r\n\t\t\t\tthis.nonActiveUrlVarExamples = {};\r\n\t\t\t\tconst varIds = this.getUrlVarIdsFromUrl(url);\r\n\t\t\t\tif (varIds && varIds.length) {\r\n\t\t\t\t\tvarIds.forEach((id) => {\r\n\t\t\t\t\t\tthis.nonActiveUrlVarExamples[id] = '';\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$('#dpwplink-url-vars-wrap').addClass('dpwplink-inactive-el');\r\n\t\t\t$('#search-panel,#wplink-link-existing-content').removeClass('dpwplink-inactive-el');\r\n\t\t}\r\n\t}\r\n\tgetUrlVarIdsFromUrl(url, excludeSysVars = true) {\r\n\t\tconst regex = /\\{([^}]+)\\}/g;\r\n\t\tconst matches = [];\r\n\t\tlet match = regex.exec(url);\r\n\t\twhile (match != null) {\r\n\t\t\tmatches.push(match[1]);\r\n\t\t\tmatch = regex.exec(url);\r\n\t\t}\r\n\t\tlet vars = matches.filter((value, index, self) => self.indexOf(value) === index);\r\n\t\tif (excludeSysVars && this.sysUrlVars) {\r\n\t\t\tvars = vars.filter((value) => !Object.keys(this.sysUrlVars).includes(value));\r\n\t\t}\r\n\t\treturn vars;\r\n\t}\r\n\tonUrlVarClick = (event) => {\r\n\t\tlet varId = '';\r\n\t\tif (event.target && event.target.tagName.toLowerCase() === 'span') {\r\n\t\t\tvarId = $(event.target).text();\r\n\t\t} else {\r\n\t\t\tvarId = $(event.target).find('span').text();\r\n\t\t}\r\n\t\tif (varId) {\r\n\t\t\tconst currentVal = this.inputs.url.val();\r\n\t\t\tlet insertAt = -1;\r\n\t\t\tfor (let i = currentVal.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (currentVal.charAt(i) === '}') break;\r\n\t\t\t\telse if (currentVal.charAt(i) === '{') {\r\n\t\t\t\t\tinsertAt = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (insertAt >= 0) {\r\n\t\t\t\tthis.inputs.url.val(currentVal.slice(0, insertAt) + varId);\r\n\t\t\t} else this.inputs.url.val(currentVal + varId);\r\n\t\t\tthis.inputs.url.focus();\r\n\t\t}\r\n\t\t// console.log(varId);\r\n\t};\r\n\trenderUrlVarItems(url, isFirstStep) {\r\n\t\tlet urlVars = this.urlVars ? Object.keys(this.urlVars) : [];\r\n\t\tif (isFirstStep) {\r\n\t\t\turlVars = this.getUrlVarIdsFromUrl(url) || [];\r\n\t\t\t$('#dpwplink-url-vars-hint-next-steps').hide();\r\n\t\t\tif (!urlVars.length) { $('#dpwplink-url-vars-hint-1st-step').show(); $('#dpwplink-url-vars-hint-1st-step-fill').hide(); }\r\n\t\t\telse { $('#dpwplink-url-vars-hint-1st-step').hide(); $('#dpwplink-url-vars-hint-1st-step-fill').show(); }\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$('#dpwplink-url-vars-hint-1st-step').hide();\r\n\t\t\t$('#dpwplink-url-vars-hint-1st-step-fill').hide();\r\n\t\t\tif (!urlVars.length) $('#dpwplink-url-vars-hint-next-steps').show();\r\n\t\t\telse $('#dpwplink-url-vars-hint-next-steps').hide();\r\n\t\t}\r\n\t\tlet sysUrlVarsLength = 0;\r\n\t\tif (this.sysUrlVars) {\r\n\t\t\tObject.keys(this.sysUrlVars).forEach((id) => {\r\n\t\t\t\turlVars.unshift(id);\r\n\t\t\t\tsysUrlVarsLength++;\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (urlVars) {\r\n\t\t\t$('.dpwplink-url-vars__item--id-only').off('click', this.onUrlVarClick);\r\n\t\t\turlVars.forEach((varId, idx) => {\r\n\t\t\t\tconst isSystemVar = idx < sysUrlVarsLength;\r\n\t\t\t\tconst idAndVal = isFirstStep && !isSystemVar;\r\n\t\t\t\tconst jUrlVarItem = $(`.dpwplink-url-vars__item[data-idx=\"${idx}\"]`);\r\n\t\t\t\tif (!jUrlVarItem.length) {\r\n\t\t\t\t\t$(isSystemVar ? '#dpwplink-sys-url-vars' : '#dpwplink-url-vars').append(this.getUrlVarExampleHtml(idx, varId, isFirstStep, isSystemVar));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjUrlVarItem.find('span').text(`{${varId}}`);\r\n\t\t\t\t\tjUrlVarItem.attr('data-var-id', varId);\r\n\t\t\t\t\tjUrlVarItem.removeClass('dpwplink-url-vars__item--inactive').show();\r\n\t\t\t\t\tif (idAndVal) jUrlVarItem.removeClass('dpwplink-url-vars__item--id-only');\r\n\t\t\t\t\telse jUrlVarItem.addClass('dpwplink-url-vars__item--id-only');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$('.dpwplink-url-vars__item--id-only').on('click', this.onUrlVarClick);\r\n\t\t\tlet idx = urlVars.length;\r\n\t\t\tdo {\r\n\t\t\t\tvar jNextItem = $(`.dpwplink-url-vars__item[data-idx=\"${idx}\"]`);\r\n\t\t\t\tjNextItem.addClass('dpwplink-url-vars__item--inactive').hide();\r\n\t\t\t\tidx++;\r\n\t\t\t}\r\n\t\t\twhile (jNextItem.length);\r\n\t\t}\r\n\t}\r\n\tgetUrlExamples() {\r\n\t\tif (!this.isFirstStep) return null;\r\n\t\tif (!this.enableUrlVarExamples) return this.nonActiveUrlVarExamples;\r\n\r\n\t\tconst getCustomVariables = this.isVariableUrl(this.inputs.url.val(), true) && this.enableUrlVarExamples;\r\n\r\n\t\tif (getCustomVariables) {\r\n\t\t\tconst res = {};\r\n\t\t\t$('.dpwplink-url-vars__item:not(.dpwplink-url-vars__item--inactive)').each((idx, element) => {\r\n\t\t\t\tconst id = $(element).data('var-id');\r\n\t\t\t\tif (id) {\r\n\t\t\t\t\tif ($(element).hasClass('dpwplink-url-vars__item--system') && this.sysUrlVars) res[id] = this.sysUrlVars[id];\r\n\t\t\t\t\telse if (getCustomVariables) res[id] = $(element).find('input').val();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\telse return this.sysUrlVars;\r\n\r\n\t}\r\n\tsetUrlExamples(urlExamples) {\r\n\t\tif (!this.enableUrlVarExamples || !this.isFirstStep) return null;\r\n\t\tif (!urlExamples) urlExamples = {};\r\n\t\tObject.keys(urlExamples).forEach((varId) => {\r\n\t\t\t$(`.dpwplink-url-vars__item[data-var-id=\"${varId}\"]`).find('input').val(urlExamples[varId]);\r\n\t\t});\r\n\t}\r\n\tgetUrlVarExampleHtml(idx, name, isFirstStep, isSystem = false) {\r\n\t\tconst itemClass = classNames({\r\n\t\t\t'dpwplink-url-vars__item': true,\r\n\t\t\t'dpwplink-url-vars__item--id-only': !isFirstStep || isSystem,\r\n\t\t\t'dpwplink-url-vars__item--system': isSystem,\r\n\t\t});\r\n\t\treturn `<li class=\"${itemClass}\" data-idx=\"${idx}\" data-var-id=\"${name}\"><span>{${name}}</span><input></li>`;\r\n\t}\r\n\tupdateAfterUrlChanged(isOnTypingEvent = false) {\r\n\t\tthis.updateSubmitButton();\r\n\t\tthis.updateVariableUrlsGUI(isOnTypingEvent);\r\n\t}\r\n\tisVariableUrl(url, beginIsEnough = false) {\r\n\t\tif (!url) return false;\r\n\t\tconst start = url.indexOf('{');\r\n\t\tif (beginIsEnough && start >= 0) return true;\r\n\t\tconst stop = url.indexOf('}');\r\n\t\treturn start >= 0 && stop > start;\r\n\t}\r\n\tisVariableTypingInProcess(url) {\r\n\r\n\t\tif (!url) return false;\r\n\t\tconst start = url.lastIndexOf('{');\r\n\t\tconst stop = url.lastIndexOf('}');\r\n\t\treturn start >= 0 && start > stop;\r\n\t}\r\n\tcancelVariableTypingInProcess() {\r\n\t\tconst url = this.inputs.url.val();\r\n\t\tif (this.isVariableTypingInProcess(url)) {\r\n\t\t\tconst lastOpen = url.lastIndexOf('{');\r\n\t\t\tif (lastOpen >= 0) {\r\n\t\t\t\tthis.inputs.url.val(url.substring(0, lastOpen));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateFields(e, li) {\r\n\t\tif (li.length) {\r\n\t\t\tconst url = li.children('.item-permalink').val();\r\n\t\t\tthis.inputs.url.val(this.sanitizeUrl(url, true));\r\n\t\t\tthis.updateAfterUrlChanged();\r\n\t\t\tif (this.inputs.wrap.hasClass('has-text-field') && !this.inputs.text.val()) {\r\n\t\t\t\tthis.inputs.text.val($(li[0]).children('.item-title').text());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetDefaultValues() {\r\n\t\tthis.inputs.url.val('');\r\n\t\tthis.updateAfterUrlChanged();\r\n\t\t// Empty the search field and swap the \"rivers\".\r\n\t\tthis.inputs.search.val('');\r\n\t\tthis.searchInternalLinks();\r\n\r\n\t\t// Update save prompt.\r\n\t\tthis.inputs.submit.val(this.config.save);\r\n\t}\r\n\r\n\tsearchInternalLinks() {\r\n\t\tlet waiting;\r\n\t\tconst search = this.inputs.search.val() || '';\r\n\t\tconst minInputLength = parseInt(this.config.minInputLength, 10) || 3;\r\n\r\n\t\tif (search.length >= minInputLength) {\r\n\t\t\tthis.rivers.recent.hide();\r\n\t\t\tthis.rivers.search.show();\r\n\r\n\t\t\t// Don't search if the keypress didn't change the title.\r\n\t\t\tif (this.lastSearch == search) return;\r\n\r\n\t\t\tthis.lastSearch = search;\r\n\t\t\twaiting = this.inputs.search.parent().find('.spinner').addClass('is-active');\r\n\r\n\t\t\tthis.rivers.search.change(search);\r\n\t\t\tthis.rivers.search.ajax(() => {\r\n\t\t\t\twaiting.removeClass('is-active');\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.rivers.search.hide();\r\n\t\t\tthis.rivers.recent.show();\r\n\t\t}\r\n\t}\r\n\r\n\tnext = () => {\r\n\r\n\t\tthis.rivers.search.next();\r\n\t\tthis.rivers.recent.next();\r\n\t};\r\n\r\n\tprev = () => {\r\n\t\tthis.rivers.search.prev();\r\n\t\tthis.rivers.recent.prev();\r\n\t};\r\n\r\n\tkeydown(event) {\r\n\t\tif (this.modalOpen) {\r\n\t\t\t// Escape key.\r\n\t\t\tif (event.keyCode === 27) {\r\n\t\t\t\t$('#dpit-wp-link-cancel').trigger('click');\r\n\t\t\t\t//this.close();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\t// Tab key.\r\n\t\t\t} else if (event.keyCode === 9) {\r\n\t\t\t\tconst id = event.target.id;\r\n\r\n\t\t\t\t// dp_wp-link-submit must always be the last focusable element in the dialog.\r\n\t\t\t\t// Following focusable elements will be skipped on keyboard navigation.\r\n\t\t\t\tif (id === 'dp_wp-link-submit' && !event.shiftKey) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t} else if (id === 'dpit-wp-link-cancel' && event.shiftKey) {\r\n\t\t\t\t\tthis.inputs.submit.focus();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Up Arrow and Down Arrow keys.\r\n\t\t\tif (event.shiftKey || (event.keyCode !== 38 && event.keyCode !== 40)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (document.activeElement\r\n\t\t\t\t&& (document.activeElement.id === 'link-title-field' || document.activeElement.id === 'url-field')) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Up Arrow key.\r\n\t\t\tconst fn = event.keyCode === 38 ? 'prev' : 'next';\r\n\t\t\tclearInterval(this.keyInterval);\r\n\t\t\tthis[fn]();\r\n\t\t\tthis.keyInterval = setInterval(this[fn], this.keySensitivity);\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tkeyup(event) {\r\n\t\t// Up Arrow and Down Arrow keys.\r\n\t\tif (event.keyCode === 38 || event.keyCode === 40) {\r\n\t\t\tclearInterval(this.keyInterval);\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t}\r\n}"],"sourceRoot":""}